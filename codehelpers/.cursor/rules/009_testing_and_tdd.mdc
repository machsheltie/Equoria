---
description: Defines rules and structure for Test-Driven Development (TDD), unit testing, and integration testing across Equoriaâ€™s full-stack codebase.
globs: ["test/**/*", "backend/**/*.test.js", "frontend/**/*.test.js", "**/*.test.js"]
alwaysApply: true
---

## ðŸ§ª Test-Driven Development (TDD) in Equoria

Equoria follows a TDD-first approach for all features, gameplay logic, and UI modules. Cursor must:

- Encourage tests to be written **before** implementing major logic
- Update this file as new test types or tools are added
- Reference tests when generating new routes, utilities, or components

---

## ðŸ› ï¸ Tools and Frameworks

- **Jest**: Used for all backend and frontend unit tests
- **React Native Testing Library (RNTL)**: Used for UI testing of mobile screens and interactions
- **Supertest**: Used for integration testing of Express.js APIs
- **pgtest / testcontainers**: May be used to test PostgreSQL behavior via a temporary test DB

---

## ðŸ“ Folder and File Structure

```
test/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ genetics/
â”‚   â””â”€â”€ auth/
â”œâ”€â”€ integration/
â”‚   â”œâ”€â”€ breeding.test.js
â”‚   â””â”€â”€ riderSynergy.test.js
â””â”€â”€ ui/
    â””â”€â”€ HorseProfileScreen.test.js
```

- Name files with `.test.js` suffix
- Group tests by type: unit, integration, ui
- Each test file should be colocated with the module it tests or mirrored in structure

---

## ðŸ§© Testing Rules by Type

### ðŸ§ª Unit Tests
- One function per test block
- Ensure 100% code coverage for utilities, breeding logic, and phenotype engine
- Avoid external API or DB calls â€” use mocks or fakes

### ðŸ”— Integration Tests
- Test API endpoints and their behavior
- Use a dedicated `.env.test` environment with isolated test DB (PostgreSQL)
- Include setup and teardown hooks to reset DB state before/after each test

### ðŸŽ¨ UI Tests (React Native)
- Test rendering, button actions, visual state changes
- Use `getByText`, `getByTestId`, `fireEvent` from RNTL
- Avoid testing visual style â€” focus on user behavior

---

## ðŸ§  Cursor Directives for TDD

- Prompt user to generate test file **first** before implementation
- When writing a function or route, automatically suggest test cases
- Refactor tests if code changes break them
- Link implementation files to tests with clear comments

**Example:**
```js
// tests/unit/genetics/phenotype.test.js
describe('determinePhenotype', () => {
  it('resolves correct shade from genotype', () => {
    const result = determinePhenotype({ ...mockGenotype });
    expect(result.shade).toBe('burnished');
  });
});
```

---

> Cursor must treat this file as a critical enforcement tool for ensuring code correctness, maintainability, and rapid iteration through test-driven workflows.
