## ENHANCED MILESTONE EVALUATION SYSTEM – IMPLEMENTATION PLAN

### 🔍 Overview
This module extends the existing milestone trait evaluation framework by integrating **groom care history**, **bond consistency**, and **task diversity** into trait determination logic for foals under 3 years of age. The goal is to create a more realistic, data-informed foundation for epigenetic trait expression.

This system tracks and rewards consistent, appropriate, and responsive care patterns during specific developmental windows and adjusts milestone trait outcomes accordingly.

---

### 📒 Key Concepts

#### ⌚ Developmental Windows
- Foals age 0–3 undergo multiple milestone evaluations:
  - Imprinting (Day 1)
  - Socialization (Week 1)
  - Curiosity & Play (Week 2)
  - Trust & Handling (Week 3)
  - Confidence vs. Reactivity (Week 4)
- Each milestone is evaluated independently but draws from cumulative care data.

#### 🤝 Groom Assignment & History
- A groom must be assigned to the foal for at least 2 full days during a milestone window for that milestone to be influenced.
- Each milestone pulls the following variables:
  - `groom_id`
  - `bond_score` (average over milestone window)
  - `groom_task_log[]` (tasks completed within milestone period)
  - `task_quality_score[]` (performance/engagement multiplier)

---

### ⚖️ Trait Evaluation Logic
Each milestone has one or more potential trait outcomes.

**New Scoring Breakdown:**
- Base Score: determined by milestone system (default behavior)
- Bond Modifier: ±1–2 based on average bond value
- Task Consistency Modifier:
  - +1 if ≥3 relevant tasks were completed in window
  - +1 if tasks were diverse (≥2 task types)
  - +1 if task quality average > 0.8
- Care Gaps Penalty:
  - −1 if no tasks completed
  - −2 if bond < 20 during window

Trait is confirmed if `score >= 3`, denied if `<= -3`, otherwise randomized within candidate pool.

---

### 📈 Database Schema Requirements
- `milestone_trait_log` table:
  - `id`, `horse_id`, `milestone_type`, `score`, `final_trait`, `timestamp`, `groom_id`
- Extend `groom_task_log` to include:
  - `task_type`, `quality_score`, `duration`, `milestone_window_id`

---

### 🚧 API Requirements
- New Milestone Evaluation Endpoint:
  - `POST /traits/evaluate-milestone`
  - Accepts: `horse_id`, `milestone_type`, `groom_id`, `bond_score`, `task_log[]`
  - Returns: `final_trait`, `modifiers_applied`, `reasoning`

---

### 💡 Implicit Implementation Rules
- If no groom is assigned → milestone is evaluated **without modifiers**
- If groom assigned < 48h → ignore groom impact
- Tasks must match milestone relevance (e.g., “leading” applies to Trust milestone)
- Bond score must be calculated using only **window-specific daily averages**

---

### 🚀 Sample Milestone Logic: Trust & Handling (Week 3)
**Positive traits:** trusting, curious, calm
**Negative traits:** hesitant, reactive, wary

Conditions:
- >3 care tasks including “touch desensitization” or “leading practice” → +1
- Bond average > 60 → +1
- No missed care days → +1
- Bond < 20 → −1
- Missed 2+ days → −2

Final score: 3 = gain `trusting`, -3 = gain `hesitant`, otherwise randomized between `calm`, `wary`, or no trait

---

### 🌐 Future Improvements
- Milestone streak bonuses (perfect care week = bonus trait)
- Foal personality seed influences milestone options
- Advanced task-based trait shaping UI (graphical feedback)

---

### ✨ END OF MODULE
