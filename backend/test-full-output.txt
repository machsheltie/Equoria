
> equoria-backend@1.0.0 test
> node --experimental-vm-modules node_modules/jest/bin/jest.js --verbose

[2025-12-27 23:17:55] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:17:55] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:17:55] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:17:57] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:17:57] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:17:57] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:17:57] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:17:57] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:17:57] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
(node:41752) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
[2025-12-27 23:17:58] info: [POST] /api/auth/register
[2025-12-27 23:17:58] info: [TokenRotation] Created new token pair
[2025-12-27 23:17:58] info: [EmailVerification] Created verification token
[2025-12-27 23:17:58] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: progress-test@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=248edab05d42ccabe1ee7dd94b0ee54104c45b6744b7fe8fd39aca3474bb20d2

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:17:58] info: [authController.register] Verification email sent
[2025-12-27 23:17:58] info: [POST] /api/auth/register - 201
[2025-12-27 23:17:58] info: [POST] /api/auth/login
[2025-12-27 23:17:59] info: [TokenRotation] Created new token pair
[2025-12-27 23:17:59] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:17:59] info: [POST] /api/auth/login - 200
[2025-12-27 23:17:59] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:17:59] info: [userRoutes] Self-access validated: user 177ee872-c44d-4b4a-a5b9-c5241b7d886e accessing own data
[2025-12-27 23:17:59] info: [userController.getUserProgressAPI] Getting comprehensive progress for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [userController.getUserProgressAPI] Successfully retrieved progress for user progresstest (Level 1, XP: 0/200, 0% progress)
[2025-12-27 23:17:59] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress - 200
[2025-12-27 23:17:59] info: [POST] /api/training/train
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for POST /training/train
[2025-12-27 23:17:59] info: [ownership] Found owned horse 94123 for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [trainingController.trainRouteHandler] Training request for horse 94123 in Racing
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Attempting to train horse 94123 in Racing
[2025-12-27 23:17:59] info: [trainingController.canTrain] Checking training eligibility for horse 94123 in Racing
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Getting age for horse 94123
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Horse 94123 is 6 years old
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94123
[2025-12-27 23:17:59] info: [trainingController.canTrain] Horse 94123 is eligible to train in Racing
[2025-12-27 23:17:59] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94123)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Horse 94123 has traits: 
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94123 in Racing
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4796
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Incrementing Racing score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Updating Racing score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Successfully updated Racing score for horse 94123: 0 -> 5
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Racing score for horse 94123
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Logging XP event: User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5, Reason: Trained horse Progress Test Horse in Racing
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2322, User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Awarded 5 XP to user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for training
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Successfully trained horse 94123 in Racing (Log ID: 4796, Score +5)
[2025-12-27 23:17:59] info: [POST] /api/training/train - 200
[2025-12-27 23:17:59] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:17:59] info: [userRoutes] Self-access validated: user 177ee872-c44d-4b4a-a5b9-c5241b7d886e accessing own data
[2025-12-27 23:17:59] info: [userController.getUserProgressAPI] Getting comprehensive progress for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [userController.getUserProgressAPI] Successfully retrieved progress for user progresstest (Level 1, XP: 5/200, 3% progress)
[2025-12-27 23:17:59] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress - 200
[2025-12-27 23:17:59] info: [POST] /api/training/train
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for POST /training/train
[2025-12-27 23:17:59] info: [ownership] Found owned horse 94123 for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [trainingController.trainRouteHandler] Training request for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Attempting to train horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingController.canTrain] Checking training eligibility for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Getting age for horse 94123
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Horse 94123 is 6 years old
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94123: Fri Dec 19 2025 23:17:59 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:17:59] info: [trainingController.canTrain] Horse 94123 is eligible to train in Dressage
[2025-12-27 23:17:59] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94123)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Horse 94123 has traits: 
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4797
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Incrementing Dressage score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Updating Dressage score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Successfully updated Dressage score for horse 94123: 0 -> 5
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Dressage score for horse 94123
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Logging XP event: User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5, Reason: Trained horse Progress Test Horse in Dressage
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2323, User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Awarded 5 XP to user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for training
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Successfully trained horse 94123 in Dressage (Log ID: 4797, Score +5)
[2025-12-27 23:17:59] info: [POST] /api/training/train - 200
[2025-12-27 23:17:59] info: [POST] /api/training/train
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for POST /training/train
[2025-12-27 23:17:59] info: [ownership] Found owned horse 94123 for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [trainingController.trainRouteHandler] Training request for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Attempting to train horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingController.canTrain] Checking training eligibility for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Getting age for horse 94123
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Horse 94123 is 6 years old
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94123: Fri Dec 19 2025 23:17:59 GMT-0500 (Eastern Standard Time) (discipline: Dressage)
[2025-12-27 23:17:59] info: [trainingController.canTrain] Horse 94123 is eligible to train in Show Jumping
[2025-12-27 23:17:59] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94123)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Horse 94123 has traits: 
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4798
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Incrementing Show Jumping score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Updating Show Jumping score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Successfully updated Show Jumping score for horse 94123: 0 -> 5
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Show Jumping score for horse 94123
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Logging XP event: User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5, Reason: Trained horse Progress Test Horse in Show Jumping
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2324, User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Awarded 5 XP to user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for training
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Successfully trained horse 94123 in Show Jumping (Log ID: 4798, Score +5)
[2025-12-27 23:17:59] info: [POST] /api/training/train - 200
[2025-12-27 23:17:59] info: [POST] /api/training/train
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for POST /training/train
[2025-12-27 23:17:59] info: [ownership] Found owned horse 94123 for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [trainingController.trainRouteHandler] Training request for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Attempting to train horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingController.canTrain] Checking training eligibility for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Getting age for horse 94123
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Horse 94123 is 6 years old
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94123: Fri Dec 19 2025 23:17:59 GMT-0500 (Eastern Standard Time) (discipline: Show Jumping)
[2025-12-27 23:17:59] info: [trainingController.canTrain] Horse 94123 is eligible to train in Dressage
[2025-12-27 23:17:59] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94123)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Horse 94123 has traits: 
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4799
[2025-12-27 23:17:59] info: [horseModel.updateHorseStat] Updating obedience by 1 for horse 94123
[2025-12-27 23:17:59] info: [horseModel.updateHorseStat] Updated obedience for horse 94123: 0 -> 1 (+1)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Stat gain: obedience +1
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Incrementing Dressage score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Updating Dressage score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Successfully updated Dressage score for horse 94123: 5 -> 10
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Dressage score for horse 94123
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Logging XP event: User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5, Reason: Trained horse Progress Test Horse in Dressage
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2325, User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Awarded 5 XP to user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for training
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Successfully trained horse 94123 in Dressage (Log ID: 4799, Score +5)
[2025-12-27 23:17:59] info: [POST] /api/training/train - 200
[2025-12-27 23:17:59] info: [POST] /api/training/train
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for POST /training/train
[2025-12-27 23:17:59] info: [ownership] Found owned horse 94123 for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [trainingController.trainRouteHandler] Training request for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Attempting to train horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingController.canTrain] Checking training eligibility for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Getting age for horse 94123
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Horse 94123 is 6 years old
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94123: Fri Dec 19 2025 23:17:59 GMT-0500 (Eastern Standard Time) (discipline: Dressage)
[2025-12-27 23:17:59] info: [trainingController.canTrain] Horse 94123 is eligible to train in Show Jumping
[2025-12-27 23:17:59] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94123)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Horse 94123 has traits: 
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4800
[2025-12-27 23:17:59] info: [horseModel.updateHorseStat] Updating precision by 2 for horse 94123
[2025-12-27 23:17:59] info: [horseModel.updateHorseStat] Updated precision for horse 94123: 0 -> 2 (+2)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Stat gain: precision +2
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Incrementing Show Jumping score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Updating Show Jumping score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Successfully updated Show Jumping score for horse 94123: 5 -> 10
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Show Jumping score for horse 94123
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Logging XP event: User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5, Reason: Trained horse Progress Test Horse in Show Jumping
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2326, User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Awarded 5 XP to user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for training
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Successfully trained horse 94123 in Show Jumping (Log ID: 4800, Score +5)
[2025-12-27 23:17:59] info: [POST] /api/training/train - 200
[2025-12-27 23:17:59] info: [POST] /api/training/train
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for POST /training/train
[2025-12-27 23:17:59] info: [ownership] Found owned horse 94123 for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [trainingController.trainRouteHandler] Training request for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Attempting to train horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingController.canTrain] Checking training eligibility for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Getting age for horse 94123
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Horse 94123 is 6 years old
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94123: Fri Dec 19 2025 23:17:59 GMT-0500 (Eastern Standard Time) (discipline: Show Jumping)
[2025-12-27 23:17:59] info: [trainingController.canTrain] Horse 94123 is eligible to train in Dressage
[2025-12-27 23:17:59] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94123)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Horse 94123 has traits: 
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4801
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Incrementing Dressage score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Updating Dressage score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Successfully updated Dressage score for horse 94123: 10 -> 15
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Dressage score for horse 94123
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Logging XP event: User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5, Reason: Trained horse Progress Test Horse in Dressage
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2327, User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Awarded 5 XP to user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for training
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Successfully trained horse 94123 in Dressage (Log ID: 4801, Score +5)
[2025-12-27 23:17:59] info: [POST] /api/training/train - 200
[2025-12-27 23:17:59] info: [POST] /api/training/train
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for POST /training/train
[2025-12-27 23:17:59] info: [ownership] Found owned horse 94123 for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [trainingController.trainRouteHandler] Training request for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Attempting to train horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingController.canTrain] Checking training eligibility for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Getting age for horse 94123
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Horse 94123 is 6 years old
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94123: Fri Dec 19 2025 23:17:59 GMT-0500 (Eastern Standard Time) (discipline: Dressage)
[2025-12-27 23:17:59] info: [trainingController.canTrain] Horse 94123 is eligible to train in Show Jumping
[2025-12-27 23:17:59] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94123)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Horse 94123 has traits: 
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4802
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Incrementing Show Jumping score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Updating Show Jumping score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Successfully updated Show Jumping score for horse 94123: 10 -> 15
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Show Jumping score for horse 94123
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Logging XP event: User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5, Reason: Trained horse Progress Test Horse in Show Jumping
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2328, User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Awarded 5 XP to user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for training
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Successfully trained horse 94123 in Show Jumping (Log ID: 4802, Score +5)
[2025-12-27 23:17:59] info: [POST] /api/training/train - 200
[2025-12-27 23:17:59] info: [POST] /api/training/train
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for POST /training/train
[2025-12-27 23:17:59] info: [ownership] Found owned horse 94123 for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [trainingController.trainRouteHandler] Training request for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Attempting to train horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingController.canTrain] Checking training eligibility for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Getting age for horse 94123
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Horse 94123 is 6 years old
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94123: Fri Dec 19 2025 23:17:59 GMT-0500 (Eastern Standard Time) (discipline: Show Jumping)
[2025-12-27 23:17:59] info: [trainingController.canTrain] Horse 94123 is eligible to train in Dressage
[2025-12-27 23:17:59] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94123)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Horse 94123 has traits: 
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4803
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Incrementing Dressage score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Updating Dressage score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Successfully updated Dressage score for horse 94123: 15 -> 20
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Dressage score for horse 94123
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Logging XP event: User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5, Reason: Trained horse Progress Test Horse in Dressage
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2329, User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Awarded 5 XP to user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for training
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Successfully trained horse 94123 in Dressage (Log ID: 4803, Score +5)
[2025-12-27 23:17:59] info: [POST] /api/training/train - 200
[2025-12-27 23:17:59] info: [POST] /api/training/train
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for POST /training/train
[2025-12-27 23:17:59] info: [ownership] Found owned horse 94123 for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [trainingController.trainRouteHandler] Training request for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Attempting to train horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingController.canTrain] Checking training eligibility for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Getting age for horse 94123
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Horse 94123 is 6 years old
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94123: Fri Dec 19 2025 23:17:59 GMT-0500 (Eastern Standard Time) (discipline: Dressage)
[2025-12-27 23:17:59] info: [trainingController.canTrain] Horse 94123 is eligible to train in Show Jumping
[2025-12-27 23:17:59] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94123)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Horse 94123 has traits: 
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4804
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Incrementing Show Jumping score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Updating Show Jumping score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Successfully updated Show Jumping score for horse 94123: 15 -> 20
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Show Jumping score for horse 94123
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Logging XP event: User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5, Reason: Trained horse Progress Test Horse in Show Jumping
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2330, User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Awarded 5 XP to user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for training
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Successfully trained horse 94123 in Show Jumping (Log ID: 4804, Score +5)
[2025-12-27 23:17:59] info: [POST] /api/training/train - 200
[2025-12-27 23:17:59] info: [POST] /api/training/train
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for POST /training/train
[2025-12-27 23:17:59] info: [ownership] Found owned horse 94123 for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [trainingController.trainRouteHandler] Training request for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Attempting to train horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingController.canTrain] Checking training eligibility for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Getting age for horse 94123
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Horse 94123 is 6 years old
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94123: Fri Dec 19 2025 23:17:59 GMT-0500 (Eastern Standard Time) (discipline: Show Jumping)
[2025-12-27 23:17:59] info: [trainingController.canTrain] Horse 94123 is eligible to train in Dressage
[2025-12-27 23:17:59] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94123)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Horse 94123 has traits: 
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94123 in Dressage
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4805
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Incrementing Dressage score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Updating Dressage score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Successfully updated Dressage score for horse 94123: 20 -> 25
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Dressage score for horse 94123
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Logging XP event: User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5, Reason: Trained horse Progress Test Horse in Dressage
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2331, User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Awarded 5 XP to user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for training
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Successfully trained horse 94123 in Dressage (Log ID: 4805, Score +5)
[2025-12-27 23:17:59] info: [POST] /api/training/train - 200
[2025-12-27 23:17:59] info: [POST] /api/training/train
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for POST /training/train
[2025-12-27 23:17:59] info: [ownership] Found owned horse 94123 for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [trainingController.trainRouteHandler] Training request for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Attempting to train horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingController.canTrain] Checking training eligibility for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Getting age for horse 94123
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Horse 94123 is 6 years old
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94123: Fri Dec 19 2025 23:17:59 GMT-0500 (Eastern Standard Time) (discipline: Dressage)
[2025-12-27 23:17:59] info: [trainingController.canTrain] Horse 94123 is eligible to train in Show Jumping
[2025-12-27 23:17:59] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94123)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Horse 94123 has traits: 
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94123 in Show Jumping
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4806
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Incrementing Show Jumping score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Updating Show Jumping score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Successfully updated Show Jumping score for horse 94123: 20 -> 25
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Show Jumping score for horse 94123
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Logging XP event: User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5, Reason: Trained horse Progress Test Horse in Show Jumping
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2332, User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Awarded 5 XP to user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for training
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Successfully trained horse 94123 in Show Jumping (Log ID: 4806, Score +5)
[2025-12-27 23:17:59] info: [POST] /api/training/train - 200
[2025-12-27 23:17:59] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:17:59] info: [userRoutes] Self-access validated: user 177ee872-c44d-4b4a-a5b9-c5241b7d886e accessing own data
[2025-12-27 23:17:59] info: [userController.getUserProgressAPI] Getting comprehensive progress for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [userController.getUserProgressAPI] Successfully retrieved progress for user progresstest (Level 1, XP: 55/200, 28% progress)
[2025-12-27 23:17:59] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress - 200
[2025-12-27 23:17:59] info: [POST] /api/training/train
[2025-12-27 23:17:59] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for POST /training/train
[2025-12-27 23:17:59] info: [ownership] Found owned horse 94123 for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:17:59] info: [trainingController.trainRouteHandler] Training request for horse 94123 in Cross Country
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Attempting to train horse 94123 in Cross Country
[2025-12-27 23:17:59] info: [trainingController.canTrain] Checking training eligibility for horse 94123 in Cross Country
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Getting age for horse 94123
[2025-12-27 23:17:59] info: [trainingModel.getHorseAge] Horse 94123 is 6 years old
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:17:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94123: Fri Dec 19 2025 23:17:59 GMT-0500 (Eastern Standard Time) (discipline: Show Jumping)
[2025-12-27 23:17:59] info: [trainingController.canTrain] Horse 94123 is eligible to train in Cross Country
[2025-12-27 23:17:59] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94123)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Horse 94123 has traits: 
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94123 in Cross Country
[2025-12-27 23:17:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4807
[2025-12-27 23:17:59] info: [horseModel.updateHorseStat] Updating endurance by 1 for horse 94123
[2025-12-27 23:17:59] info: [horseModel.updateHorseStat] Updated endurance for horse 94123: 0 -> 1 (+1)
[2025-12-27 23:17:59] info: [trainingController.trainHorse] Stat gain: endurance +1
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Incrementing Cross Country score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Updating Cross Country score for horse 94123 by +5
[2025-12-27 23:17:59] info: [horseModel.updateDisciplineScore] Successfully updated Cross Country score for horse 94123: 0 -> 5
[2025-12-27 23:17:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Cross Country score for horse 94123
[2025-12-27 23:17:59] info: [xpLogModel.logXpEvent] Logging XP event: User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5, Reason: Trained horse Progress Test Horse in Cross Country
[2025-12-27 23:18:00] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2333, User 177ee872-c44d-4b4a-a5b9-c5241b7d886e, Amount: 5
[2025-12-27 23:18:00] info: [trainingController.trainHorse] Awarded 5 XP to user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for training - LEVEL UP to undefined!
[2025-12-27 23:18:00] info: [trainingController.trainHorse] Successfully trained horse 94123 in Cross Country (Log ID: 4807, Score +5)
[2025-12-27 23:18:00] info: [POST] /api/training/train - 200
[2025-12-27 23:18:00] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:18:00] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:18:00] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:18:00] info: [userRoutes] Self-access validated: user 177ee872-c44d-4b4a-a5b9-c5241b7d886e accessing own data
[2025-12-27 23:18:00] info: [userController.getUserProgressAPI] Getting comprehensive progress for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:18:00] info: [userController.getUserProgressAPI] Successfully retrieved progress for user progresstest (Level 2, XP: 200/300, 0% progress)
[2025-12-27 23:18:00] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress - 200
[2025-12-27 23:18:00] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:18:00] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:18:00] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:18:00] info: [userRoutes] Self-access validated: user 177ee872-c44d-4b4a-a5b9-c5241b7d886e accessing own data
[2025-12-27 23:18:00] info: [userController.getUserProgressAPI] Getting comprehensive progress for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:18:00] info: [userController.getUserProgressAPI] Successfully retrieved progress for user progresstest (Level 3, XP: 350/400, 50% progress)
[2025-12-27 23:18:00] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress - 200
[2025-12-27 23:18:00] info: [GET] /api/users/dashboard/177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:18:00] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /users/dashboard/177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:18:00] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /dashboard/177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:18:00] info: [userRoutes] Self-access validated: user 177ee872-c44d-4b4a-a5b9-c5241b7d886e accessing own data
[2025-12-27 23:18:00] info: [trainingController.getTrainableHorses] Getting trainable horses for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:18:00] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94123 across all disciplines
[2025-12-27 23:18:00] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94123: Sat Dec 27 2025 23:17:59 GMT-0500 (Eastern Standard Time) (discipline: Cross Country)
[2025-12-27 23:18:00] info: [trainingController.getTrainableHorses] Found 0 trainable horses for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:18:00] info: [userController.getDashboardData] Successfully retrieved dashboard data for user progresstest (1 horses, 0 trainable)
[2025-12-27 23:18:00] info: [GET] /api/users/dashboard/177ee872-c44d-4b4a-a5b9-c5241b7d886e - 200
[2025-12-27 23:18:00] info: [GET] /api/users/999999/progress
[2025-12-27 23:18:00] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /users/999999/progress
[2025-12-27 23:18:00] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /999999/progress
[2025-12-27 23:18:00] warn: [userRoutes] Validation errors for /:id: [{"type":"field","value":"999999","msg":"User ID must be a valid UUID","path":"id","location":"params"}]
[2025-12-27 23:18:00] info: [GET] /api/users/999999/progress - 400
[2025-12-27 23:18:00] info: [GET] /api/users/invalid/progress
[2025-12-27 23:18:00] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /users/invalid/progress
[2025-12-27 23:18:00] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /invalid/progress
[2025-12-27 23:18:00] warn: [userRoutes] Validation errors for /:id: [{"type":"field","value":"invalid","msg":"User ID must be a valid UUID","path":"id","location":"params"}]
[2025-12-27 23:18:00] info: [GET] /api/users/invalid/progress - 400
[2025-12-27 23:18:00] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:18:00] warn: [auth] Access token is required for GET /users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress from ::ffff:127.0.0.1
[2025-12-27 23:18:00] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress - 401
[2025-12-27 23:18:00] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:18:00] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:18:00] info: [auth] Authenticated user 177ee872-c44d-4b4a-a5b9-c5241b7d886e for GET /177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress
[2025-12-27 23:18:00] info: [userRoutes] Self-access validated: user 177ee872-c44d-4b4a-a5b9-c5241b7d886e accessing own data
[2025-12-27 23:18:00] info: [userController.getUserProgressAPI] Getting comprehensive progress for user 177ee872-c44d-4b4a-a5b9-c5241b7d886e
[2025-12-27 23:18:00] info: [userController.getUserProgressAPI] Successfully retrieved progress for user progresstest (Level 3, XP: 350/400, 50% progress)
[2025-12-27 23:18:00] info: [GET] /api/users/177ee872-c44d-4b4a-a5b9-c5241b7d886e/progress - 200
PASS tests/integration/userProgressAPI.integration.test.mjs
  üéØ INTEGRATION: User Progress API - Complete Progress Tracking
    üîê STEP 1: User Setup & Initial Progress State
      ‚àö should create user and establish initial progress state (831 ms)
      ‚àö should return correct initial progress data via API (39 ms)
    üêé STEP 2: Horse Creation for Training Integration
      ‚àö should create training-eligible horse (14 ms)
    üèãÔ∏è STEP 3: XP Gain Through Training & Progress Updates
      ‚àö should gain XP from training and update progress correctly (110 ms)
      ‚àö should handle multiple training sessions and XP accumulation (670 ms)
    üéØ STEP 4: Level-Up Detection & Multi-Level Progression
      ‚àö should level up when reaching XP threshold (97 ms)
      ‚àö should handle multiple level gains in single XP award (28 ms)
    üìä STEP 5: Dashboard Data Integration
      ‚àö should return comprehensive dashboard data with progress integration (49 ms)
    üîç STEP 6: API Consistency & Edge Cases
      ‚àö should handle invalid user ID gracefully (25 ms)
      ‚àö should validate user ID format (28 ms)
      ‚àö should require authentication for progress endpoints (24 ms)
    üéä STEP 7: End-to-End Progress Validation
      ‚àö should validate complete progress tracking integrity (33 ms)
      ‚àö should validate all business rules were enforced throughout progression (4 ms)

[2025-12-27 23:18:00] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:00] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:00] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:01] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:01] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:01] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:01] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:01] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:01] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:01] info: [GET] /api/grooms/46621/retirement/eligibility
[2025-12-27 23:18:01] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for GET /grooms/46621/retirement/eligibility
[2025-12-27 23:18:01] info: [ownership] Validated ownership: user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b owns groom 46621
[2025-12-27 23:18:01] info: [GET] /api/grooms/46621/retirement/eligibility - 200
[2025-12-27 23:18:01] info: [GET] /api/grooms/retirement/statistics
[2025-12-27 23:18:01] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for GET /grooms/retirement/statistics
[2025-12-27 23:18:01] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for GET /retirement/statistics
[2025-12-27 23:18:01] info: [GET] /api/grooms/retirement/statistics - 200
[2025-12-27 23:18:01] info: [GET] /api/grooms/retirement/approaching
[2025-12-27 23:18:01] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for GET /grooms/retirement/approaching
[2025-12-27 23:18:01] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for GET /retirement/approaching
[2025-12-27 23:18:01] info: [GET] /api/grooms/retirement/approaching - 200
[2025-12-27 23:18:01] info: [GET] /api/grooms/46628/legacy/eligibility
[2025-12-27 23:18:01] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for GET /grooms/46628/legacy/eligibility
[2025-12-27 23:18:01] info: [ownership] Validated ownership: user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b owns groom 46628
[2025-12-27 23:18:01] info: [GET] /api/grooms/46628/legacy/eligibility - 200
[2025-12-27 23:18:01] info: [GET] /api/grooms/legacy/history
[2025-12-27 23:18:01] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for GET /grooms/legacy/history
[2025-12-27 23:18:01] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for GET /legacy/history
[2025-12-27 23:18:01] info: [GET] /api/grooms/legacy/history - 200
[2025-12-27 23:18:01] info: [GET] /api/grooms/talents/definitions
[2025-12-27 23:18:01] info: [GET] /api/grooms/talents/definitions - 200
[2025-12-27 23:18:01] info: [GET] /api/grooms/46633/talents
[2025-12-27 23:18:01] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for GET /grooms/46633/talents
[2025-12-27 23:18:01] info: [ownership] Validated ownership: user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b owns groom 46633
[2025-12-27 23:18:01] info: [GET] /api/grooms/46633/talents - 200
[2025-12-27 23:18:01] info: [POST] /api/grooms/46635/talents/validate
[2025-12-27 23:18:01] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for POST /grooms/46635/talents/validate
[2025-12-27 23:18:01] info: [ownership] Validated ownership: user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b owns groom 46635
[2025-12-27 23:18:01] info: [POST] /api/grooms/46635/talents/validate - 200
[2025-12-27 23:18:01] info: [POST] /api/grooms/46637/talents/select
[2025-12-27 23:18:01] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for POST /grooms/46637/talents/select
[2025-12-27 23:18:01] info: [ownership] Validated ownership: user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b owns groom 46637
[2025-12-27 23:18:01] info: Groom 46637 selected talent gentle_hands for tier1
[2025-12-27 23:18:01] info: [POST] /api/grooms/46637/talents/select - 200
[2025-12-27 23:18:01] info: [GET] /api/grooms/46639/retirement/eligibility
[2025-12-27 23:18:01] warn: [auth] Access token is required for GET /grooms/46639/retirement/eligibility from ::ffff:127.0.0.1
[2025-12-27 23:18:01] info: [GET] /api/grooms/46639/retirement/eligibility - 401
[2025-12-27 23:18:01] info: [GET] /api/grooms/retirement/statistics
[2025-12-27 23:18:01] warn: [auth] Access token is required for GET /grooms/retirement/statistics from ::ffff:127.0.0.1
[2025-12-27 23:18:01] info: [GET] /api/grooms/retirement/statistics - 401
[2025-12-27 23:18:02] info: [GET] /api/grooms/46639/talents
[2025-12-27 23:18:02] warn: [auth] Access token is required for GET /grooms/46639/talents from ::ffff:127.0.0.1
[2025-12-27 23:18:02] info: [GET] /api/grooms/46639/talents - 401
[2025-12-27 23:18:02] info: [GET] /api/grooms/talents/definitions
[2025-12-27 23:18:02] info: [GET] /api/grooms/talents/definitions - 200
[2025-12-27 23:18:02] info: [GET] /api/grooms/invalid/retirement/eligibility
[2025-12-27 23:18:02] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for GET /grooms/invalid/retirement/eligibility
[2025-12-27 23:18:02] warn: [groomRoutes] Validation errors: [{"type":"field","value":"invalid","msg":"Groom ID must be an integer","path":"id","location":"params"}]
[2025-12-27 23:18:02] info: [GET] /api/grooms/invalid/retirement/eligibility - 400
[2025-12-27 23:18:02] info: [POST] /api/grooms/46645/talents/select
[2025-12-27 23:18:02] info: [auth] Authenticated user 54356d43-caf7-4bf3-b1fd-b0dc57f28d4b for POST /grooms/46645/talents/select
[2025-12-27 23:18:02] warn: [groomRoutes] Validation errors: [{"type":"field","value":"invalid_tier","msg":"Invalid tier","path":"tier","location":"body"}]
[2025-12-27 23:18:02] info: [POST] /api/grooms/46645/talents/select - 400
PASS tests/routes/groomRetirementRoutes.test.mjs
  Groom Retirement Routes
    Retirement Endpoints
      ‚àö GET /api/grooms/:id/retirement/eligibility should check eligibility (89 ms)
      ‚àö GET /api/grooms/retirement/statistics should return user stats (117 ms)
      ‚àö GET /api/grooms/retirement/approaching should return approaching retirement grooms (51 ms)
    Legacy Endpoints
      ‚àö GET /api/grooms/:id/legacy/eligibility should check legacy eligibility (44 ms)
      ‚àö GET /api/grooms/legacy/history should return legacy history (40 ms)
    Talent Endpoints
      ‚àö GET /api/grooms/talents/definitions should return talent definitions (125 ms)
      ‚àö GET /api/grooms/:id/talents should return groom talent selections (40 ms)
      ‚àö POST /api/grooms/:id/talents/validate should validate talent selection (50 ms)
      ‚àö POST /api/grooms/:id/talents/select should select talent (51 ms)
    Authentication
      ‚àö should require authentication for protected endpoints (76 ms)
      ‚àö should allow unauthenticated access to talent definitions (115 ms)
    Validation
      ‚àö should validate groom ID parameter (35 ms)
      ‚àö should validate talent selection data (33 ms)

[2025-12-27 23:18:02] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:02] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:02] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:03] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:03] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:03] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:03] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:03] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:03] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/groom/46647/evolve
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /personality-evolution/groom/46647/evolve
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /groom/46647/evolve
[2025-12-27 23:18:03] info: [ownership] Validated ownership: user 1b066764-18ae-466b-bd75-0b10c473190d owns groom 46647
[2025-12-27 23:18:03] info: [personalityEvolutionController.evolveGroomPersonalityController] Processing groom evolution for ID: 46647
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.evolveGroomPersonality] Starting evolution analysis for groom 46647
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.applyPersonalityEvolutionEffects] Applying effects for groom 46647
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/groom/46647/evolve - 200
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/groom/invalid/evolve
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /personality-evolution/groom/invalid/evolve
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /groom/invalid/evolve
[2025-12-27 23:18:03] warn: [personalityEvolutionRoutes] Validation errors: [{"type":"field","value":"invalid","msg":"Groom ID must be a positive integer","path":"groomId","location":"params"}]
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/groom/invalid/evolve - 400
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/groom/46647/evolve
[2025-12-27 23:18:03] warn: [auth] Access token is required for POST /personality-evolution/groom/46647/evolve from ::ffff:127.0.0.1
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/groom/46647/evolve - 401
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/horse/94124/evolve
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /personality-evolution/horse/94124/evolve
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /horse/94124/evolve
[2025-12-27 23:18:03] info: [ownership] Validated ownership: user 1b066764-18ae-466b-bd75-0b10c473190d owns horse 94124
[2025-12-27 23:18:03] info: [personalityEvolutionController.evolveHorseTemperamentController] Processing horse evolution for ID: 94124
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.evolveHorseTemperament] Starting evolution analysis for horse 94124
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.applyPersonalityEvolutionEffects] Applying effects for horse 94124
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/horse/94124/evolve - 200
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/horse/invalid/evolve
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /personality-evolution/horse/invalid/evolve
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /horse/invalid/evolve
[2025-12-27 23:18:03] warn: [personalityEvolutionRoutes] Validation errors: [{"type":"field","value":"invalid","msg":"Horse ID must be a positive integer","path":"horseId","location":"params"}]
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/horse/invalid/evolve - 400
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/groom/46647/triggers
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /personality-evolution/groom/46647/triggers
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /groom/46647/triggers
[2025-12-27 23:18:03] info: [personalityEvolutionController.getEvolutionTriggersController] Analyzing triggers for groom ID: 46647
[2025-12-27 23:18:03] info: [ownership] Found owned groom 46647 for user 1b066764-18ae-466b-bd75-0b10c473190d
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.calculatePersonalityEvolutionTriggers] Analyzing triggers for groom 46647
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/groom/46647/triggers - 200
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/horse/94124/triggers
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /personality-evolution/horse/94124/triggers
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /horse/94124/triggers
[2025-12-27 23:18:03] info: [personalityEvolutionController.getEvolutionTriggersController] Analyzing triggers for horse ID: 94124
[2025-12-27 23:18:03] info: [ownership] Found owned horse 94124 for user 1b066764-18ae-466b-bd75-0b10c473190d
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.calculatePersonalityEvolutionTriggers] Analyzing triggers for horse 94124
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/horse/94124/triggers - 200
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/invalid/46647/triggers
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /personality-evolution/invalid/46647/triggers
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /invalid/46647/triggers
[2025-12-27 23:18:03] warn: [personalityEvolutionRoutes] Validation errors: [{"type":"field","value":"invalid","msg":"Entity type must be either \"groom\" or \"horse\"","path":"entityType","location":"params"}]
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/invalid/46647/triggers - 400
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/groom/46647/stability
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /personality-evolution/groom/46647/stability
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /groom/46647/stability
[2025-12-27 23:18:03] info: [personalityEvolutionController.getPersonalityStabilityController] Analyzing stability for groom ID: 46647
[2025-12-27 23:18:03] info: [ownership] Found owned groom 46647 for user 1b066764-18ae-466b-bd75-0b10c473190d
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.analyzePersonalityStability] Analyzing stability for groom 46647
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/groom/46647/stability - 200
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/horse/94124/stability
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /personality-evolution/horse/94124/stability
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /horse/94124/stability
[2025-12-27 23:18:03] info: [personalityEvolutionController.getPersonalityStabilityController] Analyzing stability for horse ID: 94124
[2025-12-27 23:18:03] info: [ownership] Found owned horse 94124 for user 1b066764-18ae-466b-bd75-0b10c473190d
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.analyzePersonalityStability] Analyzing stability for horse 94124
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/horse/94124/stability - 200
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/groom/46647/predict
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /personality-evolution/groom/46647/predict
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /groom/46647/predict
[2025-12-27 23:18:03] info: [personalityEvolutionController.predictPersonalityEvolutionController] Predicting evolution for groom ID: 46647 over 30 days
[2025-12-27 23:18:03] info: [ownership] Found owned groom 46647 for user 1b066764-18ae-466b-bd75-0b10c473190d
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.predictPersonalityEvolution] Predicting evolution for groom 46647 over 30 days
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/groom/46647/predict - 200
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/horse/94124/predict?timeframeDays=60
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /personality-evolution/horse/94124/predict
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /horse/94124/predict
[2025-12-27 23:18:03] info: [personalityEvolutionController.predictPersonalityEvolutionController] Predicting evolution for horse ID: 94124 over 60 days
[2025-12-27 23:18:03] info: [ownership] Found owned horse 94124 for user 1b066764-18ae-466b-bd75-0b10c473190d
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.predictPersonalityEvolution] Predicting evolution for horse 94124 over 60 days
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/horse/94124/predict?timeframeDays=60 - 200
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/groom/46647/predict?timeframeDays=500
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /personality-evolution/groom/46647/predict
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /groom/46647/predict
[2025-12-27 23:18:03] warn: [personalityEvolutionRoutes] Validation errors: [{"type":"field","value":"500","msg":"Timeframe must be between 1 and 365 days","path":"timeframeDays","location":"query"}]
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/groom/46647/predict?timeframeDays=500 - 400
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/groom/46647/history
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /personality-evolution/groom/46647/history
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /groom/46647/history
[2025-12-27 23:18:03] info: [personalityEvolutionController.getPersonalityEvolutionHistoryController] Getting evolution history for groom ID: 46647
[2025-12-27 23:18:03] info: [ownership] Found owned groom 46647 for user 1b066764-18ae-466b-bd75-0b10c473190d
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.getPersonalityEvolutionHistory] Getting history for groom 46647
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/groom/46647/history - 200
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/apply-effects
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /personality-evolution/apply-effects
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /apply-effects
[2025-12-27 23:18:03] info: [personalityEvolutionController.applyPersonalityEvolutionEffectsController] Applying evolution effects for groom ID: 46647
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.applyPersonalityEvolutionEffects] Applying effects for groom 46647
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/apply-effects - 200
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/apply-effects
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /personality-evolution/apply-effects
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /apply-effects
[2025-12-27 23:18:03] warn: [personalityEvolutionRoutes] Validation errors: [{"type":"field","msg":"Entity type must be either \"groom\" or \"horse\"","path":"entityType","location":"body"},{"type":"field","msg":"Invalid evolution type","path":"evolutionType","location":"body"}]
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/apply-effects - 400
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/batch-evolve
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /personality-evolution/batch-evolve
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /batch-evolve
[2025-12-27 23:18:03] info: [personalityEvolutionController.batchEvolvePersonalitiesController] Processing batch evolution for 2 entities
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.evolveGroomPersonality] Starting evolution analysis for groom 46647
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.applyPersonalityEvolutionEffects] Applying effects for groom 46647
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.evolveHorseTemperament] Starting evolution analysis for horse 94124
[2025-12-27 23:18:03] info: [personalityEvolutionSystem.applyPersonalityEvolutionEffects] Applying effects for horse 94124
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/batch-evolve - 200
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/batch-evolve
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /personality-evolution/batch-evolve
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for POST /batch-evolve
[2025-12-27 23:18:03] warn: [personalityEvolutionRoutes] Validation errors: [{"type":"field","value":[],"msg":"Entities must be an array with 1-50 items","path":"entities","location":"body"}]
[2025-12-27 23:18:03] info: [POST] /api/personality-evolution/batch-evolve - 400
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/config
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /personality-evolution/config
[2025-12-27 23:18:03] info: [auth] Authenticated user 1b066764-18ae-466b-bd75-0b10c473190d for GET /config
[2025-12-27 23:18:03] info: [GET] /api/personality-evolution/config - 200
PASS tests/controllers/personalityEvolutionController.test.mjs
  Personality Evolution Controller API
    POST /api/personality-evolution/groom/:groomId/evolve
      ‚àö should evolve groom personality successfully (56 ms)
      ‚àö should return 400 for invalid groom ID (26 ms)
      ‚àö should return 401 without authentication (21 ms)
    POST /api/personality-evolution/horse/:horseId/evolve
      ‚àö should evolve horse temperament successfully (41 ms)
      ‚àö should return 400 for invalid horse ID (26 ms)
    GET /api/personality-evolution/:entityType/:entityId/triggers
      ‚àö should get evolution triggers for groom (37 ms)
      ‚àö should get evolution triggers for horse (34 ms)
      ‚àö should return 400 for invalid entity type (24 ms)
    GET /api/personality-evolution/:entityType/:entityId/stability
      ‚àö should analyze personality stability for groom (34 ms)
      ‚àö should analyze personality stability for horse (34 ms)
    GET /api/personality-evolution/:entityType/:entityId/predict
      ‚àö should predict personality evolution with default timeframe (29 ms)
      ‚àö should predict personality evolution with custom timeframe (30 ms)
      ‚àö should return 400 for invalid timeframe (27 ms)
    GET /api/personality-evolution/:entityType/:entityId/history
      ‚àö should get personality evolution history (28 ms)
    POST /api/personality-evolution/apply-effects
      ‚àö should apply personality evolution effects successfully (35 ms)
      ‚àö should return 400 for missing required fields (28 ms)
    POST /api/personality-evolution/batch-evolve
      ‚àö should process batch evolution successfully (45 ms)
      ‚àö should return 400 for empty entities array (22 ms)
    GET /api/personality-evolution/config
      ‚àö should get system configuration successfully (29 ms)

[2025-12-27 23:18:04] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:04] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:04] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:04] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:04] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:04] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:04] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:04] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:04] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:04] info: [GET] /api/horses/94125/environmental-analysis
[2025-12-27 23:18:04] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94125/environmental-analysis
[2025-12-27 23:18:04] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94125/environmental-analysis
[2025-12-27 23:18:05] info: [ownership] Validated ownership: user c3457947-8124-48d0-af8c-3731ff753701 owns horse 94125
[2025-12-27 23:18:05] info: Environmental analysis generated for horse 94125 by user c3457947-8124-48d0-af8c-3731ff753701
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/environmental-analysis - 200
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/environmental-forecast?days=30
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94125/environmental-forecast
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94125/environmental-forecast
[2025-12-27 23:18:05] info: [ownership] Validated ownership: user c3457947-8124-48d0-af8c-3731ff753701 owns horse 94125
[2025-12-27 23:18:05] info: Environmental forecast generated for horse 94125 (30 days) by user c3457947-8124-48d0-af8c-3731ff753701
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/environmental-forecast?days=30 - 200
[2025-12-27 23:18:05] info: [POST] /api/horses/94125/evaluate-trait-opportunity
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for POST /horses/94125/evaluate-trait-opportunity
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for POST /horses/94125/evaluate-trait-opportunity
[2025-12-27 23:18:05] info: [ownership] Validated ownership: user c3457947-8124-48d0-af8c-3731ff753701 owns horse 94125
[2025-12-27 23:18:05] info: Trait opportunity evaluated for horse 94125 (confident in early_socialization) by user c3457947-8124-48d0-af8c-3731ff753701
[2025-12-27 23:18:05] info: [POST] /api/horses/94125/evaluate-trait-opportunity - 200
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/environmental-analysis
[2025-12-27 23:18:05] warn: [auth] Access token is required for GET /horses/94125/environmental-analysis from ::ffff:127.0.0.1
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/environmental-analysis - 401
[2025-12-27 23:18:05] info: [GET] /api/horses/94127/environmental-analysis
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94127/environmental-analysis
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94127/environmental-analysis
[2025-12-27 23:18:05] warn: [ownership] horse 94127 not found or not owned by user c3457947-8124-48d0-af8c-3731ff753701
[2025-12-27 23:18:05] info: [GET] /api/horses/94127/environmental-analysis - 404
[2025-12-27 23:18:05] info: [GET] /api/horses/94126/trait-interactions
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94126/trait-interactions
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94126/trait-interactions
[2025-12-27 23:18:05] info: [ownership] Validated ownership: user c3457947-8124-48d0-af8c-3731ff753701 owns horse 94126
[2025-12-27 23:18:05] info: Trait interactions analyzed for horse 94126 by user c3457947-8124-48d0-af8c-3731ff753701
[2025-12-27 23:18:05] info: [GET] /api/horses/94126/trait-interactions - 200
[2025-12-27 23:18:05] info: [GET] /api/horses/94126/trait-matrix
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94126/trait-matrix
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94126/trait-matrix
[2025-12-27 23:18:05] info: [ownership] Validated ownership: user c3457947-8124-48d0-af8c-3731ff753701 owns horse 94126
[2025-12-27 23:18:05] info: Trait interaction matrix generated for horse 94126 by user c3457947-8124-48d0-af8c-3731ff753701
[2025-12-27 23:18:05] info: [GET] /api/horses/94126/trait-matrix - 200
[2025-12-27 23:18:05] info: [GET] /api/horses/94126/trait-stability
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94126/trait-stability
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94126/trait-stability
[2025-12-27 23:18:05] info: [ownership] Validated ownership: user c3457947-8124-48d0-af8c-3731ff753701 owns horse 94126
[2025-12-27 23:18:05] info: Trait stability analyzed for horse 94126 by user c3457947-8124-48d0-af8c-3731ff753701
[2025-12-27 23:18:05] info: [GET] /api/horses/94126/trait-stability - 200
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/developmental-windows
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94125/developmental-windows
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94125/developmental-windows
[2025-12-27 23:18:05] info: [ownership] Validated ownership: user c3457947-8124-48d0-af8c-3731ff753701 owns horse 94125
[2025-12-27 23:18:05] info: Developmental windows identified for horse 94125 by user c3457947-8124-48d0-af8c-3731ff753701
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/developmental-windows - 200
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/developmental-forecast?days=60
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94125/developmental-forecast
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94125/developmental-forecast
[2025-12-27 23:18:05] info: [ownership] Validated ownership: user c3457947-8124-48d0-af8c-3731ff753701 owns horse 94125
[2025-12-27 23:18:05] info: Developmental forecast generated for horse 94125 (60 days) by user c3457947-8124-48d0-af8c-3731ff753701
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/developmental-forecast?days=60 - 200
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/critical-period-analysis
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94125/critical-period-analysis
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94125/critical-period-analysis
[2025-12-27 23:18:05] info: [ownership] Validated ownership: user c3457947-8124-48d0-af8c-3731ff753701 owns horse 94125
[2025-12-27 23:18:05] info: Critical period analysis generated for horse 94125 by user c3457947-8124-48d0-af8c-3731ff753701
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/critical-period-analysis - 200
[2025-12-27 23:18:05] info: [POST] /api/horses/94125/coordinate-development
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for POST /horses/94125/coordinate-development
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for POST /horses/94125/coordinate-development
[2025-12-27 23:18:05] info: [ownership] Validated ownership: user c3457947-8124-48d0-af8c-3731ff753701 owns horse 94125
[2025-12-27 23:18:05] info: Development coordination generated for horse 94125 by user c3457947-8124-48d0-af8c-3731ff753701
[2025-12-27 23:18:05] info: [POST] /api/horses/94125/coordinate-development - 200
[2025-12-27 23:18:05] info: [POST] /api/horses/94125/evaluate-trait-opportunity
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for POST /horses/94125/evaluate-trait-opportunity
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for POST /horses/94125/evaluate-trait-opportunity
[2025-12-27 23:18:05] info: [POST] /api/horses/94125/evaluate-trait-opportunity - 400
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/developmental-forecast?days=-5
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94125/developmental-forecast
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/94125/developmental-forecast
[2025-12-27 23:18:05] info: [GET] /api/horses/94125/developmental-forecast?days=-5 - 400
[2025-12-27 23:18:05] info: [GET] /api/horses/99999/environmental-analysis
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/99999/environmental-analysis
[2025-12-27 23:18:05] info: [auth] Authenticated user c3457947-8124-48d0-af8c-3731ff753701 for GET /horses/99999/environmental-analysis
[2025-12-27 23:18:05] warn: [ownership] horse 99999 not found or not owned by user c3457947-8124-48d0-af8c-3731ff753701
[2025-12-27 23:18:05] info: [GET] /api/horses/99999/environmental-analysis - 404
PASS tests/routes/advancedEpigeneticRoutes.test.mjs
  Advanced Epigenetic API Routes
    Environmental Trigger Endpoints
      ‚àö GET /api/horses/:id/environmental-analysis should return environmental trigger analysis (202 ms)
      ‚àö GET /api/horses/:id/environmental-forecast should return environmental forecast (41 ms)
      ‚àö POST /api/horses/:id/evaluate-trait-opportunity should evaluate trait development opportunity (41 ms)
      ‚àö should require authentication for environmental endpoints (22 ms)
      ‚àö should validate horse ownership for environmental endpoints (52 ms)
    Trait Interaction Endpoints
      ‚àö GET /api/horses/:id/trait-interactions should return trait interaction analysis (44 ms)
      ‚àö GET /api/horses/:id/trait-matrix should return complete interaction matrix (46 ms)
      ‚àö GET /api/horses/:id/trait-stability should return interaction stability analysis (31 ms)
    Developmental Window Endpoints
      ‚àö GET /api/horses/:id/developmental-windows should return active and upcoming windows (36 ms)
      ‚àö GET /api/horses/:id/developmental-forecast should return developmental forecast (34 ms)
      ‚àö GET /api/horses/:id/critical-period-analysis should return critical period sensitivity (46 ms)
      ‚àö POST /api/horses/:id/coordinate-development should coordinate multi-window development (36 ms)
    Input Validation
      ‚àö should validate trait opportunity evaluation input (25 ms)
      ‚àö should validate forecast days parameter (21 ms)
      ‚àö should handle non-existent horse IDs (25 ms)

[2025-12-27 23:18:05] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:05] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:05] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:06] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:06] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:06] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:06] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:06] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:06] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:07] info: [GET] /api/horses/94129/enhanced-trait-history
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/94129/enhanced-trait-history
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/94129/enhanced-trait-history
[2025-12-27 23:18:07] info: [ownership] Validated ownership: user c30947f4-6dea-426c-865f-ed0cff694ae9 owns horse 94129
[2025-12-27 23:18:07] info: Enhanced trait history generated for horse 94129 by user c30947f4-6dea-426c-865f-ed0cff694ae9
[2025-12-27 23:18:07] info: [GET] /api/horses/94129/enhanced-trait-history - 200
[2025-12-27 23:18:07] info: [GET] /api/horses/94130/epigenetic-insights
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/94130/epigenetic-insights
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/94130/epigenetic-insights
[2025-12-27 23:18:07] info: [ownership] Validated ownership: user c30947f4-6dea-426c-865f-ed0cff694ae9 owns horse 94130
[2025-12-27 23:18:07] info: Epigenetic insights generated for horse 94130 by user c30947f4-6dea-426c-865f-ed0cff694ae9
[2025-12-27 23:18:07] info: [GET] /api/horses/94130/epigenetic-insights - 200
[2025-12-27 23:18:07] info: [GET] /api/horses/94129/trait-timeline
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/94129/trait-timeline
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/94129/trait-timeline
[2025-12-27 23:18:07] info: [ownership] Validated ownership: user c30947f4-6dea-426c-865f-ed0cff694ae9 owns horse 94129
[2025-12-27 23:18:07] info: Trait timeline generated for horse 94129 by user c30947f4-6dea-426c-865f-ed0cff694ae9
[2025-12-27 23:18:07] info: [GET] /api/horses/94129/trait-timeline - 200
[2025-12-27 23:18:07] info: [GET] /api/users/c30947f4-6dea-426c-865f-ed0cff694ae9/stable-epigenetic-report
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /users/c30947f4-6dea-426c-865f-ed0cff694ae9/stable-epigenetic-report
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /users/c30947f4-6dea-426c-865f-ed0cff694ae9/stable-epigenetic-report
[2025-12-27 23:18:07] info: Stable epigenetic report generated for user c30947f4-6dea-426c-865f-ed0cff694ae9
[2025-12-27 23:18:07] info: [GET] /api/users/c30947f4-6dea-426c-865f-ed0cff694ae9/stable-epigenetic-report - 200
[2025-12-27 23:18:07] info: [POST] /api/horses/compare-epigenetics
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for POST /horses/compare-epigenetics
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for POST /horses/compare-epigenetics
[2025-12-27 23:18:07] info: Horse comparison generated for 3 horses by user c30947f4-6dea-426c-865f-ed0cff694ae9
[2025-12-27 23:18:07] info: [POST] /api/horses/compare-epigenetics - 200
[2025-12-27 23:18:07] info: [GET] /api/horses/trait-trends?userId=c30947f4-6dea-426c-865f-ed0cff694ae9&timeframe=30
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/trait-trends
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /trait-trends
[2025-12-27 23:18:07] info: Trait trends analyzed for user c30947f4-6dea-426c-865f-ed0cff694ae9 (30 days)
[2025-12-27 23:18:07] info: [GET] /api/horses/trait-trends?userId=c30947f4-6dea-426c-865f-ed0cff694ae9&timeframe=30 - 200
[2025-12-27 23:18:07] info: [GET] /api/horses/94129/enhanced-trait-history?traitType=positive&discoveryMethod=milestone_evaluation&dateFrom=2025-12-18T04%3A18%3A07.439Z&dateTo=2025-12-28T04%3A18%3A07.439Z
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/94129/enhanced-trait-history
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/94129/enhanced-trait-history
[2025-12-27 23:18:07] info: [ownership] Validated ownership: user c30947f4-6dea-426c-865f-ed0cff694ae9 owns horse 94129
[2025-12-27 23:18:07] info: Enhanced trait history generated for horse 94129 by user c30947f4-6dea-426c-865f-ed0cff694ae9
[2025-12-27 23:18:07] info: [GET] /api/horses/94129/enhanced-trait-history?traitType=positive&discoveryMethod=milestone_evaluation&dateFrom=2025-12-18T04%3A18%3A07.439Z&dateTo=2025-12-28T04%3A18%3A07.439Z - 200
[2025-12-27 23:18:07] info: [GET] /api/horses/94130/epigenetic-report-export?format=detailed
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/94130/epigenetic-report-export
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/94130/epigenetic-report-export
[2025-12-27 23:18:07] info: [ownership] Validated ownership: user c30947f4-6dea-426c-865f-ed0cff694ae9 owns horse 94130
[2025-12-27 23:18:07] info: Epigenetic report export generated for horse 94130 (detailed) by user c30947f4-6dea-426c-865f-ed0cff694ae9
[2025-12-27 23:18:07] info: [GET] /api/horses/94130/epigenetic-report-export?format=detailed - 200
[2025-12-27 23:18:07] info: [GET] /api/horses/94128/enhanced-trait-history
[2025-12-27 23:18:07] warn: [auth] Access token is required for GET /horses/94128/enhanced-trait-history from ::ffff:127.0.0.1
[2025-12-27 23:18:07] info: [GET] /api/horses/94128/enhanced-trait-history - 401
[2025-12-27 23:18:07] info: [GET] /api/horses/94131/enhanced-trait-history
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/94131/enhanced-trait-history
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/94131/enhanced-trait-history
[2025-12-27 23:18:07] warn: [ownership] horse 94131 not found or not owned by user c30947f4-6dea-426c-865f-ed0cff694ae9
[2025-12-27 23:18:07] info: [GET] /api/horses/94131/enhanced-trait-history - 404
[2025-12-27 23:18:07] info: [POST] /api/horses/compare-epigenetics
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for POST /horses/compare-epigenetics
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for POST /horses/compare-epigenetics
[2025-12-27 23:18:07] info: [POST] /api/horses/compare-epigenetics - 400
[2025-12-27 23:18:07] info: [GET] /api/horses/99999/enhanced-trait-history
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/99999/enhanced-trait-history
[2025-12-27 23:18:07] info: [auth] Authenticated user c30947f4-6dea-426c-865f-ed0cff694ae9 for GET /horses/99999/enhanced-trait-history
[2025-12-27 23:18:07] warn: [ownership] horse 99999 not found or not owned by user c30947f4-6dea-426c-865f-ed0cff694ae9
[2025-12-27 23:18:07] info: [GET] /api/horses/99999/enhanced-trait-history - 404
PASS tests/routes/enhancedReportingRoutes.test.mjs
  Enhanced Reporting API Routes
    Enhanced Trait History Endpoints
      ‚àö GET /api/horses/:id/enhanced-trait-history should return comprehensive trait history (112 ms)
      ‚àö GET /api/horses/:id/epigenetic-insights should return advanced epigenetic analysis (70 ms)
      ‚àö GET /api/horses/:id/trait-timeline should return detailed trait development timeline (40 ms)
    Multi-Horse Analysis Endpoints
      ‚àö GET /api/users/:id/stable-epigenetic-report should return stable-wide epigenetic analysis (100 ms)
      ‚àö POST /api/horses/compare-epigenetics should compare multiple horses (43 ms)
      ‚àö GET /api/horses/trait-trends should return trait development trends (34 ms)
    Advanced Filtering and Export
      ‚àö GET /api/horses/:id/enhanced-trait-history with filters should return filtered results (70 ms)
      ‚àö GET /api/horses/:id/epigenetic-report-export should return exportable report data (39 ms)
    Authentication and Validation
      ‚àö should require authentication for enhanced reporting endpoints (24 ms)
      ‚àö should validate horse ownership for reporting endpoints (64 ms)
      ‚àö should validate input parameters for comparison endpoint (30 ms)
      ‚àö should handle non-existent horse IDs in reporting (30 ms)

[2025-12-27 23:18:07] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:07] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:07] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:08] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:08] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:08] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:08] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:08] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:08] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/46650/94132
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for GET /grooms/enhanced/interactions/46650/94132
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for GET /interactions/46650/94132
[2025-12-27 23:18:09] info: [ownership] Validated ownership: user 0aec1903-ea13-464e-adca-7f719b6e2ae5 owns groom 46650
[2025-12-27 23:18:09] info: [ownership] Validated ownership: user 0aec1903-ea13-464e-adca-7f719b6e2ae5 owns horse 94132
[2025-12-27 23:18:09] info: [enhancedGroomController] Getting enhanced interactions for groom 46650 and horse 94132
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/46650/94132 - 200
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/99999/94132
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for GET /grooms/enhanced/interactions/99999/94132
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for GET /interactions/99999/94132
[2025-12-27 23:18:09] warn: [ownership] groom 99999 not found or not owned by user 0aec1903-ea13-464e-adca-7f719b6e2ae5
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/99999/94132 - 404
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/46650/99999
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for GET /grooms/enhanced/interactions/46650/99999
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for GET /interactions/46650/99999
[2025-12-27 23:18:09] info: [ownership] Validated ownership: user 0aec1903-ea13-464e-adca-7f719b6e2ae5 owns groom 46650
[2025-12-27 23:18:09] warn: [ownership] horse 99999 not found or not owned by user 0aec1903-ea13-464e-adca-7f719b6e2ae5
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/46650/99999 - 404
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /interact
[2025-12-27 23:18:09] info: [enhancedGroomController] Performing enhanced daily_care interaction
[2025-12-27 23:18:09] info: [ownership] Found owned groom 46650 for user 0aec1903-ea13-464e-adca-7f719b6e2ae5
[2025-12-27 23:18:09] info: [enhancedGroomInteractions] Calculated effects: +8 bonding, -2 stress, quality: good
[2025-12-27 23:18:09] info: [enhancedGroomController] Enhanced interaction completed: +8 bonding, -2 stress
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact - 201
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /interact
[2025-12-27 23:18:09] info: [enhancedGroomController] Performing enhanced enrichment interaction
[2025-12-27 23:18:09] info: [ownership] Found owned groom 46650 for user 0aec1903-ea13-464e-adca-7f719b6e2ae5
[2025-12-27 23:18:09] info: [enhancedGroomInteractions] Calculated effects: +5 bonding, -7 stress, quality: good
[2025-12-27 23:18:09] info: [enhancedGroomController] Enhanced interaction completed: +5 bonding, -7 stress
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact - 201
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /interact
[2025-12-27 23:18:09] info: [enhancedGroomController] Performing enhanced bonding_time interaction
[2025-12-27 23:18:09] info: [ownership] Found owned groom 46650 for user 0aec1903-ea13-464e-adca-7f719b6e2ae5
[2025-12-27 23:18:09] info: [enhancedGroomInteractions] Calculated effects: +8 bonding, -4 stress, quality: good
[2025-12-27 23:18:09] info: [enhancedGroomController] Enhanced interaction completed: +8 bonding, -4 stress
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact - 201
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /interact
[2025-12-27 23:18:09] info: [enhancedGroomController] Performing enhanced bonding_time interaction
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact - 400
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /interact
[2025-12-27 23:18:09] warn: [enhancedGroomRoutes] Validation errors: [{"type":"field","msg":"Invalid value","path":"interactionType","location":"body"},{"type":"field","msg":"Interaction type must be a non-empty string (max 50 characters)","path":"interactionType","location":"body"},{"type":"field","msg":"Invalid value","path":"variation","location":"body"},{"type":"field","msg":"Variation must be a non-empty string (max 100 characters)","path":"variation","location":"body"},{"type":"field","msg":"Duration must be between 5 and 180 minutes","path":"duration","location":"body"}]
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact - 400
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /interact
[2025-12-27 23:18:09] info: [enhancedGroomController] Performing enhanced invalid_type interaction
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact - 400
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /grooms/enhanced/interact
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for POST /interact
[2025-12-27 23:18:09] warn: [enhancedGroomRoutes] Validation errors: [{"type":"field","value":200,"msg":"Duration must be between 5 and 180 minutes","path":"duration","location":"body"}]
[2025-12-27 23:18:09] info: [POST] /api/grooms/enhanced/interact - 400
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/relationship/46650/94132
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for GET /grooms/enhanced/relationship/46650/94132
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for GET /relationship/46650/94132
[2025-12-27 23:18:09] info: [ownership] Validated ownership: user 0aec1903-ea13-464e-adca-7f719b6e2ae5 owns groom 46650
[2025-12-27 23:18:09] info: [ownership] Validated ownership: user 0aec1903-ea13-464e-adca-7f719b6e2ae5 owns horse 94132
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/relationship/46650/94132 - 200
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/types
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for GET /grooms/enhanced/interactions/types
[2025-12-27 23:18:09] info: [auth] Authenticated user 0aec1903-ea13-464e-adca-7f719b6e2ae5 for GET /interactions/types
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/types - 200
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/46650/94132
[2025-12-27 23:18:09] warn: [auth] Access token is required for GET /grooms/enhanced/interactions/46650/94132 from ::ffff:127.0.0.1
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/46650/94132 - 401
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interact
[2025-12-27 23:18:09] warn: [auth] Access token is required for GET /grooms/enhanced/interact from ::ffff:127.0.0.1
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interact - 401
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/relationship/46650/94132
[2025-12-27 23:18:09] warn: [auth] Access token is required for GET /grooms/enhanced/relationship/46650/94132 from ::ffff:127.0.0.1
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/relationship/46650/94132 - 401
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/types
[2025-12-27 23:18:09] warn: [auth] Access token is required for GET /grooms/enhanced/interactions/types from ::ffff:127.0.0.1
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/types - 401
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/46650/94132
[2025-12-27 23:18:09] info: [auth] Authenticated user 8e06badf-abbf-4e05-b6a5-f62db4489774 for GET /grooms/enhanced/interactions/46650/94132
[2025-12-27 23:18:09] info: [auth] Authenticated user 8e06badf-abbf-4e05-b6a5-f62db4489774 for GET /interactions/46650/94132
[2025-12-27 23:18:09] warn: [ownership] groom 46650 not found or not owned by user 8e06badf-abbf-4e05-b6a5-f62db4489774
[2025-12-27 23:18:09] info: [GET] /api/grooms/enhanced/interactions/46650/94132 - 404
PASS tests/integration/enhancedGroomInteractions.test.mjs
  Enhanced Groom Interactions Integration Tests
    1. Get Available Enhanced Interactions
      ‚àö should get available interactions for groom-horse pair (140 ms)
      ‚àö should return 404 for non-existent groom (28 ms)
      ‚àö should return 404 for non-existent horse (34 ms)
    2. Perform Enhanced Interactions
      ‚àö should perform a basic enhanced interaction (59 ms)
      ‚àö should perform enrichment interaction with higher effects (72 ms)
      ‚àö should prevent multiple interactions per day (77 ms)
      ‚àö should validate required fields (28 ms)
      ‚àö should validate interaction type (28 ms)
      ‚àö should validate duration bounds (28 ms)
    3. Relationship Details
      ‚àö should get detailed relationship information (39 ms)
    4. Information Endpoints
      ‚àö should get interaction types (30 ms)
    5. Authentication and Authorization
      ‚àö should require authentication for all endpoints (86 ms)
      ‚àö should prevent access to other users' grooms and horses (35 ms)

[2025-12-27 23:18:09] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:09] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:09] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:10] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:10] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:10] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:10] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:10] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:10] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/horse/94135
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /groom-handlers/horse/94135
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /horse/94135
[2025-12-27 23:18:10] info: [ownership] Validated ownership: user e97d5c50-9d50-491c-8d13-7cb391d34d74 owns horse 94135
[2025-12-27 23:18:10] info: [groomHandlerController] Getting handler for horse 94135
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/horse/94135 - 200
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/horse/94136
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /groom-handlers/horse/94136
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /horse/94136
[2025-12-27 23:18:10] info: [ownership] Validated ownership: user e97d5c50-9d50-491c-8d13-7cb391d34d74 owns horse 94136
[2025-12-27 23:18:10] info: [groomHandlerController] Getting handler for horse 94136
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/horse/94136 - 200
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/horse/94137
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /groom-handlers/horse/94137
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /horse/94137
[2025-12-27 23:18:10] warn: [ownership] horse 94137 not found or not owned by user e97d5c50-9d50-491c-8d13-7cb391d34d74
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/horse/94137 - 404
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/eligibility/94135/Mares
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /groom-handlers/eligibility/94135/Mares
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /eligibility/94135/Mares
[2025-12-27 23:18:10] info: [ownership] Validated ownership: user e97d5c50-9d50-491c-8d13-7cb391d34d74 owns horse 94135
[2025-12-27 23:18:10] info: [groomHandlerController] Checking handler eligibility for horse 94135 in conformation class Mares
[2025-12-27 23:18:10] info: [groomHandlerService] Conformation show detected: Mares
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/eligibility/94135/Mares - 200
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/eligibility/94135/InvalidClass
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /groom-handlers/eligibility/94135/InvalidClass
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /eligibility/94135/InvalidClass
[2025-12-27 23:18:10] info: [ownership] Validated ownership: user e97d5c50-9d50-491c-8d13-7cb391d34d74 owns horse 94135
[2025-12-27 23:18:10] info: [groomHandlerController] Checking handler eligibility for horse 94135 in conformation class InvalidClass
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/eligibility/94135/InvalidClass - 400
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/config
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /groom-handlers/config
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /config
[2025-12-27 23:18:10] info: [groomHandlerController] Getting handler configuration
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/config - 200
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/recommendations/94135?className=Mares
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /groom-handlers/recommendations/94135
[2025-12-27 23:18:10] info: [auth] Authenticated user e97d5c50-9d50-491c-8d13-7cb391d34d74 for GET /recommendations/94135
[2025-12-27 23:18:10] info: [ownership] Validated ownership: user e97d5c50-9d50-491c-8d13-7cb391d34d74 owns horse 94135
[2025-12-27 23:18:10] info: [groomHandlerController] Getting handler recommendations for horse 94135
[2025-12-27 23:18:10] info: [groomHandlerService] Conformation show detected: Mares
[2025-12-27 23:18:10] info: [groomHandlerService] Conformation show detected: Mares
[2025-12-27 23:18:10] info: [groomHandlerService] Conformation show detected: Mares
[2025-12-27 23:18:10] info: [GET] /api/groom-handlers/recommendations/94135?className=Mares - 200
[2025-12-27 23:18:11] info: [GET] /api/groom-handlers/horse/94135
[2025-12-27 23:18:11] warn: [auth] Access token is required for GET /groom-handlers/horse/94135 from ::ffff:127.0.0.1
[2025-12-27 23:18:11] info: [GET] /api/groom-handlers/horse/94135 - 401
[2025-12-27 23:18:11] info: [GET] /api/groom-handlers/eligibility/94135/Mares
[2025-12-27 23:18:11] warn: [auth] Access token is required for GET /groom-handlers/eligibility/94135/Mares from ::ffff:127.0.0.1
[2025-12-27 23:18:11] info: [GET] /api/groom-handlers/eligibility/94135/Mares - 401
[2025-12-27 23:18:11] info: [GET] /api/groom-handlers/config
[2025-12-27 23:18:11] warn: [auth] Access token is required for GET /groom-handlers/config from ::ffff:127.0.0.1
[2025-12-27 23:18:11] info: [GET] /api/groom-handlers/config - 401
[2025-12-27 23:18:11] info: [GET] /api/groom-handlers/recommendations/94135
[2025-12-27 23:18:11] warn: [auth] Access token is required for GET /groom-handlers/recommendations/94135 from ::ffff:127.0.0.1
[2025-12-27 23:18:11] info: [GET] /api/groom-handlers/recommendations/94135 - 401
PASS tests/integration/groomHandlerSystem.test.mjs
  Groom Handler System Integration Tests
    1. Handler Assignment
      ‚àö should get the assigned handler for a horse (54 ms)
      ‚àö should return no handler for a horse without assignment (46 ms)
      ‚àö should validate horse ownership (39 ms)
    2. Handler Eligibility
      ‚àö should check handler eligibility for a conformation class (41 ms)
      ‚àö should validate conformation class (42 ms)
    3. Handler Configuration
      ‚àö should get handler configuration (47 ms)
    4. Handler Recommendations
      ‚àö should get handler recommendations for a horse (63 ms)
    5. Authentication and Authorization
      ‚àö should require authentication for all endpoints (83 ms)

[2025-12-27 23:18:11] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:11] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:11] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:11] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:11] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:11] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:11] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:11] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:11] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:12] info: [POST] /api/compatibility/calculate
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for POST /compatibility/calculate
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for POST /calculate
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.calculateCompatibility] Calculating compatibility for groom 46654 and horse 94138
[2025-12-27 23:18:12] info: [ownership] Found owned groom 46654 for user 9c555a0f-f474-490f-a0db-b2c749a05e21
[2025-12-27 23:18:12] info: [ownership] Found owned horse 94138 for user 9c555a0f-f474-490f-a0db-b2c749a05e21
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.calculateCompatibility] Compatibility calculated: 1.381 (highly_recommended)
[2025-12-27 23:18:12] info: [POST] /api/compatibility/calculate - 200
[2025-12-27 23:18:12] info: [POST] /api/compatibility/calculate
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for POST /compatibility/calculate
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for POST /calculate
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.calculateCompatibility] Calculating compatibility for groom 46655 and horse 94138
[2025-12-27 23:18:12] info: [ownership] Found owned groom 46655 for user 9c555a0f-f474-490f-a0db-b2c749a05e21
[2025-12-27 23:18:12] info: [ownership] Found owned horse 94138 for user 9c555a0f-f474-490f-a0db-b2c749a05e21
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.calculateCompatibility] Compatibility calculated: 0.340 (not_recommended)
[2025-12-27 23:18:12] info: [POST] /api/compatibility/calculate - 200
[2025-12-27 23:18:12] info: [POST] /api/compatibility/calculate
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for POST /compatibility/calculate
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for POST /calculate
[2025-12-27 23:18:12] warn: [Validation] Input validation failed
[2025-12-27 23:18:12] info: [POST] /api/compatibility/calculate - 400
[2025-12-27 23:18:12] info: [POST] /api/compatibility/calculate
[2025-12-27 23:18:12] warn: [auth] Access token is required for POST /compatibility/calculate from ::ffff:127.0.0.1
[2025-12-27 23:18:12] info: [POST] /api/compatibility/calculate - 401
[2025-12-27 23:18:12] info: [GET] /api/compatibility/factors/46654/94138
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for GET /compatibility/factors/46654/94138
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for GET /factors/46654/94138
[2025-12-27 23:18:12] info: [ownership] Validated ownership: user 9c555a0f-f474-490f-a0db-b2c749a05e21 owns groom 46654
[2025-12-27 23:18:12] info: [ownership] Validated ownership: user 9c555a0f-f474-490f-a0db-b2c749a05e21 owns horse 94138
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.getCompatibilityFactors] Analyzing factors for groom 46654 and horse 94138
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.getCompatibilityFactors] Factors analyzed: excellent compatibility
[2025-12-27 23:18:12] info: [GET] /api/compatibility/factors/46654/94138 - 200
[2025-12-27 23:18:12] info: [GET] /api/compatibility/factors/invalid/94138
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for GET /compatibility/factors/invalid/94138
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for GET /factors/invalid/94138
[2025-12-27 23:18:12] warn: [Validation] Input validation failed
[2025-12-27 23:18:12] info: [GET] /api/compatibility/factors/invalid/94138 - 400
[2025-12-27 23:18:12] info: [POST] /api/compatibility/predict
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for POST /compatibility/predict
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for POST /predict
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.predictOutcome] Predicting outcome for groom 46654 and horse 94138
[2025-12-27 23:18:12] info: [ownership] Found owned groom 46654 for user 9c555a0f-f474-490f-a0db-b2c749a05e21
[2025-12-27 23:18:12] info: [ownership] Found owned horse 94138 for user 9c555a0f-f474-490f-a0db-b2c749a05e21
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.predictOutcome] Outcome predicted: excellent quality, 0.95 success probability
[2025-12-27 23:18:12] info: [POST] /api/compatibility/predict - 200
[2025-12-27 23:18:12] info: [POST] /api/compatibility/predict
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for POST /compatibility/predict
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for POST /predict
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.predictOutcome] Predicting outcome for groom 46655 and horse 94138
[2025-12-27 23:18:12] info: [ownership] Found owned groom 46655 for user 9c555a0f-f474-490f-a0db-b2c749a05e21
[2025-12-27 23:18:12] info: [ownership] Found owned horse 94138 for user 9c555a0f-f474-490f-a0db-b2c749a05e21
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.predictOutcome] Outcome predicted: fair quality, 0.52 success probability
[2025-12-27 23:18:12] info: [POST] /api/compatibility/predict - 200
[2025-12-27 23:18:12] info: [POST] /api/compatibility/recommendations
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for POST /compatibility/recommendations
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for POST /recommendations
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.getRecommendations] Getting recommendations for horse 94138
[2025-12-27 23:18:12] info: [ownership] Found owned horse 94138 for user 9c555a0f-f474-490f-a0db-b2c749a05e21
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.getRecommendations] Found 3 groom recommendations
[2025-12-27 23:18:12] info: [POST] /api/compatibility/recommendations - 200
[2025-12-27 23:18:12] info: [GET] /api/compatibility/trends/46654/94138
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for GET /compatibility/trends/46654/94138
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for GET /trends/46654/94138
[2025-12-27 23:18:12] info: [ownership] Validated ownership: user 9c555a0f-f474-490f-a0db-b2c749a05e21 owns groom 46654
[2025-12-27 23:18:12] info: [ownership] Validated ownership: user 9c555a0f-f474-490f-a0db-b2c749a05e21 owns horse 94138
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.getCompatibilityTrends] Analyzing trends for groom 46654 and horse 94138
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.getCompatibilityTrends] Trends analyzed: insufficient_data trend with 0 data points
[2025-12-27 23:18:12] info: [GET] /api/compatibility/trends/46654/94138 - 200
[2025-12-27 23:18:12] info: [GET] /api/compatibility/config
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for GET /compatibility/config
[2025-12-27 23:18:12] info: [auth] Authenticated user 9c555a0f-f474-490f-a0db-b2c749a05e21 for GET /config
[2025-12-27 23:18:12] info: [dynamicCompatibilityController.getCompatibilityConfig] Getting compatibility system configuration
[2025-12-27 23:18:12] info: [GET] /api/compatibility/config - 200
PASS tests/controllers/dynamicCompatibilityController.test.mjs
  Dynamic Compatibility Controller API
    POST /api/compatibility/calculate
      ‚àö should calculate high compatibility for calm groom with fearful horse (78 ms)
      ‚àö should calculate low compatibility for energetic groom with fearful horse (44 ms)
      ‚àö should return 400 for missing required fields (26 ms)
      ‚àö should return 401 for missing authentication (19 ms)
    GET /api/compatibility/factors/:groomId/:horseId
      ‚àö should analyze compatibility factors comprehensively (42 ms)
      ‚àö should return 400 for invalid groom ID (26 ms)
    POST /api/compatibility/predict
      ‚àö should predict positive outcome for good compatibility (47 ms)
      ‚àö should predict negative outcome for poor compatibility (45 ms)
    POST /api/compatibility/recommendations
      ‚àö should recommend optimal grooms for specific horse and context (121 ms)
    GET /api/compatibility/trends/:groomId/:horseId
      ‚àö should analyze compatibility trends with insufficient data (38 ms)
    GET /api/compatibility/config
      ‚àö should return compatibility system configuration (29 ms)

[2025-12-27 23:18:12] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:12] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:12] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:13] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:13] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:13] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:13] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:13] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:13] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:13] info: [groomBonusTraitService.assignBonusTraits] Assigning bonus traits to groom 46657
[2025-12-27 23:18:13] info: [groomBonusTraitService.assignBonusTraits] Successfully assigned bonus traits to groom 46657
[2025-12-27 23:18:13] info: [groomBonusTraitService.assignBonusTraits] Assigning bonus traits to groom 46658
[2025-12-27 23:18:13] error: [groomBonusTraitService.assignBonusTraits] Error assigning bonus traits to groom 46658: Bonus trait constraints violated: Maximum 3 bonus traits allowed, got 4, Bonus for trait 'trait1' must be between 0 and 0.3 (30%)
[2025-12-27 23:18:13] info: [groomBonusTraitService.getBonusTraits] Getting bonus traits for groom 46659
[2025-12-27 23:18:13] info: [groomBonusTraitService.getBonusTraits] Retrieved bonus traits for groom 46659
[2025-12-27 23:18:13] info: [traitAssignmentLogic.calculateTraitProbabilityWithBonus] Calculating probability for trait 'sensitive' on horse 94144
[2025-12-27 23:18:13] info: [groomBonusTraitService.getBonusTraits] Getting bonus traits for groom 46660
[2025-12-27 23:18:13] info: [groomBonusTraitService.getBonusTraits] Retrieved bonus traits for groom 46660
[2025-12-27 23:18:13] info: [groomBonusTraitService.checkBonusEligibility] Checking bonus eligibility for horse 94144 and groom 46660
[2025-12-27 23:18:13] info: [groomBonusTraitService.checkBonusEligibility] Eligibility check complete for horse 94144 and groom 46660: true
[2025-12-27 23:18:13] info: [traitAssignmentLogic.calculateTraitProbabilityWithBonus] Applied 20% bonus to trait 'sensitive' for horse 94144
[2025-12-27 23:18:13] info: [traitAssignmentLogic.calculateTraitProbabilityWithBonus] Calculating probability for trait 'sensitive' on horse 94145
[2025-12-27 23:18:13] info: [groomBonusTraitService.getBonusTraits] Getting bonus traits for groom 46661
[2025-12-27 23:18:13] info: [groomBonusTraitService.getBonusTraits] Retrieved bonus traits for groom 46661
[2025-12-27 23:18:13] info: [groomBonusTraitService.checkBonusEligibility] Checking bonus eligibility for horse 94145 and groom 46661
[2025-12-27 23:18:13] info: [groomBonusTraitService.checkBonusEligibility] Eligibility check complete for horse 94145 and groom 46661: false
[2025-12-27 23:18:13] info: [traitAssignmentLogic.calculateTraitProbabilityWithBonus] Groom 46661 not eligible for bonus: Bond score too low
[2025-12-27 23:18:13] info: [traitAssignmentLogic.calculateTraitProbabilityWithBonus] Calculating probability for trait 'sensitive' on horse 94146
[2025-12-27 23:18:13] info: [groomBonusTraitService.getBonusTraits] Getting bonus traits for groom 46662
[2025-12-27 23:18:13] info: [groomBonusTraitService.getBonusTraits] Retrieved bonus traits for groom 46662
[2025-12-27 23:18:13] info: [groomBonusTraitService.checkBonusEligibility] Checking bonus eligibility for horse 94146 and groom 46662
[2025-12-27 23:18:13] info: [groomBonusTraitService.checkBonusEligibility] Eligibility check complete for horse 94146 and groom 46662: false
[2025-12-27 23:18:13] info: [traitAssignmentLogic.calculateTraitProbabilityWithBonus] Groom 46662 not eligible for bonus: Insufficient assignment coverage
[2025-12-27 23:18:13] info: [GET] /api/grooms/46663/bonus-traits
[2025-12-27 23:18:13] info: [auth] Authenticated user 164f8cdd-5e53-41a3-8d2e-b6b1b2a85ed0 for GET /grooms/46663/bonus-traits
[2025-12-27 23:18:13] info: [ownership] Validated ownership: user 164f8cdd-5e53-41a3-8d2e-b6b1b2a85ed0 owns groom 46663
[2025-12-27 23:18:13] info: [groomController.getGroomBonusTraits] Getting bonus traits for groom 46663
[2025-12-27 23:18:13] info: [groomBonusTraitService.getBonusTraits] Getting bonus traits for groom 46663
[2025-12-27 23:18:13] info: [groomBonusTraitService.getBonusTraits] Retrieved bonus traits for groom 46663
[2025-12-27 23:18:13] info: [GET] /api/grooms/46663/bonus-traits - 200
[2025-12-27 23:18:13] info: [PUT] /api/grooms/46664/bonus-traits
[2025-12-27 23:18:13] info: [auth] Authenticated user e89378a5-8b57-4215-8237-621a2fcb8eb5 for PUT /grooms/46664/bonus-traits
[2025-12-27 23:18:13] info: [ownership] Validated ownership: user e89378a5-8b57-4215-8237-621a2fcb8eb5 owns groom 46664
[2025-12-27 23:18:13] info: [groomController.updateGroomBonusTraits] Updating bonus traits for groom 46664
[2025-12-27 23:18:13] info: [groomBonusTraitService.assignBonusTraits] Assigning bonus traits to groom 46664
[2025-12-27 23:18:13] info: [groomBonusTraitService.assignBonusTraits] Successfully assigned bonus traits to groom 46664
[2025-12-27 23:18:13] info: [PUT] /api/grooms/46664/bonus-traits - 200
[2025-12-27 23:18:13] info: [PUT] /api/grooms/46665/bonus-traits
[2025-12-27 23:18:13] info: [auth] Authenticated user 2a88ea13-1404-49a2-8636-cfe648989383 for PUT /grooms/46665/bonus-traits
[2025-12-27 23:18:13] info: [ownership] Validated ownership: user 2a88ea13-1404-49a2-8636-cfe648989383 owns groom 46665
[2025-12-27 23:18:13] info: [groomController.updateGroomBonusTraits] Updating bonus traits for groom 46665
[2025-12-27 23:18:13] info: [groomBonusTraitService.assignBonusTraits] Assigning bonus traits to groom 46665
[2025-12-27 23:18:13] error: [groomBonusTraitService.assignBonusTraits] Error assigning bonus traits to groom 46665: Bonus trait constraints violated: Bonus for trait 'trait1' must be between 0 and 0.3 (30%)
[2025-12-27 23:18:13] error: [groomController.updateGroomBonusTraits] Error: Bonus trait constraints violated: Bonus for trait 'trait1' must be between 0 and 0.3 (30%)
[2025-12-27 23:18:13] info: [PUT] /api/grooms/46665/bonus-traits - 400
[2025-12-27 23:18:14] info: [GET] /api/grooms/46666/bonus-traits
[2025-12-27 23:18:14] warn: [auth] Access token is required for GET /grooms/46666/bonus-traits from ::ffff:127.0.0.1
[2025-12-27 23:18:14] info: [GET] /api/grooms/46666/bonus-traits - 401
FAIL tests/groomBonusTraits.test.mjs
  Groom Bonus Traits System
    Groom Bonus Trait Management
      ‚àö should assign bonus traits to a groom (113 ms)
      ‚àö should validate bonus trait constraints (26 ms)
      ‚àö should get groom bonus traits (28 ms)
    Trait Assignment Logic Integration
      ‚àö should apply bonus probability when conditions are met (62 ms)
      ‚àö should not apply bonus when bond is too low (39 ms)
      √ó should not apply bonus when coverage is insufficient (66 ms)
    API Endpoints
      ‚àö should get groom bonus traits via API (63 ms)
      ‚àö should update groom bonus traits via API (64 ms)
      ‚àö should reject invalid bonus trait updates (66 ms)
      ‚àö should require authentication for bonus trait endpoints (56 ms)

  ‚óè Groom Bonus Traits System ‚Ä∫ Trait Assignment Logic Integration ‚Ä∫ should not apply bonus when coverage is insufficient

    expect(received).toBe(expected) // Object.is equality

    Expected: "Bond score too low"
    Received: "Insufficient assignment coverage"

    [0m [90m 302 |[39m       expect(result[33m.[39mfinalProbability)[33m.[39mtoBe([35m0.1[39m)[33m;[39m [90m// No bonus applied[39m
     [90m 303 |[39m       expect(result[33m.[39mbonusApplied)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 304 |[39m       expect(result[33m.[39mreason)[33m.[39mtoBe([32m'Bond score too low'[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 305 |[39m     })[33m;[39m
     [90m 306 |[39m   })[33m;[39m
     [90m 307 |[39m[0m

      at Object.<anonymous> (tests/groomBonusTraits.test.mjs:304:29)

[2025-12-27 23:18:14] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:14] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:14] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:14] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
[2025-12-27 23:18:14] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:14] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:14] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:14] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:14] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:14] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:14] info: [foalRoutes] POST /api/foals/1/enrichment - Day 3, Activity: Trailer Exposure
[2025-12-27 23:18:14] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "Trailer Exposure" for foal 1 on day 3
[2025-12-27 23:18:14] info: [foalModel.completeEnrichmentActivity] Activity completed successfully. Bond: 50 -> 53, Stress: 20 -> 24
[2025-12-27 23:18:14] info: [POST] /api/foals/1/enrichment - 200
[2025-12-27 23:18:14] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 1
[2025-12-27 23:18:14] info: [traitDiscovery.revealTraits] Found 0 hidden traits for horse 1
[2025-12-27 23:18:14] info: [traitDiscovery.revealTraits] No hidden traits to reveal for horse 1
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [foalRoutes] POST /api/foals/1/enrichment - Day 3, Activity: Halter Introduction
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "Halter Introduction" for foal 1 on day 3
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Activity completed successfully. Bond: 50 -> 54, Stress: 20 -> 25
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 200
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 400
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 400
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 400
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 400
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 400
[2025-12-27 23:18:15] info: [POST] /api/foals/99999/enrichment
[2025-12-27 23:18:15] warn: [ownership] foal 99999 not found or not owned by user test-user-id
[2025-12-27 23:18:15] info: [POST] /api/foals/99999/enrichment - 404
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [foalRoutes] POST /api/foals/1/enrichment - Day 0, Activity: Trailer Exposure
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "Trailer Exposure" for foal 1 on day 0
[2025-12-27 23:18:15] error: [foalModel.completeEnrichmentActivity] Error: Activity "Trailer Exposure" is not appropriate for day 0. Available activities: Gentle Touch, Quiet Presence, Soft Voice
[2025-12-27 23:18:15] error: [foalRoutes] POST /api/foals/:foalId/enrichment error: Activity "Trailer Exposure" is not appropriate for day 0. Available activities: Gentle Touch, Quiet Presence, Soft Voice
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 400
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [foalRoutes] POST /api/foals/1/enrichment - Day 3, Activity: leading_practice
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "leading_practice" for foal 1 on day 3
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Activity completed successfully. Bond: 50 -> 59, Stress: 20 -> 24
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 200
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [foalRoutes] POST /api/foals/1/enrichment - Day 3, Activity: Leading Practice
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "Leading Practice" for foal 1 on day 3
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Activity completed successfully. Bond: 50 -> 56, Stress: 20 -> 22
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 200
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [foalRoutes] POST /api/foals/1/enrichment - Day 3, Activity: HANDLING EXERCISES
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "HANDLING EXERCISES" for foal 1 on day 3
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Activity completed successfully. Bond: 50 -> 57, Stress: 20 -> 22
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 200
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [foalRoutes] POST /api/foals/1/enrichment - Day 3, Activity: Halter Introduction
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "Halter Introduction" for foal 1 on day 3
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Activity completed successfully. Bond: 50 -> 57, Stress: 20 -> 22
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 200
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [foalRoutes] POST /api/foals/1/enrichment - Day 3, Activity: Leading Practice
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "Leading Practice" for foal 1 on day 3
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Activity completed successfully. Bond: 50 -> 56, Stress: 20 -> 24
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 200
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [foalRoutes] POST /api/foals/1/enrichment - Day 3, Activity: Handling Exercises
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "Handling Exercises" for foal 1 on day 3
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Activity completed successfully. Bond: 50 -> 58, Stress: 20 -> 23
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 200
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [foalRoutes] POST /api/foals/1/enrichment - Day 3, Activity: Trailer Exposure
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "Trailer Exposure" for foal 1 on day 3
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Activity completed successfully. Bond: 50 -> 52, Stress: 20 -> 26
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 200
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment
[2025-12-27 23:18:15] info: [foalRoutes] POST /api/foals/1/enrichment - Day 1, Activity: Feeding Assistance
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "Feeding Assistance" for foal 1 on day 1
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Activity completed successfully. Bond: 50 -> 57, Stress: 20 -> 23
[2025-12-27 23:18:15] info: [POST] /api/foals/1/enrichment - 200
[2025-12-27 23:18:15] info: [POST] /api/foals/999/enrichment
[2025-12-27 23:18:15] info: [foalRoutes] POST /api/foals/999/enrichment - Day 3, Activity: Trailer Exposure
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "Trailer Exposure" for foal 999 on day 3
[2025-12-27 23:18:15] info: [foalModel.completeEnrichmentActivity] Activity completed successfully. Bond: 95 -> 97, Stress: 5 -> 11
[2025-12-27 23:18:15] info: [POST] /api/foals/999/enrichment - 200
[2025-12-27 23:18:15] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 999
[2025-12-27 23:18:15] error: [traitDiscovery.revealTraits] Error revealing traits for horse 999: Horse with ID 999 not found
[2025-12-27 23:18:15] error: [traitDiscoveryMiddleware.triggerAutoDiscovery] Error during auto-discovery for horse 999: Horse with ID 999 not found
PASS tests/foalEnrichmentIntegration.test.mjs
  üê¥ INTEGRATION: Foal Enrichment API Integration - Complete API Workflow Validation
    POST /api/foals/:foalId/enrichment
      ‚àö should complete enrichment activity successfully (61 ms)
      ‚àö should update horse bond_score and stress_level in database (21 ms)
      ‚àö should validate request parameters (84 ms)
      ‚àö should return 404 for non-existent foal (17 ms)
      ‚àö should return 400 for inappropriate activity for day (23 ms)
      ‚àö should accept different activity name formats (62 ms)
      ‚àö should handle all day 3 activities (76 ms)
      ‚àö should create training history records for each activity (22 ms)
      ‚àö should handle edge cases with bond and stress levels (20 ms)

[2025-12-27 23:18:15] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:15] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:15] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:16] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:16] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:16] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:16] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:16] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:16] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:16] info: [POST] /api/auth/register
[2025-12-27 23:18:16] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:16] info: [EmailVerification] Created verification token
[2025-12-27 23:18:16] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: integration-test@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=05f51122b52a0a4d146e23e496ba626274fbb4179cdebee1b65fcc37a6c3126e

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:16] info: [authController.register] Verification email sent
[2025-12-27 23:18:16] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:16] info: [applyEpigeneticTraitsAtBirth] Starting trait assignment at birth
[2025-12-27 23:18:16] info: [applyEpigeneticTraitsAtBirth] Mare stress: 20, Feed quality: 85
[2025-12-27 23:18:16] info: [applyEpigeneticTraitsAtBirth] Final traits assigned: {"positive":[],"negative":[]}
[2025-12-27 23:18:16] warn: [groomSystem.ensureDefaultGroomAssignment] DEPRECATED: Auto-assignment disabled for foal 94153. Players must manually assign grooms.
[2025-12-27 23:18:16] info: [foalModel.getFoalDevelopment] Getting development data for foal 94153
[2025-12-27 23:18:16] info: [foalModel.getFoalDevelopment] Retrieved development data for foal 94153
FAIL tests/integration/horseBreedingWorkflow.integration.test.mjs
  üêé INTEGRATION: Complete Horse Breeding Workflow
    üîê STEP 1: User Registration & Authentication
      ‚àö should register user and obtain authentication token (397 ms)
    üê¥ STEP 2: Horse Creation (Breeding Stock)
      ‚àö should create mare with quality traits (8 ms)
      ‚àö should create stallion with complementary traits (5 ms)
    ü§± STEP 3: Breeding Process & Foal Birth
      ‚àö should create foal with inherited and epigenetic traits (15 ms)
    üë• STEP 4: Groom Assignment & Care
      √ó should assign specialized foal care groom to newborn (19 ms)
      √ó should record groom interaction with foal (1 ms)
    üìà STEP 5: Foal Development Tracking
      ‚àö should track foal development progress (17 ms)
    üéØ STEP 6: End-to-End Workflow Validation
      √ó should validate complete breeding workflow integrity (13 ms)
      √ó should validate business rules are enforced throughout workflow (2 ms)

  ‚óè üêé INTEGRATION: Complete Horse Breeding Workflow ‚Ä∫ üë• STEP 4: Groom Assignment & Care ‚Ä∫ should assign specialized foal care groom to newborn

    expect(received).toBe(expected) // Object.is equality

    Expected: "foal_care"
    Received: "foalCare"

    [0m [90m 286 |[39m
     [90m 287 |[39m       expect(dbAssignment)[33m.[39mtoBeTruthy()[33m;[39m
    [31m[1m>[22m[39m[90m 288 |[39m       expect(dbAssignment[33m.[39mgroom[33m.[39mspeciality)[33m.[39mtoBe([32m'foal_care'[39m)[33m;[39m
     [90m     |[39m                                             [31m[1m^[22m[39m
     [90m 289 |[39m
     [90m 290 |[39m       assignedGroom [33m=[39m dbAssignment[33m.[39mgroom[33m;[39m
     [90m 291 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/horseBreedingWorkflow.integration.test.mjs:288:45)

  ‚óè üêé INTEGRATION: Complete Horse Breeding Workflow ‚Ä∫ üë• STEP 4: Groom Assignment & Care ‚Ä∫ should record groom interaction with foal

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 297 |[39m       [36mconst[39m interactionData [33m=[39m {
     [90m 298 |[39m         foalId[33m:[39m foal[33m.[39mid[33m,[39m
    [31m[1m>[22m[39m[90m 299 |[39m         groomId[33m:[39m assignedGroom[33m.[39mid[33m,[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 300 |[39m         interactionType[33m:[39m [32m'daily_care'[39m[33m,[39m
     [90m 301 |[39m         duration[33m:[39m [35m60[39m[33m,[39m [90m// 1 hour[39m
     [90m 302 |[39m         notes[33m:[39m [32m'Initial care for newborn foal'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/integration/horseBreedingWorkflow.integration.test.mjs:299:32)

  ‚óè üêé INTEGRATION: Complete Horse Breeding Workflow ‚Ä∫ üéØ STEP 6: End-to-End Workflow Validation ‚Ä∫ should validate complete breeding workflow integrity

    expect(received).toBe(expected) // Object.is equality

    Expected: "foal_care"
    Received: "foalCare"

    [0m [90m 371 |[39m       [90m// Groom care system[39m
     [90m 372 |[39m       expect(foalWithFamily[33m.[39mgroomAssignments)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 373 |[39m       expect(foalWithFamily[33m.[39mgroomAssignments[[35m0[39m][33m.[39mgroom[33m.[39mspeciality)[33m.[39mtoBe([32m'foal_care'[39m)[33m;[39m
     [90m     |[39m                                                                   [31m[1m^[22m[39m
     [90m 374 |[39m       expect(foalWithFamily[33m.[39mgroomInteractions)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m 375 |[39m
     [90m 376 |[39m       [90m// Development tracking[39m[0m

      at Object.<anonymous> (tests/integration/horseBreedingWorkflow.integration.test.mjs:373:67)

  ‚óè üêé INTEGRATION: Complete Horse Breeding Workflow ‚Ä∫ üéØ STEP 6: End-to-End Workflow Validation ‚Ä∫ should validate business rules are enforced throughout workflow

    TypeError: Cannot read properties of undefined (reading 'speciality')

    [0m [90m 397 |[39m
     [90m 398 |[39m       [90m// Groom specialization rules[39m
    [31m[1m>[22m[39m[90m 399 |[39m       expect(assignedGroom[33m.[39mspeciality)[33m.[39mtoBe([32m'foal_care'[39m)[33m;[39m [90m// Correct specialty for foal[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 400 |[39m
     [90m 401 |[39m       [90m// Data integrity[39m
     [90m 402 |[39m       expect(foal[33m.[39msireId)[33m.[39mtoBe(stallion[33m.[39mid)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/horseBreedingWorkflow.integration.test.mjs:399:28)

[2025-12-27 23:18:16] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:16] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:16] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:17] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:17] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:17] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:17] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:17] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:17] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:17] info: [GET] /api/horses/trainable/00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:17] info: [auth] Authenticated user 00000000-0000-0000-0000-000000000001 for GET /horses/trainable/00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:17] info: [trainingController.getTrainableHorses] Getting trainable horses for user 00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:17] warn: [trainingController.getTrainableHorses] User 00000000-0000-0000-0000-000000000001 not found
[2025-12-27 23:18:17] info: [GET] /api/horses/trainable/00000000-0000-0000-0000-000000000001 - 200
[2025-12-27 23:18:17] info: [GET] /api/horses/trainable/00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:17] info: [auth] Authenticated user 00000000-0000-0000-0000-000000000001 for GET /horses/trainable/00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:17] info: [trainingController.getTrainableHorses] Getting trainable horses for user 00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:17] warn: [trainingController.getTrainableHorses] User 00000000-0000-0000-0000-000000000001 not found
[2025-12-27 23:18:17] info: [GET] /api/horses/trainable/00000000-0000-0000-0000-000000000001 - 200
[2025-12-27 23:18:17] info: [GET] /api/horses/trainable/00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:17] info: [auth] Authenticated user 00000000-0000-0000-0000-000000000001 for GET /horses/trainable/00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:17] info: [trainingController.getTrainableHorses] Getting trainable horses for user 00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:17] warn: [trainingController.getTrainableHorses] User 00000000-0000-0000-0000-000000000001 not found
[2025-12-27 23:18:17] info: [GET] /api/horses/trainable/00000000-0000-0000-0000-000000000001 - 200
[2025-12-27 23:18:17] info: [GET] /api/training/status/1/Racing
[2025-12-27 23:18:17] info: [auth] Authenticated user 00000000-0000-0000-0000-000000000001 for GET /training/status/1/Racing
[2025-12-27 23:18:17] warn: [ownership] horse 1 not found or not owned by user 00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:17] info: [GET] /api/training/status/1/Racing - 404
[2025-12-27 23:18:17] info: [GET] /api/training/status/1
[2025-12-27 23:18:17] info: [auth] Authenticated user 00000000-0000-0000-0000-000000000001 for GET /training/status/1
[2025-12-27 23:18:18] warn: [ownership] horse 1 not found or not owned by user 00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:18] info: [GET] /api/training/status/1 - 404
[2025-12-27 23:18:18] info: [GET] /api/horses/trainable/00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:18] info: [trainingController.getTrainableHorses] Getting trainable horses for user 00000000-0000-0000-0000-000000000001
[2025-12-27 23:18:18] warn: [trainingController.getTrainableHorses] User 00000000-0000-0000-0000-000000000001 not found
[2025-12-27 23:18:18] info: [GET] /api/horses/trainable/00000000-0000-0000-0000-000000000001 - 200
[2025-12-27 23:18:18] info: [POST] /api/training/train
[2025-12-27 23:18:18] warn: [ownership] horse 1 not found or not owned by user test@example.com
[2025-12-27 23:18:18] info: [POST] /api/training/train - 404
[2025-12-27 23:18:18] info: [POST] /api/training/train
[2025-12-27 23:18:18] info: [auth] Authenticated user 00000000-0000-0000-0000-000000000001 for POST /training/train
[2025-12-27 23:18:18] info: [POST] /api/training/train - 403
[2025-12-27 23:18:18] info: [POST] /api/training/train
[2025-12-27 23:18:18] info: [auth] Authenticated user 00000000-0000-0000-0000-000000000001 for POST /training/train
[2025-12-27 23:18:18] info: [POST] /api/training/train - 403
FAIL tests/training-updated.test.mjs
  üèãÔ∏è INTEGRATION: Training System Updated - User Model Integration
    Age Requirement Tests
      ‚àö should get trainable horses for authenticated user (109 ms)
      ‚àö should block training for horse under 3 years old (27 ms)
      ‚àö should allow training for horse 3+ years old (25 ms)
    Training Status Tests
      √ó should get training status for a specific horse and discipline (30 ms)
      √ó should get all training status for a horse (26 ms)
    Public API Access Tests
      ‚àö should allow unauthenticated requests to get trainable horses (127 ms)
      ‚àö should allow unauthenticated training requests (114 ms)
    Error Handling Tests
      √ó should handle invalid horse ID gracefully (29 ms)
      √ó should handle invalid discipline gracefully (26 ms)

  ‚óè üèãÔ∏è INTEGRATION: Training System Updated - User Model Integration ‚Ä∫ Training Status Tests ‚Ä∫ should get training status for a specific horse and discipline

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

    [0m [90m 163 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)[33m;[39m [90m// Ensure auth token is sent[39m
     [90m 164 |[39m
    [31m[1m>[22m[39m[90m 165 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 166 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 167 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'eligible'[39m)[33m;[39m
     [90m 168 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'reason'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/training-updated.test.mjs:165:31)

  ‚óè üèãÔ∏è INTEGRATION: Training System Updated - User Model Integration ‚Ä∫ Training Status Tests ‚Ä∫ should get all training status for a horse

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

    [0m [90m 180 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)[33m;[39m [90m// Ensure auth token is sent[39m
     [90m 181 |[39m
    [31m[1m>[22m[39m[90m 182 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 183 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 184 |[39m       expect([36mtypeof[39m response[33m.[39mbody[33m.[39mdata)[33m.[39mtoBe([32m'object'[39m)[33m;[39m [90m// Fixed: API returns object with discipline keys, not array[39m
     [90m 185 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'Racing'[39m)[33m;[39m [90m// Fixed: Check for discipline properties[39m[0m

      at Object.<anonymous> (tests/training-updated.test.mjs:182:31)

  ‚óè üèãÔ∏è INTEGRATION: Training System Updated - User Model Integration ‚Ä∫ Error Handling Tests ‚Ä∫ should handle invalid horse ID gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 403

    [0m [90m 217 |[39m       })[33m;[39m
     [90m 218 |[39m
    [31m[1m>[22m[39m[90m 219 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 220 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 221 |[39m       expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'not found'[39m)[33m;[39m
     [90m 222 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/training-updated.test.mjs:219:31)

  ‚óè üèãÔ∏è INTEGRATION: Training System Updated - User Model Integration ‚Ä∫ Error Handling Tests ‚Ä∫ should handle invalid discipline gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 403

    [0m [90m 228 |[39m       })[33m;[39m
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)[33m;[39m [90m// Ownership fails before discipline validation in test mode[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 231 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 232 |[39m     })[33m;[39m
     [90m 233 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/training-updated.test.mjs:230:31)

[2025-12-27 23:18:18] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:18] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:18] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:19] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:19] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:19] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:19] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:19] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:19] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:19] info: [ultraRareTriggerEngine] Evaluating ultra-rare triggers for horse 94154
[2025-12-27 23:18:19] info: [ultraRareTriggerEngine] Ultra-rare trait triggered: Empathic Mirror for horse 94154
[2025-12-27 23:18:19] info: [ultraRareTriggerEngine] Evaluating exotic unlocks for horse 94154
[2025-12-27 23:18:19] error: [ultraRareTriggerEngine] Error evaluating Soulbonded conditions: Cannot read properties of undefined (reading 'map')
[2025-12-27 23:18:19] info: [groomRareTraitPerks] Assigning rare trait booster perks for groom 46668
[2025-12-27 23:18:19] info: [groomRareTraitPerks] Assigned perk: Phoenix Whisperer to groom 46668
[2025-12-27 23:18:19] info: [groomRareTraitPerks] Perk revealed: Phoenix Whisperer for groom 46668
[2025-12-27 23:18:19] info: [GET] /api/ultra-rare-traits/definitions
[2025-12-27 23:18:19] info: [GET] /api/ultra-rare-traits/definitions - 200
[2025-12-27 23:18:19] info: [POST] /api/ultra-rare-traits/evaluate/94154
[2025-12-27 23:18:19] info: [auth] Authenticated user test-ultra-rare-user for POST /ultra-rare-traits/evaluate/94154
[2025-12-27 23:18:19] info: [auth] Authenticated user test-ultra-rare-user for POST /evaluate/94154
[2025-12-27 23:18:19] info: [ownership] Validated ownership: user test-ultra-rare-user owns horse 94154
[2025-12-27 23:18:19] info: [ultraRareTriggerEngine] Evaluating ultra-rare triggers for horse 94154
[2025-12-27 23:18:19] info: [ultraRareTriggerEngine] Ultra-rare trait triggered: Empathic Mirror for horse 94154
[2025-12-27 23:18:19] info: [ultraRareTriggerEngine] Evaluating exotic unlocks for horse 94154
[2025-12-27 23:18:19] error: [ultraRareTriggerEngine] Error evaluating Soulbonded conditions: Cannot read properties of undefined (reading 'map')
[2025-12-27 23:18:19] info: [POST] /api/ultra-rare-traits/evaluate/94154 - 200
[2025-12-27 23:18:19] info: [GET] /api/ultra-rare-traits/horse/94154
[2025-12-27 23:18:19] info: [auth] Authenticated user test-ultra-rare-user for GET /ultra-rare-traits/horse/94154
[2025-12-27 23:18:19] info: [auth] Authenticated user test-ultra-rare-user for GET /horse/94154
[2025-12-27 23:18:19] info: [ownership] Validated ownership: user test-ultra-rare-user owns horse 94154
[2025-12-27 23:18:19] info: [GET] /api/ultra-rare-traits/horse/94154 - 200
[2025-12-27 23:18:19] info: [POST] /api/ultra-rare-traits/groom/46668/assign-perks
[2025-12-27 23:18:19] info: [auth] Authenticated user test-ultra-rare-user for POST /ultra-rare-traits/groom/46668/assign-perks
[2025-12-27 23:18:19] info: [auth] Authenticated user test-ultra-rare-user for POST /groom/46668/assign-perks
[2025-12-27 23:18:19] info: [ownership] Validated ownership: user test-ultra-rare-user owns groom 46668
[2025-12-27 23:18:19] info: [groomRareTraitPerks] Assigning rare trait booster perks for groom 46668
[2025-12-27 23:18:19] info: [POST] /api/ultra-rare-traits/groom/46668/assign-perks - 200
[2025-12-27 23:18:19] info: [GET] /api/ultra-rare-traits/horse/94154
[2025-12-27 23:18:19] warn: [auth] Access token is required for GET /ultra-rare-traits/horse/94154 from ::ffff:127.0.0.1
[2025-12-27 23:18:19] info: [GET] /api/ultra-rare-traits/horse/94154 - 401
[2025-12-27 23:18:19] info: [GET] /api/ultra-rare-traits/horse/94155
[2025-12-27 23:18:19] info: [auth] Authenticated user test-ultra-rare-user for GET /ultra-rare-traits/horse/94155
[2025-12-27 23:18:19] info: [auth] Authenticated user test-ultra-rare-user for GET /horse/94155
[2025-12-27 23:18:19] warn: [ownership] horse 94155 not found or not owned by user test-ultra-rare-user
[2025-12-27 23:18:19] info: [GET] /api/ultra-rare-traits/horse/94155 - 404
PASS tests/ultraRareTraits.test.mjs
  Ultra-Rare & Exotic Traits System
    Trait Definitions System
      ‚àö should retrieve all ultra-rare trait definitions (2 ms)
      ‚àö should retrieve all exotic trait definitions (1 ms)
      ‚àö should get specific trait definition by name (1 ms)
    Trigger Evaluation Engine
      ‚àö should evaluate ultra-rare trait triggers with proper conditions (22 ms)
      ‚àö should evaluate exotic trait unlocks with complex conditions (11 ms)
    Groom Perk System
      ‚àö should assign rare trait booster perks to eligible grooms (6 ms)
      ‚àö should apply rare trait booster effects to probability calculations (3 ms)
    Mechanical Effects Integration
      ‚àö should apply ultra-rare stress effects correctly (2 ms)
      ‚àö should apply ultra-rare competition effects correctly (1 ms)
      ‚àö should check ultra-rare abilities correctly (2 ms)
    API Endpoints
      ‚àö GET /api/ultra-rare-traits/definitions should return all trait definitions (128 ms)
      ‚àö POST /api/ultra-rare-traits/evaluate/:horseId should evaluate traits for owned horse (79 ms)
      ‚àö GET /api/ultra-rare-traits/horse/:horseId should return horse ultra-rare traits (42 ms)
      ‚àö POST /api/ultra-rare-traits/groom/:groomId/assign-perks should assign perks to owned groom (40 ms)
      ‚àö should reject unauthorized access to horse traits (24 ms)
      ‚àö should reject access to non-owned horse (61 ms)

[2025-12-27 23:18:19] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:19] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:19] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:19] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:19] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 999 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 999
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 999 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 999 not found
[2025-12-27 23:18:20] error: [trainingController.canTrain] Error checking training eligibility: Horse ID must be a positive integer
[2025-12-27 23:18:20] error: [trainingController.canTrain] Error checking training eligibility: Discipline is required
[2025-12-27 23:18:20] error: [trainingController.canTrain] Error checking training eligibility: Horse ID is required
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:18:20] info: [trainingController.getTrainingStatus] Getting training status for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getLastTrainingDate] No training records found for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 1 across all disciplines
[2025-12-27 23:18:20] info: [trainingModel.getAnyRecentTraining] No training records found for horse 1
[2025-12-27 23:18:20] info: [trainingController.getTrainingStatus] Training status retrieved for horse 1: eligible=false
[2025-12-27 23:18:20] info: [trainingController.getTrainingStatus] Getting training status for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getLastTrainingDate] No training records found for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 1 across all disciplines
[2025-12-27 23:18:20] info: [trainingModel.getAnyRecentTraining] No training records found for horse 1
[2025-12-27 23:18:20] info: [trainingController.getTrainingStatus] Training status retrieved for horse 1: eligible=false
[2025-12-27 23:18:20] info: [trainingController.getTrainingStatus] Getting training status for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getLastTrainingDate] No training records found for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 1 across all disciplines
[2025-12-27 23:18:20] info: [trainingModel.getAnyRecentTraining] No training records found for horse 1
[2025-12-27 23:18:20] info: [trainingController.getTrainingStatus] Training status retrieved for horse 1: eligible=false
[2025-12-27 23:18:20] info: [trainingController.getTrainingStatus] Getting training status for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getLastTrainingDate] No training records found for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 1 across all disciplines
[2025-12-27 23:18:20] info: [trainingModel.getAnyRecentTraining] No training records found for horse 1
[2025-12-27 23:18:20] info: [trainingController.getTrainingStatus] Training status retrieved for horse 1: eligible=false
[2025-12-27 23:18:20] info: [trainingController.getTrainingStatus] Getting training status for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getLastTrainingDate] No training records found for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 1 across all disciplines
[2025-12-27 23:18:20] info: [trainingModel.getAnyRecentTraining] No training records found for horse 1
[2025-12-27 23:18:20] info: [trainingController.getTrainingStatus] Training status retrieved for horse 1: eligible=false
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Show Jumping
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Racing
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:18:20] info: [trainingController.getTrainableHorses] Getting trainable horses for user test-player-123
[2025-12-27 23:18:20] warn: [trainingController.getTrainableHorses] User test-player-123 not found
[2025-12-27 23:18:20] info: [trainingController.getTrainableHorses] Getting trainable horses for user test-player-123
[2025-12-27 23:18:20] warn: [trainingController.getTrainableHorses] User test-player-123 not found
[2025-12-27 23:18:20] info: [trainingController.getTrainableHorses] Getting trainable horses for user non-existent-player
[2025-12-27 23:18:20] warn: [trainingController.getTrainableHorses] User non-existent-player not found
[2025-12-27 23:18:20] info: [trainingController.getTrainableHorses] Getting trainable horses for user test-player-123
[2025-12-27 23:18:20] warn: [trainingController.getTrainableHorses] User test-player-123 not found
[2025-12-27 23:18:20] info: [trainingController.getTrainableHorses] Getting trainable horses for user test-player-123
[2025-12-27 23:18:20] warn: [trainingController.getTrainableHorses] User test-player-123 not found
[2025-12-27 23:18:20] info: [trainingController.getTrainableHorses] Getting trainable horses for user test-player-123
[2025-12-27 23:18:20] warn: [trainingController.getTrainableHorses] User test-player-123 not found
[2025-12-27 23:18:20] error: [trainingController.getTrainableHorses] Error getting trainable horses: User ID is required
[2025-12-27 23:18:20] error: [trainingController.getTrainableHorses] Error getting trainable horses: User ID is required
[2025-12-27 23:18:20] info: [trainingController.getTrainableHorses] Getting trainable horses for user test-player-123
[2025-12-27 23:18:20] warn: [trainingController.getTrainableHorses] User test-player-123 not found
[2025-12-27 23:18:20] info: [trainingController.trainRouteHandler] Training request for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:18:20] info: [trainingController.trainRouteHandler] Training request for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:18:20] info: [trainingController.trainRouteHandler] Training request for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:18:20] info: [trainingController.trainRouteHandler] Training request for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:18:20] info: [trainingController.trainRouteHandler] Training request for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:18:20] info: [trainingController.trainRouteHandler] Training request for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.trainHorse] Attempting to train horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingController.canTrain] Checking training eligibility for horse 1 in Dressage
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Getting age for horse 1
[2025-12-27 23:18:20] info: [trainingModel.getHorseAge] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.canTrain] Horse 1 not found
[2025-12-27 23:18:20] warn: [trainingController.trainHorse] Training rejected: Horse not found
FAIL tests/trainingController.test.mjs
  üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic
    canTrain
      √ó should return eligible true for horse that meets all requirements (66 ms)
      √ó should return eligible false for horse under 3 years old (8 ms)
      √ó should return eligible false for horse with recent training in any discipline (8 ms)
      √ó should return eligible true for horse with old training (8+ days ago) (8 ms)
      √ó should return eligible false for non-existent horse (7 ms)
      ‚àö should throw error for invalid horse ID (5 ms)
      ‚àö should throw error for missing discipline (3 ms)
      ‚àö should throw error for missing horse ID (2 ms)
      √ó should handle database errors gracefully (7 ms)
      √ó should calculate cooldown correctly for edge case (exactly 7 days) (8 ms)
    trainHorse
      √ó should successfully train eligible horse (9 ms)
      √ó should reject training for ineligible horse (under age) (9 ms)
      √ó should reject training for horse in cooldown (10 ms)
      √ó should handle training log errors gracefully (7 ms)
      √ó should award +5 XP after successful training (8 ms)
      √ó should handle XP system errors gracefully without breaking training (8 ms)
    getTrainingStatus
      √ó should return complete status for eligible horse with no training history (21 ms)
      √ó should return complete status for horse in active cooldown (20 ms)
      √ó should return complete status for horse with expired cooldown (17 ms)
      √ó should return status for ineligible horse (under age) (20 ms)
      √ó should handle database errors gracefully (17 ms)
    Integration scenarios
      √ó should handle different disciplines with global cooldown (11 ms)
      √ó should handle edge case of exactly 7 days cooldown (8 ms)
      √ó should handle complete training workflow (8 ms)
    getTrainableHorses
      √ó should return trainable horses for user with eligible horses (7 ms)
      ‚àö should return empty array for player with no horses (5 ms)
      ‚àö should return empty array for non-existent player (5 ms)
      √ó should filter out horses under 3 years old (6 ms)
      ‚àö should exclude horses with recent training (global cooldown) (6 ms)
      √ó should handle database errors gracefully for individual horses (6 ms)
      ‚àö should throw error for missing player ID (3 ms)
      √ó should handle player model errors (5 ms)
    trainRouteHandler
      √ó should return success response with correct format for successful training (11 ms)
      √ó should return failure response for ineligible horse (under age) (9 ms)
      √ó should return failure response for horse in cooldown (9 ms)
      √ó should handle missing discipline score gracefully (11 ms)
      √ó should handle server errors gracefully (8 ms)
      √ó should handle trait effects in training (9 ms)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should return eligible true for horse that meets all requirements

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
    -   "eligible": true,
    -   "reason": null,
    +   "eligible": false,
    +   "reason": "Horse not found",
      }

    [0m [90m  97 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m canTrain([35m1[39m[33m,[39m [32m'Dressage'[39m)[33m;[39m
     [90m  98 |[39m
    [31m[1m>[22m[39m[90m  99 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 100 |[39m         eligible[33m:[39m [36mtrue[39m[33m,[39m
     [90m 101 |[39m         reason[33m:[39m [36mnull[39m[33m,[39m
     [90m 102 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:99:22)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should return eligible false for horse under 3 years old

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 1

      Object {
        "eligible": false,
    -   "reason": "Horse is under age",
    +   "reason": "Horse not found",
      }

    [0m [90m 110 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m canTrain([35m1[39m[33m,[39m [32m'Dressage'[39m)[33m;[39m
     [90m 111 |[39m
    [31m[1m>[22m[39m[90m 112 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 113 |[39m         eligible[33m:[39m [36mfalse[39m[33m,[39m
     [90m 114 |[39m         reason[33m:[39m [32m'Horse is under age'[39m[33m,[39m
     [90m 115 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:112:22)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should return eligible false for horse with recent training in any discipline

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 1

      Object {
        "eligible": false,
    -   "reason": "Training cooldown active for this horse",
    +   "reason": "Horse not found",
      }

    [0m [90m 126 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m canTrain([35m1[39m[33m,[39m [32m'Dressage'[39m)[33m;[39m
     [90m 127 |[39m
    [31m[1m>[22m[39m[90m 128 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 129 |[39m         eligible[33m:[39m [36mfalse[39m[33m,[39m
     [90m 130 |[39m         reason[33m:[39m [32m'Training cooldown active for this horse'[39m[33m,[39m
     [90m 131 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:128:22)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should return eligible true for horse with old training (8+ days ago)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
    -   "eligible": true,
    -   "reason": null,
    +   "eligible": false,
    +   "reason": "Horse not found",
      }

    [0m [90m 142 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m canTrain([35m1[39m[33m,[39m [32m'Dressage'[39m)[33m;[39m
     [90m 143 |[39m
    [31m[1m>[22m[39m[90m 144 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 145 |[39m         eligible[33m:[39m [36mtrue[39m[33m,[39m
     [90m 146 |[39m         reason[33m:[39m [36mnull[39m[33m,[39m
     [90m 147 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:144:22)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should return eligible false for non-existent horse

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 999

    Number of calls: 0

    [0m [90m 159 |[39m         reason[33m:[39m [32m'Horse not found'[39m[33m,[39m
     [90m 160 |[39m       })[33m;[39m
    [31m[1m>[22m[39m[90m 161 |[39m       expect(mockGetHorseAge)[33m.[39mtoHaveBeenCalledWith([35m999[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 162 |[39m       expect(mockGetAnyRecentTraining)[33m.[39mnot[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 163 |[39m     })[33m;[39m
     [90m 164 |[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:161:31)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"eligible": false, "reason": "Horse not found"}

    [0m [90m 178 |[39m       mockGetHorseAge[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database connection failed'[39m))[33m;[39m
     [90m 179 |[39m
    [31m[1m>[22m[39m[90m 180 |[39m       [36mawait[39m expect(canTrain([35m1[39m[33m,[39m [32m'Dressage'[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Training eligibility check failed'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 181 |[39m     })[33m;[39m
     [90m 182 |[39m
     [90m 183 |[39m     it([32m'should calculate cooldown correctly for edge case (exactly 7 days)'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/trainingController.test.mjs:180:13)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should calculate cooldown correctly for edge case (exactly 7 days)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
    -   "eligible": true,
    -   "reason": null,
    +   "eligible": false,
    +   "reason": "Horse not found",
      }

    [0m [90m 190 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m canTrain([35m1[39m[33m,[39m [32m'Dressage'[39m)[33m;[39m
     [90m 191 |[39m
    [31m[1m>[22m[39m[90m 192 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 193 |[39m         eligible[33m:[39m [36mtrue[39m[33m,[39m
     [90m 194 |[39m         reason[33m:[39m [36mnull[39m[33m,[39m
     [90m 195 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:192:22)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainHorse ‚Ä∫ should successfully train eligible horse

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 246 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m trainHorse([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 247 |[39m
    [31m[1m>[22m[39m[90m 248 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 249 |[39m       expect(result[33m.[39mmessage)[33m.[39mtoContain([32m'Horse trained successfully in Racing. +5 added.'[39m)[33m;[39m
     [90m 250 |[39m       expect(result[33m.[39mupdatedHorse[33m.[39mname)[33m.[39mtoBe([32m'Test Horse'[39m)[33m;[39m
     [90m 251 |[39m       expect(result[33m.[39mnextEligible)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:248:30)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainHorse ‚Ä∫ should reject training for ineligible horse (under age)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
    -   "message": "Training not allowed: Horse is under age",
    +   "message": "Training not allowed: Horse not found",
        "nextEligible": null,
    -   "reason": "Horse is under age",
    +   "reason": "Horse not found",
        "success": false,
        "updatedHorse": null,
      }

    [0m [90m 262 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m trainHorse([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 263 |[39m
    [31m[1m>[22m[39m[90m 264 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 265 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 266 |[39m         reason[33m:[39m [32m'Horse is under age'[39m[33m,[39m
     [90m 267 |[39m         updatedHorse[33m:[39m [36mnull[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:264:22)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainHorse ‚Ä∫ should reject training for horse in cooldown

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
    -   "message": "Training not allowed: Training cooldown active for this horse",
    +   "message": "Training not allowed: Horse not found",
        "nextEligible": null,
    -   "reason": "Training cooldown active for this horse",
    +   "reason": "Horse not found",
        "success": false,
        "updatedHorse": null,
      }

    [0m [90m 279 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m trainHorse([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 280 |[39m
    [31m[1m>[22m[39m[90m 281 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 282 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 283 |[39m         reason[33m:[39m [32m'Training cooldown active for this horse'[39m[33m,[39m
     [90m 284 |[39m         updatedHorse[33m:[39m [36mnull[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:281:22)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainHorse ‚Ä∫ should handle training log errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"message": "Training not allowed: Horse not found", "nextEligible": null, "reason": "Horse not found", "success": false, "updatedHorse": null}

    [0m [90m 299 |[39m       mockLogTrainingSession[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Failed to log training'[39m))[33m;[39m
     [90m 300 |[39m
    [31m[1m>[22m[39m[90m 301 |[39m       [36mawait[39m expect(trainHorse([35m1[39m[33m,[39m [32m'Racing'[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Training failed: Failed to log training'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 302 |[39m     })[33m;[39m
     [90m 303 |[39m
     [90m 304 |[39m     it([32m'should award +5 XP after successful training'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/trainingController.test.mjs:301:13)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainHorse ‚Ä∫ should award +5 XP after successful training

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 344 |[39m
     [90m 345 |[39m       [90m// Verify training success[39m
    [31m[1m>[22m[39m[90m 346 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 347 |[39m       expect(result[33m.[39mmessage)[33m.[39mtoContain([32m'Horse trained successfully in Dressage. +5 added.'[39m)[33m;[39m
     [90m 348 |[39m
     [90m 349 |[39m       [90m// Verify XP award system[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:346:30)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainHorse ‚Ä∫ should handle XP system errors gracefully without breaking training

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 386 |[39m
     [90m 387 |[39m       [90m// Training should still succeed despite XP error[39m
    [31m[1m>[22m[39m[90m 388 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 389 |[39m       expect(result[33m.[39mmessage)[33m.[39mtoContain([32m'Horse trained successfully in Racing. +5 added.'[39m)[33m;[39m
     [90m 390 |[39m       expect(result[33m.[39mupdatedHorse[33m.[39mname)[33m.[39mtoBe([32m'Error Test Horse'[39m)[33m;[39m
     [90m 391 |[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:388:30)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainingStatus ‚Ä∫ should return complete status for eligible horse with no training history

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 3

      Object {
        "cooldown": null,
    -   "eligible": true,
    -   "horseAge": 5,
    +   "eligible": false,
    +   "horseAge": null,
        "lastTrainingDate": null,
    -   "reason": null,
    +   "reason": "Horse not found",
      }

    [0m [90m 409 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getTrainingStatus([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 410 |[39m
    [31m[1m>[22m[39m[90m 411 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 412 |[39m         eligible[33m:[39m [36mtrue[39m[33m,[39m
     [90m 413 |[39m         reason[33m:[39m [36mnull[39m[33m,[39m
     [90m 414 |[39m         horseAge[33m:[39m [35m5[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:411:22)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainingStatus ‚Ä∫ should return complete status for horse in active cooldown

    expect(received).toBe(expected) // Object.is equality

    Expected: "Training cooldown active for this horse"
    Received: "Horse not found"

    [0m [90m 427 |[39m
     [90m 428 |[39m       expect(result[33m.[39meligible)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 429 |[39m       expect(result[33m.[39mreason)[33m.[39mtoBe([32m'Training cooldown active for this horse'[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 430 |[39m       expect(result[33m.[39mhorseAge)[33m.[39mtoBe([35m4[39m)[33m;[39m
     [90m 431 |[39m       expect(result[33m.[39mlastTrainingDate)[33m.[39mtoBe([36mnull[39m)[33m;[39m [90m// Still null for this specific discipline[39m
     [90m 432 |[39m       expect(result[33m.[39mcooldown[33m.[39mactive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:429:29)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainingStatus ‚Ä∫ should return complete status for horse with expired cooldown

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 443 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getTrainingStatus([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 444 |[39m
    [31m[1m>[22m[39m[90m 445 |[39m       expect(result[33m.[39meligible)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 446 |[39m       expect(result[33m.[39mreason)[33m.[39mtoBe([36mnull[39m)[33m;[39m
     [90m 447 |[39m       expect(result[33m.[39mhorseAge)[33m.[39mtoBe([35m4[39m)[33m;[39m
     [90m 448 |[39m       expect(result[33m.[39mlastTrainingDate)[33m.[39mtoEqual(eightDaysAgo)[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:445:31)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainingStatus ‚Ä∫ should return status for ineligible horse (under age)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
        "cooldown": null,
        "eligible": false,
    -   "horseAge": 2,
    +   "horseAge": null,
        "lastTrainingDate": null,
    -   "reason": "Horse is under age",
    +   "reason": "Horse not found",
      }

    [0m [90m 458 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getTrainingStatus([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 459 |[39m
    [31m[1m>[22m[39m[90m 460 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 461 |[39m         eligible[33m:[39m [36mfalse[39m[33m,[39m
     [90m 462 |[39m         reason[33m:[39m [32m'Horse is under age'[39m[33m,[39m
     [90m 463 |[39m         horseAge[33m:[39m [35m2[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:460:22)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainingStatus ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"cooldown": null, "eligible": false, "horseAge": null, "lastTrainingDate": null, "reason": "Horse not found"}

    [0m [90m 470 |[39m       mockGetHorseAge[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database error'[39m))[33m;[39m
     [90m 471 |[39m
    [31m[1m>[22m[39m[90m 472 |[39m       [36mawait[39m expect(getTrainingStatus([35m1[39m[33m,[39m [32m'Racing'[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Training status check failed'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 473 |[39m     })[33m;[39m
     [90m 474 |[39m   })[33m;[39m
     [90m 475 |[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/trainingController.test.mjs:472:13)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ Integration scenarios ‚Ä∫ should handle different disciplines with global cooldown

    expect(received).toBe(expected) // Object.is equality

    Expected: "Training cooldown active for this horse"
    Received: "Horse not found"

    [0m [90m 491 |[39m       [90m// Both should be blocked due to global cooldown[39m
     [90m 492 |[39m       expect(racingResult[33m.[39meligible)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 493 |[39m       expect(racingResult[33m.[39mreason)[33m.[39mtoBe([32m'Training cooldown active for this horse'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 494 |[39m
     [90m 495 |[39m       expect(jumpingResult[33m.[39meligible)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 496 |[39m       expect(jumpingResult[33m.[39mreason)[33m.[39mtoBe([32m'Training cooldown active for this horse'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:493:35)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ Integration scenarios ‚Ä∫ should handle edge case of exactly 7 days cooldown

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 504 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m canTrain([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 505 |[39m
    [31m[1m>[22m[39m[90m 506 |[39m       expect(result[33m.[39meligible)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 507 |[39m       expect(result[33m.[39mreason)[33m.[39mtoBe([36mnull[39m)[33m;[39m
     [90m 508 |[39m     })[33m;[39m
     [90m 509 |[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:506:31)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ Integration scenarios ‚Ä∫ should handle complete training workflow

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 542 |[39m
     [90m 543 |[39m       [36mconst[39m trainResult [33m=[39m [36mawait[39m trainHorse([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 544 |[39m       expect(trainResult[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 545 |[39m
     [90m 546 |[39m       [90m// Now mock that the horse has recently trained[39m
     [90m 547 |[39m       [36mconst[39m justNow [33m=[39m [36mnew[39m [33mDate[39m()[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:544:35)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainableHorses ‚Ä∫ should return trainable horses for user with eligible horses

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 0
    Received array:  []

    [0m [90m 577 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getTrainableHorses(playerId)[33m;[39m
     [90m 578 |[39m
    [31m[1m>[22m[39m[90m 579 |[39m       expect(result)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 580 |[39m       expect(result[[35m0[39m])[33m.[39mtoEqual({
     [90m 581 |[39m         horseId[33m:[39m [35m1[39m[33m,[39m
     [90m 582 |[39m         name[33m:[39m [32m'Thunder'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:579:22)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainableHorses ‚Ä∫ should filter out horses under 3 years old

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

    [0m [90m 630 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getTrainableHorses(playerId)[33m;[39m
     [90m 631 |[39m
    [31m[1m>[22m[39m[90m 632 |[39m       expect(result)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 633 |[39m       expect(result[[35m0[39m][33m.[39mname)[33m.[39mtoBe([32m'Adult Horse'[39m)[33m;[39m
     [90m 634 |[39m       expect(result[[35m0[39m][33m.[39mage)[33m.[39mtoBe([35m4[39m)[33m;[39m
     [90m 635 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:632:22)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainableHorses ‚Ä∫ should handle database errors gracefully for individual horses

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

    [0m [90m 668 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getTrainableHorses(playerId)[33m;[39m
     [90m 669 |[39m
    [31m[1m>[22m[39m[90m 670 |[39m       expect(result)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 671 |[39m       expect(result[[35m0[39m][33m.[39mname)[33m.[39mtoBe([32m'Good Horse'[39m)[33m;[39m
     [90m 672 |[39m       expect(result[[35m0[39m][33m.[39mtrainableDisciplines)[33m.[39mtoEqual([
     [90m 673 |[39m         [32m'Racing'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:670:22)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainableHorses ‚Ä∫ should handle player model errors

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: []

    [0m [90m 688 |[39m       mockGetUserWithHorses[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Player database error'[39m))[33m;[39m
     [90m 689 |[39m
    [31m[1m>[22m[39m[90m 690 |[39m       [36mawait[39m expect(getTrainableHorses(playerId))[33m.[39mrejects[33m.[39mtoThrow(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 691 |[39m         [32m'Failed to get trainable horses: Player database error'[39m[33m,[39m
     [90m 692 |[39m       )[33m;[39m
     [90m 693 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/trainingController.test.mjs:690:13)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainRouteHandler ‚Ä∫ should return success response with correct format for successful training

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Nova trained in Dressage. +5 added.",
    -   "nextEligibleDate": Any<String>,
    -   "success": true,
    -   "traitEffects": ObjectContaining {
    -     "appliedTraits": Array [],
    -     "scoreModifier": 0,
    -     "xpModifier": 0,
    -   },
    -   "updatedScore": 25,
    +   "message": "Training not allowed: Horse not found",
    +   "success": false,
      },

    Number of calls: 1

    [0m [90m 747 |[39m       [36mawait[39m trainRouteHandler(mockReq[33m,[39m mockRes)[33m;[39m
     [90m 748 |[39m
    [31m[1m>[22m[39m[90m 749 |[39m       expect(mockRes[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 750 |[39m         success[33m:[39m [36mtrue[39m[33m,[39m
     [90m 751 |[39m         message[33m:[39m [32m'Nova trained in Dressage. +5 added.'[39m[33m,[39m
     [90m 752 |[39m         updatedScore[33m:[39m [35m25[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:749:28)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainRouteHandler ‚Ä∫ should return failure response for ineligible horse (under age)

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Training not allowed: Horse is under age",
    +   "message": "Training not allowed: Horse not found",
        "success": false,
      },

    Number of calls: 1

    [0m [90m 768 |[39m
     [90m 769 |[39m       expect(mockRes[33m.[39mstatus)[33m.[39mtoHaveBeenCalledWith([35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 770 |[39m       expect(mockRes[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 771 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 772 |[39m         message[33m:[39m [32m'Training not allowed: Horse is under age'[39m[33m,[39m
     [90m 773 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:770:28)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainRouteHandler ‚Ä∫ should return failure response for horse in cooldown

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Training not allowed: Training cooldown active for this horse",
    +   "message": "Training not allowed: Horse not found",
        "success": false,
      },

    Number of calls: 1

    [0m [90m 783 |[39m
     [90m 784 |[39m       expect(mockRes[33m.[39mstatus)[33m.[39mtoHaveBeenCalledWith([35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 785 |[39m       expect(mockRes[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 786 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 787 |[39m         message[33m:[39m [32m'Training not allowed: Training cooldown active for this horse'[39m[33m,[39m
     [90m 788 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:785:28)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainRouteHandler ‚Ä∫ should handle missing discipline score gracefully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Nova trained in Dressage. +5 added.",
    -   "nextEligibleDate": Any<String>,
    -   "success": true,
    -   "traitEffects": ObjectContaining {
    -     "appliedTraits": Array [],
    -     "scoreModifier": 0,
    -     "xpModifier": 0,
    -   },
    -   "updatedScore": 0,
    +   "message": "Training not allowed: Horse not found",
    +   "success": false,
      },

    Number of calls: 1

    [0m [90m 825 |[39m       [36mawait[39m trainRouteHandler(mockReq[33m,[39m mockRes)[33m;[39m
     [90m 826 |[39m
    [31m[1m>[22m[39m[90m 827 |[39m       expect(mockRes[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 828 |[39m         success[33m:[39m [36mtrue[39m[33m,[39m
     [90m 829 |[39m         message[33m:[39m [32m'Nova trained in Dressage. +5 added.'[39m[33m,[39m
     [90m 830 |[39m         updatedScore[33m:[39m [35m0[39m[33m,[39m [90m// Should default to 0 when no scores exist[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:827:28)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainRouteHandler ‚Ä∫ should handle server errors gracefully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 500
    Received: 400

    Number of calls: 1

    [0m [90m 844 |[39m       [36mawait[39m trainRouteHandler(mockReq[33m,[39m mockRes)[33m;[39m
     [90m 845 |[39m
    [31m[1m>[22m[39m[90m 846 |[39m       expect(mockRes[33m.[39mstatus)[33m.[39mtoHaveBeenCalledWith([35m500[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 847 |[39m       expect(mockRes[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m 848 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 849 |[39m         message[33m:[39m [32m'Failed to train horse'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:846:30)

  ‚óè üèãÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainRouteHandler ‚Ä∫ should handle trait effects in training

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Intelligent Horse trained in Dressage. +6 added.",
    -   "nextEligibleDate": Any<String>,
    -   "success": true,
    -   "traitEffects": ObjectContaining {
    -     "appliedTraits": Array [
    -       "intelligent",
    -     ],
    -     "scoreModifier": 1,
    -     "xpModifier": 1,
    -   },
    -   "updatedScore": 6,
    +   "message": "Training not allowed: Horse not found",
    +   "success": false,
      },

    Number of calls: 1

    [0m [90m 889 |[39m       [36mawait[39m trainRouteHandler(mockReq[33m,[39m mockRes)[33m;[39m
     [90m 890 |[39m
    [31m[1m>[22m[39m[90m 891 |[39m       expect(mockRes[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 892 |[39m         success[33m:[39m [36mtrue[39m[33m,[39m
     [90m 893 |[39m         message[33m:[39m [32m'Intelligent Horse trained in Dressage. +6 added.'[39m[33m,[39m
     [90m 894 |[39m         updatedScore[33m:[39m [35m6[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:891:28)

[2025-12-27 23:18:20] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:20] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:20] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:20] info: [seed] Environment loaded successfully
[2025-12-27 23:18:20] info: [seed] Found existing breed: TestSeed_Thoroughbred (ID: 20906)
[2025-12-27 23:18:20] info: [seed] Breed "TestSeed_NewArabian" not found, creating new one.
[2025-12-27 23:18:20] info: [seed] Created breed: TestSeed_NewArabian (ID: 20907)
[2025-12-27 23:18:20] warn: [seed] Breed name is undefined or null. Skipping breed creation/connection.
[2025-12-27 23:18:20] info: [seed] Breed "TestSeed_InvalidBreed" not found, creating new one.
[2025-12-27 23:18:20] info: [seed] Created breed: TestSeed_InvalidBreed (ID: 20908)
[2025-12-27 23:18:20] info: [seed] Ensured User owner1@example.com exists.
[2025-12-27 23:18:20] info: [seed] Ensured User owner2@example.com exists.
[2025-12-27 23:18:20] info: [seed] Ensured Stable ID 1 exists.
[2025-12-27 23:18:20] info: [seed] Ensured Stable ID 2 exists.
[2025-12-27 23:18:20] info: [seed] Ensured User owner1@example.com exists.
[2025-12-27 23:18:20] info: [seed] Ensured User owner2@example.com exists.
[2025-12-27 23:18:20] info: [seed] Ensured Stable ID 1 exists.
[2025-12-27 23:18:20] info: [seed] Ensured Stable ID 2 exists.
[2025-12-27 23:18:20] info: [seed] Ensured User owner1@example.com exists.
[2025-12-27 23:18:20] info: [seed] Ensured User owner2@example.com exists.
[2025-12-27 23:18:20] info: [seed] Ensured Stable ID 1 exists.
[2025-12-27 23:18:20] info: [seed] Ensured Stable ID 2 exists.
[2025-12-27 23:18:20] info: [seed] Ensured User owner1@example.com exists.
[2025-12-27 23:18:20] info: [seed] Ensured User owner2@example.com exists.
[2025-12-27 23:18:20] info: [seed] Ensured Stable ID 1 exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 2 exists.
[2025-12-27 23:18:21] info: [seed] Ensured User owner1@example.com exists.
[2025-12-27 23:18:21] info: [seed] Ensured User owner2@example.com exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 1 exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 2 exists.
[2025-12-27 23:18:21] warn: No users provided for horse seeding. Skipping horse creation.
[2025-12-27 23:18:21] info: [seed] Ensured User owner1@example.com exists.
[2025-12-27 23:18:21] info: [seed] Ensured User owner2@example.com exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 1 exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 2 exists.
[2025-12-27 23:18:21] info: Found existing breed: Thoroughbred
[2025-12-27 23:18:21] info: Found existing breed: Arabian
[2025-12-27 23:18:21] info: Found existing breed: Quarter Horse
[2025-12-27 23:18:21] info: Found existing breed: Akhal-Teke
[2025-12-27 23:18:21] info: Created horse: Lightning Bolt for user ID: e64625dd-9602-4a16-9e9a-07c476260d88
[2025-12-27 23:18:21] info: Created horse: Desert Rose for user ID: e64625dd-9602-4a16-9e9a-07c476260d88
[2025-12-27 23:18:21] info: [seed] Ensured User owner1@example.com exists.
[2025-12-27 23:18:21] info: [seed] Ensured User owner2@example.com exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 1 exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 2 exists.
[2025-12-27 23:18:21] info: Found existing breed: Thoroughbred
[2025-12-27 23:18:21] info: Found existing breed: Arabian
[2025-12-27 23:18:21] info: Found existing breed: Quarter Horse
[2025-12-27 23:18:21] info: Found existing breed: Akhal-Teke
[2025-12-27 23:18:21] info: Created horse: Lightning Bolt for user ID: e64625dd-9602-4a16-9e9a-07c476260d88
[2025-12-27 23:18:21] info: Created horse: Desert Rose for user ID: e64625dd-9602-4a16-9e9a-07c476260d88
[2025-12-27 23:18:21] info: [seed] Ensured User owner1@example.com exists.
[2025-12-27 23:18:21] info: [seed] Ensured User owner2@example.com exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 1 exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 2 exists.
[2025-12-27 23:18:21] info: Found existing breed: Thoroughbred
[2025-12-27 23:18:21] info: Found existing breed: Arabian
[2025-12-27 23:18:21] info: Found existing breed: Quarter Horse
[2025-12-27 23:18:21] info: Found existing breed: Akhal-Teke
[2025-12-27 23:18:21] info: Created horse: Lightning Bolt for user ID: e64625dd-9602-4a16-9e9a-07c476260d88
[2025-12-27 23:18:21] info: Created horse: Desert Rose for user ID: e64625dd-9602-4a16-9e9a-07c476260d88
[2025-12-27 23:18:21] info: [seed] Ensured User owner1@example.com exists.
[2025-12-27 23:18:21] info: [seed] Ensured User owner2@example.com exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 1 exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 2 exists.
[2025-12-27 23:18:21] info: Found existing breed: Thoroughbred
[2025-12-27 23:18:21] info: Found existing breed: Arabian
[2025-12-27 23:18:21] info: Found existing breed: Quarter Horse
[2025-12-27 23:18:21] info: Found existing breed: Akhal-Teke
[2025-12-27 23:18:21] info: Created horse: Lightning Bolt for user ID: e64625dd-9602-4a16-9e9a-07c476260d88
[2025-12-27 23:18:21] info: Created horse: Desert Rose for user ID: e64625dd-9602-4a16-9e9a-07c476260d88
[2025-12-27 23:18:21] info: [seed] Ensured User owner1@example.com exists.
[2025-12-27 23:18:21] info: [seed] Ensured User owner2@example.com exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 1 exists.
[2025-12-27 23:18:21] info: [seed] Ensured Stable ID 2 exists.
[2025-12-27 23:18:21] info: Found existing breed: Thoroughbred
[2025-12-27 23:18:21] info: Found existing breed: Arabian
[2025-12-27 23:18:21] info: Found existing breed: Quarter Horse
[2025-12-27 23:18:21] info: Found existing breed: Akhal-Teke
[2025-12-27 23:18:21] info: Created horse: Lightning Bolt for user ID: e64625dd-9602-4a16-9e9a-07c476260d88
[2025-12-27 23:18:21] info: Created horse: Desert Rose for user ID: e64625dd-9602-4a16-9e9a-07c476260d88
FAIL seed/horseSeed.test.mjs
  Horse Seed Integration Tests
    checkHorseExists - Real Database Operations
      ‚àö should return true if horse exists in database (32 ms)
      ‚àö should return false if horse does not exist in database (3 ms)
      ‚àö should handle database errors gracefully (4 ms)
    findOrCreateBreed - Real Database Operations
      √ó should return existing breed if found in database (8 ms)
      √ó should create new breed if not found in database (5 ms)
      √ó should return null for undefined breed name (2 ms)
      ‚àö should handle database errors gracefully (7 ms)
    ensureReferencedRecordsExist - Real Database Operations
      √ó should create users and stables if they do not exist in database (27 ms)
      √ó should update existing users and stables if they already exist (25 ms)
      ‚àö should handle database constraints gracefully (15 ms)
    seedHorses - Real Database Operations
      √ó should log a warning and return an empty array if no users are provided (14 ms)
      √ó should create breeds and horses for the provided user in database (46 ms)
      ‚àö should handle database constraints and validation errors gracefully (35 ms)
      ‚àö should handle edge cases and maintain data integrity (44 ms)
    Complete Horse Seeding Integration Test
      √ó should execute complete seeding workflow with real database operations (34 ms)
      ‚àö should maintain database integrity throughout complete seeding process (41 ms)

  ‚óè Horse Seed Integration Tests ‚Ä∫ findOrCreateBreed - Real Database Operations ‚Ä∫ should return existing breed if found in database

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[seed] Found existing breed: TestSeed_Thoroughbred (ID: 20906)"

    Number of calls: 0

    [0m [90m 152 |[39m       expect(result[33m.[39mname)[33m.[39mtoBe([32m'TestSeed_Thoroughbred'[39m)[33m;[39m
     [90m 153 |[39m       expect(result[33m.[39mid)[33m.[39mtoBe(testBreed[33m.[39mid)[33m;[39m
    [31m[1m>[22m[39m[90m 154 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 155 |[39m         [32m`[seed] Found existing breed: TestSeed_Thoroughbred (ID: ${testBreed.id})`[39m[33m,[39m
     [90m 156 |[39m       )[33m;[39m
     [90m 157 |[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:154:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ findOrCreateBreed - Real Database Operations ‚Ä∫ should create new breed if not found in database

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[seed] Breed \"TestSeed_NewArabian\" not found, creating new one."

    Number of calls: 0

    [0m [90m 166 |[39m       expect(result[33m.[39mname)[33m.[39mtoBe([32m'TestSeed_NewArabian'[39m)[33m;[39m
     [90m 167 |[39m       expect(result[33m.[39mdescription)[33m.[39mtoBe([32m'Seed-created TestSeed_NewArabian'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 168 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Breed "TestSeed_NewArabian" not found, creating new one.'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 169 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m`[seed] Created breed: TestSeed_NewArabian (ID: ${result.id})`[39m)[33m;[39m
     [90m 170 |[39m
     [90m 171 |[39m       [90m// Verify it was actually created in database[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:168:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ findOrCreateBreed - Real Database Operations ‚Ä∫ should return null for undefined breed name

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[seed] Breed name is undefined or null. Skipping breed creation/connection."

    Number of calls: 0

    [0m [90m 182 |[39m
     [90m 183 |[39m       expect(result)[33m.[39mtoBeNull()[33m;[39m
    [31m[1m>[22m[39m[90m 184 |[39m       expect(mockLogger[33m.[39mwarn)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 185 |[39m         [32m'[seed] Breed name is undefined or null. Skipping breed creation/connection.'[39m[33m,[39m
     [90m 186 |[39m       )[33m;[39m
     [90m 187 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:184:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ ensureReferencedRecordsExist - Real Database Operations ‚Ä∫ should create users and stables if they do not exist in database

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[seed] Ensured User owner1@example.com exists."

    Number of calls: 0

    [0m [90m 220 |[39m       expect(stable2[33m.[39mname)[33m.[39mtoBe([32m'Second Stable'[39m)[33m;[39m
     [90m 221 |[39m
    [31m[1m>[22m[39m[90m 222 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured User owner1@example.com exists.'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 223 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured User owner2@example.com exists.'[39m)[33m;[39m
     [90m 224 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured Stable ID 1 exists.'[39m)[33m;[39m
     [90m 225 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured Stable ID 2 exists.'[39m)[33m;[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:222:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ ensureReferencedRecordsExist - Real Database Operations ‚Ä∫ should update existing users and stables if they already exist

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[seed] Ensured User owner1@example.com exists."

    Number of calls: 0

    [0m [90m 242 |[39m       expect(user2)[33m.[39mtoBeTruthy()[33m;[39m
     [90m 243 |[39m
    [31m[1m>[22m[39m[90m 244 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured User owner1@example.com exists.'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 245 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured User owner2@example.com exists.'[39m)[33m;[39m
     [90m 246 |[39m     })[33m;[39m
     [90m 247 |[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:244:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ seedHorses - Real Database Operations ‚Ä∫ should log a warning and return an empty array if no users are provided

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "No users provided for horse seeding. Skipping horse creation."

    Number of calls: 0

    [0m [90m 265 |[39m     it([32m'should log a warning and return an empty array if no users are provided'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 266 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m seedHorses(prisma[33m,[39m [])[33m;[39m
    [31m[1m>[22m[39m[90m 267 |[39m       expect(mockLogger[33m.[39mwarn)[33m.[39mtoHaveBeenCalledWith([32m'No users provided for horse seeding. Skipping horse creation.'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 268 |[39m       expect(result)[33m.[39mtoEqual([])[33m;[39m
     [90m 269 |[39m     })[33m;[39m
     [90m 270 |[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:267:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ seedHorses - Real Database Operations ‚Ä∫ should create breeds and horses for the provided user in database

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "Created horse:"

    Number of calls: 0

    [0m [90m 302 |[39m
     [90m 303 |[39m       [90m// Verify logging occurred[39m
    [31m[1m>[22m[39m[90m 304 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 305 |[39m         expect[33m.[39mstringContaining([32m'Created horse:'[39m)[33m,[39m
     [90m 306 |[39m       )[33m;[39m
     [90m 307 |[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:304:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ Complete Horse Seeding Integration Test ‚Ä∫ should execute complete seeding workflow with real database operations

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[seed] Ensured User owner1@example.com exists."

    Number of calls: 0

    [0m [90m 386 |[39m
     [90m 387 |[39m       [90m// Verify logging occurred[39m
    [31m[1m>[22m[39m[90m 388 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured User owner1@example.com exists.'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 389 |[39m
     [90m 390 |[39m       [36mif[39m (result[33m.[39mlength [33m>[39m [35m0[39m) {
     [90m 391 |[39m         expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:388:31)

[2025-12-27 23:18:21] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:21] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:21] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:21] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:21] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:21] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:21] error: [resultModel.saveResult] Database error: PrismaClientKnownRequestError: 
Invalid `prisma.competitionResult.create()` invocation:


Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`
    at Zn.handleRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:7459)
    at Zn.handleAndLogRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6784)
    at Zn.request (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6491)
    at l (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:130:9778)
    at saveResult (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\models\resultModel.mjs:101:16)
    at Object.<anonymous> (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\tests\resultModel.test.mjs:105:22) {
  [stack]: [Getter/Setter],
  [message]: '\n' +
    'Invalid `prisma.competitionResult.create()` invocation:\n' +
    '\n' +
    '\n' +
    'Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`',
  code: 'P2003',
  meta: {
    modelName: 'CompetitionResult',
    constraint: 'competition_results_horseId_fkey'
  },
  clientVersion: '6.8.2',
  [batchRequestIdx]: undefined,
  name: 'PrismaClientKnownRequestError',
  [Symbol(Symbol.toStringTag)]: [Getter]
}
[2025-12-27 23:18:21] error: [resultModel.saveResult] Database error: PrismaClientKnownRequestError: 
Invalid `prisma.competitionResult.create()` invocation:


Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`
    at Zn.handleRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:7459)
    at Zn.handleAndLogRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6784)
    at Zn.request (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6491)
    at l (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:130:9778)
    at saveResult (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\models\resultModel.mjs:101:16)
    at Object.<anonymous> (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\tests\resultModel.test.mjs:146:22) {
  [stack]: [Getter/Setter],
  [message]: '\n' +
    'Invalid `prisma.competitionResult.create()` invocation:\n' +
    '\n' +
    '\n' +
    'Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`',
  code: 'P2003',
  meta: {
    modelName: 'CompetitionResult',
    constraint: 'competition_results_horseId_fkey'
  },
  clientVersion: '6.8.2',
  [batchRequestIdx]: undefined,
  name: 'PrismaClientKnownRequestError',
  [Symbol(Symbol.toStringTag)]: [Getter]
}
[2025-12-27 23:18:21] error: [resultModel.saveResult] Database error: PrismaClientKnownRequestError: 
Invalid `prisma.competitionResult.create()` invocation:


Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`
    at Zn.handleRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:7459)
    at Zn.handleAndLogRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6784)
    at Zn.request (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6491)
    at l (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:130:9778)
    at saveResult (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\models\resultModel.mjs:101:16)
    at Object.<anonymous> (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\tests\resultModel.test.mjs:329:7) {
  [stack]: [Getter/Setter],
  [message]: '\n' +
    'Invalid `prisma.competitionResult.create()` invocation:\n' +
    '\n' +
    '\n' +
    'Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`',
  code: 'P2003',
  meta: {
    modelName: 'CompetitionResult',
    constraint: 'competition_results_horseId_fkey'
  },
  clientVersion: '6.8.2',
  [batchRequestIdx]: undefined,
  name: 'PrismaClientKnownRequestError',
  [Symbol(Symbol.toStringTag)]: [Getter]
}
[2025-12-27 23:18:21] error: [resultModel.saveResult] Database error: PrismaClientKnownRequestError: 
Invalid `prisma.competitionResult.create()` invocation:


Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`
    at Zn.handleRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:7459)
    at Zn.handleAndLogRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6784)
    at Zn.request (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6491)
    at l (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:130:9778)
    at saveResult (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\models\resultModel.mjs:101:16)
    at Object.<anonymous> (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\tests\resultModel.test.mjs:352:7) {
  [stack]: [Getter/Setter],
  [message]: '\n' +
    'Invalid `prisma.competitionResult.create()` invocation:\n' +
    '\n' +
    '\n' +
    'Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`',
  code: 'P2003',
  meta: {
    modelName: 'CompetitionResult',
    constraint: 'competition_results_horseId_fkey'
  },
  clientVersion: '6.8.2',
  [batchRequestIdx]: undefined,
  name: 'PrismaClientKnownRequestError',
  [Symbol(Symbol.toStringTag)]: [Getter]
}
[2025-12-27 23:18:21] error: [resultModel.saveResult] Database error: PrismaClientKnownRequestError: 
Invalid `prisma.competitionResult.create()` invocation:


Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`
    at Zn.handleRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:7459)
    at Zn.handleAndLogRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6784)
    at Zn.request (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6491)
    at l (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:130:9778)
    at saveResult (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\models\resultModel.mjs:101:16)
    at Object.<anonymous> (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\tests\resultModel.test.mjs:390:22) {
  [stack]: [Getter/Setter],
  [message]: '\n' +
    'Invalid `prisma.competitionResult.create()` invocation:\n' +
    '\n' +
    '\n' +
    'Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`',
  code: 'P2003',
  meta: {
    modelName: 'CompetitionResult',
    constraint: 'competition_results_horseId_fkey'
  },
  clientVersion: '6.8.2',
  [batchRequestIdx]: undefined,
  name: 'PrismaClientKnownRequestError',
  [Symbol(Symbol.toStringTag)]: [Getter]
}
[2025-12-27 23:18:21] error: [resultModel.saveResult] Database error: PrismaClientKnownRequestError: 
Invalid `prisma.competitionResult.create()` invocation:


Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`
    at Zn.handleRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:7459)
    at Zn.handleAndLogRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6784)
    at Zn.request (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6491)
    at l (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:130:9778)
    at saveResult (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\models\resultModel.mjs:101:16)
    at Object.<anonymous> (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\tests\resultModel.test.mjs:447:22) {
  [stack]: [Getter/Setter],
  [message]: '\n' +
    'Invalid `prisma.competitionResult.create()` invocation:\n' +
    '\n' +
    '\n' +
    'Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`',
  code: 'P2003',
  meta: {
    modelName: 'CompetitionResult',
    constraint: 'competition_results_horseId_fkey'
  },
  clientVersion: '6.8.2',
  [batchRequestIdx]: undefined,
  name: 'PrismaClientKnownRequestError',
  [Symbol(Symbol.toStringTag)]: [Getter]
}
[2025-12-27 23:18:21] info: [resultModel.getResultsByHorse] Found 0 results for horse 1
[2025-12-27 23:18:21] info: [resultModel.getResultsByHorse] Found 0 results for horse 999
[2025-12-27 23:18:21] info: [resultModel.getResultsByHorse] Found 0 results for horse 1
[2025-12-27 23:18:21] info: [resultModel.getResultsByShow] Found 0 results for show 2
[2025-12-27 23:18:22] info: [resultModel.getResultsByShow] Found 0 results for show 999
[2025-12-27 23:18:22] info: [resultModel.getResultsByShow] Found 0 results for show 1
[2025-12-27 23:18:22] error: [resultModel.saveResult] Database error: PrismaClientKnownRequestError: 
Invalid `prisma.competitionResult.create()` invocation:


Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`
    at Zn.handleRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:7459)
    at Zn.handleAndLogRequestError (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6784)
    at Zn.request (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:121:6491)
    at l (C:\Users\heirr\OneDrive\Desktop\Equoria\packages\database\node_modules\@prisma\client\runtime\library.js:130:9778)
    at saveResult (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\models\resultModel.mjs:101:16)
    at createResult (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\models\resultModel.mjs:248:10)
    at Object.<anonymous> (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\tests\resultModel.test.mjs:702:22) {
  [stack]: [Getter/Setter],
  [message]: '\n' +
    'Invalid `prisma.competitionResult.create()` invocation:\n' +
    '\n' +
    '\n' +
    'Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`',
  code: 'P2003',
  meta: {
    modelName: 'CompetitionResult',
    constraint: 'competition_results_horseId_fkey'
  },
  clientVersion: '6.8.2',
  [batchRequestIdx]: undefined,
  name: 'PrismaClientKnownRequestError',
  [Symbol(Symbol.toStringTag)]: [Getter]
}
[2025-12-27 23:18:22] info: [resultModel.getResultsByUser] Retrieved 0 results for user user123
[2025-12-27 23:18:22] info: [resultModel.getResultsByUser] Retrieved 0 results for user user123
[2025-12-27 23:18:22] info: [resultModel.getResultsByUser] Retrieved 0 results for user user123
[2025-12-27 23:18:22] info: [resultModel.getResultsByUser] Retrieved 0 results for user user123
[2025-12-27 23:18:22] info: [resultModel.getResultsByHorse] Found 0 results for horse 123
[2025-12-27 23:18:22] info: [resultModel.getResultsByShow] Found 0 results for show 456
FAIL tests/resultModel.test.mjs
  üèÜ UNIT: Result Model - Competition Result Management
    saveResult
      √ó should save a competition result with all required fields (78 ms)
      √ó should save a result without placement (null for non-top-3) (8 ms)
      ‚àö should throw error if horseId is missing (4 ms)
      ‚àö should throw error if showId is missing (3 ms)
      ‚àö should throw error if score is missing (2 ms)
      ‚àö should throw error if discipline is missing (6 ms)
      ‚àö should throw error if runDate is missing (1 ms)
      ‚àö should validate score is a number (2 ms)
      ‚àö should validate horseId is a positive integer (1 ms)
      ‚àö should validate showId is a positive integer (1 ms)
      ‚àö should throw error if showName is missing (1 ms)
      ‚àö should throw error if showName is not a string (1 ms)
      √ó should handle prizeWon as string and convert to float (7 ms)
      √ó should handle database errors gracefully (12 ms)
      √ó should update existing placeholder result instead of creating new one (8 ms)
      √ó should create new result when no placeholder exists (10 ms)
    getResultsByHorse
      √ó should retrieve all results for a specific horse (7 ms)
      ‚àö should return empty array if no results found for horse (7 ms)
      ‚àö should validate horseId is a positive integer (3 ms)
      √ó should handle database errors gracefully (5 ms)
    getResultsByShow
      √ó should retrieve all results for a specific show (7 ms)
      ‚àö should return empty array if no results found for show (5 ms)
      ‚àö should validate showId is a positive integer (4 ms)
      √ó should handle database errors gracefully (6 ms)
    getResultById
      √ó should retrieve a specific result by ID (9 ms)
      ‚àö should return null if result not found (5 ms)
      ‚àö should validate resultId is a positive integer (2 ms)
      √ó should handle database errors gracefully (5 ms)
    createResult
      √ó should be an alias for saveResult and work identically (8 ms)
      ‚àö should throw same validation errors as saveResult (2 ms)
    getResultsByUser
      √ó should retrieve results for all user horses with default options (6 ms)
      √ó should handle custom options (limit, offset, discipline) (5 ms)
      √ó should cap limit at 100 and ensure non-negative offset (6 ms)
      √ó should handle database errors gracefully (6 ms)
    parseInt conversion edge cases
      √ó should handle string IDs in getResultsByHorse (6 ms)
      √ó should handle string IDs in getResultsByShow (5 ms)
      √ó should handle string IDs in getResultById (3 ms)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ saveResult ‚Ä∫ should save a competition result with all required fields

    Database error in saveResult: 
    Invalid `prisma.competitionResult.create()` invocation:


    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`

    [0m [90m 128 |[39m   } [36mcatch[39m (error) {
     [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 131 |[39m   }
     [90m 132 |[39m }
     [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at Object.<anonymous> (tests/resultModel.test.mjs:105:22)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ saveResult ‚Ä∫ should save a result without placement (null for non-top-3)

    Database error in saveResult: 
    Invalid `prisma.competitionResult.create()` invocation:


    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`

    [0m [90m 128 |[39m   } [36mcatch[39m (error) {
     [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 131 |[39m   }
     [90m 132 |[39m }
     [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at Object.<anonymous> (tests/resultModel.test.mjs:146:22)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ saveResult ‚Ä∫ should handle prizeWon as string and convert to float

    Database error in saveResult: 
    Invalid `prisma.competitionResult.create()` invocation:


    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`

    [0m [90m 128 |[39m   } [36mcatch[39m (error) {
     [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 131 |[39m   }
     [90m 132 |[39m }
     [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at Object.<anonymous> (tests/resultModel.test.mjs:329:7)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ saveResult ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow(expected)

    Expected substring: "Database error in saveResult: Database connection failed"
    Received message:   "Database error in saveResult:¬∑
    Invalid `prisma.competitionResult.create()` invocation:¬∑¬∑
    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`"

        [0m [90m 128 |[39m   } [36mcatch[39m (error) {
         [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
        [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
         [90m     |[39m           [31m[1m^[22m[39m
         [90m 131 |[39m   }
         [90m 132 |[39m }
         [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at Object.<anonymous> (tests/resultModel.test.mjs:352:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/resultModel.test.mjs:352:52)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ saveResult ‚Ä∫ should update existing placeholder result instead of creating new one

    Database error in saveResult: 
    Invalid `prisma.competitionResult.create()` invocation:


    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`

    [0m [90m 128 |[39m   } [36mcatch[39m (error) {
     [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 131 |[39m   }
     [90m 132 |[39m }
     [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at Object.<anonymous> (tests/resultModel.test.mjs:390:22)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ saveResult ‚Ä∫ should create new result when no placeholder exists

    Database error in saveResult: 
    Invalid `prisma.competitionResult.create()` invocation:


    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`

    [0m [90m 128 |[39m   } [36mcatch[39m (error) {
     [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 131 |[39m   }
     [90m 132 |[39m }
     [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at Object.<anonymous> (tests/resultModel.test.mjs:447:22)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByHorse ‚Ä∫ should retrieve all results for a specific horse

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 517 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m getResultsByHorse(horseId)[33m;[39m
     [90m 518 |[39m
    [31m[1m>[22m[39m[90m 519 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 520 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m 521 |[39m         where[33m:[39m { horseId[33m:[39m [35m1[39m }[33m,[39m
     [90m 522 |[39m         include[33m:[39m {[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:519:53)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByHorse ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: []

    [0m [90m 551 |[39m       mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database connection failed'[39m))[33m;[39m
     [90m 552 |[39m
    [31m[1m>[22m[39m[90m 553 |[39m       [36mawait[39m expect(getResultsByHorse([35m1[39m))[33m.[39mrejects[33m.[39mtoThrow(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 554 |[39m         [32m'Database error in getResultsByHorse: Database connection failed'[39m[33m,[39m
     [90m 555 |[39m       )[33m;[39m
     [90m 556 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/resultModel.test.mjs:553:13)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByShow ‚Ä∫ should retrieve all results for a specific show

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 589 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m getResultsByShow(showId)[33m;[39m
     [90m 590 |[39m
    [31m[1m>[22m[39m[90m 591 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 592 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m 593 |[39m         where[33m:[39m { showId[33m:[39m [35m2[39m }[33m,[39m
     [90m 594 |[39m         include[33m:[39m {[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:591:53)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByShow ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: []

    [0m [90m 623 |[39m       mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database connection failed'[39m))[33m;[39m
     [90m 624 |[39m
    [31m[1m>[22m[39m[90m 625 |[39m       [36mawait[39m expect(getResultsByShow([35m1[39m))[33m.[39mrejects[33m.[39mtoThrow(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 626 |[39m         [32m'Database error in getResultsByShow: Database connection failed'[39m[33m,[39m
     [90m 627 |[39m       )[33m;[39m
     [90m 628 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/resultModel.test.mjs:625:13)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultById ‚Ä∫ should retrieve a specific result by ID

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 648 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getResultById(resultId)[33m;[39m
     [90m 649 |[39m
    [31m[1m>[22m[39m[90m 650 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                                       [31m[1m^[22m[39m
     [90m 651 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith({
     [90m 652 |[39m         where[33m:[39m { id[33m:[39m [35m1[39m }[33m,[39m
     [90m 653 |[39m         include[33m:[39m {[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:650:55)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultById ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: null

    [0m [90m 681 |[39m       mockPrisma[33m.[39mcompetitionResult[33m.[39mfindUnique[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database connection failed'[39m))[33m;[39m
     [90m 682 |[39m
    [31m[1m>[22m[39m[90m 683 |[39m       [36mawait[39m expect(getResultById([35m1[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Database error in getResultById: Database connection failed'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 684 |[39m     })[33m;[39m
     [90m 685 |[39m   })[33m;[39m
     [90m 686 |[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/resultModel.test.mjs:683:13)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ createResult ‚Ä∫ should be an alias for saveResult and work identically

    Database error in saveResult: 
    Invalid `prisma.competitionResult.create()` invocation:


    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`

    [0m [90m 128 |[39m   } [36mcatch[39m (error) {
     [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 131 |[39m   }
     [90m 132 |[39m }
     [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at createResult (models/resultModel.mjs:248:10)
      at Object.<anonymous> (tests/resultModel.test.mjs:702:22)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByUser ‚Ä∫ should retrieve results for all user horses with default options

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"include": {"horse": {"include": {"breed": true}}, "show": true}, "orderBy": {"runDate": "desc"}, "skip": 0, "take": 50, "where": {"horse": {"userId": "user123"}}}

    Number of calls: 0

    [0m [90m 736 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m getResultsByUser(userId)[33m;[39m
     [90m 737 |[39m
    [31m[1m>[22m[39m[90m 738 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 739 |[39m         where[33m:[39m {
     [90m 740 |[39m           horse[33m:[39m {
     [90m 741 |[39m             userId[33m:[39m [32m'user123'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:738:53)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByUser ‚Ä∫ should handle custom options (limit, offset, discipline)

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"include": Any<Object>, "orderBy": {"runDate": "desc"}, "skip": 5, "take": 10, "where": {"discipline": "Racing", "horse": {"userId": "user123"}}}

    Number of calls: 0

    [0m [90m 767 |[39m       [36mawait[39m getResultsByUser(userId[33m,[39m options)[33m;[39m
     [90m 768 |[39m
    [31m[1m>[22m[39m[90m 769 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 770 |[39m         where[33m:[39m {
     [90m 771 |[39m           horse[33m:[39m {
     [90m 772 |[39m             userId[33m:[39m [32m'user123'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:769:53)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByUser ‚Ä∫ should cap limit at 100 and ensure non-negative offset

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"skip": 0, "take": 100}

    Number of calls: 0

    [0m [90m 789 |[39m       [36mawait[39m getResultsByUser(userId[33m,[39m options)[33m;[39m
     [90m 790 |[39m
    [31m[1m>[22m[39m[90m 791 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 792 |[39m         expect[33m.[39mobjectContaining({
     [90m 793 |[39m           take[33m:[39m [35m100[39m[33m,[39m [90m// Capped at 100[39m
     [90m 794 |[39m           skip[33m:[39m [35m0[39m[33m,[39m [90m// Non-negative[39m[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:791:53)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByUser ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: []

    [0m [90m 800 |[39m       mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database error'[39m))[33m;[39m
     [90m 801 |[39m
    [31m[1m>[22m[39m[90m 802 |[39m       [36mawait[39m expect(getResultsByUser([32m'user123'[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Database error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 803 |[39m     })[33m;[39m
     [90m 804 |[39m   })[33m;[39m
     [90m 805 |[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/resultModel.test.mjs:802:13)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ parseInt conversion edge cases ‚Ä∫ should handle string IDs in getResultsByHorse

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"where": {"horseId": 123}}

    Number of calls: 0

    [0m [90m 810 |[39m       [36mawait[39m getResultsByHorse([32m'123'[39m)[33m;[39m [90m// String ID[39m
     [90m 811 |[39m
    [31m[1m>[22m[39m[90m 812 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 813 |[39m         expect[33m.[39mobjectContaining({
     [90m 814 |[39m           where[33m:[39m { horseId[33m:[39m [35m123[39m }[33m,[39m [90m// Should be converted to number[39m
     [90m 815 |[39m         })[33m,[39m[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:812:53)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ parseInt conversion edge cases ‚Ä∫ should handle string IDs in getResultsByShow

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"where": {"showId": 456}}

    Number of calls: 0

    [0m [90m 822 |[39m       [36mawait[39m getResultsByShow([32m'456'[39m)[33m;[39m [90m// String ID[39m
     [90m 823 |[39m
    [31m[1m>[22m[39m[90m 824 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 825 |[39m         expect[33m.[39mobjectContaining({
     [90m 826 |[39m           where[33m:[39m { showId[33m:[39m [35m456[39m }[33m,[39m [90m// Should be converted to number[39m
     [90m 827 |[39m         })[33m,[39m[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:824:53)

  ‚óè üèÜ UNIT: Result Model - Competition Result Management ‚Ä∫ parseInt conversion edge cases ‚Ä∫ should handle string IDs in getResultById

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"where": {"id": 789}}

    Number of calls: 0

    [0m [90m 834 |[39m       [36mawait[39m getResultById([32m'789'[39m)[33m;[39m [90m// String ID[39m
     [90m 835 |[39m
    [31m[1m>[22m[39m[90m 836 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                       [31m[1m^[22m[39m
     [90m 837 |[39m         expect[33m.[39mobjectContaining({
     [90m 838 |[39m           where[33m:[39m { id[33m:[39m [35m789[39m }[33m,[39m [90m// Should be converted to number[39m
     [90m 839 |[39m         })[33m,[39m[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:836:55)

[2025-12-27 23:18:22] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:22] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:22] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 1
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 1
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 1
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 1
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 1
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 1
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 999
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 999: Horse with ID 999 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 1
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 1
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 1
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 1
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error in batch evaluation for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 2
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 2: Horse with ID 2 not found
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error in batch evaluation for horse 2: Horse with ID 2 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 3
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 3: Horse with ID 3 not found
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error in batch evaluation for horse 3: Horse with ID 3 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 1
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error in batch evaluation for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:22] info: [flagEvaluationEngine] Starting flag evaluation for horse 2
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error evaluating flags for horse 2: Horse with ID 2 not found
[2025-12-27 23:18:22] error: [flagEvaluationEngine] Error in batch evaluation for horse 2: Horse with ID 2 not found
FAIL tests/unit/flagEvaluationEngine.test.mjs
  Flag Evaluation Engine
    evaluateHorseFlags
      √ó should evaluate and assign flags for eligible horse (62 ms)
      √ó should reject horse outside age range (10 ms)
      √ó should reject horse with maximum flags (7 ms)
      √ó should not assign duplicate flags (8 ms)
      √ó should respect flag limit during assignment (7 ms)
      √ó should handle care analysis ineligibility (8 ms)
      ‚àö should handle non-existent horse (11 ms)
      √ó should handle database errors (16 ms)
    Flag Trigger Evaluation
      √ó should trigger brave flag with correct conditions (9 ms)
      √ó should trigger fearful flag with correct conditions (9 ms)
    batchEvaluateFlags
      √ó should evaluate multiple horses (23 ms)
      √ó should handle mixed success/failure in batch (17 ms)
    getEligibleHorses
      √ó should return eligible horses within age range (10 ms)
      √ó should handle database errors in getEligibleHorses (3 ms)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should evaluate and assign flags for eligible horse

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:124:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should reject horse outside age range

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:147:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should reject horse with maximum flags

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:162:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should not assign duplicate flags

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:180:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should respect flag limit during assignment

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:210:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should handle care analysis ineligibility

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:224:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should handle database errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Database error"
    Received message:   "Horse with ID 1 not found"

        [0m [90m 49 |[39m
         [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
        [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
         [90m    |[39m             [31m[1m^[22m[39m
         [90m 52 |[39m     }
         [90m 53 |[39m
         [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:241:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:241:51)

  ‚óè Flag Evaluation Engine ‚Ä∫ Flag Trigger Evaluation ‚Ä∫ should trigger brave flag with correct conditions

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:278:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ Flag Trigger Evaluation ‚Ä∫ should trigger fearful flag with correct conditions

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:318:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ batchEvaluateFlags ‚Ä∫ should evaluate multiple horses

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 348 |[39m
     [90m 349 |[39m       expect(results)[33m.[39mtoHaveLength([35m3[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 350 |[39m       expect(results[33m.[39mevery(r [33m=>[39m r[33m.[39msuccess))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                             [31m[1m^[22m[39m
     [90m 351 |[39m     })[33m;[39m
     [90m 352 |[39m
     [90m 353 |[39m     test([32m'should handle mixed success/failure in batch'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:350:45)

  ‚óè Flag Evaluation Engine ‚Ä∫ batchEvaluateFlags ‚Ä∫ should handle mixed success/failure in batch

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 373 |[39m
     [90m 374 |[39m       expect(results)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 375 |[39m       expect(results[[35m0[39m][33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 376 |[39m       expect(results[[35m1[39m][33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 377 |[39m       expect(results[[35m1[39m][33m.[39merror)[33m.[39mtoContain([32m'Horse with ID 2 not found'[39m)[33m;[39m
     [90m 378 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:375:34)

  ‚óè Flag Evaluation Engine ‚Ä∫ getEligibleHorses ‚Ä∫ should return eligible horses within age range

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 1

    - Array [
    -   1,
    -   2,
    - ]
    + Array []

    [0m [90m 390 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getEligibleHorses()[33m;[39m
     [90m 391 |[39m
    [31m[1m>[22m[39m[90m 392 |[39m       expect(result)[33m.[39mtoEqual([[35m1[39m[33m,[39m [35m2[39m])[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 393 |[39m       expect(mockPrisma[33m.[39mhorse[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m 394 |[39m         where[33m:[39m {
     [90m 395 |[39m           dateOfBirth[33m:[39m {[0m

      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:392:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ getEligibleHorses ‚Ä∫ should handle database errors in getEligibleHorses

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: []

    [0m [90m 410 |[39m       mockPrisma[33m.[39mhorse[33m.[39mfindMany[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database error'[39m))[33m;[39m
     [90m 411 |[39m
    [31m[1m>[22m[39m[90m 412 |[39m       [36mawait[39m expect(getEligibleHorses())[33m.[39mrejects[33m.[39mtoThrow([32m'Database error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 413 |[39m     })[33m;[39m
     [90m 414 |[39m   })[33m;[39m
     [90m 415 |[39m })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:412:13)

[2025-12-27 23:18:22] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:22] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:22] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:22] info: [xpLogModel.logXpEvent] Logging XP event: User user-123, Amount: 5, Reason: Trained horse in Dressage
[2025-12-27 23:18:23] error: [xpLogModel.logXpEvent] Error logging XP event: 
Invalid `prisma.xpEvent.create()` invocation:


Foreign key constraint violated on the constraint: `xp_events_userId_fkey`
[2025-12-27 23:18:23] info: [xpLogModel.logXpEvent] Logging XP event: User undefined, Amount: 5, Reason: Test reason
[2025-12-27 23:18:23] error: [xpLogModel.logXpEvent] Error logging XP event: User ID is required
[2025-12-27 23:18:23] info: [xpLogModel.logXpEvent] Logging XP event: User user-123, Amount: invalid, Reason: Test reason
[2025-12-27 23:18:23] error: [xpLogModel.logXpEvent] Error logging XP event: Amount must be a number
[2025-12-27 23:18:23] info: [xpLogModel.logXpEvent] Logging XP event: User user-123, Amount: 5, Reason: undefined
[2025-12-27 23:18:23] error: [xpLogModel.logXpEvent] Error logging XP event: Reason is required and must be a string
[2025-12-27 23:18:23] info: [xpLogModel.logXpEvent] Logging XP event: User user-123, Amount: 5, Reason: Test reason
[2025-12-27 23:18:23] error: [xpLogModel.logXpEvent] Error logging XP event: 
Invalid `prisma.xpEvent.create()` invocation:


Foreign key constraint violated on the constraint: `xp_events_userId_fkey`
[2025-12-27 23:18:23] info: [xpLogModel.logXpEvent] Logging XP event: User user-123, Amount: -10, Reason: XP penalty for rule violation
[2025-12-27 23:18:23] error: [xpLogModel.logXpEvent] Error logging XP event: 
Invalid `prisma.xpEvent.create()` invocation:


Foreign key constraint violated on the constraint: `xp_events_userId_fkey`
[2025-12-27 23:18:23] info: [xpLogModel.getUserXpEvents] Getting XP events for user user-123, limit: 50, offset: 0
[2025-12-27 23:18:23] info: [xpLogModel.getUserXpEvents] Retrieved 0 XP events for user user-123
[2025-12-27 23:18:23] info: [xpLogModel.getUserXpEvents] Getting XP events for user user-123, limit: 10, offset: 5
[2025-12-27 23:18:23] info: [xpLogModel.getUserXpEvents] Retrieved 0 XP events for user user-123
[2025-12-27 23:18:23] info: [xpLogModel.getUserXpSummary] Getting XP summary for user user-123
[2025-12-27 23:18:23] info: [xpLogModel.getUserXpSummary] XP summary for user user-123: Gained 0, Lost 0, Net 0
[2025-12-27 23:18:23] info: [xpLogModel.getUserXpSummary] Getting XP summary for user user-123
[2025-12-27 23:18:23] info: [xpLogModel.getUserXpSummary] XP summary for user user-123: Gained 0, Lost 0, Net 0
[2025-12-27 23:18:23] info: [xpLogModel.getUserXpSummary] Getting XP summary for user user-123
[2025-12-27 23:18:23] info: [xpLogModel.getUserXpSummary] XP summary for user user-123: Gained 0, Lost 0, Net 0
[2025-12-27 23:18:23] info: [xpLogModel.getRecentXpEvents] Getting recent XP events, limit: 10, offset: 0
[2025-12-27 23:18:23] info: [xpLogModel.getRecentXpEvents] Retrieved 0 recent XP events
[2025-12-27 23:18:23] info: [xpLogModel.getRecentXpEvents] Getting recent XP events, limit: 100, offset: 0
[2025-12-27 23:18:23] info: [xpLogModel.getRecentXpEvents] Retrieved 0 recent XP events
FAIL tests/xpLogModel.test.mjs
  üìä UNIT: XP Log Model - Experience Point Event Tracking
    logXpEvent
      √ó should log XP event successfully (68 ms)
      ‚àö should validate required parameters (14 ms)
      √ó should handle database errors (10 ms)
      √ó should handle negative XP amounts (5 ms)
    getUserXpEvents
      √ó should retrieve XP events for a user (7 ms)
      √ó should handle date filters (6 ms)
    getUserXpSummary
      √ó should calculate XP summary correctly (9 ms)
      ‚àö should handle empty results (7 ms)
      √ó should handle date filters in summary (7 ms)
    getRecentXpEvents
      √ó should retrieve recent XP events across all users (6 ms)
      √ó should use default options (5 ms)

  ‚óè üìä UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ logXpEvent ‚Ä∫ should log XP event successfully

    PrismaClientKnownRequestError: 
    Invalid `prisma.xpEvent.create()` invocation:


    Foreign key constraint violated on the constraint: `xp_events_userId_fkey`

    [0m [90m 38 |[39m
     [90m 39 |[39m     [90m// Insert XP event into database using Prisma[39m
    [31m[1m>[22m[39m[90m 40 |[39m     [36mconst[39m xpEvent [33m=[39m [36mawait[39m prisma[33m.[39mxpEvent[33m.[39mcreate({
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 41 |[39m       data[33m:[39m {
     [90m 42 |[39m         userId[33m,[39m [90m// Changed userId to userId[39m
     [90m 43 |[39m         amount[33m,[39m[0m

      at Zn.handleRequestError (../packages/database/node_modules/@prisma/client/runtime/library.js:121:7459)
      at Zn.handleAndLogRequestError (../packages/database/node_modules/@prisma/client/runtime/library.js:121:6784)
      at Zn.request (../packages/database/node_modules/@prisma/client/runtime/library.js:121:6491)
      at l (../packages/database/node_modules/@prisma/client/runtime/library.js:130:9778)
      at logXpEvent (models/xpLogModel.mjs:40:21)
      at Object.<anonymous> (tests/xpLogModel.test.mjs:98:22)

  ‚óè üìä UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ logXpEvent ‚Ä∫ should handle database errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Database connection failed"
    Received message:   "
    Invalid `prisma.xpEvent.create()` invocation:¬∑¬∑
    Foreign key constraint violated on the constraint: `xp_events_userId_fkey`"

        [0m [90m 38 |[39m
         [90m 39 |[39m     [90m// Insert XP event into database using Prisma[39m
        [31m[1m>[22m[39m[90m 40 |[39m     [36mconst[39m xpEvent [33m=[39m [36mawait[39m prisma[33m.[39mxpEvent[33m.[39mcreate({
         [90m    |[39m                     [31m[1m^[22m[39m
         [90m 41 |[39m       data[33m:[39m {
         [90m 42 |[39m         userId[33m,[39m [90m// Changed userId to userId[39m
         [90m 43 |[39m         amount[33m,[39m[0m

      at Zn.handleRequestError (../packages/database/node_modules/@prisma/client/runtime/library.js:121:7459)
      at Zn.handleAndLogRequestError (../packages/database/node_modules/@prisma/client/runtime/library.js:121:6784)
      at Zn.request (../packages/database/node_modules/@prisma/client/runtime/library.js:121:6491)
      at l (../packages/database/node_modules/@prisma/client/runtime/library.js:130:9778)
      at logXpEvent (models/xpLogModel.mjs:40:21)
      at Object.<anonymous> (tests/xpLogModel.test.mjs:157:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/xpLogModel.test.mjs:163:17)

  ‚óè üìä UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ logXpEvent ‚Ä∫ should handle negative XP amounts

    PrismaClientKnownRequestError: 
    Invalid `prisma.xpEvent.create()` invocation:


    Foreign key constraint violated on the constraint: `xp_events_userId_fkey`

    [0m [90m 38 |[39m
     [90m 39 |[39m     [90m// Insert XP event into database using Prisma[39m
    [31m[1m>[22m[39m[90m 40 |[39m     [36mconst[39m xpEvent [33m=[39m [36mawait[39m prisma[33m.[39mxpEvent[33m.[39mcreate({
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 41 |[39m       data[33m:[39m {
     [90m 42 |[39m         userId[33m,[39m [90m// Changed userId to userId[39m
     [90m 43 |[39m         amount[33m,[39m[0m

      at Zn.handleRequestError (../packages/database/node_modules/@prisma/client/runtime/library.js:121:7459)
      at Zn.handleAndLogRequestError (../packages/database/node_modules/@prisma/client/runtime/library.js:121:6784)
      at Zn.request (../packages/database/node_modules/@prisma/client/runtime/library.js:121:6491)
      at l (../packages/database/node_modules/@prisma/client/runtime/library.js:130:9778)
      at logXpEvent (models/xpLogModel.mjs:40:21)
      at Object.<anonymous> (tests/xpLogModel.test.mjs:181:22)

  ‚óè üìä UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ getUserXpEvents ‚Ä∫ should retrieve XP events for a user

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"orderBy": {"timestamp": "desc"}, "skip": 0, "take": 50, "where": {"userId": "user-123"}}

    Number of calls: 0

    [0m [90m 219 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserXpEvents([32m'user-123'[39m)[33m;[39m
     [90m 220 |[39m
    [31m[1m>[22m[39m[90m 221 |[39m       expect(mockPrismaXpEvent[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 222 |[39m         where[33m:[39m { userId[33m:[39m [32m'user-123'[39m }[33m,[39m
     [90m 223 |[39m         orderBy[33m:[39m { timestamp[33m:[39m [32m'desc'[39m }[33m,[39m
     [90m 224 |[39m         take[33m:[39m [35m50[39m[33m,[39m[0m

      at Object.<anonymous> (tests/xpLogModel.test.mjs:221:42)

  ‚óè üìä UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ getUserXpEvents ‚Ä∫ should handle date filters

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"orderBy": {"timestamp": "desc"}, "skip": 5, "take": 10, "where": {"timestamp": {"gte": 2024-01-01T00:00:00.000Z, "lte": 2024-01-02T00:00:00.000Z}, "userId": "user-123"}}

    Number of calls: 0

    [0m [90m 245 |[39m       })[33m;[39m
     [90m 246 |[39m
    [31m[1m>[22m[39m[90m 247 |[39m       expect(mockPrismaXpEvent[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 248 |[39m         where[33m:[39m {
     [90m 249 |[39m           userId[33m:[39m [32m'user-123'[39m[33m,[39m
     [90m 250 |[39m           timestamp[33m:[39m {[0m

      at Object.<anonymous> (tests/xpLogModel.test.mjs:247:42)

  ‚óè üìä UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ getUserXpSummary ‚Ä∫ should calculate XP summary correctly

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 4

      Object {
    -   "netTotal": 45,
    -   "totalEvents": 5,
    -   "totalGained": 50,
    -   "totalLost": 5,
    +   "netTotal": 0,
    +   "totalEvents": 0,
    +   "totalGained": 0,
    +   "totalLost": 0,
      }

    [0m [90m 268 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserXpSummary([32m'user-123'[39m)[33m;[39m
     [90m 269 |[39m
    [31m[1m>[22m[39m[90m 270 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 271 |[39m         totalGained[33m:[39m [35m50[39m[33m,[39m [90m// 20 + 15 + 5 + 10[39m
     [90m 272 |[39m         totalLost[33m:[39m [35m5[39m[33m,[39m [90m// abs(-5)[39m
     [90m 273 |[39m         netTotal[33m:[39m [35m45[39m[33m,[39m [90m// 20 + 15 + 5 - 5 + 10[39m[0m

      at Object.<anonymous> (tests/xpLogModel.test.mjs:270:22)

  ‚óè üìä UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ getUserXpSummary ‚Ä∫ should handle date filters in summary

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"select": {"amount": true}, "where": {"timestamp": {"gte": 2024-01-01T00:00:00.000Z, "lte": 2024-01-02T00:00:00.000Z}, "userId": "user-123"}}

    Number of calls: 0

    [0m [90m 302 |[39m       [36mawait[39m getUserXpSummary([32m'user-123'[39m[33m,[39m startDate[33m,[39m endDate)[33m;[39m
     [90m 303 |[39m
    [31m[1m>[22m[39m[90m 304 |[39m       expect(mockPrismaXpEvent[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 305 |[39m         where[33m:[39m {
     [90m 306 |[39m           userId[33m:[39m [32m'user-123'[39m[33m,[39m
     [90m 307 |[39m           timestamp[33m:[39m {[0m

      at Object.<anonymous> (tests/xpLogModel.test.mjs:304:42)

  ‚óè üìä UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ getRecentXpEvents ‚Ä∫ should retrieve recent XP events across all users

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"include": {"user": {"select": {"id": true, "username": true}}}, "orderBy": {"timestamp": "desc"}, "skip": 0, "take": 10}

    Number of calls: 0

    [0m [90m 338 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getRecentXpEvents({ limit[33m:[39m [35m10[39m[33m,[39m offset[33m:[39m [35m0[39m })[33m;[39m
     [90m 339 |[39m
    [31m[1m>[22m[39m[90m 340 |[39m       expect(mockPrismaXpEvent[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 341 |[39m         orderBy[33m:[39m { timestamp[33m:[39m [32m'desc'[39m }[33m,[39m
     [90m 342 |[39m         take[33m:[39m [35m10[39m[33m,[39m
     [90m 343 |[39m         skip[33m:[39m [35m0[39m[33m,[39m[0m

      at Object.<anonymous> (tests/xpLogModel.test.mjs:340:42)

  ‚óè üìä UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ getRecentXpEvents ‚Ä∫ should use default options

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"include": {"user": {"select": {"id": true, "username": true}}}, "orderBy": {"timestamp": "desc"}, "skip": 0, "take": 100}

    Number of calls: 0

    [0m [90m 363 |[39m       [36mawait[39m getRecentXpEvents()[33m;[39m
     [90m 364 |[39m
    [31m[1m>[22m[39m[90m 365 |[39m       expect(mockPrismaXpEvent[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 366 |[39m         orderBy[33m:[39m { timestamp[33m:[39m [32m'desc'[39m }[33m,[39m
     [90m 367 |[39m         take[33m:[39m [35m100[39m[33m,[39m
     [90m 368 |[39m         skip[33m:[39m [35m0[39m[33m,[39m[0m

      at Object.<anonymous> (tests/xpLogModel.test.mjs:365:42)

[2025-12-27 23:18:23] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:23] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:23] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:23] info: [carePatternAnalysis] Starting analysis for horse 1
[2025-12-27 23:18:23] error: [carePatternAnalysis] Error analyzing patterns for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:23] info: [carePatternAnalysis] Starting analysis for horse 1
[2025-12-27 23:18:23] error: [carePatternAnalysis] Error analyzing patterns for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:23] info: [carePatternAnalysis] Starting analysis for horse 999
[2025-12-27 23:18:23] error: [carePatternAnalysis] Error analyzing patterns for horse 999: Horse with ID 999 not found
[2025-12-27 23:18:23] info: [carePatternAnalysis] Starting analysis for horse 1
[2025-12-27 23:18:23] error: [carePatternAnalysis] Error analyzing patterns for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:23] info: [carePatternAnalysis] Starting analysis for horse 1
[2025-12-27 23:18:23] error: [carePatternAnalysis] Error analyzing patterns for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:23] info: [carePatternAnalysis] Starting analysis for horse 1
[2025-12-27 23:18:23] error: [carePatternAnalysis] Error analyzing patterns for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:23] info: [carePatternAnalysis] Starting analysis for horse 1
[2025-12-27 23:18:23] error: [carePatternAnalysis] Error analyzing patterns for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:23] info: [carePatternAnalysis] Starting analysis for horse 1
[2025-12-27 23:18:23] error: [carePatternAnalysis] Error analyzing patterns for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:23] info: [carePatternAnalysis] Starting analysis for horse 1
[2025-12-27 23:18:23] error: [carePatternAnalysis] Error analyzing patterns for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:23] info: [carePatternAnalysis] Starting analysis for horse 1
[2025-12-27 23:18:23] error: [carePatternAnalysis] Error analyzing patterns for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:23] info: [carePatternAnalysis] Starting analysis for horse 1
[2025-12-27 23:18:23] error: [carePatternAnalysis] Error analyzing patterns for horse 1: Horse with ID 1 not found
[2025-12-27 23:18:23] info: [carePatternAnalysis] Starting analysis for horse 1
[2025-12-27 23:18:23] error: [carePatternAnalysis] Error analyzing patterns for horse 1: 
Invalid `prisma.horse.findUnique()` invocation:

{
  where: {
    id: 1
  },
  include: {
    groomInteractions: {
      where: {
        createdAt: {
          gte: new Date("Invalid Date")
               ~~~~~~~~~~~~~~~~~~~~~~~~
        }
      },
      orderBy: {
        createdAt: "asc"
      }
    }
  }
}

Invalid value for argument `gte`: Provided Date object is invalid. Expected Date.
FAIL tests/unit/carePatternAnalysis.test.mjs
  Care Pattern Analysis
    analyzeCarePatterns
      √ó should analyze patterns for eligible horse (183 ms)
      √ó should reject horse too old for evaluation (8 ms)
      ‚àö should throw error for non-existent horse (13 ms)
      √ó should analyze consistent care patterns (13 ms)
      √ó should analyze novelty exposure patterns (8 ms)
      √ó should analyze stress management patterns (7 ms)
      √ó should analyze bonding patterns (8 ms)
      √ó should analyze neglect patterns (9 ms)
      √ó should analyze environmental factors (7 ms)
    Edge Cases
      √ó should handle horse with no interactions (8 ms)
      √ó should handle database errors gracefully (15 ms)
      √ó should handle invalid evaluation date (7 ms)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze patterns for eligible horse

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:58:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should reject horse too old for evaluation

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:78:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze consistent care patterns

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:123:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze novelty exposure patterns

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:172:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze stress management patterns

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:222:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze bonding patterns

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:263:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze neglect patterns

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:296:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze environmental factors

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:338:22)

  ‚óè Care Pattern Analysis ‚Ä∫ Edge Cases ‚Ä∫ should handle horse with no interactions

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:355:22)

  ‚óè Care Pattern Analysis ‚Ä∫ Edge Cases ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow(expected)

    Expected substring: "Database connection failed"
    Received message:   "Horse with ID 1 not found"

        [0m [90m 46 |[39m
         [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
        [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
         [90m    |[39m             [31m[1m^[22m[39m
         [90m 49 |[39m     }
         [90m 50 |[39m
         [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:367:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:367:52)

  ‚óè Care Pattern Analysis ‚Ä∫ Edge Cases ‚Ä∫ should handle invalid evaluation date

    PrismaClientValidationError: 
    Invalid `prisma.horse.findUnique()` invocation:

    {
      where: {
        id: 1
      },
      include: {
        groomInteractions: {
          where: {
            createdAt: {
              gte: new Date("Invalid Date")
                   ~~~~~~~~~~~~~~~~~~~~~~~~
            }
          },
          orderBy: {
            createdAt: "asc"
          }
        }
      }
    }

    Invalid value for argument `gte`: Provided Date object is invalid. Expected Date.

      at kn (../packages/database/node_modules/@prisma/client/runtime/library.js:29:1363)
      at e.throwValidationError (../packages/database/node_modules/@prisma/client/runtime/library.js:29:10051)
      at Ia (../packages/database/node_modules/@prisma/client/runtime/library.js:29:7488)
      at ka (../packages/database/node_modules/@prisma/client/runtime/library.js:29:8741)
      at Ia (../packages/database/node_modules/@prisma/client/runtime/library.js:29:8272)
      at ka (../packages/database/node_modules/@prisma/client/runtime/library.js:29:8741)
      at Ia (../packages/database/node_modules/@prisma/client/runtime/library.js:29:8272)
      at ka (../packages/database/node_modules/@prisma/client/runtime/library.js:29:8741)
      at Et (../packages/database/node_modules/@prisma/client/runtime/library.js:29:5845)
      at rm (../packages/database/node_modules/@prisma/client/runtime/library.js:29:6654)
      at em (../packages/database/node_modules/@prisma/client/runtime/library.js:29:6300)
      at Xd (../packages/database/node_modules/@prisma/client/runtime/library.js:29:6186)
      at Et (../packages/database/node_modules/@prisma/client/runtime/library.js:29:5863)
      at Nn (../packages/database/node_modules/@prisma/client/runtime/library.js:29:5747)
      at ../packages/database/node_modules/@prisma/client/runtime/library.js:130:10331
      at Object.runInChildSpan (../packages/database/node_modules/@prisma/client/runtime/library.js:121:1549)
      at Io.runInChildSpan (../packages/database/node_modules/@prisma/client/runtime/library.js:121:1913)
      at r._executeRequest (../packages/database/node_modules/@prisma/client/runtime/library.js:130:10310)
      at il (../packages/database/node_modules/@prisma/client/runtime/library.js:31:9835)
      at l (../packages/database/node_modules/@prisma/client/runtime/library.js:130:9784)
      at ../packages/database/node_modules/@prisma/client/runtime/library.js:130:10078
      at ../packages/database/node_modules/@prisma/client/runtime/library.js:130:10058
      at Object.runInChildSpan (../packages/database/node_modules/@prisma/client/runtime/library.js:121:1549)
      at Io.runInChildSpan (../packages/database/node_modules/@prisma/client/runtime/library.js:121:1913)
      at r._request (../packages/database/node_modules/@prisma/client/runtime/library.js:130:9981)
      at e._createPrismaPromise.action (../packages/database/node_modules/@prisma/client/runtime/library.js:31:5390)
      at o (../packages/database/node_modules/@prisma/client/runtime/library.js:121:1018)
      at Proxy.then (../packages/database/node_modules/@prisma/client/runtime/library.js:121:1114)

[2025-12-27 23:18:23] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:23] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:23] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:23] info: [trainingModel.logTrainingSession] Logging training session for horse 5 in Show Jumping
[2025-12-27 23:18:24] error: [trainingModel.logTrainingSession] Database error: 
Invalid `prisma.trainingLog.create()` invocation:


Foreign key constraint violated on the constraint: `training_logs_horseId_fkey`
[2025-12-27 23:18:24] error: [trainingModel.logTrainingSession] Database error: Horse ID is required
[2025-12-27 23:18:24] error: [trainingModel.logTrainingSession] Database error: Discipline is required
[2025-12-27 23:18:24] error: [trainingModel.logTrainingSession] Database error: Horse ID must be a positive integer
[2025-12-27 23:18:24] error: [trainingModel.logTrainingSession] Database error: Horse ID must be a positive integer
[2025-12-27 23:18:24] error: [trainingModel.logTrainingSession] Database error: Horse ID must be a positive integer
[2025-12-27 23:18:24] info: [trainingModel.logTrainingSession] Logging training session for horse 5 in Racing
[2025-12-27 23:18:24] error: [trainingModel.logTrainingSession] Database error: 
Invalid `prisma.trainingLog.create()` invocation:


Foreign key constraint violated on the constraint: `training_logs_horseId_fkey`
[2025-12-27 23:18:24] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 5 in Show Jumping
[2025-12-27 23:18:24] info: [trainingModel.getLastTrainingDate] No training records found for horse 5 in Show Jumping
[2025-12-27 23:18:24] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 5 in Racing
[2025-12-27 23:18:24] info: [trainingModel.getLastTrainingDate] No training records found for horse 5 in Racing
[2025-12-27 23:18:24] error: [trainingModel.getLastTrainingDate] Database error: Horse ID must be a positive integer
[2025-12-27 23:18:24] error: [trainingModel.getLastTrainingDate] Database error: Horse ID must be a positive integer
[2025-12-27 23:18:24] error: [trainingModel.getLastTrainingDate] Database error: Horse ID must be a positive integer
[2025-12-27 23:18:24] error: [trainingModel.getLastTrainingDate] Database error: Discipline is required
[2025-12-27 23:18:24] error: [trainingModel.getLastTrainingDate] Database error: Discipline is required
[2025-12-27 23:18:24] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 5 in Racing
[2025-12-27 23:18:24] info: [trainingModel.getLastTrainingDate] No training records found for horse 5 in Racing
[2025-12-27 23:18:24] info: [trainingModel.getHorseAge] Getting age for horse 10
[2025-12-27 23:18:24] info: [trainingModel.getHorseAge] Horse 10 not found
[2025-12-27 23:18:24] info: [trainingModel.getHorseAge] Getting age for horse 999
[2025-12-27 23:18:24] info: [trainingModel.getHorseAge] Horse 999 not found
[2025-12-27 23:18:24] error: [trainingModel.getHorseAge] Database error: Horse ID must be a positive integer
[2025-12-27 23:18:24] error: [trainingModel.getHorseAge] Database error: Horse ID must be a positive integer
[2025-12-27 23:18:24] error: [trainingModel.getHorseAge] Database error: Horse ID must be a positive integer
[2025-12-27 23:18:24] info: [trainingModel.getHorseAge] Getting age for horse 5
[2025-12-27 23:18:24] info: [trainingModel.getHorseAge] Horse 5 not found
[2025-12-27 23:18:24] info: [trainingModel.logTrainingSession] Logging training session for horse 5 in Racing
[2025-12-27 23:18:24] error: [trainingModel.logTrainingSession] Database error: 
Invalid `prisma.trainingLog.create()` invocation:


Foreign key constraint violated on the constraint: `training_logs_horseId_fkey`
[2025-12-27 23:18:24] info: [trainingModel.getHorseAge] Getting age for horse 5
[2025-12-27 23:18:24] info: [trainingModel.getHorseAge] Horse 5 not found
FAIL tests/trainingModel.test.mjs
  üèãÔ∏è UNIT: Training Model - Training Session Logging & Horse Data
    logTrainingSession
      √ó should log a training session with all required fields (58 ms)
      ‚àö should throw error if horseId is missing (5 ms)
      ‚àö should throw error if discipline is missing (2 ms)
      ‚àö should throw error if horseId is not a positive integer (4 ms)
      √ó should handle database errors gracefully (15 ms)
    getLastTrainingDate
      √ó should return the most recent training date for horse and discipline (7 ms)
      ‚àö should return null if no training records found (4 ms)
      ‚àö should throw error if horseId is not a positive integer (4 ms)
      ‚àö should throw error if discipline is missing (4 ms)
      √ó should handle database errors gracefully (4 ms)
    getHorseAge
      √ó should return horse age from database (8 ms)
      ‚àö should return null if horse not found (6 ms)
      ‚àö should throw error if horseId is not a positive integer (4 ms)
      √ó should handle database errors gracefully (6 ms)
    Integration scenarios
      √ó should handle multiple training sessions for same horse different disciplines (6 ms)
      √ó should validate horse age before allowing training (6 ms)

  ‚óè üèãÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ logTrainingSession ‚Ä∫ should log a training session with all required fields

    Database error: 
    Invalid `prisma.trainingLog.create()` invocation:


    Foreign key constraint violated on the constraint: `training_logs_horseId_fkey`

    [0m [90m 47 |[39m   } [36mcatch[39m (error) {
     [90m 48 |[39m     logger[33m.[39merror([32m`[trainingModel.logTrainingSession] Database error: ${error.message}`[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 49 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error: ${error.message}`[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 50 |[39m   }
     [90m 51 |[39m }
     [90m 52 |[39m[0m

      at logTrainingSession (models/trainingModel.mjs:49:11)
      at Object.<anonymous> (tests/trainingModel.test.mjs:86:22)

  ‚óè üèãÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ logTrainingSession ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow(expected)

    Expected substring: "Database error: Database connection failed"
    Received message:   "Database error:¬∑
    Invalid `prisma.trainingLog.create()` invocation:¬∑¬∑
    Foreign key constraint violated on the constraint: `training_logs_horseId_fkey`"

        [0m [90m 47 |[39m   } [36mcatch[39m (error) {
         [90m 48 |[39m     logger[33m.[39merror([32m`[trainingModel.logTrainingSession] Database error: ${error.message}`[39m)[33m;[39m
        [31m[1m>[22m[39m[90m 49 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error: ${error.message}`[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 50 |[39m   }
         [90m 51 |[39m }
         [90m 52 |[39m[0m

      at logTrainingSession (models/trainingModel.mjs:49:11)
      at Object.<anonymous> (tests/trainingModel.test.mjs:123:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/trainingModel.test.mjs:123:86)

  ‚óè üèãÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ getLastTrainingDate ‚Ä∫ should return the most recent training date for horse and discipline

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"orderBy": {"trainedAt": "desc"}, "where": {"discipline": "Show Jumping", "horseId": 5}}

    Number of calls: 0

    [0m [90m 136 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getLastTrainingDate([35m5[39m[33m,[39m [32m'Show Jumping'[39m)[33m;[39m
     [90m 137 |[39m
    [31m[1m>[22m[39m[90m 138 |[39m       expect(mockTrainingLogFindFirst)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 139 |[39m         where[33m:[39m {
     [90m 140 |[39m           horseId[33m:[39m [35m5[39m[33m,[39m
     [90m 141 |[39m           discipline[33m:[39m [32m'Show Jumping'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingModel.test.mjs:138:40)

  ‚óè üèãÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ getLastTrainingDate ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: null

    [0m [90m 173 |[39m       mockTrainingLogFindFirst[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database connection failed'[39m))[33m;[39m
     [90m 174 |[39m
    [31m[1m>[22m[39m[90m 175 |[39m       [36mawait[39m expect(getLastTrainingDate([35m5[39m[33m,[39m [32m'Racing'[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Database error: Database connection failed'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 176 |[39m     })[33m;[39m
     [90m 177 |[39m   })[33m;[39m
     [90m 178 |[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/trainingModel.test.mjs:175:13)

  ‚óè üèãÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ getHorseAge ‚Ä∫ should return horse age from database

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"select": {"age": true}, "where": {"id": 10}}

    Number of calls: 0

    [0m [90m 186 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getHorseAge([35m10[39m)[33m;[39m
     [90m 187 |[39m
    [31m[1m>[22m[39m[90m 188 |[39m       expect(mockHorseFindUnique)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 189 |[39m         where[33m:[39m { id[33m:[39m [35m10[39m }[33m,[39m
     [90m 190 |[39m         select[33m:[39m { age[33m:[39m [36mtrue[39m }[33m,[39m
     [90m 191 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingModel.test.mjs:188:35)

  ‚óè üèãÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ getHorseAge ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: null

    [0m [90m 212 |[39m       mockHorseFindUnique[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database connection failed'[39m))[33m;[39m
     [90m 213 |[39m
    [31m[1m>[22m[39m[90m 214 |[39m       [36mawait[39m expect(getHorseAge([35m5[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Database error: Database connection failed'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 215 |[39m     })[33m;[39m
     [90m 216 |[39m   })[33m;[39m
     [90m 217 |[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/trainingModel.test.mjs:214:13)

  ‚óè üèãÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ Integration scenarios ‚Ä∫ should handle multiple training sessions for same horse different disciplines

    Database error: 
    Invalid `prisma.trainingLog.create()` invocation:


    Foreign key constraint violated on the constraint: `training_logs_horseId_fkey`

    [0m [90m 47 |[39m   } [36mcatch[39m (error) {
     [90m 48 |[39m     logger[33m.[39merror([32m`[trainingModel.logTrainingSession] Database error: ${error.message}`[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 49 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error: ${error.message}`[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 50 |[39m   }
     [90m 51 |[39m }
     [90m 52 |[39m[0m

      at logTrainingSession (models/trainingModel.mjs:49:11)
      at Object.<anonymous> (tests/trainingModel.test.mjs:228:7)

  ‚óè üèãÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ Integration scenarios ‚Ä∫ should validate horse age before allowing training

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: null

    [0m [90m 237 |[39m
     [90m 238 |[39m       [36mconst[39m age [33m=[39m [36mawait[39m getHorseAge([35m5[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 239 |[39m       expect(age)[33m.[39mtoBe([35m2[39m)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 240 |[39m
     [90m 241 |[39m       [90m// In the actual training logic, this would prevent training[39m
     [90m 242 |[39m       [90m// since horse is under 3 years old[39m[0m

      at Object.<anonymous> (tests/trainingModel.test.mjs:239:19)

[2025-12-27 23:18:24] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:24] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:24] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:24] error: [createUser] Error: Username, email, and password are required.
[2025-12-27 23:18:24] error: [createUser] Error: Username, email, and password are required.
[2025-12-27 23:18:24] error: [createUser] Error: Username, email, and password are required.
[2025-12-27 23:18:24] error: [getUserById] Error: User ID is required.
[2025-12-27 23:18:24] error: [getUserById] Error: User ID is required.
[2025-12-27 23:18:24] error: [getUserByEmail] Error: Email required.
[2025-12-27 23:18:24] error: [getUserByEmail] Error: Email required.
[2025-12-27 23:18:24] error: [getUserWithHorses] Error: User ID is required.
[2025-12-27 23:18:24] error: [updateUser] Error: User ID is required.
[2025-12-27 23:18:24] error: [deleteUser] Error: User ID is required.
[2025-12-27 23:18:24] error: [addXpToUser] Error: XP amount must be a positive number.
[2025-12-27 23:18:24] error: [addXpToUser] Error: User ID is required.
[2025-12-27 23:18:24] error: [getUserById] Error: User ID is required.
FAIL models/userModel.test.mjs
  üë§ UNIT: User Model - Database Operations & Business Logic
    createUser
      √ó should create a user successfully (3 ms)
      ‚àö should throw error if username is missing (4 ms)
      ‚àö should throw error if email is missing (2 ms)
      ‚àö should throw error if password is missing (2 ms)
      √ó should throw error on unique constraint violation for username (2 ms)
      √ó should throw error on unique constraint violation for email (1 ms)
      √ó should throw DatabaseError for other Prisma errors (5 ms)
    getUserById
      √ó should return user if found (1 ms)
      √ó should return null if user not found
      ‚àö should throw DatabaseError if ID is not provided (3 ms)
    getUserByEmail
      √ó should return user by email (case insensitive) (1 ms)
      ‚àö should throw DatabaseError if email is not provided (3 ms)
    getUserWithHorses
      √ó should return user with horses if found (1 ms)
      ‚àö should throw DatabaseError if ID is not provided (3 ms)
    updateUser
      √ó should update user successfully (1 ms)
      ‚àö should throw DatabaseError if ID is not provided (2 ms)
      √ó should handle Prisma update errors (user not found) (1 ms)
      √ó should handle general update errors (1 ms)
    deleteUser
      √ó should delete user successfully (1 ms)
      ‚àö should throw DatabaseError if ID is not provided (2 ms)
      √ó should handle Prisma delete errors (user not found)
    addXpToUser
      √ó should add XP without leveling up (1 ms)
      √ó should add XP and level up (1 ms)
      √ó should return error for invalid XP amount (4 ms)
      √ó should return error for invalid user ID (2 ms)
      √ó should return error if user not found (1 ms)
    getUserProgress
      √ó should return user progress (2 ms)
      ‚àö should throw DatabaseError if ID is not provided (2 ms)
      √ó should throw DatabaseError if user not found
    getUserStats
      √ó should return user stats with horses (1 ms)
      √ó should handle user with no horses (1 ms)
      √ó should handle user with null horses array (1 ms)
      √ó should return null for non-existent user
      ‚àö should throw DatabaseError if ID is not provided (1 ms)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ createUser ‚Ä∫ should create a user successfully

    TypeError: mockPrisma.user.create.mockResolvedValue is not a function

    [0m [90m 122 |[39m       }[33m;[39m
     [90m 123 |[39m
    [31m[1m>[22m[39m[90m 124 |[39m       mockPrisma[33m.[39muser[33m.[39mcreate[33m.[39mmockResolvedValue(mockCreatedUser)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 125 |[39m
     [90m 126 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m createUser(baseUserData)[33m;[39m
     [90m 127 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:124:30)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ createUser ‚Ä∫ should throw error on unique constraint violation for username

    TypeError: mockPrisma.user.create.mockRejectedValue is not a function

    [0m [90m 154 |[39m     it([32m'should throw error on unique constraint violation for username'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 155 |[39m       [36mconst[39m dbError [33m=[39m { code[33m:[39m [32m'P2002'[39m[33m,[39m meta[33m:[39m { target[33m:[39m [[32m'username'[39m] } }[33m;[39m
    [31m[1m>[22m[39m[90m 156 |[39m       mockPrisma[33m.[39muser[33m.[39mcreate[33m.[39mmockRejectedValue(dbError)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 157 |[39m       [36mawait[39m expect(createUser(baseUserData))[33m.[39mrejects[33m.[39mtoThrow([32m'Duplicate value for username.'[39m)[33m;[39m
     [90m 158 |[39m     })[33m;[39m
     [90m 159 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:156:30)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ createUser ‚Ä∫ should throw error on unique constraint violation for email

    TypeError: mockPrisma.user.create.mockRejectedValue is not a function

    [0m [90m 160 |[39m     it([32m'should throw error on unique constraint violation for email'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 161 |[39m       [36mconst[39m dbError [33m=[39m { code[33m:[39m [32m'P2002'[39m[33m,[39m meta[33m:[39m { target[33m:[39m [[32m'email'[39m] } }[33m;[39m
    [31m[1m>[22m[39m[90m 162 |[39m       mockPrisma[33m.[39muser[33m.[39mcreate[33m.[39mmockRejectedValue(dbError)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 163 |[39m       [36mawait[39m expect(createUser(baseUserData))[33m.[39mrejects[33m.[39mtoThrow([32m'Duplicate value for email.'[39m)[33m;[39m
     [90m 164 |[39m     })[33m;[39m
     [90m 165 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:162:30)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ createUser ‚Ä∫ should throw DatabaseError for other Prisma errors

    TypeError: mockPrisma.user.create.mockRejectedValue is not a function

    [0m [90m 166 |[39m     it([32m'should throw DatabaseError for other Prisma errors'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 167 |[39m       [36mconst[39m dbError [33m=[39m [36mnew[39m [33mError[39m([32m'Some other DB error'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 168 |[39m       mockPrisma[33m.[39muser[33m.[39mcreate[33m.[39mmockRejectedValue(dbError)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 169 |[39m       [36mawait[39m expect(createUser(baseUserData))[33m.[39mrejects[33m.[39mtoThrow(
     [90m 170 |[39m         [36mnew[39m [33mDatabaseError[39m([32m'Create user failed: Some other DB error'[39m)[33m,[39m
     [90m 171 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:168:30)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserById ‚Ä∫ should return user if found

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 175 |[39m     it([32m'should return user if found'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 176 |[39m       [36mconst[39m mockUser [33m=[39m { id[33m:[39m [35m1[39m[33m,[39m username[33m:[39m [32m'testuser'[39m[33m,[39m email[33m:[39m [32m'test@example.com'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 177 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 178 |[39m
     [90m 179 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserById([35m1[39m)[33m;[39m
     [90m 180 |[39m       expect(mockPrisma[33m.[39muser[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith({ where[33m:[39m { id[33m:[39m [35m1[39m } })[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:177:34)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserById ‚Ä∫ should return null if user not found

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 183 |[39m
     [90m 184 |[39m     it([32m'should return null if user not found'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 185 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 186 |[39m       [36mconst[39m user [33m=[39m [36mawait[39m getUserById([35m99[39m)[33m;[39m
     [90m 187 |[39m       expect(user)[33m.[39mtoBeNull()[33m;[39m
     [90m 188 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:185:34)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserByEmail ‚Ä∫ should return user by email (case insensitive)

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 197 |[39m     it([32m'should return user by email (case insensitive)'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 198 |[39m       [36mconst[39m mockUser [33m=[39m { id[33m:[39m [35m1[39m[33m,[39m email[33m:[39m [32m'test@example.com'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 199 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 200 |[39m
     [90m 201 |[39m       [36mconst[39m user [33m=[39m [36mawait[39m getUserByEmail([32m'TEST@EXAMPLE.COM'[39m)[33m;[39m
     [90m 202 |[39m       expect(mockPrisma[33m.[39muser[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith({[0m

      at Object.<anonymous> (models/userModel.test.mjs:199:34)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserWithHorses ‚Ä∫ should return user with horses if found

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 215 |[39m     it([32m'should return user with horses if found'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 216 |[39m       [36mconst[39m mockUser [33m=[39m { id[33m:[39m [35m1[39m[33m,[39m horses[33m:[39m [{ id[33m:[39m [35m101[39m[33m,[39m name[33m:[39m [32m'Spirit'[39m }] }[33m;[39m
    [31m[1m>[22m[39m[90m 217 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 218 |[39m
     [90m 219 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserWithHorses([35m1[39m)[33m;[39m
     [90m 220 |[39m       expect(mockPrisma[33m.[39muser[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith({[0m

      at Object.<anonymous> (models/userModel.test.mjs:217:34)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ updateUser ‚Ä∫ should update user successfully

    TypeError: mockPrisma.user.update.mockResolvedValue is not a function

    [0m [90m 235 |[39m     it([32m'should update user successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 236 |[39m       [36mconst[39m mockUpdatedUser [33m=[39m { id[33m:[39m [35m1[39m[33m,[39m username[33m:[39m [32m'testuser'[39m[33m,[39m [33m...[39mupdateData }[33m;[39m
    [31m[1m>[22m[39m[90m 237 |[39m       mockPrisma[33m.[39muser[33m.[39mupdate[33m.[39mmockResolvedValue(mockUpdatedUser)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 238 |[39m
     [90m 239 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m updateUser([35m1[39m[33m,[39m updateData)[33m;[39m
     [90m 240 |[39m       expect(mockPrisma[33m.[39muser[33m.[39mupdate)[33m.[39mtoHaveBeenCalledWith({[0m

      at Object.<anonymous> (models/userModel.test.mjs:237:30)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ updateUser ‚Ä∫ should handle Prisma update errors (user not found)

    TypeError: mockPrisma.user.update.mockRejectedValue is not a function

    [0m [90m 253 |[39m     it([32m'should handle Prisma update errors (user not found)'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 254 |[39m       [36mconst[39m prismaError [33m=[39m { code[33m:[39m [32m'P2025'[39m[33m,[39m message[33m:[39m [32m'Record to update not found.'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 255 |[39m       mockPrisma[33m.[39muser[33m.[39mupdate[33m.[39mmockRejectedValue(prismaError)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 256 |[39m
     [90m 257 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m updateUser([35m1[39m[33m,[39m updateData)[33m;[39m
     [90m 258 |[39m       expect(result)[33m.[39mtoBeNull()[33m;[39m [90m// Returns null when user not found[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:255:30)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ updateUser ‚Ä∫ should handle general update errors

    TypeError: mockPrisma.user.update.mockRejectedValue is not a function

    [0m [90m 261 |[39m     it([32m'should handle general update errors'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 262 |[39m       [36mconst[39m prismaError [33m=[39m { message[33m:[39m [32m'Some other update error'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 263 |[39m       mockPrisma[33m.[39muser[33m.[39mupdate[33m.[39mmockRejectedValue(prismaError)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 264 |[39m
     [90m 265 |[39m       [36mawait[39m expect(updateUser([35m1[39m[33m,[39m updateData))[33m.[39mrejects[33m.[39mtoThrow(
     [90m 266 |[39m         [36mnew[39m [33mDatabaseError[39m([32m'Update failed: Some other update error'[39m)[33m,[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:263:30)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ deleteUser ‚Ä∫ should delete user successfully

    TypeError: mockPrisma.user.delete.mockResolvedValue is not a function

    [0m [90m 272 |[39m     it([32m'should delete user successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 273 |[39m       [36mconst[39m deletedUser [33m=[39m { id[33m:[39m [35m1[39m[33m,[39m username[33m:[39m [32m'testuser'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 274 |[39m       mockPrisma[33m.[39muser[33m.[39m[36mdelete[39m[33m.[39mmockResolvedValue(deletedUser)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 275 |[39m
     [90m 276 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m deleteUser([35m1[39m)[33m;[39m
     [90m 277 |[39m       expect(mockPrisma[33m.[39muser[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith({ where[33m:[39m { id[33m:[39m [35m1[39m } })[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:274:30)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ deleteUser ‚Ä∫ should handle Prisma delete errors (user not found)

    TypeError: mockPrisma.user.delete.mockRejectedValue is not a function

    [0m [90m 285 |[39m     it([32m'should handle Prisma delete errors (user not found)'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 286 |[39m       [36mconst[39m prismaError [33m=[39m { code[33m:[39m [32m'P2025'[39m[33m,[39m message[33m:[39m [32m'Record to delete not found.'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 287 |[39m       mockPrisma[33m.[39muser[33m.[39m[36mdelete[39m[33m.[39mmockRejectedValue(prismaError)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 288 |[39m
     [90m 289 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m deleteUser([35m99[39m)[33m;[39m
     [90m 290 |[39m       expect(result)[33m.[39mtoBeNull()[33m;[39m [90m// Returns null when user not found[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:287:30)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ addXpToUser ‚Ä∫ should add XP without leveling up

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 296 |[39m
     [90m 297 |[39m     it([32m'should add XP without leveling up'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 298 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(baseUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 299 |[39m       [36mconst[39m updatedUser [33m=[39m { [33m...[39mbaseUser[33m,[39m xp[33m:[39m [35m70[39m[33m,[39m level[33m:[39m [35m1[39m }[33m;[39m
     [90m 300 |[39m       mockPrisma[33m.[39muser[33m.[39mupdate[33m.[39mmockResolvedValue(updatedUser)[33m;[39m
     [90m 301 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:298:34)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ addXpToUser ‚Ä∫ should add XP and level up

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 313 |[39m
     [90m 314 |[39m     it([32m'should add XP and level up'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 315 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(baseUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 316 |[39m       [36mconst[39m updatedUser [33m=[39m { [33m...[39mbaseUser[33m,[39m xp[33m:[39m [35m200[39m[33m,[39m level[33m:[39m [35m2[39m }[33m;[39m
     [90m 317 |[39m       mockPrisma[33m.[39muser[33m.[39mupdate[33m.[39mmockResolvedValue(updatedUser)[33m;[39m
     [90m 318 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:315:34)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ addXpToUser ‚Ä∫ should return error for invalid XP amount

    expect(received).toHaveBeenCalledWith(...expected)

    Matcher error: received value must be a mock or spy function

    Received has type:  function
    Received has value: [Function anonymous]

    [0m [90m 337 |[39m         })[33m,[39m
     [90m 338 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 339 |[39m       expect(mockLogger[33m.[39merror)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 340 |[39m         expect[33m.[39mstringContaining([32m'Error: XP amount must be a positive number.'[39m)[33m,[39m
     [90m 341 |[39m       )[33m;[39m
     [90m 342 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:339:32)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ addXpToUser ‚Ä∫ should return error for invalid user ID

    expect(received).toHaveBeenCalledWith(...expected)

    Matcher error: received value must be a mock or spy function

    Received has type:  function
    Received has value: [Function anonymous]

    [0m [90m 350 |[39m         })[33m,[39m
     [90m 351 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 352 |[39m       expect(mockLogger[33m.[39merror)[33m.[39mtoHaveBeenCalledWith(expect[33m.[39mstringContaining([32m'Error: User ID is required.'[39m))[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 353 |[39m     })[33m;[39m
     [90m 354 |[39m
     [90m 355 |[39m     it([32m'should return error if user not found'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (models/userModel.test.mjs:352:32)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ addXpToUser ‚Ä∫ should return error if user not found

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 354 |[39m
     [90m 355 |[39m     it([32m'should return error if user not found'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 356 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 357 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m addXpToUser([35m99[39m[33m,[39m [35m20[39m)[33m;[39m
     [90m 358 |[39m       expect(result)[33m.[39mtoEqual(
     [90m 359 |[39m         expect[33m.[39mobjectContaining({[0m

      at Object.<anonymous> (models/userModel.test.mjs:356:34)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserProgress ‚Ä∫ should return user progress

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 369 |[39m     it([32m'should return user progress'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 370 |[39m       [36mconst[39m mockUser [33m=[39m { id[33m:[39m [35m1[39m[33m,[39m level[33m:[39m [35m1[39m[33m,[39m xp[33m:[39m [35m50[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 371 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 372 |[39m
     [90m 373 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserProgress([35m1[39m)[33m;[39m
     [90m 374 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:371:34)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserProgress ‚Ä∫ should throw DatabaseError if user not found

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 389 |[39m
     [90m 390 |[39m     it([32m'should throw DatabaseError if user not found'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 391 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 392 |[39m       [36mawait[39m expect(getUserProgress([35m99[39m))[33m.[39mrejects[33m.[39mtoThrow([36mnew[39m [33mDatabaseError[39m([32m'Progress fetch failed: User not found.'[39m))[33m;[39m
     [90m 393 |[39m     })[33m;[39m
     [90m 394 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:391:34)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserStats ‚Ä∫ should return user stats with horses

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 409 |[39m       }[33m;[39m
     [90m 410 |[39m
    [31m[1m>[22m[39m[90m 411 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 412 |[39m
     [90m 413 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserStats([35m1[39m)[33m;[39m
     [90m 414 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:411:34)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserStats ‚Ä∫ should handle user with no horses

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 442 |[39m       }[33m;[39m
     [90m 443 |[39m
    [31m[1m>[22m[39m[90m 444 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 445 |[39m
     [90m 446 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserStats([35m2[39m)[33m;[39m
     [90m 447 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:444:34)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserStats ‚Ä∫ should handle user with null horses array

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 468 |[39m       }[33m;[39m
     [90m 469 |[39m
    [31m[1m>[22m[39m[90m 470 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 471 |[39m
     [90m 472 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserStats([35m3[39m)[33m;[39m
     [90m 473 |[39m       expect(result)[33m.[39mtoEqual([0m

      at Object.<anonymous> (models/userModel.test.mjs:470:34)

  ‚óè üë§ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserStats ‚Ä∫ should return null for non-existent user

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 480 |[39m
     [90m 481 |[39m     it([32m'should return null for non-existent user'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 482 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 483 |[39m
     [90m 484 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserStats([35m999[39m)[33m;[39m
     [90m 485 |[39m       expect(result)[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:482:34)

[2025-12-27 23:18:24] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:24] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:24] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/groomInteractionLimits.test.mjs
  üê¥ TDD: Groom Interaction Daily Limits - ALL Horses
    Adult Horse Daily Limits (FAILING TESTS - Current Implementation Bug)
      ‚àö should FAIL: 1-year-old horse should be limited to once per day (3 ms)
      ‚àö should FAIL: 2-year-old horse should be limited to once per day (1 ms)
    Foal Daily Limits (Should PASS with current implementation)
      ‚àö should correctly limit 3-day-old foal to once per day (1 ms)
    Edge Cases
      ‚àö should handle missing horse (3 ms)
      ‚àö should allow interaction when no previous interactions today (1 ms)

[2025-12-27 23:18:24] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:24] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:24] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:25] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:25] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:25] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:25] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:25] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:25] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:25] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:25] info: [POST] /api/auth/register
[2025-12-27 23:18:25] warn: [MemoryMonitoring] Memory threshold exceeded: 558MB
[2025-12-27 23:18:26] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:26] info: [EmailVerification] Created verification token
[2025-12-27 23:18:26] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: newuser@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=449d65e76b194c69903dfe117237b4fcde5d2716b14d1407f46131d5bcea3fd7

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:26] info: [authController.register] Verification email sent
[2025-12-27 23:18:26] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:26] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:26] info: [POST] /api/auth/register
[2025-12-27 23:18:26] warn: [MemoryMonitoring] Memory threshold exceeded: 555MB
[2025-12-27 23:18:26] warn: [Validation] Input validation failed
[2025-12-27 23:18:26] info: [POST] /api/auth/register - 400
[2025-12-27 23:18:26] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:26] info: [POST] /api/auth/register
[2025-12-27 23:18:26] warn: [MemoryMonitoring] Memory threshold exceeded: 552MB
[2025-12-27 23:18:26] warn: [Validation] Input validation failed
[2025-12-27 23:18:26] info: [POST] /api/auth/register - 400
[2025-12-27 23:18:26] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:26] info: [POST] /api/auth/register
[2025-12-27 23:18:26] warn: [MemoryMonitoring] Memory threshold exceeded: 562MB
[2025-12-27 23:18:26] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:26] info: [EmailVerification] Created verification token
[2025-12-27 23:18:26] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: duplicate@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=b0065d812e14f442fe248bbea907a714cc3336bd530e25d22df44570e7677c1f

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:26] info: [authController.register] Verification email sent
[2025-12-27 23:18:26] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:26] info: [POST] /api/auth/register
[2025-12-27 23:18:26] warn: [MemoryMonitoring] Memory threshold exceeded: 562MB
[2025-12-27 23:18:26] error: [authController.register] Error registering user: User with this email or username already exists
[2025-12-27 23:18:26] error: [POST] /api/auth/register - ERROR
[2025-12-27 23:18:26] error: Error User with this email or username already exists
[2025-12-27 23:18:26] info: [POST] /api/auth/register - 400
[2025-12-27 23:18:26] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:26] info: [POST] /api/auth/register
[2025-12-27 23:18:26] warn: [MemoryMonitoring] Memory threshold exceeded: 562MB
[2025-12-27 23:18:26] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:26] info: [EmailVerification] Created verification token
[2025-12-27 23:18:26] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: logintest@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=b6e61a21fde17bf56d18afeaa6ebd81f58a3bfa9471dba52742a4174ee95ce07

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:26] info: [authController.register] Verification email sent
[2025-12-27 23:18:26] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:26] info: [POST] /api/auth/login
[2025-12-27 23:18:26] warn: [MemoryMonitoring] Memory threshold exceeded: 563MB
[2025-12-27 23:18:27] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:27] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:18:27] info: [POST] /api/auth/login - 200
[2025-12-27 23:18:27] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:27] info: [POST] /api/auth/register
[2025-12-27 23:18:27] warn: [MemoryMonitoring] Memory threshold exceeded: 562MB
[2025-12-27 23:18:27] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:27] info: [EmailVerification] Created verification token
[2025-12-27 23:18:27] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: logintest@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=895fa3386c44983ee9d7af2557a3cfaef5547c374f10c4114ffeec1c09eae011

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:27] info: [authController.register] Verification email sent
[2025-12-27 23:18:27] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:27] info: [POST] /api/auth/login
[2025-12-27 23:18:27] warn: [MemoryMonitoring] Memory threshold exceeded: 564MB
[2025-12-27 23:18:27] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:18:27] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:18:27] error: Error Invalid credentials
[2025-12-27 23:18:27] info: [POST] /api/auth/login - 401
[2025-12-27 23:18:27] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:27] info: [POST] /api/auth/register
[2025-12-27 23:18:27] warn: [MemoryMonitoring] Memory threshold exceeded: 563MB
[2025-12-27 23:18:27] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:27] info: [EmailVerification] Created verification token
[2025-12-27 23:18:27] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: logintest@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=e4aef8951c8517ca6f863dd0aeaeae3812f5214858a8fbab92a8831e118fb5e2

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:27] info: [authController.register] Verification email sent
[2025-12-27 23:18:27] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:27] info: [POST] /api/auth/login
[2025-12-27 23:18:27] warn: [MemoryMonitoring] Memory threshold exceeded: 564MB
[2025-12-27 23:18:28] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:18:28] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:18:28] error: Error Invalid credentials
[2025-12-27 23:18:28] info: [POST] /api/auth/login - 401
[2025-12-27 23:18:28] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:28] info: [POST] /api/auth/register
[2025-12-27 23:18:28] warn: [MemoryMonitoring] Memory threshold exceeded: 565MB
[2025-12-27 23:18:28] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:28] info: [EmailVerification] Created verification token
[2025-12-27 23:18:28] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: logintest@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=edc01235e12ec1bd5ee8614490a9247850364fb109b5ba8302bb6d71d523fc06

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:28] info: [authController.register] Verification email sent
[2025-12-27 23:18:28] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:28] info: [POST] /api/auth/login
[2025-12-27 23:18:28] warn: [MemoryMonitoring] Memory threshold exceeded: 565MB
[2025-12-27 23:18:28] warn: [Validation] Input validation failed
[2025-12-27 23:18:28] info: [POST] /api/auth/login - 400
[2025-12-27 23:18:28] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:28] info: [POST] /api/auth/register
[2025-12-27 23:18:28] warn: [MemoryMonitoring] Memory threshold exceeded: 560MB
[2025-12-27 23:18:28] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:28] info: [EmailVerification] Created verification token
[2025-12-27 23:18:28] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: refreshtest@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=55062d1c5d9b3b648a90b369bfa79b9216bdabda68279e8f94257c01b81aa2e0

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:28] info: [authController.register] Verification email sent
[2025-12-27 23:18:28] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:28] info: [POST] /api/auth/refresh
[2025-12-27 23:18:28] warn: [MemoryMonitoring] Memory threshold exceeded: 561MB
[2025-12-27 23:18:28] info: [TokenRotation] Token rotation successful
[2025-12-27 23:18:28] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:18:28] info: [POST] /api/auth/refresh - 200
[2025-12-27 23:18:28] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:28] info: [POST] /api/auth/register
[2025-12-27 23:18:28] warn: [MemoryMonitoring] Memory threshold exceeded: 558MB
[2025-12-27 23:18:29] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:29] info: [EmailVerification] Created verification token
[2025-12-27 23:18:29] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: refreshtest@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=cd6063d11e612b90c0d7b5d7a5532e2bd706baab1ea22b9802be1c3273643fd9

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:29] info: [authController.register] Verification email sent
[2025-12-27 23:18:29] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:29] info: [POST] /api/auth/refresh
[2025-12-27 23:18:29] warn: [MemoryMonitoring] Memory threshold exceeded: 558MB
[2025-12-27 23:18:29] warn: [TokenRotation] Token reuse detected during rotation
[2025-12-27 23:18:29] warn: [authController.refreshToken] Token family invalidated due to reuse detection
[2025-12-27 23:18:29] error: [authController.refreshToken] Error refreshing token: Token reuse detected - please login again
[2025-12-27 23:18:29] error: [POST] /api/auth/refresh - ERROR
[2025-12-27 23:18:29] error: Error Token reuse detected - please login again
[2025-12-27 23:18:29] info: [POST] /api/auth/refresh - 401
[2025-12-27 23:18:29] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:29] info: [POST] /api/auth/register
[2025-12-27 23:18:29] warn: [MemoryMonitoring] Memory threshold exceeded: 559MB
[2025-12-27 23:18:29] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:29] info: [EmailVerification] Created verification token
[2025-12-27 23:18:29] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: refreshtest@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=1958e942f34ee3e27963e6c2b0779e4f1d2c84d7e163069db141d7dd85b72994

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:29] info: [authController.register] Verification email sent
[2025-12-27 23:18:29] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:29] info: [POST] /api/auth/refresh
[2025-12-27 23:18:29] warn: [MemoryMonitoring] Memory threshold exceeded: 558MB
[2025-12-27 23:18:29] warn: [Validation] Input validation failed
[2025-12-27 23:18:29] info: [POST] /api/auth/refresh - 400
[2025-12-27 23:18:29] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:29] info: [POST] /api/auth/register
[2025-12-27 23:18:29] warn: [MemoryMonitoring] Memory threshold exceeded: 569MB
[2025-12-27 23:18:30] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:30] info: [EmailVerification] Created verification token
[2025-12-27 23:18:30] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: profiletest@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=476e2ef55a22ac1fd4f7ed47cae31e2fb093c17bd46a86979e366efdfaeb9244

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:30] info: [authController.register] Verification email sent
[2025-12-27 23:18:30] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:30] info: [GET] /api/auth/me
[2025-12-27 23:18:30] warn: [MemoryMonitoring] Memory threshold exceeded: 568MB
[2025-12-27 23:18:30] info: [auth] Authenticated user 3eb80d0c-3567-4b35-a9f8-2011435a8c40 for GET /me
[2025-12-27 23:18:30] info: [GET] /api/auth/me - 200
[2025-12-27 23:18:30] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:30] info: [POST] /api/auth/register
[2025-12-27 23:18:30] warn: [MemoryMonitoring] Memory threshold exceeded: 565MB
[2025-12-27 23:18:30] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:30] info: [EmailVerification] Created verification token
[2025-12-27 23:18:30] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: profiletest@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=a4fa37f172823b5e17488c28f4df5fad812385aeb56a38663e1da8dea935c007

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:30] info: [authController.register] Verification email sent
[2025-12-27 23:18:30] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:30] info: [GET] /api/auth/me
[2025-12-27 23:18:30] warn: [MemoryMonitoring] Memory threshold exceeded: 567MB
[2025-12-27 23:18:30] warn: [auth] Access token is required for GET /me from ::ffff:127.0.0.1
[2025-12-27 23:18:30] info: [GET] /api/auth/me - 401
[2025-12-27 23:18:30] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:30] info: [POST] /api/auth/register
[2025-12-27 23:18:30] warn: [MemoryMonitoring] Memory threshold exceeded: 565MB
[2025-12-27 23:18:30] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:30] info: [EmailVerification] Created verification token
[2025-12-27 23:18:30] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: profiletest@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=737562903ec9e043cf17a4deed62103a5563eef3ca78728a70b5840436790a13

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:30] info: [authController.register] Verification email sent
[2025-12-27 23:18:30] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:30] info: [GET] /api/auth/me
[2025-12-27 23:18:30] warn: [MemoryMonitoring] Memory threshold exceeded: 567MB
[2025-12-27 23:18:30] warn: [auth] Invalid or expired token for GET /me from ::ffff:127.0.0.1
[2025-12-27 23:18:30] info: [GET] /api/auth/me - 401
[2025-12-27 23:18:30] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:30] info: [POST] /api/auth/register
[2025-12-27 23:18:30] warn: [MemoryMonitoring] Memory threshold exceeded: 565MB
[2025-12-27 23:18:31] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:31] info: [EmailVerification] Created verification token
[2025-12-27 23:18:31] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: logouttest@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=a9e96b4a0d4152b1b3b55b401211ff8f83a4baaed35007a0a750992e6b5bb038

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:31] info: [authController.register] Verification email sent
[2025-12-27 23:18:31] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:31] info: [POST] /api/auth/logout
[2025-12-27 23:18:31] warn: [MemoryMonitoring] Memory threshold exceeded: 567MB
[2025-12-27 23:18:31] info: [auth] Authenticated user 5a698732-619f-4040-a78d-dfbda57f07cf for POST /logout
[2025-12-27 23:18:31] info: [POST] /api/auth/logout - 200
[2025-12-27 23:18:31] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:18:31] info: [POST] /api/auth/register
[2025-12-27 23:18:31] warn: [MemoryMonitoring] Memory threshold exceeded: 564MB
[2025-12-27 23:18:31] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:31] info: [EmailVerification] Created verification token
[2025-12-27 23:18:31] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: logouttest@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=d5d692fa7e7b28ef34bb547fb99fc3deee7e7d6ad2ee38c212ae642bb68a9500

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:31] info: [authController.register] Verification email sent
[2025-12-27 23:18:31] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:31] info: [POST] /api/auth/logout
[2025-12-27 23:18:31] warn: [MemoryMonitoring] Memory threshold exceeded: 566MB
[2025-12-27 23:18:31] warn: [auth] Access token is required for POST /logout from ::ffff:127.0.0.1
[2025-12-27 23:18:31] info: [POST] /api/auth/logout - 401
PASS tests/auth.test.mjs (6.867 s)
  üîê INTEGRATION: Authentication System - User Registration & Session Management
    POST /api/auth/register
      ‚àö should register a new user and player successfully (460 ms)
      ‚àö should reject registration with invalid email (33 ms)
      ‚àö should reject registration with weak password (24 ms)
      ‚àö should reject duplicate email registration (351 ms)
    POST /api/auth/login
      ‚àö should login successfully with valid credentials (652 ms)
      ‚àö should reject login with invalid email (354 ms)
      ‚àö should reject login with invalid password (658 ms)
      ‚àö should reject login with malformed email (354 ms)
    POST /api/auth/refresh
      ‚àö should refresh token successfully with valid refresh token (374 ms)
      ‚àö should reject refresh with invalid token (359 ms)
      ‚àö should reject refresh without token (364 ms)
    GET /api/auth/me
      ‚àö should get user profile successfully with valid token (422 ms)
      ‚àö should reject profile request without token (365 ms)
      ‚àö should reject profile request with invalid token (363 ms)
    POST /api/auth/logout
      ‚àö should logout successfully with valid token (410 ms)
      ‚àö should reject logout without token (369 ms)

[2025-12-27 23:18:31] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:31] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:31] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:32] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:32] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:32] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:32] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:32] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:32] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:32] info: [POST] /auth/register
[2025-12-27 23:18:32] warn: [MemoryMonitoring] Memory threshold exceeded: 606MB
[2025-12-27 23:18:32] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:32] info: [EmailVerification] Created verification token
[2025-12-27 23:18:32] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: cookietest1@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=974d1415b22fc1c4e84801f539477cbf0717215325715c7680f4dc7145b0fcfa

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:32] info: [authController.register] Verification email sent
[2025-12-27 23:18:32] info: [POST] /auth/register - 201
[2025-12-27 23:18:33] info: [POST] /auth/register
[2025-12-27 23:18:33] warn: [MemoryMonitoring] Memory threshold exceeded: 602MB
[2025-12-27 23:18:33] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:33] info: [EmailVerification] Created verification token
[2025-12-27 23:18:33] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: cookietest2@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=8b5e7a00464c77c4a8ee6163c9b57c35efb7bccc0228a14489a12866e8362463

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:33] info: [authController.register] Verification email sent
[2025-12-27 23:18:33] info: [POST] /auth/register - 201
[2025-12-27 23:18:33] info: [POST] /auth/register
[2025-12-27 23:18:33] warn: [MemoryMonitoring] Memory threshold exceeded: 605MB
[2025-12-27 23:18:33] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:33] info: [EmailVerification] Created verification token
[2025-12-27 23:18:33] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: cookietest3@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=a7f454275bdfc552b37c7a90fcc077b566a8cd827e677a4e26674a5243abe2e0

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:33] info: [authController.register] Verification email sent
[2025-12-27 23:18:33] info: [POST] /auth/register - 201
[2025-12-27 23:18:33] info: [POST] /auth/register
[2025-12-27 23:18:33] warn: [MemoryMonitoring] Memory threshold exceeded: 608MB
[2025-12-27 23:18:34] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:34] info: [EmailVerification] Created verification token
[2025-12-27 23:18:34] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: logincookietest@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=7ce009d531b20bee58a6aef5da2fb73bd60a57324d027b3b063d2d5b1f77f859

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:34] info: [authController.register] Verification email sent
[2025-12-27 23:18:34] info: [POST] /auth/register - 201
[2025-12-27 23:18:34] info: [POST] /auth/login
[2025-12-27 23:18:34] warn: [MemoryMonitoring] Memory threshold exceeded: 612MB
[2025-12-27 23:18:34] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:34] info: [POST] /auth/login - 200
[2025-12-27 23:18:34] info: [POST] /auth/register
[2025-12-27 23:18:34] warn: [MemoryMonitoring] Memory threshold exceeded: 608MB
[2025-12-27 23:18:34] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:34] info: [EmailVerification] Created verification token
[2025-12-27 23:18:34] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: logincookietest@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=43270fdc623875e1902e5f13c30dbd53c7ac4d35276897d6a325369691fc8cc5

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:34] info: [authController.register] Verification email sent
[2025-12-27 23:18:34] info: [POST] /auth/register - 201
[2025-12-27 23:18:34] info: [POST] /auth/login
[2025-12-27 23:18:34] warn: [MemoryMonitoring] Memory threshold exceeded: 611MB
[2025-12-27 23:18:34] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:34] info: [POST] /auth/login - 200
[2025-12-27 23:18:34] info: [POST] /auth/register
[2025-12-27 23:18:34] warn: [MemoryMonitoring] Memory threshold exceeded: 609MB
[2025-12-27 23:18:34] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:34] info: [EmailVerification] Created verification token
[2025-12-27 23:18:34] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: logincookietest@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=c8716d822006678ace2e3b7d3a4e430e8a396bffd22a5926b850f794dab9e2f9

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:34] info: [authController.register] Verification email sent
[2025-12-27 23:18:34] info: [POST] /auth/register - 201
[2025-12-27 23:18:34] info: [POST] /auth/login
[2025-12-27 23:18:34] warn: [MemoryMonitoring] Memory threshold exceeded: 612MB
[2025-12-27 23:18:34] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:34] info: [POST] /auth/login - 200
[2025-12-27 23:18:34] info: [POST] /auth/register
[2025-12-27 23:18:34] warn: [MemoryMonitoring] Memory threshold exceeded: 609MB
[2025-12-27 23:18:35] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:35] info: [EmailVerification] Created verification token
[2025-12-27 23:18:35] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: refreshcookietest@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=923807aa69361e264486c5b1f92ae42cc0819cc085a1f703e10bf5d2de2390cf

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:35] info: [authController.register] Verification email sent
[2025-12-27 23:18:35] info: [POST] /auth/register - 201
[2025-12-27 23:18:35] info: [POST] /auth/login
[2025-12-27 23:18:35] warn: [MemoryMonitoring] Memory threshold exceeded: 612MB
[2025-12-27 23:18:35] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:35] info: [POST] /auth/login - 200
[2025-12-27 23:18:35] info: [POST] /auth/refresh-token
[2025-12-27 23:18:35] warn: [MemoryMonitoring] Memory threshold exceeded: 609MB
[2025-12-27 23:18:35] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:35] info: [POST] /auth/refresh-token - 200
[2025-12-27 23:18:35] info: [POST] /auth/register
[2025-12-27 23:18:35] warn: [MemoryMonitoring] Memory threshold exceeded: 607MB
[2025-12-27 23:18:35] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:35] info: [EmailVerification] Created verification token
[2025-12-27 23:18:35] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: refreshcookietest@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=5f32a2644872e03d4e40db6907e9693007c0677efd4b8d2a2dd9f6de474b8ec4

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:35] info: [authController.register] Verification email sent
[2025-12-27 23:18:35] info: [POST] /auth/register - 201
[2025-12-27 23:18:35] info: [POST] /auth/login
[2025-12-27 23:18:35] warn: [MemoryMonitoring] Memory threshold exceeded: 609MB
[2025-12-27 23:18:35] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:35] info: [POST] /auth/login - 200
[2025-12-27 23:18:35] info: [POST] /auth/refresh-token
[2025-12-27 23:18:35] warn: [MemoryMonitoring] Memory threshold exceeded: 605MB
[2025-12-27 23:18:35] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:35] info: [POST] /auth/refresh-token - 200
[2025-12-27 23:18:35] info: [POST] /auth/register
[2025-12-27 23:18:35] warn: [MemoryMonitoring] Memory threshold exceeded: 617MB
[2025-12-27 23:18:35] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:35] info: [EmailVerification] Created verification token
[2025-12-27 23:18:35] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: refreshcookietest@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=451daba83e7af6812b1ca2b6180296460eb2781478e0c338d788b69989c158e8

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:35] info: [authController.register] Verification email sent
[2025-12-27 23:18:35] info: [POST] /auth/register - 201
[2025-12-27 23:18:35] info: [POST] /auth/login
[2025-12-27 23:18:35] warn: [MemoryMonitoring] Memory threshold exceeded: 617MB
[2025-12-27 23:18:36] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:36] info: [POST] /auth/login - 200
[2025-12-27 23:18:36] info: [POST] /auth/refresh-token
[2025-12-27 23:18:36] warn: [MemoryMonitoring] Memory threshold exceeded: 612MB
[2025-12-27 23:18:36] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:36] info: [POST] /auth/refresh-token - 200
[2025-12-27 23:18:36] info: [POST] /auth/register
[2025-12-27 23:18:36] warn: [MemoryMonitoring] Memory threshold exceeded: 611MB
[2025-12-27 23:18:36] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:36] info: [EmailVerification] Created verification token
[2025-12-27 23:18:36] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: logoutcookietest@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=5b3473731a7e086619ed9ebc3c0e3c3bb2a8947ea591cf860f8c99c84026bb66

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:36] info: [authController.register] Verification email sent
[2025-12-27 23:18:36] info: [POST] /auth/register - 201
[2025-12-27 23:18:36] info: [POST] /auth/login
[2025-12-27 23:18:36] warn: [MemoryMonitoring] Memory threshold exceeded: 613MB
[2025-12-27 23:18:36] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:36] info: [POST] /auth/login - 200
[2025-12-27 23:18:36] info: [POST] /auth/logout
[2025-12-27 23:18:36] warn: [MemoryMonitoring] Memory threshold exceeded: 610MB
[2025-12-27 23:18:36] info: [POST] /auth/logout - 200
[2025-12-27 23:18:36] info: [POST] /auth/register
[2025-12-27 23:18:36] warn: [MemoryMonitoring] Memory threshold exceeded: 607MB
[2025-12-27 23:18:36] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:36] info: [EmailVerification] Created verification token
[2025-12-27 23:18:36] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: logoutcookietest@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=66f0eac62d0a66390d7fa9986bfa5657ef5a82b35b48669d329ec68e671df15d

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:36] info: [authController.register] Verification email sent
[2025-12-27 23:18:36] info: [POST] /auth/register - 201
[2025-12-27 23:18:36] info: [POST] /auth/login
[2025-12-27 23:18:36] warn: [MemoryMonitoring] Memory threshold exceeded: 608MB
[2025-12-27 23:18:36] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:36] info: [POST] /auth/login - 200
[2025-12-27 23:18:36] info: [POST] /auth/logout
[2025-12-27 23:18:36] warn: [MemoryMonitoring] Memory threshold exceeded: 618MB
[2025-12-27 23:18:36] info: [POST] /auth/logout - 200
[2025-12-27 23:18:36] info: [POST] /auth/register
[2025-12-27 23:18:36] warn: [MemoryMonitoring] Memory threshold exceeded: 614MB
[2025-12-27 23:18:37] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:37] info: [EmailVerification] Created verification token
[2025-12-27 23:18:37] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: logoutcookietest@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=7bcc9f735ec9458c04a7f32a5fc8635eed2105a2af199011c961b7f6f2b3d120

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:37] info: [authController.register] Verification email sent
[2025-12-27 23:18:37] info: [POST] /auth/register - 201
[2025-12-27 23:18:37] info: [POST] /auth/login
[2025-12-27 23:18:37] warn: [MemoryMonitoring] Memory threshold exceeded: 616MB
[2025-12-27 23:18:37] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:37] info: [POST] /auth/login - 200
[2025-12-27 23:18:37] info: [POST] /auth/logout
[2025-12-27 23:18:37] warn: [MemoryMonitoring] Memory threshold exceeded: 611MB
[2025-12-27 23:18:37] info: [POST] /auth/logout - 200
[2025-12-27 23:18:37] info: [POST] /auth/register
[2025-12-27 23:18:37] warn: [MemoryMonitoring] Memory threshold exceeded: 608MB
[2025-12-27 23:18:37] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:37] info: [EmailVerification] Created verification token
[2025-12-27 23:18:37] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: securitytest1@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=f8de14336654b878b80a978fc6487c4523bb1c5d5a2bf28be5e030bbf04b2810

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:37] info: [authController.register] Verification email sent
[2025-12-27 23:18:37] info: [POST] /auth/register - 201
[2025-12-27 23:18:37] info: [POST] /auth/login
[2025-12-27 23:18:37] warn: [MemoryMonitoring] Memory threshold exceeded: 608MB
[2025-12-27 23:18:37] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:37] info: [POST] /auth/login - 200
[2025-12-27 23:18:37] info: [POST] /auth/refresh-token
[2025-12-27 23:18:37] warn: [MemoryMonitoring] Memory threshold exceeded: 619MB
[2025-12-27 23:18:37] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:37] info: [POST] /auth/refresh-token - 200
PASS __tests__/integration/cookieIntegration.test.mjs (6.129 s)
  Cookie Integration Tests
    Registration Endpoint Cookies
      ‚àö should set accessToken cookie with correct attributes (407 ms)
      ‚àö should set refreshToken cookie with correct attributes (348 ms)
      ‚àö should set both cookies in a single response (333 ms)
    Login Endpoint Cookies
      ‚àö should set cookies on successful login (363 ms)
      ‚àö should set accessToken cookie with correct attributes on login (365 ms)
      ‚àö should set refreshToken cookie with correct attributes on login (364 ms)
    Token Refresh Endpoint Cookies
      ‚àö should set new cookies on token refresh (463 ms)
      ‚àö should set new accessToken cookie with correct attributes (386 ms)
      ‚àö should set new refreshToken cookie with correct attributes (403 ms)
    Logout Endpoint Cookie Clearing
      ‚àö should clear accessToken cookie on logout (455 ms)
      ‚àö should clear refreshToken cookie on logout (403 ms)
      ‚àö should maintain same path when clearing cookies (420 ms)
    Cookie Security Attributes
      ‚àö should use consistent security attributes across all endpoints (402 ms)

[2025-12-27 23:18:37] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:37] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:37] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:38] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:38] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:38] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:38] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:38] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:38] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:38] info: [POST] /auth/register
[2025-12-27 23:18:38] warn: [MemoryMonitoring] Memory threshold exceeded: 648MB
[2025-12-27 23:18:39] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:39] info: [EmailVerification] Created verification token
[2025-12-27 23:18:39] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895518655@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=0968435f1cf56e07c0c318bb5163e37f9daccfe07cfc7781c8e039f060591405

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:39] info: [authController.register] Verification email sent
[2025-12-27 23:18:39] info: [POST] /auth/register - 201
[2025-12-27 23:18:39] info: [GET] /auth/csrf-token
[2025-12-27 23:18:39] warn: [MemoryMonitoring] Memory threshold exceeded: 654MB
[2025-12-27 23:18:39] info: [CSRF] Token generated
[2025-12-27 23:18:39] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:18:39] info: [POST] /auth/register
[2025-12-27 23:18:39] warn: [MemoryMonitoring] Memory threshold exceeded: 653MB
[2025-12-27 23:18:39] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:39] info: [EmailVerification] Created verification token
[2025-12-27 23:18:39] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895519096@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=1b9a168a32c5464f20ceb40ff8e878e2f5b7fd5a59160c487eb3e0dfa2b82839

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:39] info: [authController.register] Verification email sent
[2025-12-27 23:18:39] info: [POST] /auth/register - 201
[2025-12-27 23:18:39] info: [GET] /auth/csrf-token
[2025-12-27 23:18:39] warn: [MemoryMonitoring] Memory threshold exceeded: 655MB
[2025-12-27 23:18:39] info: [CSRF] Token generated
[2025-12-27 23:18:39] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:18:39] info: [POST] /auth/register
[2025-12-27 23:18:39] warn: [MemoryMonitoring] Memory threshold exceeded: 653MB
[2025-12-27 23:18:39] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:39] info: [EmailVerification] Created verification token
[2025-12-27 23:18:39] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895519475@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=6b799d59a132101da65176d18c4322f7f0d4e695263a018e6554b1074d218a85

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:39] info: [authController.register] Verification email sent
[2025-12-27 23:18:39] info: [POST] /auth/register - 201
[2025-12-27 23:18:39] info: [GET] /auth/csrf-token
[2025-12-27 23:18:39] warn: [MemoryMonitoring] Memory threshold exceeded: 655MB
[2025-12-27 23:18:39] info: [CSRF] Token generated
[2025-12-27 23:18:39] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:18:39] info: [GET] /auth/csrf-token
[2025-12-27 23:18:39] warn: [MemoryMonitoring] Memory threshold exceeded: 652MB
[2025-12-27 23:18:39] info: [CSRF] Token generated
[2025-12-27 23:18:39] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:18:39] info: [POST] /auth/register
[2025-12-27 23:18:39] warn: [MemoryMonitoring] Memory threshold exceeded: 652MB
[2025-12-27 23:18:40] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:40] info: [EmailVerification] Created verification token
[2025-12-27 23:18:40] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895519867@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=7276cb5ec237ab9e669e7a4fedda46f3b1f6c787f6c60cdc29bef3add8ff549a

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:40] info: [authController.register] Verification email sent
[2025-12-27 23:18:40] info: [POST] /auth/register - 201
[2025-12-27 23:18:40] info: [GET] /auth/csrf-token
[2025-12-27 23:18:40] warn: [MemoryMonitoring] Memory threshold exceeded: 653MB
[2025-12-27 23:18:40] info: [CSRF] Token generated
[2025-12-27 23:18:40] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:18:40] info: [PUT] /api/users/a63f5379-a4d2-42f4-93d5-d70fde3bbc8a
[2025-12-27 23:18:40] warn: [MemoryMonitoring] Memory threshold exceeded: 650MB
[2025-12-27 23:18:40] info: [auth] Authenticated user a63f5379-a4d2-42f4-93d5-d70fde3bbc8a for PUT /users/a63f5379-a4d2-42f4-93d5-d70fde3bbc8a
[2025-12-27 23:18:40] info: [PUT] /api/users/a63f5379-a4d2-42f4-93d5-d70fde3bbc8a - 403
[2025-12-27 23:18:40] info: [POST] /auth/register
[2025-12-27 23:18:40] warn: [MemoryMonitoring] Memory threshold exceeded: 663MB
[2025-12-27 23:18:40] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:40] info: [EmailVerification] Created verification token
[2025-12-27 23:18:40] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895520248@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=9826a605c61a934a8b407893454a4839d4be8384efe164f01ebe8e11dfdb9d01

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:40] info: [authController.register] Verification email sent
[2025-12-27 23:18:40] info: [POST] /auth/register - 201
[2025-12-27 23:18:40] info: [GET] /auth/csrf-token
[2025-12-27 23:18:40] warn: [MemoryMonitoring] Memory threshold exceeded: 651MB
[2025-12-27 23:18:40] info: [CSRF] Token generated
[2025-12-27 23:18:40] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:18:40] info: [PUT] /api/users/d128750f-fd9b-44e0-bf40-114a2a70c7f8
[2025-12-27 23:18:40] warn: [MemoryMonitoring] Memory threshold exceeded: 650MB
[2025-12-27 23:18:40] info: [auth] Authenticated user d128750f-fd9b-44e0-bf40-114a2a70c7f8 for PUT /users/d128750f-fd9b-44e0-bf40-114a2a70c7f8
[2025-12-27 23:18:40] info: [PUT] /api/users/d128750f-fd9b-44e0-bf40-114a2a70c7f8 - 403
[2025-12-27 23:18:40] info: [POST] /auth/register
[2025-12-27 23:18:40] warn: [MemoryMonitoring] Memory threshold exceeded: 663MB
[2025-12-27 23:18:40] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:40] info: [EmailVerification] Created verification token
[2025-12-27 23:18:40] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895520644@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=d20e870086ba2ff7f2c0305a3d9d06bb7e6e2da716d4cf3b086c15450be48fb6

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:40] info: [authController.register] Verification email sent
[2025-12-27 23:18:40] info: [POST] /auth/register - 201
[2025-12-27 23:18:40] info: [GET] /auth/csrf-token
[2025-12-27 23:18:40] warn: [MemoryMonitoring] Memory threshold exceeded: 664MB
[2025-12-27 23:18:40] info: [CSRF] Token generated
[2025-12-27 23:18:40] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:18:41] info: [DELETE] /api/users/20d810a2-ce39-40ec-9a99-32ea7e5c6c5d
[2025-12-27 23:18:41] warn: [MemoryMonitoring] Memory threshold exceeded: 660MB
[2025-12-27 23:18:41] info: [auth] Authenticated user 20d810a2-ce39-40ec-9a99-32ea7e5c6c5d for DELETE /users/20d810a2-ce39-40ec-9a99-32ea7e5c6c5d
[2025-12-27 23:18:41] info: [DELETE] /api/users/20d810a2-ce39-40ec-9a99-32ea7e5c6c5d - 403
[2025-12-27 23:18:41] info: [POST] /auth/register
[2025-12-27 23:18:41] warn: [MemoryMonitoring] Memory threshold exceeded: 659MB
[2025-12-27 23:18:41] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:41] info: [EmailVerification] Created verification token
[2025-12-27 23:18:41] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895521043@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=e0064fc86bf4c6d4a9e2560cf752892ccf11cf87f733be16c630d90001ac4f81

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:41] info: [authController.register] Verification email sent
[2025-12-27 23:18:41] info: [POST] /auth/register - 201
[2025-12-27 23:18:41] info: [GET] /auth/csrf-token
[2025-12-27 23:18:41] warn: [MemoryMonitoring] Memory threshold exceeded: 662MB
[2025-12-27 23:18:41] info: [CSRF] Token generated
[2025-12-27 23:18:41] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:18:41] info: [PATCH] /api/users/9d6ec3c0-7dd8-439a-826d-f3037f89fb5b
[2025-12-27 23:18:41] warn: [MemoryMonitoring] Memory threshold exceeded: 659MB
[2025-12-27 23:18:41] info: [auth] Authenticated user 9d6ec3c0-7dd8-439a-826d-f3037f89fb5b for PATCH /users/9d6ec3c0-7dd8-439a-826d-f3037f89fb5b
[2025-12-27 23:18:41] info: [PATCH] /api/users/9d6ec3c0-7dd8-439a-826d-f3037f89fb5b - 403
[2025-12-27 23:18:41] info: [POST] /auth/register
[2025-12-27 23:18:41] warn: [MemoryMonitoring] Memory threshold exceeded: 656MB
[2025-12-27 23:18:41] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:41] info: [EmailVerification] Created verification token
[2025-12-27 23:18:41] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895521418@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=b267948770a56a9db68c03c9412b0aecfda933209cd33277bb3ab39b2c86dec2

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:41] info: [authController.register] Verification email sent
[2025-12-27 23:18:41] info: [POST] /auth/register - 201
[2025-12-27 23:18:41] info: [GET] /api/users/9c944db7-42b3-4d66-b1ce-603b580210e9
[2025-12-27 23:18:41] warn: [MemoryMonitoring] Memory threshold exceeded: 657MB
[2025-12-27 23:18:41] info: [auth] Authenticated user 9c944db7-42b3-4d66-b1ce-603b580210e9 for GET /users/9c944db7-42b3-4d66-b1ce-603b580210e9
[2025-12-27 23:18:41] info: [auth] Authenticated user 9c944db7-42b3-4d66-b1ce-603b580210e9 for GET /9c944db7-42b3-4d66-b1ce-603b580210e9
[2025-12-27 23:18:41] info: [userRoutes] Self-access validated: user 9c944db7-42b3-4d66-b1ce-603b580210e9 accessing own data
[2025-12-27 23:18:41] info: [userController.getUser] Getting user 9c944db7-42b3-4d66-b1ce-603b580210e9
[2025-12-27 23:18:41] info: [GET] /api/users/9c944db7-42b3-4d66-b1ce-603b580210e9 - 200
[2025-12-27 23:18:41] info: [POST] /auth/register
[2025-12-27 23:18:41] warn: [MemoryMonitoring] Memory threshold exceeded: 658MB
[2025-12-27 23:18:42] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:42] info: [EmailVerification] Created verification token
[2025-12-27 23:18:42] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895521775@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=0545c55f2b0cbd1b1d77591198a2a44db9763911dfd7fb40f3125c53aa45dbde

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:42] info: [authController.register] Verification email sent
[2025-12-27 23:18:42] info: [POST] /auth/register - 201
[2025-12-27 23:18:42] info: [HEAD] /health
[2025-12-27 23:18:42] warn: [MemoryMonitoring] Memory threshold exceeded: 661MB
[2025-12-27 23:18:42] info: [HEAD] /health - 200
[2025-12-27 23:18:42] info: [POST] /auth/register
[2025-12-27 23:18:42] warn: [MemoryMonitoring] Memory threshold exceeded: 658MB
[2025-12-27 23:18:42] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:42] info: [EmailVerification] Created verification token
[2025-12-27 23:18:42] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895522141@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=89d38ade70942bd0c1d0a3a07aabcc409f209fe565f90381d366673ea5338cc5

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:42] info: [authController.register] Verification email sent
[2025-12-27 23:18:42] info: [POST] /auth/register - 201
[2025-12-27 23:18:42] info: [POST] /auth/register
[2025-12-27 23:18:42] warn: [MemoryMonitoring] Memory threshold exceeded: 666MB
[2025-12-27 23:18:42] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:42] info: [EmailVerification] Created verification token
[2025-12-27 23:18:42] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895522486@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=e1bb1aa3859244f7fc5691c7830f437f5cc303e67de5b2f406fb07217b47be10

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:42] info: [authController.register] Verification email sent
[2025-12-27 23:18:42] info: [POST] /auth/register - 201
[2025-12-27 23:18:42] info: [POST] /api/users/me
[2025-12-27 23:18:42] warn: [MemoryMonitoring] Memory threshold exceeded: 653MB
[2025-12-27 23:18:42] info: [auth] Authenticated user 4dd0b54e-23a7-4dd1-bd20-b2bb1be290d9 for POST /users/me
[2025-12-27 23:18:42] info: [POST] /api/users/me - 403
[2025-12-27 23:18:42] info: [POST] /auth/register
[2025-12-27 23:18:42] warn: [MemoryMonitoring] Memory threshold exceeded: 666MB
[2025-12-27 23:18:43] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:43] info: [EmailVerification] Created verification token
[2025-12-27 23:18:43] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895522862@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=e173938f5db8936c005a10027b097741270c5c1dd6b752dd5f4e039b1737228f

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:43] info: [authController.register] Verification email sent
[2025-12-27 23:18:43] info: [POST] /auth/register - 201
[2025-12-27 23:18:43] info: [PUT] /api/users/49702922-8e42-4420-b6c6-7972aa463add
[2025-12-27 23:18:43] warn: [MemoryMonitoring] Memory threshold exceeded: 665MB
[2025-12-27 23:18:43] info: [auth] Authenticated user 49702922-8e42-4420-b6c6-7972aa463add for PUT /users/49702922-8e42-4420-b6c6-7972aa463add
[2025-12-27 23:18:43] info: [PUT] /api/users/49702922-8e42-4420-b6c6-7972aa463add - 403
[2025-12-27 23:18:43] info: [POST] /auth/register
[2025-12-27 23:18:43] warn: [MemoryMonitoring] Memory threshold exceeded: 663MB
[2025-12-27 23:18:43] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:43] info: [EmailVerification] Created verification token
[2025-12-27 23:18:43] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895523218@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=ef84af207010977e943cde57f18f7301d8b7eb6c1853fe50f5b670118a342a75

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:43] info: [authController.register] Verification email sent
[2025-12-27 23:18:43] info: [POST] /auth/register - 201
[2025-12-27 23:18:43] info: [DELETE] /api/users/641b88f0-bae2-4a53-b592-e00b41a07629
[2025-12-27 23:18:43] warn: [MemoryMonitoring] Memory threshold exceeded: 663MB
[2025-12-27 23:18:43] info: [auth] Authenticated user 641b88f0-bae2-4a53-b592-e00b41a07629 for DELETE /users/641b88f0-bae2-4a53-b592-e00b41a07629
[2025-12-27 23:18:43] info: [DELETE] /api/users/641b88f0-bae2-4a53-b592-e00b41a07629 - 403
[2025-12-27 23:18:43] info: [POST] /auth/register
[2025-12-27 23:18:43] warn: [MemoryMonitoring] Memory threshold exceeded: 661MB
[2025-12-27 23:18:43] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:43] info: [EmailVerification] Created verification token
[2025-12-27 23:18:43] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895523577@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=bf61f75b7a7d211dbfe7f67d0ce1d6284467a90d77017330294709ac042e27e0

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:43] info: [authController.register] Verification email sent
[2025-12-27 23:18:43] info: [POST] /auth/register - 201
[2025-12-27 23:18:43] info: [GET] /auth/csrf-token
[2025-12-27 23:18:43] warn: [MemoryMonitoring] Memory threshold exceeded: 664MB
[2025-12-27 23:18:43] info: [CSRF] Token generated
[2025-12-27 23:18:43] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:18:43] info: [PUT] /api/users/437cfdad-c91a-4cb6-ad7a-8b0a89d0972a
[2025-12-27 23:18:43] warn: [MemoryMonitoring] Memory threshold exceeded: 661MB
[2025-12-27 23:18:43] info: [auth] Authenticated user 437cfdad-c91a-4cb6-ad7a-8b0a89d0972a for PUT /users/437cfdad-c91a-4cb6-ad7a-8b0a89d0972a
[2025-12-27 23:18:43] info: [auth] Authenticated user 437cfdad-c91a-4cb6-ad7a-8b0a89d0972a for PUT /437cfdad-c91a-4cb6-ad7a-8b0a89d0972a
[2025-12-27 23:18:43] info: [userRoutes] Self-access validated: user 437cfdad-c91a-4cb6-ad7a-8b0a89d0972a accessing own data
[2025-12-27 23:18:43] info: [userController.updateUser] Updating user 437cfdad-c91a-4cb6-ad7a-8b0a89d0972a
[2025-12-27 23:18:43] info: [PUT] /api/users/437cfdad-c91a-4cb6-ad7a-8b0a89d0972a - 200
[2025-12-27 23:18:43] info: [POST] /auth/register
[2025-12-27 23:18:43] warn: [MemoryMonitoring] Memory threshold exceeded: 660MB
[2025-12-27 23:18:44] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:44] info: [EmailVerification] Created verification token
[2025-12-27 23:18:44] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895523983@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=5de751ca75986cac743d7b8c83e7eb15d827ee69d56c168e53336b5448ac6f6c

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:44] info: [authController.register] Verification email sent
[2025-12-27 23:18:44] info: [POST] /auth/register - 201
[2025-12-27 23:18:44] info: [GET] /auth/csrf-token
[2025-12-27 23:18:44] warn: [MemoryMonitoring] Memory threshold exceeded: 663MB
[2025-12-27 23:18:44] info: [CSRF] Token generated
[2025-12-27 23:18:44] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:18:44] info: [GET] /auth/csrf-token
[2025-12-27 23:18:44] warn: [MemoryMonitoring] Memory threshold exceeded: 660MB
[2025-12-27 23:18:44] info: [CSRF] Token generated
[2025-12-27 23:18:44] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:18:44] info: [GET] /auth/csrf-token
[2025-12-27 23:18:44] warn: [MemoryMonitoring] Memory threshold exceeded: 658MB
[2025-12-27 23:18:44] info: [CSRF] Token generated
[2025-12-27 23:18:44] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:18:44] info: [POST] /auth/register
[2025-12-27 23:18:44] warn: [MemoryMonitoring] Memory threshold exceeded: 657MB
[2025-12-27 23:18:44] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:44] info: [EmailVerification] Created verification token
[2025-12-27 23:18:44] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895524397@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=8a89f53ad38316cd1cde60e1d41c5b9b0e973b525f8eda45d4bde470247634b8

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:44] info: [authController.register] Verification email sent
[2025-12-27 23:18:44] info: [POST] /auth/register - 201
[2025-12-27 23:18:44] info: [POST] /api/users/me
[2025-12-27 23:18:44] warn: [MemoryMonitoring] Memory threshold exceeded: 657MB
[2025-12-27 23:18:44] info: [auth] Authenticated user 206d5057-220b-4416-a62e-32b2002990cd for POST /users/me
[2025-12-27 23:18:44] info: [POST] /api/users/me - 403
[2025-12-27 23:18:44] info: [POST] /auth/register
[2025-12-27 23:18:44] warn: [MemoryMonitoring] Memory threshold exceeded: 658MB
[2025-12-27 23:18:45] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:45] info: [EmailVerification] Created verification token
[2025-12-27 23:18:45] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895524768@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=b0fe1d272e7a487f4c843971c84b8ed34146a7d1828058c00eb5242a81092a02

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:45] info: [authController.register] Verification email sent
[2025-12-27 23:18:45] info: [POST] /auth/register - 201
[2025-12-27 23:18:45] info: [POST] /auth/register
[2025-12-27 23:18:45] warn: [MemoryMonitoring] Memory threshold exceeded: 663MB
[2025-12-27 23:18:45] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:45] info: [EmailVerification] Created verification token
[2025-12-27 23:18:45] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895525121@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=2d95d159c393c7f05f11c26a7c8b883d76435d82ae2ff48c05ebb90d8b00441a

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:45] info: [authController.register] Verification email sent
[2025-12-27 23:18:45] info: [POST] /auth/register - 201
[2025-12-27 23:18:45] info: [POST] /auth/login
[2025-12-27 23:18:45] warn: [MemoryMonitoring] Memory threshold exceeded: 667MB
[2025-12-27 23:18:45] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:45] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:18:45] info: [POST] /auth/login - 200
[2025-12-27 23:18:45] info: [POST] /auth/register
[2025-12-27 23:18:45] warn: [MemoryMonitoring] Memory threshold exceeded: 664MB
[2025-12-27 23:18:46] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:46] info: [EmailVerification] Created verification token
[2025-12-27 23:18:46] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895525781@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=3476a6e10952a9bbc98f4003bec9c232ee516fbb791944a2dfbb14ac5e97b37a

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:46] info: [authController.register] Verification email sent
[2025-12-27 23:18:46] info: [POST] /auth/register - 201
[2025-12-27 23:18:46] info: [POST] /auth/register
[2025-12-27 23:18:46] warn: [MemoryMonitoring] Memory threshold exceeded: 667MB
[2025-12-27 23:18:46] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:46] info: [EmailVerification] Created verification token
[2025-12-27 23:18:46] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: newuser1766895526120@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=7379464659e13b2783c7bf2820ad43d53459f7d133015e7660d34a51943997a2

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:46] info: [authController.register] Verification email sent
[2025-12-27 23:18:46] info: [POST] /auth/register - 201
[2025-12-27 23:18:46] info: [POST] /auth/register
[2025-12-27 23:18:46] warn: [MemoryMonitoring] Memory threshold exceeded: 668MB
[2025-12-27 23:18:46] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:46] info: [EmailVerification] Created verification token
[2025-12-27 23:18:46] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: csrftest1766895526450@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=e261fb75d456a15bf104e0559452d79aebf9d09b3ecbecee922ea5efbabf7012

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:46] info: [authController.register] Verification email sent
[2025-12-27 23:18:46] info: [POST] /auth/register - 201
[2025-12-27 23:18:46] info: [POST] /auth/forgot-password
[2025-12-27 23:18:46] warn: [MemoryMonitoring] Memory threshold exceeded: 669MB
[2025-12-27 23:18:46] warn: 404 - Route not found: POST /auth/forgot-password from ::ffff:127.0.0.1
[2025-12-27 23:18:46] info: [POST] /auth/forgot-password - 404
PASS __tests__/integration/csrf-integration.test.mjs (9.067 s)
  CSRF Protection Integration Tests
    CSRF Token Acquisition
      ‚àö should get CSRF token from /auth/csrf-token endpoint (441 ms)
      ‚àö should set CSRF token in cookie (378 ms)
      ‚àö should generate unique tokens for different requests (392 ms)
    CSRF Protection for State-Changing Operations
      ‚àö should reject POST request without CSRF token (381 ms)
      ‚àö should reject PUT request without CSRF token (396 ms)
      ‚àö should reject DELETE request without CSRF token (397 ms)
      ‚àö should reject PATCH request without CSRF token (374 ms)
    Safe HTTP Methods (No CSRF Required)
      ‚àö should allow GET requests without CSRF token (357 ms)
      ‚àö should allow HEAD requests without CSRF token (367 ms)
      ‚àö should allow OPTIONS requests without CSRF token (345 ms)
    CSRF Error Messages
      ‚àö should provide clear error message for missing token (376 ms)
      ‚àö should include error code in response (356 ms)
      ‚àö should return 403 status for CSRF failures (359 ms)
    CSRF Token Lifecycle
      ‚àö should accept newly generated token (406 ms)
      ‚àö should generate new token on each request to /auth/csrf-token (413 ms)
    CORS and CSRF Integration
      ‚àö should require X-CSRF-Token header for cross-origin requests (372 ms)
      ‚àö should allow CORS preflight without CSRF token (351 ms)
    Public Endpoints (No CSRF)
      ‚àö should not require CSRF token for login (661 ms)
      ‚àö should not require CSRF token for registration (668 ms)
      ‚àö should not require CSRF token for password reset request (352 ms)

[2025-12-27 23:18:46] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:46] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:46] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:47] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:47] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:47] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:47] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:47] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:47] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:47] info: [POST] /api/auth/register
[2025-12-27 23:18:47] warn: [MemoryMonitoring] Memory threshold exceeded: 703MB
[2025-12-27 23:18:48] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:48] info: [EmailVerification] Created verification token
[2025-12-27 23:18:48] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: genetics@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=b557c5ade5154c38c16b92906ca8e65eb4b154a031a0575e75ff8cc8a575a4ec

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:48] info: [authController.register] Verification email sent
[2025-12-27 23:18:48] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:48] info: [POST] /api/auth/login
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 700MB
[2025-12-27 23:18:48] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:48] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:18:48] info: [POST] /api/auth/login - 200
[2025-12-27 23:18:48] info: [POST] /api/horses
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 711MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:48] info: [horseModel.createHorse] Successfully created horse: Genetic Test Stallion (ID: 94167)
[2025-12-27 23:18:48] info: [horseRoutes] Created new horse: Genetic Test Stallion (ID: 94167)
[2025-12-27 23:18:48] info: [POST] /api/horses - 201
[2025-12-27 23:18:48] info: [POST] /api/horses
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 709MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:48] info: [horseModel.createHorse] Successfully created horse: Genetic Test Mare (ID: 94168)
[2025-12-27 23:18:48] info: [horseRoutes] Created new horse: Genetic Test Mare (ID: 94168)
[2025-12-27 23:18:48] info: [POST] /api/horses - 201
[2025-12-27 23:18:48] info: [POST] /api/horses
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 707MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:48] info: [POST] /api/horses
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 699MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:48] info: [horseModel.createHorse] Successfully created horse: Population Horse 1 (ID: 94169)
[2025-12-27 23:18:48] info: [horseRoutes] Created new horse: Population Horse 1 (ID: 94169)
[2025-12-27 23:18:48] info: [POST] /api/horses - 201
[2025-12-27 23:18:48] info: [horseModel.createHorse] Successfully created horse: Population Horse 2 (ID: 94170)
[2025-12-27 23:18:48] info: [horseRoutes] Created new horse: Population Horse 2 (ID: 94170)
[2025-12-27 23:18:48] info: [POST] /api/horses - 201
[2025-12-27 23:18:48] info: [POST] /api/breeding/genetic-probability
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 702MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /breeding/genetic-probability
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /breeding/genetic-probability
[2025-12-27 23:18:48] info: [advancedBreedingGeneticsRoutes.genetic-probability] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d calculating for stallion 94167 and mare 94168
[2025-12-27 23:18:48] info: Calculating enhanced genetic probabilities
[2025-12-27 23:18:48] info: [advancedLineageAnalysisService.generateLineageTree] Generating tree for stallion 94167 and mare 94168, 3 generations
[2025-12-27 23:18:48] info: [advancedLineageAnalysisService.generateLineageTree] Generated tree with 2 horses across 1 generations
[2025-12-27 23:18:48] info: Calculating genetic diversity impact
[2025-12-27 23:18:48] info: Calculating multi-generational predictions
[2025-12-27 23:18:48] info: [POST] /api/breeding/genetic-probability - 200
[2025-12-27 23:18:48] info: [DELETE] /api/horses/94167
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 708MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94167
[2025-12-27 23:18:48] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94167
[2025-12-27 23:18:48] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94167
[2025-12-27 23:18:48] info: [DELETE] /api/horses/94167 - 200
[2025-12-27 23:18:48] info: [DELETE] /api/horses/94168
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 705MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94168
[2025-12-27 23:18:48] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94168
[2025-12-27 23:18:48] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94168
[2025-12-27 23:18:48] info: [DELETE] /api/horses/94168 - 200
[2025-12-27 23:18:48] info: [DELETE] /api/horses/94169
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 702MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94169
[2025-12-27 23:18:48] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94169
[2025-12-27 23:18:48] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94169
[2025-12-27 23:18:48] info: [DELETE] /api/horses/94169 - 200
[2025-12-27 23:18:48] info: [DELETE] /api/horses/94170
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 700MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94170
[2025-12-27 23:18:48] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94170
[2025-12-27 23:18:48] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94170
[2025-12-27 23:18:48] info: [DELETE] /api/horses/94170 - 200
[2025-12-27 23:18:48] info: [POST] /api/horses
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 712MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:48] info: [horseModel.createHorse] Successfully created horse: Genetic Test Stallion (ID: 94171)
[2025-12-27 23:18:48] info: [horseRoutes] Created new horse: Genetic Test Stallion (ID: 94171)
[2025-12-27 23:18:48] info: [POST] /api/horses - 201
[2025-12-27 23:18:48] info: [POST] /api/horses
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 710MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:48] info: [horseModel.createHorse] Successfully created horse: Genetic Test Mare (ID: 94172)
[2025-12-27 23:18:48] info: [horseRoutes] Created new horse: Genetic Test Mare (ID: 94172)
[2025-12-27 23:18:48] info: [POST] /api/horses - 201
[2025-12-27 23:18:48] info: [POST] /api/horses
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 708MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:48] info: [POST] /api/horses
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 700MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:48] info: [horseModel.createHorse] Successfully created horse: Population Horse 1 (ID: 94173)
[2025-12-27 23:18:48] info: [horseRoutes] Created new horse: Population Horse 1 (ID: 94173)
[2025-12-27 23:18:48] info: [POST] /api/horses - 201
[2025-12-27 23:18:48] info: [horseModel.createHorse] Successfully created horse: Population Horse 2 (ID: 94174)
[2025-12-27 23:18:48] info: [horseRoutes] Created new horse: Population Horse 2 (ID: 94174)
[2025-12-27 23:18:48] info: [POST] /api/horses - 201
[2025-12-27 23:18:48] info: [POST] /api/breeding/genetic-probability
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 703MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /breeding/genetic-probability
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /breeding/genetic-probability
[2025-12-27 23:18:48] info: [advancedBreedingGeneticsRoutes.genetic-probability] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d calculating for stallion 99999 and mare 94172
[2025-12-27 23:18:48] info: [POST] /api/breeding/genetic-probability - 404
[2025-12-27 23:18:48] info: [DELETE] /api/horses/94171
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 701MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94171
[2025-12-27 23:18:48] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94171
[2025-12-27 23:18:48] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94171
[2025-12-27 23:18:48] info: [DELETE] /api/horses/94171 - 200
[2025-12-27 23:18:48] info: [DELETE] /api/horses/94172
[2025-12-27 23:18:48] warn: [MemoryMonitoring] Memory threshold exceeded: 712MB
[2025-12-27 23:18:48] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94172
[2025-12-27 23:18:48] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94172
[2025-12-27 23:18:48] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94172
[2025-12-27 23:18:48] info: [DELETE] /api/horses/94172 - 200
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94173
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 708MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94173
[2025-12-27 23:18:49] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94173
[2025-12-27 23:18:49] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94173
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94173 - 200
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94174
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 707MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94174
[2025-12-27 23:18:49] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94174
[2025-12-27 23:18:49] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94174
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94174 - 200
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 705MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:49] info: [horseModel.createHorse] Successfully created horse: Genetic Test Stallion (ID: 94175)
[2025-12-27 23:18:49] info: [horseRoutes] Created new horse: Genetic Test Stallion (ID: 94175)
[2025-12-27 23:18:49] info: [POST] /api/horses - 201
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 704MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:49] info: [horseModel.createHorse] Successfully created horse: Genetic Test Mare (ID: 94176)
[2025-12-27 23:18:49] info: [horseRoutes] Created new horse: Genetic Test Mare (ID: 94176)
[2025-12-27 23:18:49] info: [POST] /api/horses - 201
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 705MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 712MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:49] info: [horseModel.createHorse] Successfully created horse: Population Horse 1 (ID: 94177)
[2025-12-27 23:18:49] info: [horseRoutes] Created new horse: Population Horse 1 (ID: 94177)
[2025-12-27 23:18:49] info: [POST] /api/horses - 201
[2025-12-27 23:18:49] info: [horseModel.createHorse] Successfully created horse: Population Horse 2 (ID: 94178)
[2025-12-27 23:18:49] info: [horseRoutes] Created new horse: Population Horse 2 (ID: 94178)
[2025-12-27 23:18:49] info: [POST] /api/horses - 201
[2025-12-27 23:18:49] info: [POST] /api/breeding/genetic-probability
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 715MB
[2025-12-27 23:18:49] warn: [auth] Access token is required for POST /breeding/genetic-probability from ::ffff:127.0.0.1
[2025-12-27 23:18:49] info: [POST] /api/breeding/genetic-probability - 401
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94175
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 710MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94175
[2025-12-27 23:18:49] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94175
[2025-12-27 23:18:49] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94175
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94175 - 200
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94176
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 708MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94176
[2025-12-27 23:18:49] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94176
[2025-12-27 23:18:49] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94176
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94176 - 200
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94177
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 705MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94177
[2025-12-27 23:18:49] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94177
[2025-12-27 23:18:49] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94177
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94177 - 200
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94178
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 703MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94178
[2025-12-27 23:18:49] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94178
[2025-12-27 23:18:49] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94178
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94178 - 200
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 715MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:49] info: [horseModel.createHorse] Successfully created horse: Genetic Test Stallion (ID: 94179)
[2025-12-27 23:18:49] info: [horseRoutes] Created new horse: Genetic Test Stallion (ID: 94179)
[2025-12-27 23:18:49] info: [POST] /api/horses - 201
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 713MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:49] info: [horseModel.createHorse] Successfully created horse: Genetic Test Mare (ID: 94180)
[2025-12-27 23:18:49] info: [horseRoutes] Created new horse: Genetic Test Mare (ID: 94180)
[2025-12-27 23:18:49] info: [POST] /api/horses - 201
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 711MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 703MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /
[2025-12-27 23:18:49] info: [horseModel.createHorse] Successfully created horse: Population Horse 1 (ID: 94181)
[2025-12-27 23:18:49] info: [horseRoutes] Created new horse: Population Horse 1 (ID: 94181)
[2025-12-27 23:18:49] info: [POST] /api/horses - 201
[2025-12-27 23:18:49] info: [horseModel.createHorse] Successfully created horse: Population Horse 2 (ID: 94182)
[2025-12-27 23:18:49] info: [horseRoutes] Created new horse: Population Horse 2 (ID: 94182)
[2025-12-27 23:18:49] info: [POST] /api/horses - 201
[2025-12-27 23:18:49] info: [GET] /api/breeding/lineage-analysis/94179/94180?generations=3
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 706MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for GET /breeding/lineage-analysis/94179/94180
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for GET /breeding/lineage-analysis/94179/94180
[2025-12-27 23:18:49] info: [advancedBreedingGeneticsRoutes.lineage-analysis] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d analyzing lineage for stallion 94179 and mare 94180
[2025-12-27 23:18:49] info: [advancedLineageAnalysisService.generateLineageTree] Generating tree for stallion 94179 and mare 94180, 3 generations
[2025-12-27 23:18:49] info: [advancedLineageAnalysisService.calculateGeneticDiversityMetrics] Calculating diversity for 1 generations
[2025-12-27 23:18:49] info: [advancedLineageAnalysisService.analyzeLineagePerformance] Analyzing performance for 1 generations
[2025-12-27 23:18:49] info: [advancedLineageAnalysisService.createVisualizationData] Creating visualization for stallion 94179 and mare 94180
[2025-12-27 23:18:49] info: [advancedLineageAnalysisService.generateLineageTree] Generating tree for stallion 94179 and mare 94180, 3 generations
[2025-12-27 23:18:49] info: [advancedLineageAnalysisService.generateLineageTree] Generated tree with 2 horses across 1 generations
[2025-12-27 23:18:49] info: [advancedLineageAnalysisService.generateLineageTree] Generated tree with 2 horses across 1 generations
[2025-12-27 23:18:49] info: [GET] /api/breeding/lineage-analysis/94179/94180?generations=3 - 200
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94179
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 714MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94179
[2025-12-27 23:18:49] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94179
[2025-12-27 23:18:49] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94179
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94179 - 200
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94180
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 709MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94180
[2025-12-27 23:18:49] info: [ownership] Validated ownership: user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d owns horse 94180
[2025-12-27 23:18:49] info: [horseRoutes] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d deleted horse ID: 94180
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94180 - 200
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94181
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 706MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94181
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94181 - 429
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94182
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 716MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for DELETE /horses/94182
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [DELETE] /api/horses/94182 - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 711MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 707MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 705MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 713MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [GET] /api/breeding/lineage-analysis/99999/99998
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 708MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for GET /breeding/lineage-analysis/99999/99998
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for GET /breeding/lineage-analysis/99999/99998
[2025-12-27 23:18:49] info: [advancedBreedingGeneticsRoutes.lineage-analysis] User 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d analyzing lineage for stallion 99999 and mare 99998
[2025-12-27 23:18:49] info: [GET] /api/breeding/lineage-analysis/99999/99998 - 404
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 706MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 716MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 711MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 719MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 716MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 710MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 707MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 714MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 711MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 707MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 718MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 710MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:49] info: [POST] /api/horses
[2025-12-27 23:18:49] warn: [MemoryMonitoring] Memory threshold exceeded: 708MB
[2025-12-27 23:18:49] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:49] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:49] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 717MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 713MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 720MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [GET] /api/genetics/diversity-report/2f6f0c5b-609e-4e0c-9914-3fcb02b9524d
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 716MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for GET /genetics/diversity-report/2f6f0c5b-609e-4e0c-9914-3fcb02b9524d
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for GET /genetics/diversity-report/2f6f0c5b-609e-4e0c-9914-3fcb02b9524d
[2025-12-27 23:18:50] info: [advancedBreedingGeneticsRoutes.diversity-report] Generating report for user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.generateGeneticDiversityReport] Generating report for 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.trackPopulationGeneticHealth] Tracking health for 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.analyzeGeneticTrends] Analyzing trends for 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.generateOptimalBreedingRecommendations] Generating recommendations for 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.trackGeneticDiversityOverTime] Tracking diversity for 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.calculateEffectivePopulationSize] Calculating for 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.trackPopulationGeneticHealth] Tracking health for 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.calculateEffectivePopulationSize] Calculating for 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.identifyGeneticFounders] Identifying founders in 2 horses
[2025-12-27 23:18:50] info: [geneticDiversityTrackingService.identifyGeneticFounders] Identifying founders in 2 horses
[2025-12-27 23:18:50] info: [GET] /api/genetics/diversity-report/2f6f0c5b-609e-4e0c-9914-3fcb02b9524d - 200
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 719MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 713MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 709MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 717MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 713MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 709MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 720MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 712MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 710MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 720MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 715MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 723MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/breeding/genetic-probability
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 719MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /breeding/genetic-probability
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /breeding/genetic-probability
[2025-12-27 23:18:50] info: [POST] /api/breeding/genetic-probability - 400
[2025-12-27 23:18:50] info: [POST] /api/genetics/inbreeding-analysis
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 714MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /genetics/inbreeding-analysis
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /genetics/inbreeding-analysis
[2025-12-27 23:18:50] info: [POST] /api/genetics/inbreeding-analysis - 400
[2025-12-27 23:18:50] info: [POST] /api/genetics/population-analysis
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 711MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /genetics/population-analysis
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /genetics/population-analysis
[2025-12-27 23:18:50] info: [POST] /api/genetics/population-analysis - 400
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 723MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 717MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 714MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/horses
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 722MB
[2025-12-27 23:18:50] info: [auth] Authenticated user 2f6f0c5b-609e-4e0c-9914-3fcb02b9524d for POST /horses
[2025-12-27 23:18:50] warn: [RateLimit] Limit exceeded
[2025-12-27 23:18:50] info: [POST] /api/horses - 429
[2025-12-27 23:18:50] info: [POST] /api/auth/register
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 718MB
[2025-12-27 23:18:50] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:50] info: [EmailVerification] Created verification token
[2025-12-27 23:18:50] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: other@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=e43878aacfe351c23db070d26f33131e76c0e916184bda01ddc784e9b5cae67c

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:50] info: [authController.register] Verification email sent
[2025-12-27 23:18:50] info: [POST] /api/auth/register - 201
[2025-12-27 23:18:50] info: [POST] /api/auth/login
[2025-12-27 23:18:50] warn: [MemoryMonitoring] Memory threshold exceeded: 719MB
[2025-12-27 23:18:51] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:51] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:18:51] info: [POST] /api/auth/login - 200
FAIL tests/integration/advancedBreedingGeneticsAPI.test.mjs
  üß¨ Advanced Breeding Genetics API Integration
    üéØ Enhanced Genetic Probability API
      ‚àö POST /api/breeding/genetic-probability should calculate breeding probabilities (326 ms)
      ‚àö POST /api/breeding/genetic-probability should handle invalid horse IDs (297 ms)
      ‚àö POST /api/breeding/genetic-probability should require authentication (270 ms)
    üå≥ Advanced Lineage Analysis API
      ‚àö GET /api/breeding/lineage-analysis/:stallionId/:mareId should generate lineage tree (281 ms)
      ‚àö GET /api/breeding/lineage-analysis should handle missing horses gracefully (116 ms)
      √ó POST /api/breeding/breeding-recommendations should generate comprehensive recommendations (84 ms)
    üìä Genetic Diversity Tracking API
      √ó POST /api/genetics/population-analysis should analyze population genetics (82 ms)
      √ó POST /api/genetics/inbreeding-analysis should calculate detailed inbreeding (83 ms)
      ‚àö GET /api/genetics/diversity-report/:userId should generate comprehensive report (233 ms)
      √ó POST /api/genetics/optimal-breeding should recommend optimal breeding pairs (82 ms)
    üîí API Security and Validation
      √ó All genetic endpoints should require authentication (86 ms)
      ‚àö Genetic endpoints should validate input parameters (159 ms)
      √ó Genetic endpoints should handle ownership validation (737 ms)

  ‚óè üß¨ Advanced Breeding Genetics API Integration ‚Ä∫ üå≥ Advanced Lineage Analysis API ‚Ä∫ POST /api/breeding/breeding-recommendations should generate comprehensive recommendations

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 241 |[39m         [33m.[39m[36mset[39m([32m'x-test-skip-csrf'[39m[33m,[39m [32m'true'[39m)
     [90m 242 |[39m         [33m.[39msend({
    [31m[1m>[22m[39m[90m 243 |[39m           stallionId[33m:[39m testStallion[33m.[39mid[33m,[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 244 |[39m           mareId[33m:[39m testMare[33m.[39mid[33m,[39m
     [90m 245 |[39m         })[33m;[39m
     [90m 246 |[39m[0m

      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:243:36)

  ‚óè üß¨ Advanced Breeding Genetics API Integration ‚Ä∫ üìä Genetic Diversity Tracking API ‚Ä∫ POST /api/genetics/population-analysis should analyze population genetics

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 265 |[39m   describe([32m'üìä Genetic Diversity Tracking API'[39m[33m,[39m () [33m=>[39m {
     [90m 266 |[39m     test([32m'POST /api/genetics/population-analysis should analyze population genetics'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 267 |[39m       [36mconst[39m horseIds [33m=[39m testPopulation[33m.[39mmap(h [33m=>[39m h[33m.[39mid)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 268 |[39m
     [90m 269 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
     [90m 270 |[39m         [33m.[39mpost([32m'/api/genetics/population-analysis'[39m)[0m

      at tests/integration/advancedBreedingGeneticsAPI.test.mjs:267:50
          at Array.map (<anonymous>)
      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:267:39)

  ‚óè üß¨ Advanced Breeding Genetics API Integration ‚Ä∫ üìä Genetic Diversity Tracking API ‚Ä∫ POST /api/genetics/inbreeding-analysis should calculate detailed inbreeding

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 298 |[39m         [33m.[39m[36mset[39m([32m'x-test-skip-csrf'[39m[33m,[39m [32m'true'[39m)
     [90m 299 |[39m         [33m.[39msend({
    [31m[1m>[22m[39m[90m 300 |[39m           stallionId[33m:[39m testStallion[33m.[39mid[33m,[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 301 |[39m           mareId[33m:[39m testMare[33m.[39mid[33m,[39m
     [90m 302 |[39m         })[33m;[39m
     [90m 303 |[39m[0m

      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:300:36)

  ‚óè üß¨ Advanced Breeding Genetics API Integration ‚Ä∫ üìä Genetic Diversity Tracking API ‚Ä∫ POST /api/genetics/optimal-breeding should recommend optimal breeding pairs

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 345 |[39m
     [90m 346 |[39m     test([32m'POST /api/genetics/optimal-breeding should recommend optimal breeding pairs'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 347 |[39m       [36mconst[39m horseIds [33m=[39m testPopulation[33m.[39mmap(h [33m=>[39m h[33m.[39mid)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 348 |[39m
     [90m 349 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
     [90m 350 |[39m         [33m.[39mpost([32m'/api/genetics/optimal-breeding'[39m)[0m

      at tests/integration/advancedBreedingGeneticsAPI.test.mjs:347:50
          at Array.map (<anonymous>)
      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:347:39)

  ‚óè üß¨ Advanced Breeding Genetics API Integration ‚Ä∫ üîí API Security and Validation ‚Ä∫ All genetic endpoints should require authentication

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 378 |[39m       [36mconst[39m endpoints [33m=[39m [
     [90m 379 |[39m         { method[33m:[39m [32m'post'[39m[33m,[39m path[33m:[39m [32m'/api/breeding/genetic-probability'[39m }[33m,[39m
    [31m[1m>[22m[39m[90m 380 |[39m         { method[33m:[39m [32m'get'[39m[33m,[39m path[33m:[39m [32m`/api/breeding/lineage-analysis/${testStallion.id}/${testMare.id}`[39m }[33m,[39m
     [90m     |[39m                                                                               [31m[1m^[22m[39m
     [90m 381 |[39m         { method[33m:[39m [32m'post'[39m[33m,[39m path[33m:[39m [32m'/api/breeding/breeding-recommendations'[39m }[33m,[39m
     [90m 382 |[39m         { method[33m:[39m [32m'post'[39m[33m,[39m path[33m:[39m [32m'/api/genetics/population-analysis'[39m }[33m,[39m
     [90m 383 |[39m         { method[33m:[39m [32m'post'[39m[33m,[39m path[33m:[39m [32m'/api/genetics/inbreeding-analysis'[39m }[33m,[39m[0m

      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:380:79)

  ‚óè üß¨ Advanced Breeding Genetics API Integration ‚Ä∫ üîí API Security and Validation ‚Ä∫ Genetic endpoints should handle ownership validation

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 451 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${otherToken}`[39m)
     [90m 452 |[39m         [33m.[39msend({
    [31m[1m>[22m[39m[90m 453 |[39m           stallionId[33m:[39m testStallion[33m.[39mid[33m,[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 454 |[39m           mareId[33m:[39m testMare[33m.[39mid[33m,[39m
     [90m 455 |[39m         })[33m;[39m
     [90m 456 |[39m[0m

      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:453:36)

[2025-12-27 23:18:51] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:51] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:51] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:51] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:52] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:52] info: [EmailVerification] Created verification token
[2025-12-27 23:18:52] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=4d6ba7198fa576255f434aa59105aec98986b166b7d4b2a1b24fded3d2645252

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:52] info: [authController.register] Verification email sent
[2025-12-27 23:18:52] info: [auth] Authenticated user bf780058-73d5-4655-b513-5ffdc6db6fb6 for GET /api/test/success
[2025-12-27 23:18:52] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:52] info: [EmailVerification] Created verification token
[2025-12-27 23:18:52] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=56a3c3d0eb2faa0139563fae6ec67ee7534e87ddd0fa1b3fc7466fbefafb691f

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:52] info: [authController.register] Verification email sent
[2025-12-27 23:18:52] info: [auth] Authenticated user da6e292c-412f-4867-a6f5-0e63c4259159 for GET /api/test/error
[2025-12-27 23:18:53] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:53] info: [EmailVerification] Created verification token
[2025-12-27 23:18:53] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=8e2ad48571bac4a3dba8d39f07685daaa0c02674508aa45255f97bf4ef37aee2

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:53] info: [authController.register] Verification email sent
[2025-12-27 23:18:53] info: [auth] Authenticated user 0729f67b-33ea-4c06-b33f-0a4894c475c1 for GET /api/test/not-found
[2025-12-27 23:18:53] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:53] info: [EmailVerification] Created verification token
[2025-12-27 23:18:53] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=72b9e3f5781fa08f415c6668ca7c060307dc2c32c41ee82e261cefaf3f001a8a

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:53] info: [authController.register] Verification email sent
[2025-12-27 23:18:53] info: [auth] Authenticated user fa708517-6567-41df-bc82-d6e0690e1a45 for GET /api/test/validation-error
[2025-12-27 23:18:53] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:53] info: [EmailVerification] Created verification token
[2025-12-27 23:18:53] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=129f55705fe956fdd2558e8575e572e3a035f14e676427137b7d3ba09e0cbb46

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:53] info: [authController.register] Verification email sent
[2025-12-27 23:18:53] info: [auth] Authenticated user 3f4d70da-e16b-4ecd-b60f-0cfe518b7b0f for GET /api/test/paginated
[2025-12-27 23:18:54] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:54] info: [EmailVerification] Created verification token
[2025-12-27 23:18:54] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=80060b882a247ba1bff82eef6ab4cb6bb340795e6bf260ed2064b659503875a8

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:54] info: [authController.register] Verification email sent
[2025-12-27 23:18:54] info: [auth] Authenticated user d1d430d3-e1d2-485b-aa7a-e96e7b15b021 for GET /api/test/paginated
[2025-12-27 23:18:54] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:54] info: [EmailVerification] Created verification token
[2025-12-27 23:18:54] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=04a56cb77857a10476630d0915467cb964c8586f10e963d52f5e036c8946b836

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:54] info: [authController.register] Verification email sent
[2025-12-27 23:18:54] info: [auth] Authenticated user 8396fd90-8b1f-4038-9298-40c300eb6289 for GET /api/test/success
[2025-12-27 23:18:54] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:54] info: [EmailVerification] Created verification token
[2025-12-27 23:18:54] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=51d4e9c926a39a2b1e220ff8c851155c3128bbe38c68b691d8108d90b48fa706

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:54] info: [authController.register] Verification email sent
[2025-12-27 23:18:54] info: [auth] Authenticated user 8c7f2d22-6a7b-44ae-8d72-dae5834db98d for GET /api/test/large-data
[2025-12-27 23:18:55] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:55] info: [EmailVerification] Created verification token
[2025-12-27 23:18:55] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=b6a9b9446978302ca95d0b2a1ac8eba40593c673c2e416e9a3d830bef4588983

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:55] info: [authController.register] Verification email sent
[2025-12-27 23:18:55] info: [auth] Authenticated user cfe9b164-a8c3-47a4-be5f-fbb7914c0089 for GET /api/test/field-selection
[2025-12-27 23:18:55] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:55] info: [EmailVerification] Created verification token
[2025-12-27 23:18:55] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=25566a2ddd246709a7e2e6647b27242b23234a1c6246bb337a26ea1c42478dcc

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:55] info: [authController.register] Verification email sent
[2025-12-27 23:18:55] info: [auth] Authenticated user eee0cd5c-d79f-42c6-82a8-b5bd9c7267bf for GET /api/test/field-selection
[2025-12-27 23:18:55] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:55] info: [EmailVerification] Created verification token
[2025-12-27 23:18:55] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=c29aa09e80711a52c4e4ba8c00c76a6be49d6bdac4c4c8d829b47c964e5b307b

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:55] info: [authController.register] Verification email sent
[2025-12-27 23:18:55] info: [auth] Authenticated user 93a5dc3d-4ecf-4ec1-be32-325a174db1e0 for GET /api/test/etag
[2025-12-27 23:18:55] info: [auth] Authenticated user 93a5dc3d-4ecf-4ec1-be32-325a174db1e0 for GET /api/test/etag
[2025-12-27 23:18:56] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:56] info: [EmailVerification] Created verification token
[2025-12-27 23:18:56] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=23cef38c9b1e98c507683976b849248f13a2a07e977d9f8b79cc2acdd492bd02

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:56] info: [authController.register] Verification email sent
[2025-12-27 23:18:56] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:56] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:18:56] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:56] info: [EmailVerification] Created verification token
[2025-12-27 23:18:56] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=bd0fcf965d2e44cf286c4509453d69e99ea7a7832e62cfa64ec72a6e1409b473

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:56] info: [authController.register] Verification email sent
[2025-12-27 23:18:56] info: [health] Health check passed
[2025-12-27 23:18:57] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:57] info: [EmailVerification] Created verification token
[2025-12-27 23:18:57] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=b7117aff801059e527363d57dc13ddaa19838f53cd431f9206d142f9142d78f6

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:57] info: [authController.register] Verification email sent
[2025-12-27 23:18:57] warn: [auth] Access token is required for GET /api/test/success from ::ffff:127.0.0.1
[2025-12-27 23:18:57] warn: [auth] Access token is required for GET /api/test/error from ::ffff:127.0.0.1
[2025-12-27 23:18:57] warn: [auth] Access token is required for GET /api/test/large-data from ::ffff:127.0.0.1
[2025-12-27 23:18:57] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:57] info: [EmailVerification] Created verification token
[2025-12-27 23:18:57] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=79c4ba1487a3cb54f5e3cfbb14be4059ad5c93c63ff1c01f395fbfaf4cd777d1

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:57] info: [authController.register] Verification email sent
[2025-12-27 23:18:57] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:57] info: [EmailVerification] Created verification token
[2025-12-27 23:18:57] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=e4a1b05a7f6727ac64fbdf17df087083977c7e276ca9c5dc460d4e2f5096ed78

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:57] info: [authController.register] Verification email sent
[2025-12-27 23:18:57] warn: [Validation] Input validation failed
[2025-12-27 23:18:58] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:58] info: [EmailVerification] Created verification token
[2025-12-27 23:18:58] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=70f11b616ca9a543cdd16d14a9a3d7154c97f8901f84ec6d8e28b10ddb175be2

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:58] info: [authController.register] Verification email sent
[2025-12-27 23:18:58] info: [auth] Authenticated user d737db8e-b5a6-41f6-aa0b-b964de9aad95 for GET /api/test/success
[2025-12-27 23:18:58] info: [TokenRotation] Created new token pair
[2025-12-27 23:18:58] info: [EmailVerification] Created verification token
[2025-12-27 23:18:58] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: apiresponseintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=ab311dc23d192affcf140ca91cf604a5d3e2b23f61cc1c9f0c1b9f4145b4e0c9

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:18:58] info: [authController.register] Verification email sent
[2025-12-27 23:18:58] info: [auth] Authenticated user afc7d9da-a75c-4fa3-b988-f72a87b77ea7 for GET /api/test/large-data
PASS tests/integration/api-response-integration.test.mjs (7.423 s)
  üîÑ API Response Integration Tests
    üìã Response Format Standardization
      ‚àö should provide consistent success response format (465 ms)
      ‚àö should provide consistent error response format (341 ms)
      ‚àö should provide consistent not found response format (342 ms)
      ‚àö should provide consistent validation error response format (334 ms)
    üìä Pagination Response Validation
      ‚àö should provide consistent paginated response format (340 ms)
      ‚àö should handle pagination edge cases correctly (343 ms)
    ‚ö° Performance Monitoring Integration
      ‚àö should include performance headers in responses (332 ms)
      ‚àö should monitor large response performance (351 ms)
    üîß Response Optimization Features
      ‚àö should support field selection optimization (334 ms)
      ‚àö should support field exclusion optimization (347 ms)
      ‚àö should generate and validate ETags correctly (363 ms)
    üîó Cross-System Response Consistency
      ‚àö should maintain consistent response format across auth endpoints (632 ms)
      ‚àö should maintain consistent response format across health endpoints (342 ms)
      ‚àö should handle authentication errors consistently (391 ms)
    üõ°Ô∏è Error Handling Consistency
      ‚àö should handle invalid JSON gracefully (360 ms)
      ‚àö should handle validation errors consistently (351 ms)
    üìà Response Performance Benchmarking
      ‚àö should meet performance benchmarks for simple responses (361 ms)
      ‚àö should meet performance benchmarks for large responses (387 ms)

[2025-12-27 23:18:58] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:18:58] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:18:58] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:18:59] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:18:59] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:18:59] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:18:59] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:18:59] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:18:59] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:18:59] info: [POST] /auth/register
[2025-12-27 23:18:59] warn: [MemoryMonitoring] Memory threshold exceeded: 578MB
[2025-12-27 23:19:00] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:00] info: [EmailVerification] Created verification token
[2025-12-27 23:19:00] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: newuser_1766895539934@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=3369fd2ed173349168f29c4b0acd4a868e501f2c206b75558bf864cd3692834f

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:00] info: [authController.register] Verification email sent
[2025-12-27 23:19:00] info: [POST] /auth/register - 201
[2025-12-27 23:19:00] info: [POST] /auth/register
[2025-12-27 23:19:00] warn: [MemoryMonitoring] Memory threshold exceeded: 587MB
[2025-12-27 23:19:00] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:00] info: [EmailVerification] Created verification token
[2025-12-27 23:19:00] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: newuser2_1766895540393@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=a48a798bd947485e2402dec5da89d4ef182b440d59fd3eab3b2eb3d4bf14146c

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:00] info: [authController.register] Verification email sent
[2025-12-27 23:19:00] info: [POST] /auth/register - 201
[2025-12-27 23:19:00] info: [POST] /auth/register
[2025-12-27 23:19:00] warn: [MemoryMonitoring] Memory threshold exceeded: 576MB
[2025-12-27 23:19:01] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:01] info: [EmailVerification] Created verification token
[2025-12-27 23:19:01] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: devuser_1766895540812@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=eeb05687274c21c405e0241870ee30ccb6c8c7c1b2e6ccd39fb30a39291d90e6

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:01] info: [authController.register] Verification email sent
[2025-12-27 23:19:01] info: [POST] /auth/register - 201
[2025-12-27 23:19:01] info: [GET] /auth/verify-email?token=46e7d9aef464c78fad4adc88a8c686f4b0eba6af2ee8665dd4ed961718a9a4b1
[2025-12-27 23:19:01] warn: [MemoryMonitoring] Memory threshold exceeded: 580MB
[2025-12-27 23:19:01] info: [EmailVerification] Email verified successfully
[2025-12-27 23:19:01] info: [EmailService] Welcome email (DEV MODE - not sent)
[2025-12-27 23:19:01] info: [GET] /auth/verify-email?token=46e7d9aef464c78fad4adc88a8c686f4b0eba6af2ee8665dd4ed961718a9a4b1 - 200
[2025-12-27 23:19:01] info: [GET] /auth/verify-email?token=e47c06374fb19a8123f40cae19c0c83259ce31e22a463f4afca887ab0edcb92b
[2025-12-27 23:19:01] warn: [MemoryMonitoring] Memory threshold exceeded: 579MB
[2025-12-27 23:19:01] info: [EmailVerification] Email verified successfully
[2025-12-27 23:19:01] info: [EmailService] Welcome email (DEV MODE - not sent)
[2025-12-27 23:19:01] info: [GET] /auth/verify-email?token=e47c06374fb19a8123f40cae19c0c83259ce31e22a463f4afca887ab0edcb92b - 200
[2025-12-27 23:19:01] info: [GET] /auth/verify-email?token=b027f629969e39fc0a12444f951113e027c5e4469d43b498f567b88e8ea91fc9
[2025-12-27 23:19:01] warn: [MemoryMonitoring] Memory threshold exceeded: 580MB
[2025-12-27 23:19:01] info: [EmailVerification] Email verified successfully
[2025-12-27 23:19:01] info: [EmailService] Welcome email (DEV MODE - not sent)
[2025-12-27 23:19:01] info: [GET] /auth/verify-email?token=b027f629969e39fc0a12444f951113e027c5e4469d43b498f567b88e8ea91fc9 - 200
[2025-12-27 23:19:01] info: [GET] /auth/verify-email
[2025-12-27 23:19:01] warn: [MemoryMonitoring] Memory threshold exceeded: 580MB
[2025-12-27 23:19:01] error: [authController.verifyEmail] Error verifying email: Verification token is required
[2025-12-27 23:19:01] error: [GET] /auth/verify-email - ERROR
[2025-12-27 23:19:01] error: Error Verification token is required
[2025-12-27 23:19:01] info: [GET] /auth/verify-email - 400
[2025-12-27 23:19:01] info: [GET] /auth/verify-email?token=invalid_token_here
[2025-12-27 23:19:01] warn: [MemoryMonitoring] Memory threshold exceeded: 584MB
[2025-12-27 23:19:01] error: [authController.verifyEmail] Error verifying email: Invalid or expired verification token
[2025-12-27 23:19:01] error: [GET] /auth/verify-email?token=invalid_token_here - ERROR
[2025-12-27 23:19:01] error: Error Invalid or expired verification token
[2025-12-27 23:19:01] info: [GET] /auth/verify-email?token=invalid_token_here - 400
[2025-12-27 23:19:01] info: [GET] /auth/verify-email?token=df184183123cb797116f656fec1a733a528712c5c9d151c0cd1c9e9f0da695d4
[2025-12-27 23:19:01] warn: [MemoryMonitoring] Memory threshold exceeded: 587MB
[2025-12-27 23:19:01] error: [authController.verifyEmail] Error verifying email: Verification token has expired
[2025-12-27 23:19:01] error: [GET] /auth/verify-email?token=df184183123cb797116f656fec1a733a528712c5c9d151c0cd1c9e9f0da695d4 - ERROR
[2025-12-27 23:19:01] error: Error Verification token has expired
[2025-12-27 23:19:01] info: [GET] /auth/verify-email?token=df184183123cb797116f656fec1a733a528712c5c9d151c0cd1c9e9f0da695d4 - 400
[2025-12-27 23:19:02] info: [GET] /auth/verify-email?token=5ff3406762ce9ba4b1b00c15ac991ddd211164e08e856e9835b9544a96efc29f
[2025-12-27 23:19:02] warn: [MemoryMonitoring] Memory threshold exceeded: 587MB
[2025-12-27 23:19:02] info: [EmailVerification] Email verified successfully
[2025-12-27 23:19:02] info: [EmailService] Welcome email (DEV MODE - not sent)
[2025-12-27 23:19:02] info: [GET] /auth/verify-email?token=5ff3406762ce9ba4b1b00c15ac991ddd211164e08e856e9835b9544a96efc29f - 200
[2025-12-27 23:19:02] info: [GET] /auth/verify-email?token=5ff3406762ce9ba4b1b00c15ac991ddd211164e08e856e9835b9544a96efc29f
[2025-12-27 23:19:02] warn: [MemoryMonitoring] Memory threshold exceeded: 584MB
[2025-12-27 23:19:02] error: [EmailVerification] Error verifying email token: Verification token has already been used
[2025-12-27 23:19:02] error: [authController.verifyEmail] Error verifying email: Verification token has already been used
[2025-12-27 23:19:02] error: [GET] /auth/verify-email?token=5ff3406762ce9ba4b1b00c15ac991ddd211164e08e856e9835b9544a96efc29f - ERROR
[2025-12-27 23:19:02] error: Error Verification token has already been used
[2025-12-27 23:19:02] info: [GET] /auth/verify-email?token=5ff3406762ce9ba4b1b00c15ac991ddd211164e08e856e9835b9544a96efc29f - 400
[2025-12-27 23:19:02] info: [GET] /auth/verify-email?token=cdbfeda9b2d9a0cc29581c16f9eb68af0259f166db4a788ee334f5e07552c371
[2025-12-27 23:19:02] warn: [MemoryMonitoring] Memory threshold exceeded: 584MB
[2025-12-27 23:19:02] info: [EmailVerification] Email verified successfully
[2025-12-27 23:19:02] info: [EmailService] Welcome email (DEV MODE - not sent)
[2025-12-27 23:19:02] info: [GET] /auth/verify-email?token=cdbfeda9b2d9a0cc29581c16f9eb68af0259f166db4a788ee334f5e07552c371 - 200
[2025-12-27 23:19:02] info: [POST] /auth/resend-verification
[2025-12-27 23:19:02] warn: [MemoryMonitoring] Memory threshold exceeded: 583MB
[2025-12-27 23:19:02] info: [auth] Authenticated user 91b39ed5-0955-4820-bbf6-a41508c86443 for POST /resend-verification
[2025-12-27 23:19:02] info: [EmailVerification] Created verification token
[2025-12-27 23:19:02] info: [EmailVerification] Resent verification email
[2025-12-27 23:19:02] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: emailint_1766895542236@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=8ccb35727f6d128fd23e7a16378a818f9b0cb8d0b3cb7e03815a7343739ae122

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:02] info: [POST] /auth/resend-verification - 200
[2025-12-27 23:19:02] info: [POST] /auth/resend-verification
[2025-12-27 23:19:02] warn: [MemoryMonitoring] Memory threshold exceeded: 586MB
[2025-12-27 23:19:02] warn: [auth] Access token is required for POST /resend-verification from ::ffff:127.0.0.1
[2025-12-27 23:19:02] info: [POST] /auth/resend-verification - 401
[2025-12-27 23:19:02] info: [POST] /auth/resend-verification
[2025-12-27 23:19:02] warn: [MemoryMonitoring] Memory threshold exceeded: 585MB
[2025-12-27 23:19:02] info: [auth] Authenticated user e67ab0bf-de8f-479d-a35f-adc81bb0c7e3 for POST /resend-verification
[2025-12-27 23:19:02] error: [EmailVerification] Error resending verification email: Email is already verified
[2025-12-27 23:19:02] error: [authController.resendVerification] Error resending verification: Email is already verified
[2025-12-27 23:19:02] error: [POST] /auth/resend-verification - ERROR
[2025-12-27 23:19:02] error: Error Email is already verified
[2025-12-27 23:19:02] info: [POST] /auth/resend-verification - 500
[2025-12-27 23:19:02] info: [POST] /auth/resend-verification
[2025-12-27 23:19:02] warn: [MemoryMonitoring] Memory threshold exceeded: 588MB
[2025-12-27 23:19:02] info: [auth] Authenticated user 03238671-5e15-4d98-9abe-0151e2d0b7bf for POST /resend-verification
[2025-12-27 23:19:02] info: [EmailVerification] Created verification token
[2025-12-27 23:19:02] info: [EmailVerification] Resent verification email
[2025-12-27 23:19:02] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: emailint_1766895542574@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=3e07fbf645271bd4356c03ae99cfe31d5262f76c41e06848a8de46d81ba4b791

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:02] info: [POST] /auth/resend-verification - 200
[2025-12-27 23:19:02] info: [POST] /auth/resend-verification
[2025-12-27 23:19:02] warn: [MemoryMonitoring] Memory threshold exceeded: 587MB
[2025-12-27 23:19:02] info: [auth] Authenticated user 03238671-5e15-4d98-9abe-0151e2d0b7bf for POST /resend-verification
[2025-12-27 23:19:02] error: [EmailVerification] Error creating verification token: Please wait 300 seconds before requesting another verification email
[2025-12-27 23:19:02] error: [EmailVerification] Error resending verification email: Please wait 300 seconds before requesting another verification email
[2025-12-27 23:19:02] error: [authController.resendVerification] Error resending verification: Please wait 300 seconds before requesting another verification email
[2025-12-27 23:19:02] error: [POST] /auth/resend-verification - ERROR
[2025-12-27 23:19:02] error: Error Please wait 300 seconds before requesting another verification email
[2025-12-27 23:19:02] info: [POST] /auth/resend-verification - 429
[2025-12-27 23:19:02] info: [POST] /auth/resend-verification
[2025-12-27 23:19:02] warn: [MemoryMonitoring] Memory threshold exceeded: 590MB
[2025-12-27 23:19:02] info: [auth] Authenticated user 9a29c0c1-e937-4b5e-926a-2bc7c3fa13d2 for POST /resend-verification
[2025-12-27 23:19:02] info: [EmailVerification] Created verification token
[2025-12-27 23:19:02] info: [EmailVerification] Resent verification email
[2025-12-27 23:19:02] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: emailint_1766895542726@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=604324c7391e173813a8e8cdc717a5203d6d986bbc49f6f1db3486dca5a201ab

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:02] info: [POST] /auth/resend-verification - 200
[2025-12-27 23:19:02] info: [GET] /auth/verification-status
[2025-12-27 23:19:02] warn: [MemoryMonitoring] Memory threshold exceeded: 591MB
[2025-12-27 23:19:02] info: [auth] Authenticated user 0d792380-e341-442f-bd32-6201b3057121 for GET /verification-status
[2025-12-27 23:19:02] info: [EmailVerification] Verification status check
[2025-12-27 23:19:02] info: [GET] /auth/verification-status - 200
[2025-12-27 23:19:03] info: [GET] /auth/verification-status
[2025-12-27 23:19:03] warn: [MemoryMonitoring] Memory threshold exceeded: 589MB
[2025-12-27 23:19:03] info: [auth] Authenticated user 7ee1476a-99e3-4a50-be55-ee7f350f3f6a for GET /verification-status
[2025-12-27 23:19:03] info: [EmailVerification] Verification status check
[2025-12-27 23:19:03] info: [GET] /auth/verification-status - 200
[2025-12-27 23:19:03] info: [GET] /auth/verification-status
[2025-12-27 23:19:03] warn: [MemoryMonitoring] Memory threshold exceeded: 588MB
[2025-12-27 23:19:03] warn: [auth] Access token is required for GET /verification-status from ::ffff:127.0.0.1
[2025-12-27 23:19:03] info: [GET] /auth/verification-status - 401
[2025-12-27 23:19:03] info: [GET] /auth/verification-status
[2025-12-27 23:19:03] warn: [MemoryMonitoring] Memory threshold exceeded: 587MB
[2025-12-27 23:19:03] info: [auth] Authenticated user 35db817e-ae3b-4cb6-a431-fd810effab5e for GET /verification-status
[2025-12-27 23:19:03] info: [EmailVerification] Verification status check
[2025-12-27 23:19:03] info: [GET] /auth/verification-status - 200
[2025-12-27 23:19:03] info: [POST] /auth/register
[2025-12-27 23:19:03] warn: [MemoryMonitoring] Memory threshold exceeded: 587MB
[2025-12-27 23:19:03] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:03] info: [EmailVerification] Created verification token
[2025-12-27 23:19:03] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: workflow_1766895543359@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=e11a876a64134568ab7084f16d2a5db0ba12b56a5024662d74b74b031be521d0

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:03] info: [authController.register] Verification email sent
[2025-12-27 23:19:03] info: [POST] /auth/register - 201
[2025-12-27 23:19:03] info: [GET] /auth/verify-email?token=e11a876a64134568ab7084f16d2a5db0ba12b56a5024662d74b74b031be521d0
[2025-12-27 23:19:03] warn: [MemoryMonitoring] Memory threshold exceeded: 589MB
[2025-12-27 23:19:03] info: [EmailVerification] Email verified successfully
[2025-12-27 23:19:03] info: [EmailService] Welcome email (DEV MODE - not sent)
[2025-12-27 23:19:03] info: [GET] /auth/verify-email?token=e11a876a64134568ab7084f16d2a5db0ba12b56a5024662d74b74b031be521d0 - 200
[2025-12-27 23:19:03] info: [GET] /auth/verification-status
[2025-12-27 23:19:03] warn: [MemoryMonitoring] Memory threshold exceeded: 589MB
[2025-12-27 23:19:03] info: [auth] Authenticated user 497dd9c8-996b-471c-be59-6eb26b95aeaf for GET /verification-status
[2025-12-27 23:19:03] info: [EmailVerification] Verification status check
[2025-12-27 23:19:03] info: [GET] /auth/verification-status - 200
[2025-12-27 23:19:03] info: [POST] /auth/resend-verification
[2025-12-27 23:19:03] warn: [MemoryMonitoring] Memory threshold exceeded: 585MB
[2025-12-27 23:19:03] info: [auth] Authenticated user 497dd9c8-996b-471c-be59-6eb26b95aeaf for POST /resend-verification
[2025-12-27 23:19:03] info: [EmailVerification] Created verification token
[2025-12-27 23:19:03] info: [EmailVerification] Resent verification email
[2025-12-27 23:19:03] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: emailint_1766895543764@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=f7c923e09ef41c566f6668534434779b41d36b736a552cf9b74c3f526f87551d

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:03] info: [POST] /auth/resend-verification - 200
[2025-12-27 23:19:03] info: [GET] /auth/verify-email?token=f7c923e09ef41c566f6668534434779b41d36b736a552cf9b74c3f526f87551d
[2025-12-27 23:19:03] warn: [MemoryMonitoring] Memory threshold exceeded: 586MB
[2025-12-27 23:19:03] info: [EmailVerification] Email verified successfully
[2025-12-27 23:19:03] info: [EmailService] Welcome email (DEV MODE - not sent)
[2025-12-27 23:19:03] info: [GET] /auth/verify-email?token=f7c923e09ef41c566f6668534434779b41d36b736a552cf9b74c3f526f87551d - 200
[2025-12-27 23:19:03] info: [GET] /auth/verification-status
[2025-12-27 23:19:03] warn: [MemoryMonitoring] Memory threshold exceeded: 583MB
[2025-12-27 23:19:03] info: [auth] Authenticated user 497dd9c8-996b-471c-be59-6eb26b95aeaf for GET /verification-status
[2025-12-27 23:19:03] info: [EmailVerification] Verification status check
[2025-12-27 23:19:03] info: [GET] /auth/verification-status - 200
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=dc839b8f4f15b797adb807f40c1d4fe4e6a85456b62355f88b923f7687d77e37
[2025-12-27 23:19:04] warn: [MemoryMonitoring] Memory threshold exceeded: 584MB
[2025-12-27 23:19:04] info: [EmailVerification] Email verified successfully
[2025-12-27 23:19:04] info: [EmailService] Welcome email (DEV MODE - not sent)
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=dc839b8f4f15b797adb807f40c1d4fe4e6a85456b62355f88b923f7687d77e37 - 200
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=dc839b8f4f15b797adb807f40c1d4fe4e6a85456b62355f88b923f7687d77e37
[2025-12-27 23:19:04] warn: [MemoryMonitoring] Memory threshold exceeded: 582MB
[2025-12-27 23:19:04] error: [EmailVerification] Error verifying email token: Verification token has already been used
[2025-12-27 23:19:04] error: [authController.verifyEmail] Error verifying email: Verification token has already been used
[2025-12-27 23:19:04] error: [GET] /auth/verify-email?token=dc839b8f4f15b797adb807f40c1d4fe4e6a85456b62355f88b923f7687d77e37 - ERROR
[2025-12-27 23:19:04] error: Error Verification token has already been used
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=dc839b8f4f15b797adb807f40c1d4fe4e6a85456b62355f88b923f7687d77e37 - 400
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=dc839b8f4f15b797adb807f40c1d4fe4e6a85456b62355f88b923f7687d77e37
[2025-12-27 23:19:04] warn: [MemoryMonitoring] Memory threshold exceeded: 582MB
[2025-12-27 23:19:04] error: [EmailVerification] Error verifying email token: Verification token has already been used
[2025-12-27 23:19:04] error: [authController.verifyEmail] Error verifying email: Verification token has already been used
[2025-12-27 23:19:04] error: [GET] /auth/verify-email?token=dc839b8f4f15b797adb807f40c1d4fe4e6a85456b62355f88b923f7687d77e37 - ERROR
[2025-12-27 23:19:04] error: Error Verification token has already been used
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=dc839b8f4f15b797adb807f40c1d4fe4e6a85456b62355f88b923f7687d77e37 - 400
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=f0b8b3c6211e913a0c80fb2e65e4a3d859655c6efd7c7f976f15dd0e5e19e139
[2025-12-27 23:19:04] warn: [MemoryMonitoring] Memory threshold exceeded: 585MB
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=f0b8b3c6211e913a0c80fb2e65e4a3d859655c6efd7c7f976f15dd0e5e19e139
[2025-12-27 23:19:04] warn: [MemoryMonitoring] Memory threshold exceeded: 591MB
[2025-12-27 23:19:04] info: [EmailVerification] Email verified successfully
[2025-12-27 23:19:04] info: [EmailService] Welcome email (DEV MODE - not sent)
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=f0b8b3c6211e913a0c80fb2e65e4a3d859655c6efd7c7f976f15dd0e5e19e139 - 200
[2025-12-27 23:19:04] error: [EmailVerification] Error verifying email token: Verification token has already been used
[2025-12-27 23:19:04] error: [authController.verifyEmail] Error verifying email: Verification token has already been used
[2025-12-27 23:19:04] error: [GET] /auth/verify-email?token=f0b8b3c6211e913a0c80fb2e65e4a3d859655c6efd7c7f976f15dd0e5e19e139 - ERROR
[2025-12-27 23:19:04] error: Error Verification token has already been used
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=f0b8b3c6211e913a0c80fb2e65e4a3d859655c6efd7c7f976f15dd0e5e19e139 - 400
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=definitely_invalid_token_123
[2025-12-27 23:19:04] warn: [MemoryMonitoring] Memory threshold exceeded: 584MB
[2025-12-27 23:19:04] error: [authController.verifyEmail] Error verifying email: Invalid or expired verification token
[2025-12-27 23:19:04] error: [GET] /auth/verify-email?token=definitely_invalid_token_123 - ERROR
[2025-12-27 23:19:04] error: Error Invalid or expired verification token
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=definitely_invalid_token_123 - 400
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=
[2025-12-27 23:19:04] warn: [MemoryMonitoring] Memory threshold exceeded: 585MB
[2025-12-27 23:19:04] error: [authController.verifyEmail] Error verifying email: Verification token is required
[2025-12-27 23:19:04] error: [GET] /auth/verify-email?token= - ERROR
[2025-12-27 23:19:04] error: Error Verification token is required
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token= - 400
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=
[2025-12-27 23:19:04] warn: [MemoryMonitoring] Memory threshold exceeded: 586MB
[2025-12-27 23:19:04] error: [authController.verifyEmail] Error verifying email: Verification token is required
[2025-12-27 23:19:04] error: [GET] /auth/verify-email?token= - ERROR
[2025-12-27 23:19:04] error: Error Verification token is required
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token= - 400
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
[2025-12-27 23:19:04] warn: [MemoryMonitoring] Memory threshold exceeded: 589MB
[2025-12-27 23:19:04] error: [authController.verifyEmail] Error verifying email: Invalid or expired verification token
[2025-12-27 23:19:04] error: [GET] /auth/verify-email?token=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa - ERROR
[2025-12-27 23:19:04] error: Error Invalid or expired verification token
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa - 400
[2025-12-27 23:19:04] info: [GET] /auth/verify-email?token=%3Cscript%3Ealert(%22xss%22)%3C/script%3E
[2025-12-27 23:19:04] warn: [MemoryMonitoring] Memory threshold exceeded: 586MB
[2025-12-27 23:19:05] error: [authController.verifyEmail] Error verifying email: Invalid or expired verification token
[2025-12-27 23:19:05] error: [GET] /auth/verify-email?token=%3Cscript%3Ealert(%22xss%22)%3C/script%3E - ERROR
[2025-12-27 23:19:05] error: Error Invalid or expired verification token
[2025-12-27 23:19:05] info: [GET] /auth/verify-email?token=%3Cscript%3Ealert(%22xss%22)%3C/script%3E - 400
[2025-12-27 23:19:05] info: [GET] /auth/verify-email?token=%27;%20DROP%20TABLE%20users;%20--
[2025-12-27 23:19:05] warn: [MemoryMonitoring] Memory threshold exceeded: 584MB
[2025-12-27 23:19:05] error: [authController.verifyEmail] Error verifying email: Invalid or expired verification token
[2025-12-27 23:19:05] error: [GET] /auth/verify-email?token=%27;%20DROP%20TABLE%20users;%20-- - ERROR
[2025-12-27 23:19:05] error: Error Invalid or expired verification token
[2025-12-27 23:19:05] info: [GET] /auth/verify-email?token=%27;%20DROP%20TABLE%20users;%20-- - 400
[2025-12-27 23:19:05] info: [GET] /auth/verify-email?token=
[2025-12-27 23:19:05] warn: [MemoryMonitoring] Memory threshold exceeded: 584MB
[2025-12-27 23:19:05] error: [authController.verifyEmail] Error verifying email: Verification token is required
[2025-12-27 23:19:05] error: [GET] /auth/verify-email?token= - ERROR
[2025-12-27 23:19:05] error: Error Verification token is required
[2025-12-27 23:19:05] info: [GET] /auth/verify-email?token= - 400
[2025-12-27 23:19:05] info: [GET] /auth/verify-email?token=
[2025-12-27 23:19:05] warn: [MemoryMonitoring] Memory threshold exceeded: 586MB
[2025-12-27 23:19:05] error: [authController.verifyEmail] Error verifying email: Verification token is required
[2025-12-27 23:19:05] error: [GET] /auth/verify-email?token= - ERROR
[2025-12-27 23:19:05] error: Error Verification token is required
[2025-12-27 23:19:05] info: [GET] /auth/verify-email?token= - 400
PASS __tests__/integration/email-verification.test.mjs (6.462 s)
  Email Verification System - Integration Tests
    POST /auth/register - Email Verification Integration
      ‚àö should_create_verification_token_on_registration (520 ms)
      ‚àö should_include_email_verified_status_in_response (419 ms)
      ‚àö should_log_verification_email_in_development_mode (423 ms)
    GET /auth/verify-email
      ‚àö should_verify_email_with_valid_token (130 ms)
      ‚àö should_update_user_email_verified_status (127 ms)
      ‚àö should_mark_token_as_used (123 ms)
      ‚àö should_reject_missing_token (116 ms)
      ‚àö should_reject_invalid_token (220 ms)
      ‚àö should_reject_expired_token (108 ms)
      ‚àö should_reject_already_used_token (142 ms)
      ‚àö should_be_publicly_accessible_without_authentication (113 ms)
    POST /auth/resend-verification
      ‚àö should_create_new_verification_token (122 ms)
      ‚àö should_require_authentication (107 ms)
      ‚àö should_reject_if_email_already_verified (109 ms)
      ‚àö should_enforce_rate_limiting (152 ms)
      ‚àö should_cleanup_expired_tokens (124 ms)
    GET /auth/verification-status
      ‚àö should_return_unverified_status_for_new_user (109 ms)
      ‚àö should_return_verified_status_after_verification (111 ms)
      ‚àö should_require_authentication (107 ms)
      ‚àö should_return_user_email_address (105 ms)
    Complete Email Verification Workflow
      ‚àö should_complete_full_registration_to_verification_flow (473 ms)
      ‚àö should_handle_resend_and_verify_workflow (226 ms)
      ‚àö should_prevent_multiple_verification_attempts (189 ms)
    Security and Edge Cases
      ‚àö should_handle_concurrent_verification_requests (208 ms)
      ‚àö should_sanitize_error_messages_to_prevent_enumeration (234 ms)
      ‚àö should_handle_malformed_token_input (599 ms)

[2025-12-27 23:19:05] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:05] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:05] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:05] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:06] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:06] info: [EmailVerification] Created verification token
[2025-12-27 23:19:06] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=7eefd81a1d0080ec973f6f0ed2045b1525eee295fc90f844570b428edd1fe4ec

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:06] info: [authController.register] Verification email sent
[2025-12-27 23:19:06] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:06] info: [EmailVerification] Created verification token
[2025-12-27 23:19:06] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=9ff30e4214a3533d1698e85cd7c358a3ebe2f62bbf59637b34f915299da296fa

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:06] info: [authController.register] Verification email sent
[2025-12-27 23:19:07] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:07] info: [EmailVerification] Created verification token
[2025-12-27 23:19:07] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=0b21ce7df44ddb98f1d29c35d193056fcd0f15aa9eb8a8801eb78a3c43f8de4b

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:07] info: [authController.register] Verification email sent
[2025-12-27 23:19:07] info: [health] Health check passed
[2025-12-27 23:19:07] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:07] info: [EmailVerification] Created verification token
[2025-12-27 23:19:07] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=6b64d994f045fe26a3e2877b670ea77c164132598af32317adbe4cc1cecd833e

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:07] info: [authController.register] Verification email sent
[2025-12-27 23:19:07] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:07] info: [EmailVerification] Created verification token
[2025-12-27 23:19:07] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=51bed85dd58bd5e4c8cc84d0d7dadbdf4239631afb926c0d6e956c990f04859e

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:07] info: [authController.register] Verification email sent
[2025-12-27 23:19:07] info: [auth] Authenticated user 244f6def-6f43-47b2-b96a-5b8c207ec6a8 for GET /health
[2025-12-27 23:19:07] info: [MemoryManagement] Getting system health assessment
[2025-12-27 23:19:08] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:08] info: [EmailVerification] Created verification token
[2025-12-27 23:19:08] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=fb6509a9afaeaec32528f99555abfaf0041511591cd59af89e9d681c3dd582fd

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:08] info: [authController.register] Verification email sent
[2025-12-27 23:19:08] info: [auth] Authenticated user 1de4dc8b-78ca-4cb6-a4b9-b822c422c6f3 for GET /health
[2025-12-27 23:19:08] info: [MemoryManagement] Getting system health assessment
[2025-12-27 23:19:08] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:08] info: [EmailVerification] Created verification token
[2025-12-27 23:19:08] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=52bd96989fd3178f5ff6aedfc37a13727ffcb779ca173529a9752a055d7a6f43

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:08] info: [authController.register] Verification email sent
[2025-12-27 23:19:08] info: [auth] Authenticated user b60294fd-2d0b-4296-af06-230313cc87d2 for GET /health
[2025-12-27 23:19:08] info: [DocumentationRoutes] Getting documentation health status
[2025-12-27 23:19:08] info: [ApiDocService] OpenAPI specification validation passed
[2025-12-27 23:19:08] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:08] info: [EmailVerification] Created verification token
[2025-12-27 23:19:08] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=35b6c44e5589b401c4e33560a9cc65384a87b4fc916d6158867f9fb70c22dc4f

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:08] info: [authController.register] Verification email sent
[2025-12-27 23:19:08] info: [UserDocService] Loaded 1 documentation files
[2025-12-27 23:19:08] info: [UserDocService] Built search index with 34 terms
[2025-12-27 23:19:08] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:19:09] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:09] info: [EmailVerification] Created verification token
[2025-12-27 23:19:09] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=1c1fc17187ebf57ec9d30297bdabb3a754a0a0f0faab0ac5200cd16f93385957

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:09] info: [authController.register] Verification email sent
[2025-12-27 23:19:09] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:09] info: [EmailVerification] Created verification token
[2025-12-27 23:19:09] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=ee2d1f1e17ad42f62b3ea8aa1018575767433213085e06667086cbcfac9c510f

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:09] info: [authController.register] Verification email sent
[2025-12-27 23:19:09] info: [health] Health check passed
[2025-12-27 23:19:09] info: [auth] Authenticated user 0dcd7cb6-45a8-4f60-94a3-d6e90991c67b for GET /health
[2025-12-27 23:19:09] info: [MemoryManagement] Getting system health assessment
[2025-12-27 23:19:09] info: [auth] Authenticated user 0dcd7cb6-45a8-4f60-94a3-d6e90991c67b for GET /health
[2025-12-27 23:19:09] info: [DocumentationRoutes] Getting documentation health status
[2025-12-27 23:19:09] info: [ApiDocService] OpenAPI specification validation passed
[2025-12-27 23:19:09] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:09] info: [EmailVerification] Created verification token
[2025-12-27 23:19:09] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=9b95e167551a01f5187606a16954c96bf903eac2c0f800eb8c1114487813d581

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:09] info: [authController.register] Verification email sent
[2025-12-27 23:19:09] info: [auth] Authenticated user 952824bc-0837-4633-8dd8-4e302698e178 for GET /health
[2025-12-27 23:19:09] info: [MemoryManagement] Getting system health assessment
[2025-12-27 23:19:09] info: [health] Health check passed
[2025-12-27 23:19:10] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:10] info: [EmailVerification] Created verification token
[2025-12-27 23:19:10] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=05d6eec9f36f849e9e266a216d9f5bc4949848f00f75fcf78666613f4fa60fa5

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:10] info: [authController.register] Verification email sent
[2025-12-27 23:19:10] info: [health] Health check passed
[2025-12-27 23:19:10] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:10] info: [EmailVerification] Created verification token
[2025-12-27 23:19:10] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=b102fe285b5ff05486b61548f2318cb0eca61ce723ba52c80bcb539c85e43f1c

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:10] info: [authController.register] Verification email sent
[2025-12-27 23:19:10] info: [health] Health check passed
[2025-12-27 23:19:10] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:10] info: [EmailVerification] Created verification token
[2025-12-27 23:19:10] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=a0369fa570b61952b864161b9d6123f215d067102cc472dfa9230618fdddd6c2

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:10] info: [authController.register] Verification email sent
[2025-12-27 23:19:11] warn: [auth] Access token is required for GET /health from ::ffff:127.0.0.1
[2025-12-27 23:19:11] warn: [auth] Access token is required for GET /health from ::ffff:127.0.0.1
[2025-12-27 23:19:11] warn: [auth] Access token is required for GET /api/test/health-status from ::ffff:127.0.0.1
[2025-12-27 23:19:11] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:11] info: [EmailVerification] Created verification token
[2025-12-27 23:19:11] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=8dfa1efc7aec2e5c35b98b05d4b049d73bebc6bb6e39a1e7bf30da16a430b86b

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:11] info: [authController.register] Verification email sent
[2025-12-27 23:19:11] info: [health] Health check passed
[2025-12-27 23:19:11] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:11] info: [EmailVerification] Created verification token
[2025-12-27 23:19:11] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=0091af451ba5d49781853b9d9048e8589144042222f22afc5613b37dfebb1683

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:11] info: [authController.register] Verification email sent
[2025-12-27 23:19:11] info: [auth] Authenticated user 36a98d18-6e21-4ccb-bd13-ddedf9127bf3 for GET /api/test/health-status
[2025-12-27 23:19:12] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:12] info: [EmailVerification] Created verification token
[2025-12-27 23:19:12] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: healthintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=bad898de3999502183a8a1f53f65be4fe50fbc501077139903da00e8ce6fabb0

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:12] info: [authController.register] Verification email sent
[2025-12-27 23:19:12] warn: [auth] Invalid or expired token for GET /health from ::ffff:127.0.0.1
[2025-12-27 23:19:12] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:12] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
PASS tests/integration/health-monitoring-integration.test.mjs (6.945 s)
  üè• Health Monitoring Integration Tests
    üîç Main Health Endpoints
      ‚àö should provide basic ping health check (430 ms)
      ‚àö should provide ping with custom name (359 ms)
      ‚àö should provide comprehensive health check (361 ms)
      ‚àö should provide readiness check (348 ms)
    üß† Memory Management Health
      ‚àö should provide memory system health assessment (336 ms)
      ‚àö should validate memory health score ranges (336 ms)
    üìö Documentation System Health
      ‚àö should provide API documentation health status (342 ms)
      ‚àö should provide user documentation health status (349 ms)
    üß¨ Epigenetic Flag System Health
      ‚àö should provide flag system operational status (359 ms)
    üîó Cross-System Health Integration
      ‚àö should validate health across all systems (467 ms)
      ‚àö should provide consistent health response formats (366 ms)
    ‚ö° Performance Health Monitoring
      ‚àö should monitor health endpoint response times (339 ms)
      ‚àö should validate database performance in health checks (369 ms)
    üõ°Ô∏è Health Monitoring Security
      ‚àö should require authentication for protected health endpoints (372 ms)
      ‚àö should allow public access to basic health endpoints (393 ms)
    üö® Error Handling and Reporting
      ‚àö should handle health check errors gracefully (359 ms)
      ‚àö should provide meaningful error messages for health failures (354 ms)

[2025-12-27 23:19:12] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:12] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:12] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:13] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:13] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:19:13] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:19:13] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:19:13] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:19:13] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:19:13] info: [POST] /api/horses/foals
[2025-12-27 23:19:13] warn: [MemoryMonitoring] Memory threshold exceeded: 665MB
[2025-12-27 23:19:13] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /horses/foals
[2025-12-27 23:19:13] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /foals
[2025-12-27 23:19:13] info: [horseController.createFoal] Creating foal: Trait Test Foal with sire 94183 and dam 94183
[2025-12-27 23:19:13] info: [horseModel.getHorseById] Successfully found horse: Cross System Test Horse (ID: 94183)
[2025-12-27 23:19:13] info: [horseModel.getHorseById] Successfully found horse: Cross System Test Horse (ID: 94183)
[2025-12-27 23:19:13] info: [horseController.gatherLineage] Gathering lineage for sire 94183 and dam 94183, 3 generations
[2025-12-27 23:19:13] info: [horseController.gatherLineage] Gathered 1 ancestors
[2025-12-27 23:19:13] info: [horseController.assessFeedQualityFromMare] Mare Cross System Test Horse feed quality: 75 (health: Good, bond: 50)
[2025-12-27 23:19:13] info: [horseController.createFoal] Mare stress: 50, Feed quality: 75, Lineage count: 1
[2025-12-27 23:19:13] info: [applyEpigeneticTraitsAtBirth] Starting trait assignment at birth
[2025-12-27 23:19:13] info: [applyEpigeneticTraitsAtBirth] Mare stress: 50, Feed quality: 75
[2025-12-27 23:19:13] info: [applyEpigeneticTraitsAtBirth] Final traits assigned: {"positive":[],"negative":[]}
[2025-12-27 23:19:13] info: [horseController.createFoal] Applied epigenetic traits: {"positive":[],"negative":[]}
[2025-12-27 23:19:13] info: [horseModel.createHorse] Applying at-birth traits for newborn with sire 94183 and dam 94183
[2025-12-27 23:19:13] info: [atBirthTraits.applyEpigeneticTraitsAtBirth] Applying at-birth traits for sire 94183 and dam 94183
[2025-12-27 23:19:13] info: [atBirthTraits.assessFeedQuality] Mare 94183 feed quality: 70
[2025-12-27 23:19:13] info: [atBirthTraits.applyEpigeneticTraitsAtBirth] Mare stress: 50, Feed quality: 70
[2025-12-27 23:19:13] info: [atBirthTraits.analyzeLineage] Analyzing lineage for sire 94183 and dam 94183
[2025-12-27 23:19:13] info: [atBirthTraits.analyzeLineage] Found 0 ancestors, 0 competitions
[2025-12-27 23:19:13] info: [atBirthTraits.detectInbreeding] Checking for inbreeding between sire 94183 and dam 94183
[2025-12-27 23:19:13] info: [atBirthTraits.detectInbreeding] Inbreeding not detected
[2025-12-27 23:19:13] info: [atBirthTraits.applyEpigeneticTraitsAtBirth] Breeding conditions: {"mareStress":50,"feedQuality":70,"disciplineSpecialization":false,"inbreedingDetected":false,"noInbreeding":true}
[2025-12-27 23:19:13] info: [atBirthTraits.applyEpigeneticTraitsAtBirth] Final traits: {"positive":[],"negative":[],"hidden":[]}
[2025-12-27 23:19:13] info: [horseModel.createHorse] Applied at-birth traits: {"positive":[],"negative":[],"hidden":[]}
[2025-12-27 23:19:13] info: [horseModel.createHorse] Breeding analysis - Lineage specialization: false, Inbreeding: false
[2025-12-27 23:19:13] info: [horseModel.createHorse] Successfully created horse: Trait Test Foal (ID: 94184)
[2025-12-27 23:19:13] info: [horseController.createFoal] Successfully created foal: Trait Test Foal (ID: 94184)
[2025-12-27 23:19:13] info: [POST] /api/horses/foals - 201
[2025-12-27 23:19:13] info: [POST] /api/foals/94184/enrichment
[2025-12-27 23:19:13] warn: [MemoryMonitoring] Memory threshold exceeded: 670MB
[2025-12-27 23:19:13] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /foals/94184/enrichment
[2025-12-27 23:19:13] info: [ownership] Validated ownership: user a055d652-654b-4cc2-aa05-77a8d00a5d9c owns foal 94184
[2025-12-27 23:19:13] info: [foalRoutes] POST /api/foals/94184/enrichment - Day 1, Activity: Feeding Assistance
[2025-12-27 23:19:13] info: [foalModel.completeEnrichmentActivity] Processing enrichment activity "Feeding Assistance" for foal 94184 on day 1
[2025-12-27 23:19:13] info: [foalModel.completeEnrichmentActivity] Activity completed successfully. Bond: 0 -> 7, Stress: 0 -> 1
[2025-12-27 23:19:13] info: [POST] /api/foals/94184/enrichment - 200
[2025-12-27 23:19:13] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 94184
[2025-12-27 23:19:13] info: [traitDiscovery.revealTraits] Found 0 hidden traits for horse 94184
[2025-12-27 23:19:13] info: [traitDiscovery.revealTraits] No hidden traits to reveal for horse 94184
[2025-12-27 23:19:13] info: [POST] /api/traits/discover/94184
[2025-12-27 23:19:13] warn: [MemoryMonitoring] Memory threshold exceeded: 670MB
[2025-12-27 23:19:13] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /traits/discover/94184
[2025-12-27 23:19:13] info: [ownership] Validated ownership: user a055d652-654b-4cc2-aa05-77a8d00a5d9c owns horse 94184
[2025-12-27 23:19:13] info: [traitController.discoverTraits] Triggering trait discovery for horse 94184
[2025-12-27 23:19:13] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 94184
[2025-12-27 23:19:13] info: [traitDiscovery.revealTraits] Found 0 hidden traits for horse 94184
[2025-12-27 23:19:13] info: [traitDiscovery.revealTraits] No hidden traits to reveal for horse 94184
[2025-12-27 23:19:13] info: [POST] /api/traits/discover/94184 - 200
[2025-12-27 23:19:13] info: [GET] /api/traits/discovery-status/94184
[2025-12-27 23:19:13] warn: [MemoryMonitoring] Memory threshold exceeded: 668MB
[2025-12-27 23:19:13] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /traits/discovery-status/94184
[2025-12-27 23:19:13] info: [ownership] Validated ownership: user a055d652-654b-4cc2-aa05-77a8d00a5d9c owns horse 94184
[2025-12-27 23:19:13] info: [traitController.getDiscoveryStatus] Getting discovery status for horse 94184
[2025-12-27 23:19:13] info: [GET] /api/traits/discovery-status/94184 - 200
[2025-12-27 23:19:13] info: [POST] /api/milestones/evaluate-milestone
[2025-12-27 23:19:13] warn: [MemoryMonitoring] Memory threshold exceeded: 666MB
[2025-12-27 23:19:13] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /milestones/evaluate-milestone
[2025-12-27 23:19:13] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /evaluate-milestone
[2025-12-27 23:19:13] info: [enhancedMilestoneController.evaluateMilestone] Evaluating milestone imprinting for horse 94184
[2025-12-27 23:19:13] info: [ownership] Found owned horse 94184 for user a055d652-654b-4cc2-aa05-77a8d00a5d9c
[2025-12-27 23:19:13] info: [enhancedMilestoneEvaluationSystem.evaluateEnhancedMilestone] Starting evaluation for horse 94184, milestone imprinting
[2025-12-27 23:19:13] info: [enhancedMilestoneEvaluationSystem] No personality effects applied - missing groom personality or horse temperament
[2025-12-27 23:19:13] info: [enhancedMilestoneEvaluationSystem.evaluateEnhancedMilestone] Completed evaluation for horse 94184: fearful (score: -5)
[2025-12-27 23:19:13] info: [POST] /api/milestones/evaluate-milestone - 200
[2025-12-27 23:19:13] info: [GET] /api/horses/94183/environmental-analysis
[2025-12-27 23:19:13] warn: [MemoryMonitoring] Memory threshold exceeded: 669MB
[2025-12-27 23:19:13] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses/94183/environmental-analysis
[2025-12-27 23:19:13] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses/94183/environmental-analysis
[2025-12-27 23:19:13] info: [ownership] Validated ownership: user a055d652-654b-4cc2-aa05-77a8d00a5d9c owns horse 94183
[2025-12-27 23:19:13] info: Environmental analysis generated for horse 94183 by user a055d652-654b-4cc2-aa05-77a8d00a5d9c
[2025-12-27 23:19:13] info: [GET] /api/horses/94183/environmental-analysis - 200
[2025-12-27 23:19:13] info: [GET] /api/horses/94183/trait-matrix
[2025-12-27 23:19:13] warn: [MemoryMonitoring] Memory threshold exceeded: 664MB
[2025-12-27 23:19:13] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses/94183/trait-matrix
[2025-12-27 23:19:13] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses/94183/trait-matrix
[2025-12-27 23:19:13] info: [ownership] Validated ownership: user a055d652-654b-4cc2-aa05-77a8d00a5d9c owns horse 94183
[2025-12-27 23:19:13] info: Trait interaction matrix generated for horse 94183 by user a055d652-654b-4cc2-aa05-77a8d00a5d9c
[2025-12-27 23:19:13] info: [GET] /api/horses/94183/trait-matrix - 200
[2025-12-27 23:19:13] info: [GET] /api/horses/94183
[2025-12-27 23:19:13] warn: [MemoryMonitoring] Memory threshold exceeded: 668MB
[2025-12-27 23:19:13] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses/94183
[2025-12-27 23:19:13] info: [ownership] Validated ownership: user a055d652-654b-4cc2-aa05-77a8d00a5d9c owns horse 94183
[2025-12-27 23:19:13] info: [GET] /api/horses/94183 - 200
[2025-12-27 23:19:14] info: [POST] /api/training/train
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 668MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /training/train
[2025-12-27 23:19:14] info: [ownership] Found owned horse 94183 for user a055d652-654b-4cc2-aa05-77a8d00a5d9c
[2025-12-27 23:19:14] info: [trainingController.trainRouteHandler] Training request for horse 94183 in Racing
[2025-12-27 23:19:14] info: [trainingController.trainHorse] Attempting to train horse 94183 in Racing
[2025-12-27 23:19:14] info: [trainingController.canTrain] Checking training eligibility for horse 94183 in Racing
[2025-12-27 23:19:14] info: [trainingModel.getHorseAge] Getting age for horse 94183
[2025-12-27 23:19:14] info: [trainingModel.getHorseAge] Horse 94183 is 28 years old
[2025-12-27 23:19:14] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94183 across all disciplines
[2025-12-27 23:19:14] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94183
[2025-12-27 23:19:14] info: [trainingController.canTrain] Horse 94183 is eligible to train in Racing
[2025-12-27 23:19:14] info: [horseModel.getHorseById] Successfully found horse: Cross System Test Horse (ID: 94183)
[2025-12-27 23:19:14] info: [trainingController.trainHorse] Horse 94183 has traits: 
[2025-12-27 23:19:14] info: [trainingModel.logTrainingSession] Logging training session for horse 94183 in Racing
[2025-12-27 23:19:14] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4811
[2025-12-27 23:19:14] info: [horseModel.incrementDisciplineScore] Incrementing Racing score for horse 94183 by +5
[2025-12-27 23:19:14] info: [horseModel.updateDisciplineScore] Updating Racing score for horse 94183 by +5
[2025-12-27 23:19:14] info: [horseModel.updateDisciplineScore] Successfully updated Racing score for horse 94183: 0 -> 5
[2025-12-27 23:19:14] info: [horseModel.incrementDisciplineScore] Successfully incremented Racing score for horse 94183
[2025-12-27 23:19:14] info: [xpLogModel.logXpEvent] Logging XP event: User a055d652-654b-4cc2-aa05-77a8d00a5d9c, Amount: 5, Reason: Trained horse Cross System Test Horse in Racing
[2025-12-27 23:19:14] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2337, User a055d652-654b-4cc2-aa05-77a8d00a5d9c, Amount: 5
[2025-12-27 23:19:14] info: [trainingController.trainHorse] Awarded 5 XP to user a055d652-654b-4cc2-aa05-77a8d00a5d9c for training
[2025-12-27 23:19:14] info: [trainingController.trainHorse] Successfully trained horse 94183 in Racing (Log ID: 4811, Score +5)
[2025-12-27 23:19:14] info: [POST] /api/training/train - 200
[2025-12-27 23:19:14] info: [GET] /api/horses/94183
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 663MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses/94183
[2025-12-27 23:19:14] info: [ownership] Validated ownership: user a055d652-654b-4cc2-aa05-77a8d00a5d9c owns horse 94183
[2025-12-27 23:19:14] info: [GET] /api/horses/94183 - 200
[2025-12-27 23:19:14] info: [GET] /api/competition/eligibility/94183/Racing
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 675MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /competition/eligibility/94183/Racing
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /eligibility/94183/Racing
[2025-12-27 23:19:14] info: [ownership] Validated ownership: user a055d652-654b-4cc2-aa05-77a8d00a5d9c owns horse 94183
[2025-12-27 23:19:14] info: [competitionRoutes.GET /eligibility] Checking eligibility for horse 94183 in Racing
[2025-12-27 23:19:14] info: [competitionRoutes.GET /eligibility] Horse 94183 eligibility checked for Racing
[2025-12-27 23:19:14] info: [GET] /api/competition/eligibility/94183/Racing - 200
[2025-12-27 23:19:14] info: [POST] /api/competition/enter
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 673MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /competition/enter
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /enter
[2025-12-27 23:19:14] info: [competitionRoutes.POST /enter] User a055d652-654b-4cc2-aa05-77a8d00a5d9c entering horse 94183 in show 5465
[2025-12-27 23:19:14] info: [ownership] Found owned horse 94183 for user a055d652-654b-4cc2-aa05-77a8d00a5d9c
[2025-12-27 23:19:14] info: [competitionRoutes.POST /enter] Successfully entered horse 94183 in show 5465
[2025-12-27 23:19:14] info: [POST] /api/competition/enter - 201
[2025-12-27 23:19:14] info: [POST] /api/competition/execute
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 672MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /competition/execute
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /execute
[2025-12-27 23:19:14] info: [competitionRoutes.POST /execute] User a055d652-654b-4cc2-aa05-77a8d00a5d9c executing competition for show 5465
[2025-12-27 23:19:14] info: [competitionRoutes.POST /execute] Executing competition with 1 entries
[2025-12-27 23:19:14] info: [enhancedCompetitionSimulation] Executing competition: Cross System Test Show 1766895554169 (Racing)
[2025-12-27 23:19:14] info: [calculateCompetitionScore] Horse Cross System Test Horse: Base score for Racing: 240
[2025-12-27 23:19:14] info: [calculateCompetitionScore] Horse Cross System Test Horse: Luck modifier: 3.5%, adjustment: 8.4
[2025-12-27 23:19:14] info: [calculateCompetitionScore] Horse Cross System Test Horse: Final score: 248 (base: 240, trait: +0, luck: 8.4)
[2025-12-27 23:19:14] info: [enhancedCompetitionSimulation] Horse Cross System Test Horse (ID: 94183) scored 248 in Racing
[2025-12-27 23:19:14] info: [resultModel.saveResult] Successfully updated placeholder result for horse 94183 in show 5465 with score 248
[2025-12-27 23:19:14] info: [horseXpModel.addXpToHorse] Added 30 XP to horse Cross System Test Horse (ID: 94183). New XP: 30, Stat points gained: 0, Available: 0
[2025-12-27 23:19:14] info: [enhancedCompetitionSimulation] Awarded 30 Horse XP to Cross System Test Horse for 1st place
[2025-12-27 23:19:14] info: [enhancedCompetitionSimulation] Competition completed. 1 entries processed.
[2025-12-27 23:19:14] info: [competitionRoutes.POST /execute] Competition executed successfully for show 5465
[2025-12-27 23:19:14] info: [POST] /api/competition/execute - 200
[2025-12-27 23:19:14] info: [GET] /api/horses/94183/xp
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 676MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses/94183/xp
[2025-12-27 23:19:14] info: [ownership] Validated ownership: user a055d652-654b-4cc2-aa05-77a8d00a5d9c owns horse 94183
[2025-12-27 23:19:14] info: [horseXpController.getHorseXpStatus] Retrieved XP status for horse Cross System Test Horse (ID: 94183)
[2025-12-27 23:19:14] info: [GET] /api/horses/94183/xp - 200
[2025-12-27 23:19:14] info: [GET] /api/leaderboards/competition?discipline=Racing&timeframe=all
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 673MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /leaderboards/competition
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /competition
[2025-12-27 23:19:14] info: [leaderboardRoutes.GET /competition] Getting competition leaderboard: discipline=Racing, period=all, metric=wins
[2025-12-27 23:19:14] info: [leaderboardRoutes.GET /competition] Retrieved 0 leaderboard entries
[2025-12-27 23:19:14] info: [GET] /api/leaderboards/competition?discipline=Racing&timeframe=all - 200
[2025-12-27 23:19:14] info: [GET] /api/grooms/user/a055d652-654b-4cc2-aa05-77a8d00a5d9c
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 671MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /grooms/user/a055d652-654b-4cc2-aa05-77a8d00a5d9c
[2025-12-27 23:19:14] info: [groomController.getUserGrooms] Getting grooms for user a055d652-654b-4cc2-aa05-77a8d00a5d9c
[2025-12-27 23:19:14] info: [GET] /api/grooms/user/a055d652-654b-4cc2-aa05-77a8d00a5d9c - 200
[2025-12-27 23:19:14] info: [POST] /api/grooms/interact
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 670MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /grooms/interact
[2025-12-27 23:19:14] info: [groomController.recordInteraction] Recording brushing interaction for foal 94183
[2025-12-27 23:19:14] warn: [groomPersonalityEffects.calculatePersonalityEffects] Unknown personality: methodical
[2025-12-27 23:19:14] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for methodical: none
[2025-12-27 23:19:14] info: [groomController.recordInteraction] Interaction recorded: 10 bonding, -1 stress
[2025-12-27 23:19:14] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46669 for interaction_completed
[2025-12-27 23:19:14] info: [groomProgressionService.awardGroomXP] Groom 46669 gained 2 XP: 200 ‚Üí 202 (Level 4 ‚Üí 2)
[2025-12-27 23:19:14] info: [groomController.recordInteraction] Awarded 2 XP to groom 46669 for interaction
[2025-12-27 23:19:14] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:19:14] info: [GET] /api/grooms/user/a055d652-654b-4cc2-aa05-77a8d00a5d9c
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 675MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /grooms/user/a055d652-654b-4cc2-aa05-77a8d00a5d9c
[2025-12-27 23:19:14] info: [groomController.getUserGrooms] Getting grooms for user a055d652-654b-4cc2-aa05-77a8d00a5d9c
[2025-12-27 23:19:14] info: [GET] /api/grooms/user/a055d652-654b-4cc2-aa05-77a8d00a5d9c - 200
[2025-12-27 23:19:14] info: [GET] /api/grooms/46669/retirement/eligibility
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 671MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /grooms/46669/retirement/eligibility
[2025-12-27 23:19:14] info: [ownership] Validated ownership: user a055d652-654b-4cc2-aa05-77a8d00a5d9c owns groom 46669
[2025-12-27 23:19:14] info: [GET] /api/grooms/46669/retirement/eligibility - 200
[2025-12-27 23:19:14] info: [POST] /api/grooms/assign
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 669MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /grooms/assign
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /assign
[2025-12-27 23:19:14] info: [groomController.assignGroom] Assigning groom 46669 to foal 94183
[2025-12-27 23:19:14] info: [groomSystem.assignGroomToFoal] Assigning groom 46669 to foal 94183
[2025-12-27 23:19:14] info: [groomSystem.assignGroomToFoal] Successfully assigned Cross System Test Groom to foal Cross System Test Horse
[2025-12-27 23:19:14] info: [POST] /api/grooms/assign - 201
[2025-12-27 23:19:14] info: [GET] /api/grooms/assignments/94183
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 671MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /grooms/assignments/94183
[2025-12-27 23:19:14] info: [groomController.getFoalAssignments] Getting assignments for foal 94183
[2025-12-27 23:19:14] info: [GET] /api/grooms/assignments/94183 - 200
[2025-12-27 23:19:14] info: [GET] /api/memory/status
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 668MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /memory/status
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /status
[2025-12-27 23:19:14] info: [MemoryManagement] Getting memory status
[2025-12-27 23:19:14] info: [GET] /api/memory/status - 200
[2025-12-27 23:19:14] info: [GET] /api/horses
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 675MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses
[2025-12-27 23:19:14] info: [GET] /api/horses
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 665MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses
[2025-12-27 23:19:14] info: [GET] /api/horses
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 671MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses
[2025-12-27 23:19:14] info: [GET] /api/horses
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 676MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses
[2025-12-27 23:19:14] info: [GET] /api/horses
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 667MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses
[2025-12-27 23:19:14] info: [GET] /api/horses
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 672MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses
[2025-12-27 23:19:14] info: [GET] /api/horses
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 678MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses
[2025-12-27 23:19:14] info: [GET] /api/horses
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 668MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses
[2025-12-27 23:19:14] info: [GET] /api/horses
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 673MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses
[2025-12-27 23:19:14] info: [GET] /api/horses
[2025-12-27 23:19:14] warn: [MemoryMonitoring] Memory threshold exceeded: 679MB
[2025-12-27 23:19:14] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses
[2025-12-27 23:19:14] info: [GET] /api/horses - 200
[2025-12-27 23:19:14] info: [GET] /api/horses - 200
[2025-12-27 23:19:14] info: [GET] /api/horses - 200
[2025-12-27 23:19:14] info: [GET] /api/horses - 200
[2025-12-27 23:19:14] info: [GET] /api/horses - 200
[2025-12-27 23:19:14] info: [GET] /api/horses - 200
[2025-12-27 23:19:14] info: [GET] /api/horses - 200
[2025-12-27 23:19:14] info: [GET] /api/horses - 200
[2025-12-27 23:19:14] info: [GET] /api/horses - 200
[2025-12-27 23:19:14] info: [GET] /api/horses - 200
[2025-12-27 23:19:15] info: [GET] /api/memory/status
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 670MB
[2025-12-27 23:19:15] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /memory/status
[2025-12-27 23:19:15] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /status
[2025-12-27 23:19:15] info: [MemoryManagement] Getting memory status
[2025-12-27 23:19:15] info: [GET] /api/memory/status - 200
[2025-12-27 23:19:15] info: [POST] /api/memory/gc
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 668MB
[2025-12-27 23:19:15] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /memory/gc
[2025-12-27 23:19:15] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for POST /gc
[2025-12-27 23:19:15] info: [MemoryManagement] Manual GC trigger requested (force: false)
[2025-12-27 23:19:15] info: [POST] /api/memory/gc - 400
[2025-12-27 23:19:15] info: [GET] /api/horses
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 668MB
[2025-12-27 23:19:15] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses
[2025-12-27 23:19:15] info: [GET] /api/horses - 200
[2025-12-27 23:19:15] info: [GET] /api/horses?page=1&limit=5
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 680MB
[2025-12-27 23:19:15] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /horses
[2025-12-27 23:19:15] info: [GET] /api/horses?page=1&limit=5 - 200
[2025-12-27 23:19:15] info: [GET] /api-docs/swagger.json
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 678MB
[2025-12-27 23:19:15] info: [GET] /api-docs/swagger.json - 200
[2025-12-27 23:19:15] info: [GET] /api/docs/health
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 675MB
[2025-12-27 23:19:15] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /health
[2025-12-27 23:19:15] info: [DocumentationRoutes] Getting documentation health status
[2025-12-27 23:19:15] info: [ApiDocService] OpenAPI specification validation passed
[2025-12-27 23:19:15] info: [GET] /api/docs/health - 200
[2025-12-27 23:19:15] info: [GET] /api/user-docs/search?q=competition
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 676MB
[2025-12-27 23:19:15] info: [UserDocRoutes] Searching documentation for: "competition"
[2025-12-27 23:19:15] info: [UserDocService] Loaded 1 documentation files
[2025-12-27 23:19:15] info: [UserDocService] Built search index with 34 terms
[2025-12-27 23:19:15] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:19:15] info: [GET] /api/user-docs/search?q=competition - 200
[2025-12-27 23:19:15] info: [GET] /api/user-docs/feature-guide
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 672MB
[2025-12-27 23:19:15] info: [UserDocRoutes] Getting document: feature-guide
[2025-12-27 23:19:15] info: [GET] /api/user-docs/feature-guide - 200
[2025-12-27 23:19:15] info: [GET] /api/user-docs/analytics
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 670MB
[2025-12-27 23:19:15] info: [UserDocRoutes] Getting documentation analytics
[2025-12-27 23:19:15] info: [GET] /api/user-docs/analytics - 200
[2025-12-27 23:19:15] info: [GET] /health
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 683MB
[2025-12-27 23:19:15] info: [GET] /health - 200
[2025-12-27 23:19:15] info: [GET] /ping
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 679MB
[2025-12-27 23:19:15] info: [GET] /ping - 200
[2025-12-27 23:19:15] info: [GET] /api/memory/health
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 673MB
[2025-12-27 23:19:15] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /memory/health
[2025-12-27 23:19:15] info: [auth] Authenticated user a055d652-654b-4cc2-aa05-77a8d00a5d9c for GET /health
[2025-12-27 23:19:15] info: [MemoryManagement] Getting system health assessment
[2025-12-27 23:19:15] info: [GET] /api/memory/health - 200
[2025-12-27 23:19:15] info: [GET] /api/user-docs/health
[2025-12-27 23:19:15] warn: [MemoryMonitoring] Memory threshold exceeded: 671MB
[2025-12-27 23:19:15] info: [GET] /api/user-docs/health - 200
PASS __tests__/integration/crossSystemValidation.test.mjs
  Cross-System Validation Tests
    Epigenetic Trait System Integration
      ‚àö Trait discovery integration with groom care patterns (344 ms)
      ‚àö Environmental trigger system integration (277 ms)
    Competition System Integration
      ‚àö Training system integration with competition performance (415 ms)
      ‚àö Leaderboard integration with competition results (42 ms)
    Groom System Integration
      ‚àö Groom career progression with horse development (203 ms)
      ‚àö Groom assignment integration with horse care (83 ms)
    Performance System Integration
      ‚àö Memory management integration with API operations (386 ms)
      ‚àö API optimization integration with response compression (65 ms)
    Documentation System Integration
      ‚àö API documentation integration with live endpoints (64 ms)
      ‚àö User documentation integration with search functionality (71 ms)
    System Health and Monitoring
      ‚àö Overall system health validation (113 ms)

[2025-12-27 23:19:15] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:15] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:15] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:16] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:16] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:19:16] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:19:16] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:19:16] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:19:16] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:19:16] info: [POST] /api/auth/register
[2025-12-27 23:19:16] warn: [MemoryMonitoring] Memory threshold exceeded: 716MB
[2025-12-27 23:19:17] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:17] info: [EmailVerification] Created verification token
[2025-12-27 23:19:17] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: cookietest+1766895556729@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=4771d3078836dd3c18dbdf87f562e122e3b023fe3b5aec10cedda7de5505cb24

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:17] info: [authController.register] Verification email sent
[2025-12-27 23:19:17] info: [POST] /api/auth/register - 201
[2025-12-27 23:19:17] info: [POST] /api/auth/register
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 722MB
[2025-12-27 23:19:17] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:17] info: [EmailVerification] Created verification token
[2025-12-27 23:19:17] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: cookietest2@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=659f226f9ca65105314995d6260b9df11a7c0214e25152d9202b667151b99f4b

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:17] info: [authController.register] Verification email sent
[2025-12-27 23:19:17] info: [POST] /api/auth/register - 201
[2025-12-27 23:19:17] info: [POST] /api/auth/login
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 724MB
[2025-12-27 23:19:17] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:17] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:17] info: [POST] /api/auth/login
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 719MB
[2025-12-27 23:19:17] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:17] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:17] info: [POST] /api/auth/login
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 714MB
[2025-12-27 23:19:17] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:17] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:17] info: [GET] /api/auth/profile
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 724MB
[2025-12-27 23:19:17] info: [GET] /api/auth/profile - 200
[2025-12-27 23:19:17] info: [GET] /api/auth/profile
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 719MB
[2025-12-27 23:19:17] warn: [auth] Access token is required for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:19:17] info: [GET] /api/auth/profile - 401
[2025-12-27 23:19:17] info: [GET] /api/auth/profile
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 715MB
[2025-12-27 23:19:17] warn: [auth] Invalid or expired token for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:19:17] info: [GET] /api/auth/profile - 401
[2025-12-27 23:19:17] info: [POST] /api/auth/login
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 723MB
[2025-12-27 23:19:17] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:17] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:17] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 720MB
[2025-12-27 23:19:17] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:17] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:17] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 715MB
[2025-12-27 23:19:17] error: [authController.refreshToken] Error refreshing token: Refresh token is required
[2025-12-27 23:19:17] error: [POST] /api/auth/refresh-token - ERROR
[2025-12-27 23:19:17] error: Error Refresh token is required
[2025-12-27 23:19:17] info: [POST] /api/auth/refresh-token - 400
[2025-12-27 23:19:17] info: [POST] /api/auth/login
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 717MB
[2025-12-27 23:19:17] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:17] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:17] info: [POST] /api/auth/logout
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 726MB
[2025-12-27 23:19:17] info: [POST] /api/auth/logout - 200
[2025-12-27 23:19:17] info: [POST] /api/auth/login
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 722MB
[2025-12-27 23:19:17] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:17] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:17] info: [POST] /api/auth/logout
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 717MB
[2025-12-27 23:19:17] info: [POST] /api/auth/logout - 200
[2025-12-27 23:19:17] info: [POST] /api/auth/register
[2025-12-27 23:19:17] warn: [MemoryMonitoring] Memory threshold exceeded: 726MB
[2025-12-27 23:19:18] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:18] info: [EmailVerification] Created verification token
[2025-12-27 23:19:18] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: xss-test@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=596b00d6bd048874df075f903015fcb6c7b55d00932265a17b685959a86ece23

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:18] info: [authController.register] Verification email sent
[2025-12-27 23:19:18] info: [POST] /api/auth/register - 201
[2025-12-27 23:19:18] info: [POST] /api/auth/login
[2025-12-27 23:19:18] warn: [MemoryMonitoring] Memory threshold exceeded: 727MB
[2025-12-27 23:19:18] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:18] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:18] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:18] info: [POST] /api/auth/login
[2025-12-27 23:19:18] warn: [MemoryMonitoring] Memory threshold exceeded: 724MB
[2025-12-27 23:19:18] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:18] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:18] info: [POST] /api/auth/login
[2025-12-27 23:19:18] warn: [MemoryMonitoring] Memory threshold exceeded: 721MB
[2025-12-27 23:19:18] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:18] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:18] info: [GET] /api/auth/profile
[2025-12-27 23:19:18] warn: [MemoryMonitoring] Memory threshold exceeded: 718MB
[2025-12-27 23:19:18] info: [GET] /api/auth/profile - 200
PASS __tests__/integration/auth-cookies.test.mjs
  Authentication with HttpOnly Cookies
    POST /api/auth/register - Cookie Setting
      ‚àö should set httpOnly cookies on successful registration (412 ms)
      ‚àö should NOT expose tokens in response body (XSS protection) (331 ms)
    POST /api/auth/login - Cookie Setting
      ‚àö should set httpOnly cookies on successful login (31 ms)
      ‚àö should include SameSite=Strict for CSRF protection (29 ms)
    GET /api/auth/profile - Cookie Authentication
      ‚àö should authenticate with httpOnly cookies (26 ms)
      ‚àö should reject request without cookies (18 ms)
      ‚àö should reject request with invalid cookies (21 ms)
    POST /api/auth/refresh-token - Cookie Refresh
      ‚àö should refresh accessToken using httpOnly refreshToken cookie (34 ms)
      ‚àö should reject refresh without refreshToken cookie (43 ms)
    POST /api/auth/logout - Cookie Clearing
      ‚àö should clear httpOnly cookies on logout (60 ms)
      ‚àö should invalidate refresh tokens in database on logout (60 ms)
    Security: XSS Protection Verification
      ‚àö should never include JWT tokens in any response body (704 ms)
    Security: CSRF Protection Verification
      ‚àö should set SameSite=Strict on all auth cookies (42 ms)
    Production Security: HTTPS Enforcement
      ‚àö should set Secure flag in production environment (38 ms)
    Backward Compatibility: Authorization Header Fallback
      ‚àö should still accept Authorization header for backward compatibility (28 ms)

[2025-12-27 23:19:19] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:19] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:19] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:19] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:19] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:19:19] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:19:19] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:19:19] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:19:19] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:19:20] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:20] info: [EmailVerification] Created verification token
[2025-12-27 23:19:20] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=56ea0f2d149e3c03208a4c808e84a7aa85ae890c1afdf13bf65419f763f4e907

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:20] info: [authController.register] Verification email sent
[2025-12-27 23:19:20] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:20] info: [EmailVerification] Created verification token
[2025-12-27 23:19:20] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=61f1ca97e05d21102fbad11039c5cc47b7be7340f106a9c0514bc5f5404da66f

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:20] info: [authController.register] Verification email sent
[2025-12-27 23:19:20] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:20] info: [EmailVerification] Created verification token
[2025-12-27 23:19:20] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=b0be0b9c59d0ecccd2e9b8749f581b94b73357ac46d51c9f43df5226aa95477f

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:20] info: [authController.register] Verification email sent
[2025-12-27 23:19:21] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:21] info: [EmailVerification] Created verification token
[2025-12-27 23:19:21] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=c800d2e99d84f4a9d1ac1a8dc1594cc7cf159824efc1fe65c29599a34c23739d

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:21] info: [authController.register] Verification email sent
[2025-12-27 23:19:21] info: [auth] Authenticated user d4e8532d-4fcf-45e4-9b11-db426beafa29 for POST /endpoints
[2025-12-27 23:19:21] info: [DocumentationRoutes] Registering endpoint: GET /api/test/integration
[2025-12-27 23:19:21] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:21] info: [EmailVerification] Created verification token
[2025-12-27 23:19:21] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=c9bf8f52b10901143e6d9d1cfb4763bb4e59710c8cc40990d9981fa93836ee5d

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:21] info: [authController.register] Verification email sent
[2025-12-27 23:19:21] info: [auth] Authenticated user 1719c2a6-d3ee-40a6-9609-2b1dd8c79f16 for POST /schemas
[2025-12-27 23:19:21] info: [DocumentationRoutes] Registering schema: TestSchema
[2025-12-27 23:19:21] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:21] info: [EmailVerification] Created verification token
[2025-12-27 23:19:21] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=6e4f9cdfaeaa8cd44aff3f23b2c60352168d8d3bbcd959e01220882642093e48

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:21] info: [authController.register] Verification email sent
[2025-12-27 23:19:21] info: [auth] Authenticated user 7e2bdaee-76f4-47fa-9268-9472cc9e5c82 for POST /endpoints
[2025-12-27 23:19:21] info: [DocumentationRoutes] Registering endpoint: POST /api/test/create
[2025-12-27 23:19:21] info: [auth] Authenticated user 7e2bdaee-76f4-47fa-9268-9472cc9e5c82 for POST /schemas
[2025-12-27 23:19:21] info: [DocumentationRoutes] Registering schema: CreateTestSchema
[2025-12-27 23:19:21] info: [auth] Authenticated user 7e2bdaee-76f4-47fa-9268-9472cc9e5c82 for POST /generate
[2025-12-27 23:19:21] info: [DocumentationRoutes] Generating API documentation
[2025-12-27 23:19:21] info: [ApiDocService] OpenAPI specification saved successfully
[2025-12-27 23:19:21] info: [ApiDocService] Documentation generated for 2 endpoints
[2025-12-27 23:19:22] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:22] info: [EmailVerification] Created verification token
[2025-12-27 23:19:22] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=0d95149f4a3d545942bea30de4386d6ea2c3e35c24b3ffc7a439bc6a67bf3263

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:22] info: [authController.register] Verification email sent
[2025-12-27 23:19:22] info: [auth] Authenticated user 96dc77b6-5758-4429-b3d0-c3c45995418c for GET /metrics
[2025-12-27 23:19:22] info: [DocumentationRoutes] Getting documentation metrics
[2025-12-27 23:19:22] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:22] info: [EmailVerification] Created verification token
[2025-12-27 23:19:22] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=8f74256fe0b3a4bf2a59e0b1a804487955ecc4a182dc3f2b4768fe6c9fcff670

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:22] info: [authController.register] Verification email sent
[2025-12-27 23:19:22] info: [auth] Authenticated user 3a794dfa-02c2-4f16-9fc5-69d7601384c7 for GET /health
[2025-12-27 23:19:22] info: [DocumentationRoutes] Getting documentation health status
[2025-12-27 23:19:22] info: [ApiDocService] OpenAPI specification validation passed
[2025-12-27 23:19:22] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:22] info: [EmailVerification] Created verification token
[2025-12-27 23:19:22] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=91bebf2b9d8da1f3fb912294fb0034685ba5e1affd94517ed969503f91fd2fff

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:22] info: [authController.register] Verification email sent
[2025-12-27 23:19:23] info: [auth] Authenticated user 4170c021-3a3f-4634-88a6-040eafcfc78a for GET /coverage
[2025-12-27 23:19:23] info: [DocumentationRoutes] Getting documentation coverage analysis
[2025-12-27 23:19:23] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:23] info: [EmailVerification] Created verification token
[2025-12-27 23:19:23] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=34bf17d17676611d8213fd7edb253e6ed9dfbcc2964708eab9168230c91f8d19

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:23] info: [authController.register] Verification email sent
[2025-12-27 23:19:23] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:23] info: [EmailVerification] Created verification token
[2025-12-27 23:19:23] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=2c0e52252e2a36bfe1e9a2267e1f8e644d45ac35cc1859381c2e8307ed105804

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:23] info: [authController.register] Verification email sent
[2025-12-27 23:19:23] info: [auth] Authenticated user b7635ab7-c29b-4c44-a755-8742619d0faa for GET /api/test/documented
[2025-12-27 23:19:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:24] info: [EmailVerification] Created verification token
[2025-12-27 23:19:24] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=a08b438fb60b33c3e49d6d7219bec5c16a5562f144c448c6c13def0f797d99e4

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:24] info: [authController.register] Verification email sent
[2025-12-27 23:19:24] warn: [auth] Access token is required for POST /endpoints from ::ffff:127.0.0.1
[2025-12-27 23:19:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:24] info: [EmailVerification] Created verification token
[2025-12-27 23:19:24] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: docintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=6afe27c6b34b2370ed1daf5b9630b4289c422ff553cdbebcd3d663db395dd191

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:24] info: [authController.register] Verification email sent
[2025-12-27 23:19:24] info: [auth] Authenticated user 8085dadc-bac1-4dc9-a864-6af43438dc65 for POST /endpoints
PASS tests/integration/documentation-system-integration.test.mjs (5.636 s)
  üìö Documentation System Integration Tests
    üìã Swagger/OpenAPI Specification Validation
      ‚àö should load and validate OpenAPI specification (451 ms)
      ‚àö should serve YAML specification format (365 ms)
      ‚àö should provide interactive Swagger UI (360 ms)
    üîç API Documentation Service Integration
      ‚àö should register and validate endpoint documentation (371 ms)
      ‚àö should register and validate schema documentation (359 ms)
      ‚àö should generate documentation with metrics (387 ms)
    üìä Documentation Coverage and Health
      ‚àö should provide documentation metrics and coverage (336 ms)
      ‚àö should provide documentation health status (367 ms)
      ‚àö should analyze documentation coverage by system (351 ms)
    üîó Live API Integration Validation
      ‚àö should validate API root endpoint documentation (338 ms)
      ‚àö should validate documented endpoint response format (335 ms)
    üõ°Ô∏è Documentation Security and Access
      ‚àö should require authentication for documentation management (355 ms)
      ‚àö should validate documentation input data (343 ms)

[2025-12-27 23:19:24] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:24] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:24] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:25] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:25] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:19:25] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:19:25] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:19:25] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:19:25] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:19:25] info: [POST] /api/auth/login
[2025-12-27 23:19:25] warn: [MemoryMonitoring] Memory threshold exceeded: 799MB
[2025-12-27 23:19:25] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:25] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:25] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:25] warn: [MemoryMonitoring] Memory threshold exceeded: 798MB
[2025-12-27 23:19:25] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:25] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:25] info: [POST] /api/auth/login
[2025-12-27 23:19:25] warn: [MemoryMonitoring] Memory threshold exceeded: 796MB
[2025-12-27 23:19:25] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:25] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:25] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:25] warn: [MemoryMonitoring] Memory threshold exceeded: 805MB
[2025-12-27 23:19:25] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:25] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:25] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:25] warn: [MemoryMonitoring] Memory threshold exceeded: 798MB
[2025-12-27 23:19:25] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:25] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:26] info: [POST] /api/auth/login
[2025-12-27 23:19:26] warn: [MemoryMonitoring] Memory threshold exceeded: 796MB
[2025-12-27 23:19:26] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:26] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:26] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:26] warn: [MemoryMonitoring] Memory threshold exceeded: 794MB
[2025-12-27 23:19:26] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:26] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:26] info: [POST] /api/auth/login
[2025-12-27 23:19:26] warn: [MemoryMonitoring] Memory threshold exceeded: 806MB
[2025-12-27 23:19:26] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:26] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:26] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:26] warn: [MemoryMonitoring] Memory threshold exceeded: 800MB
[2025-12-27 23:19:26] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:26] warn: [MemoryMonitoring] Memory threshold exceeded: 795MB
[2025-12-27 23:19:26] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:26] info: [POST] /api/auth/login
[2025-12-27 23:19:26] warn: [MemoryMonitoring] Memory threshold exceeded: 806MB
[2025-12-27 23:19:26] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:26] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:26] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:26] warn: [MemoryMonitoring] Memory threshold exceeded: 800MB
[2025-12-27 23:19:26] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:26] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:26] warn: [MemoryMonitoring] Memory threshold exceeded: 795MB
[2025-12-27 23:19:26] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:26] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:26] warn: [MemoryMonitoring] Memory threshold exceeded: 805MB
[2025-12-27 23:19:26] warn: [TokenRotation] Token reuse detected
[2025-12-27 23:19:26] warn: [TokenRotation] Token family invalidated
[2025-12-27 23:19:26] warn: [TokenRotation] Token reuse detected during rotation
[2025-12-27 23:19:26] warn: [authController.refreshToken] Token family invalidated due to reuse detection
[2025-12-27 23:19:26] error: [authController.refreshToken] Error refreshing token: Token reuse detected - please login again
[2025-12-27 23:19:26] error: [POST] /api/auth/refresh-token - ERROR
[2025-12-27 23:19:26] error: Error Token reuse detected - please login again
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token - 401
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:26] warn: [MemoryMonitoring] Memory threshold exceeded: 805MB
[2025-12-27 23:19:26] warn: [authController.refreshToken] Token rotation failed:
[2025-12-27 23:19:26] error: [authController.refreshToken] Error refreshing token: Invalid refresh token
[2025-12-27 23:19:26] error: [POST] /api/auth/refresh-token - ERROR
[2025-12-27 23:19:26] error: Error Invalid refresh token
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token - 401
[2025-12-27 23:19:26] info: [POST] /api/auth/login
[2025-12-27 23:19:26] warn: [MemoryMonitoring] Memory threshold exceeded: 805MB
[2025-12-27 23:19:26] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:26] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:26] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:26] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 801MB
[2025-12-27 23:19:27] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:27] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 796MB
[2025-12-27 23:19:27] warn: [TokenRotation] Token reuse detected
[2025-12-27 23:19:27] warn: [TokenRotation] Token family invalidated
[2025-12-27 23:19:27] warn: [TokenRotation] Token reuse detected during rotation
[2025-12-27 23:19:27] warn: [authController.refreshToken] Token family invalidated due to reuse detection
[2025-12-27 23:19:27] error: [authController.refreshToken] Error refreshing token: Token reuse detected - please login again
[2025-12-27 23:19:27] error: [POST] /api/auth/refresh-token - ERROR
[2025-12-27 23:19:27] error: Error Token reuse detected - please login again
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token - 401
[2025-12-27 23:19:27] info: [POST] /api/auth/login
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 796MB
[2025-12-27 23:19:27] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:27] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:27] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 806MB
[2025-12-27 23:19:27] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:27] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:27] info: [POST] /api/auth/login
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 804MB
[2025-12-27 23:19:27] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:27] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:27] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 805MB
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 809MB
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 798MB
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 802MB
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 806MB
[2025-12-27 23:19:27] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:27] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:27] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:27] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:27] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:27] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:27] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:27] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:27] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:27] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:27] info: [POST] /api/auth/login
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 809MB
[2025-12-27 23:19:27] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:27] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:27] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 805MB
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 809MB
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:27] warn: [MemoryMonitoring] Memory threshold exceeded: 798MB
[2025-12-27 23:19:27] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:27] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:27] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:27] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:27] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:27] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:27] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:28] info: [POST] /api/auth/login
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 806MB
[2025-12-27 23:19:28] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:28] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:28] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 803MB
[2025-12-27 23:19:28] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:28] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 798MB
[2025-12-27 23:19:28] warn: [TokenRotation] Token reuse detected
[2025-12-27 23:19:28] warn: [TokenRotation] Token family invalidated
[2025-12-27 23:19:28] warn: [TokenRotation] Token reuse detected during rotation
[2025-12-27 23:19:28] warn: [authController.refreshToken] Token family invalidated due to reuse detection
[2025-12-27 23:19:28] error: [authController.refreshToken] Error refreshing token: Token reuse detected - please login again
[2025-12-27 23:19:28] error: [POST] /api/auth/refresh-token - ERROR
[2025-12-27 23:19:28] error: Error Token reuse detected - please login again
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token - 401
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 798MB
[2025-12-27 23:19:28] warn: [authController.refreshToken] Token rotation failed:
[2025-12-27 23:19:28] error: [authController.refreshToken] Error refreshing token: Invalid refresh token
[2025-12-27 23:19:28] error: [POST] /api/auth/refresh-token - ERROR
[2025-12-27 23:19:28] error: Error Invalid refresh token
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token - 401
[2025-12-27 23:19:28] info: [POST] /api/auth/login
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 799MB
[2025-12-27 23:19:28] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:28] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:28] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 808MB
[2025-12-27 23:19:28] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:28] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 805MB
[2025-12-27 23:19:28] warn: [TokenRotation] Token reuse detected
[2025-12-27 23:19:28] warn: [TokenRotation] Token family invalidated
[2025-12-27 23:19:28] warn: [TokenRotation] Token reuse detected during rotation
[2025-12-27 23:19:28] warn: [authController.refreshToken] Token family invalidated due to reuse detection
[2025-12-27 23:19:28] error: [authController.refreshToken] Error refreshing token: Token reuse detected - please login again
[2025-12-27 23:19:28] error: [POST] /api/auth/refresh-token - ERROR
[2025-12-27 23:19:28] error: Error Token reuse detected - please login again
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token - 401
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 805MB
[2025-12-27 23:19:28] warn: [authController.refreshToken] Token rotation failed:
[2025-12-27 23:19:28] error: [authController.refreshToken] Error refreshing token: Invalid refresh token
[2025-12-27 23:19:28] error: [POST] /api/auth/refresh-token - ERROR
[2025-12-27 23:19:28] error: Error Invalid refresh token
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token - 401
[2025-12-27 23:19:28] info: [POST] /api/auth/login
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 803MB
[2025-12-27 23:19:28] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:28] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:28] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:28] info: [POST] /api/auth/logout
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 799MB
[2025-12-27 23:19:28] info: [POST] /api/auth/logout - 200
[2025-12-27 23:19:28] info: [POST] /api/auth/login
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 808MB
[2025-12-27 23:19:28] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:28] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:28] info: [POST] /api/auth/login - 200
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 805MB
[2025-12-27 23:19:28] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:28] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:28] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:28] warn: [MemoryMonitoring] Memory threshold exceeded: 800MB
[2025-12-27 23:19:28] warn: [TokenRotation] Token reuse detected
[2025-12-27 23:19:29] warn: [TokenRotation] Token family invalidated
[2025-12-27 23:19:29] warn: [TokenRotation] Token reuse detected during rotation
[2025-12-27 23:19:29] warn: [authController.refreshToken] Token family invalidated due to reuse detection
[2025-12-27 23:19:29] error: [authController.refreshToken] Error refreshing token: Token reuse detected - please login again
[2025-12-27 23:19:29] error: [POST] /api/auth/refresh-token - ERROR
[2025-12-27 23:19:29] error: Error Token reuse detected - please login again
[2025-12-27 23:19:29] info: [POST] /api/auth/refresh-token - 401
[2025-12-27 23:19:29] info: [POST] /api/auth/cleanup-tokens
[2025-12-27 23:19:29] warn: [MemoryMonitoring] Memory threshold exceeded: 800MB
[2025-12-27 23:19:29] warn: 404 - Route not found: POST /api/auth/cleanup-tokens from ::ffff:127.0.0.1
[2025-12-27 23:19:29] info: [POST] /api/auth/cleanup-tokens - 404
[2025-12-27 23:19:29] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:29] warn: [MemoryMonitoring] Memory threshold exceeded: 800MB
[2025-12-27 23:19:29] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:29] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:29] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:29] warn: [MemoryMonitoring] Memory threshold exceeded: 809MB
[2025-12-27 23:19:29] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:29] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:29] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:29] warn: [MemoryMonitoring] Memory threshold exceeded: 805MB
[2025-12-27 23:19:29] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:29] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:29] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:29] warn: [MemoryMonitoring] Memory threshold exceeded: 800MB
[2025-12-27 23:19:29] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:29] info: [POST] /api/auth/refresh-token - 200
[2025-12-27 23:19:29] info: [POST] /api/auth/refresh-token
[2025-12-27 23:19:29] warn: [MemoryMonitoring] Memory threshold exceeded: 809MB
[2025-12-27 23:19:29] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:29] info: [POST] /api/auth/refresh-token - 200
PASS __tests__/integration/token-rotation.test.mjs
  Token Rotation and Reuse Detection System
    Basic Token Rotation
      ‚àö should_rotate_refresh_token_on_each_use (344 ms)
      ‚àö should_invalidate_old_refresh_token_after_rotation (201 ms)
      ‚àö should_track_token_families_in_database (253 ms)
    Token Reuse Detection
      ‚àö should_detect_refresh_token_reuse (229 ms)
      ‚àö should_invalidate_entire_token_family_on_reuse_detection (367 ms)
      ‚àö should_require_reauthentication_after_family_invalidation (435 ms)
    Concurrent Token Usage
      ‚àö should_handle_concurrent_refresh_requests_gracefully (435 ms)
      ‚àö should_prevent_race_conditions_in_token_rotation (291 ms)
    Token Compromise Scenarios
      ‚àö should_handle_legitimate_user_concurrent_with_attacker (276 ms)
      ‚àö should_log_security_events_for_monitoring (254 ms)
    Token Expiration and Cleanup
      ‚àö should_reject_expired_refresh_tokens (125 ms)
      ‚àö should_clean_up_invalidated_token_families (444 ms)
    Database Constraints and Security
      ‚àö should_enforce_unique_constraints_on_token_families (90 ms)
      ‚àö should_validate_token_structure_and_signatures (248 ms)

[2025-12-27 23:19:29] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:29] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:29] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:30] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:30] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:30] info: [EmailVerification] Created verification token
[2025-12-27 23:19:30] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=0758325947ec11c74b4d50eee300d24624e8f90d323b8d7c241aaaa99b52ea11

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:30] info: [authController.register] Verification email sent
[2025-12-27 23:19:30] info: [auth] Authenticated user 612c7ff1-992c-4559-83ee-2edf68b65fc5 for GET /status
[2025-12-27 23:19:30] info: [MemoryManagement] Getting memory status
[2025-12-27 23:19:30] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:30] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:31] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:31] info: [EmailVerification] Created verification token
[2025-12-27 23:19:31] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=df9f7d8b50ba6999a1d2ac4b74014c5aed4362dcaff7b165c6349f984b79687d

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:31] info: [authController.register] Verification email sent
[2025-12-27 23:19:31] info: [auth] Authenticated user 630e45fa-8c65-4127-b81b-02e999585965 for GET /metrics
[2025-12-27 23:19:31] info: [MemoryManagement] Getting memory metrics for timeframe: 1h
[2025-12-27 23:19:31] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:31] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:31] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:31] info: [EmailVerification] Created verification token
[2025-12-27 23:19:31] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=097bc6afde7af9356141502a0f012c2e71072e29a5bbf54d52cf18bc71e78145

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:31] info: [authController.register] Verification email sent
[2025-12-27 23:19:31] info: [auth] Authenticated user 1d47db87-c2bc-4a32-9d53-136576b68682 for GET /status
[2025-12-27 23:19:31] info: [MemoryManagement] Getting memory status
[2025-12-27 23:19:31] info: [auth] Authenticated user 1d47db87-c2bc-4a32-9d53-136576b68682 for POST /api/test/memory-load
[2025-12-27 23:19:32] info: [auth] Authenticated user 1d47db87-c2bc-4a32-9d53-136576b68682 for GET /status
[2025-12-27 23:19:32] info: [MemoryManagement] Getting memory status
[2025-12-27 23:19:32] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:32] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:32] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:32] info: [EmailVerification] Created verification token
[2025-12-27 23:19:32] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=3db46704c538f03d8cb1a163c46ec9cd95308857b06e260d30a07ca054734239

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:32] info: [authController.register] Verification email sent
[2025-12-27 23:19:32] info: [auth] Authenticated user 5bec69c4-6b8b-4ce6-b69d-0d755a76df3e for GET /resources
[2025-12-27 23:19:32] info: [MemoryManagement] Getting resource analytics
[2025-12-27 23:19:32] info: [auth] Authenticated user 5bec69c4-6b8b-4ce6-b69d-0d755a76df3e for POST /cleanup
[2025-12-27 23:19:32] info: [MemoryManagement] Resource cleanup requested for: all
[2025-12-27 23:19:32] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:32] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:32] info: [auth] Authenticated user 5bec69c4-6b8b-4ce6-b69d-0d755a76df3e for GET /resources
[2025-12-27 23:19:33] info: [MemoryManagement] Getting resource analytics
[2025-12-27 23:19:33] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:33] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:33] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:33] info: [EmailVerification] Created verification token
[2025-12-27 23:19:33] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=a557fa3d5eb8092cffcb3d74e0ed9d96f5f9cb17c5b477f52f7ce0950cfd5e87

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:33] info: [authController.register] Verification email sent
[2025-12-27 23:19:33] info: [auth] Authenticated user 33ff0568-c186-4201-aadd-c1e8bfd310e8 for GET /resources
[2025-12-27 23:19:33] info: [MemoryManagement] Getting resource analytics
[2025-12-27 23:19:33] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:33] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:33] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:33] info: [EmailVerification] Created verification token
[2025-12-27 23:19:33] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=764a08c864d18a100a46c35c7bcd6625250356ba2156b0cad15419d3829ca2c4

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:33] info: [authController.register] Verification email sent
[2025-12-27 23:19:33] info: [auth] Authenticated user e0a1f20f-e3af-43dc-bb82-4b32e0ee626d for POST /gc
[2025-12-27 23:19:33] info: [MemoryManagement] Manual GC trigger requested (force: false)
[2025-12-27 23:19:33] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:33] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:34] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:34] info: [EmailVerification] Created verification token
[2025-12-27 23:19:34] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=24dddafdd4065c5ed51aaea8190aa15d515c616592d1561b08be6ba9e4c37d00

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:34] info: [authController.register] Verification email sent
[2025-12-27 23:19:34] info: [auth] Authenticated user 22b08c1b-ab6b-4f9e-85af-941bbd621b87 for POST /gc
[2025-12-27 23:19:34] info: [MemoryManagement] Manual GC trigger requested (force: true)
[2025-12-27 23:19:34] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:34] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:34] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:34] info: [EmailVerification] Created verification token
[2025-12-27 23:19:34] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=3b8432613e0c5235946a0601f76341d3842fccb722d43354f201f7199de0a7fd

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:34] info: [authController.register] Verification email sent
[2025-12-27 23:19:34] info: [auth] Authenticated user d1da90e9-d86c-41f9-aba3-06e7e8de5bee for GET /alerts
[2025-12-27 23:19:34] info: [MemoryManagement] Getting memory alerts
[2025-12-27 23:19:34] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:34] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:34] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:34] info: [EmailVerification] Created verification token
[2025-12-27 23:19:34] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=64539a7eb491c6a2713c034f9cc7eb8a75dc6b0e5d4bd288d999ba5cfe464752

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:34] info: [authController.register] Verification email sent
[2025-12-27 23:19:34] info: [auth] Authenticated user 17bafef4-accb-4fc9-a29f-1d536955bff4 for GET /alerts
[2025-12-27 23:19:34] info: [MemoryManagement] Getting memory alerts
[2025-12-27 23:19:34] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:34] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:35] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:35] info: [EmailVerification] Created verification token
[2025-12-27 23:19:35] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=706dc1c3d71aec91d08b9e48029cdb6a5953499894467a07fbd3ace6a9a65a66

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:35] info: [authController.register] Verification email sent
[2025-12-27 23:19:35] warn: [auth] Access token is required for GET /status from ::ffff:127.0.0.1
[2025-12-27 23:19:35] warn: [auth] Access token is required for GET /metrics from ::ffff:127.0.0.1
[2025-12-27 23:19:35] warn: [auth] Access token is required for GET /resources from ::ffff:127.0.0.1
[2025-12-27 23:19:35] warn: [auth] Access token is required for GET /alerts from ::ffff:127.0.0.1
[2025-12-27 23:19:35] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:35] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:35] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:35] info: [EmailVerification] Created verification token
[2025-12-27 23:19:35] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=07b8d646affb2d4d4e740fd0ce2e99f9ed0e5782d60381781613eb6638024625

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:35] info: [authController.register] Verification email sent
[2025-12-27 23:19:35] info: [auth] Authenticated user f29e0b84-3bcf-4701-a16c-569f93a09a31 for POST /gc
[2025-12-27 23:19:35] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:35] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:35] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:35] info: [EmailVerification] Created verification token
[2025-12-27 23:19:35] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=c53fb2dcb561888a16a5e0b3603601616169c51a03c48bcc23f6019fb95c9ac2

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:35] info: [authController.register] Verification email sent
[2025-12-27 23:19:35] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:35] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:36] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:36] info: [EmailVerification] Created verification token
[2025-12-27 23:19:36] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: memoryintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=1d44de8f3f29e6c44e8c9d4d7f7011d4ea47c1c9d41d14fd668aeb1f62eb13bf

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:36] info: [authController.register] Verification email sent
[2025-12-27 23:19:36] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:36] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:19:36] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:19:36] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
PASS tests/integration/memory-management-integration.test.mjs (6.778 s)
  üß† Memory Management Integration Tests
    üîç Memory Monitoring Integration
      ‚àö should monitor memory usage and provide reports (469 ms)
      ‚àö should provide detailed memory metrics (389 ms)
      ‚àö should track memory usage during load operations (1447 ms)
    üîß Resource Management Integration
      ‚àö should track and cleanup resources correctly (434 ms)
      ‚àö should provide resource analytics and counts (375 ms)
    üóëÔ∏è Garbage Collection Integration
      ‚àö should trigger garbage collection when available (361 ms)
      ‚àö should handle GC unavailability gracefully (358 ms)
    üö® Memory Alert System Integration
      ‚àö should provide memory alerts and warnings (334 ms)
      ‚àö should filter alerts by severity (346 ms)
    üîí Memory Management Security
      ‚àö should require authentication for memory operations (382 ms)
      ‚àö should validate input for memory operations (342 ms)
    üìä Memory Service Integration
      ‚àö should integrate with memory service functions (339 ms)
      ‚àö should track and untrack resources through service (326 ms)

[2025-12-27 23:19:36] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:36] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:36] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:37] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:37] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:19:37] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:19:37] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:19:37] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:19:37] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:19:37] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:37] warn: [MemoryMonitoring] Memory threshold exceeded: 875MB
[2025-12-27 23:19:37] warn: [auth] Access token is required for GET /groom-marketplace from ::ffff:127.0.0.1
[2025-12-27 23:19:37] info: [GET] /api/groom-marketplace - 401
[2025-12-27 23:19:37] info: [POST] /api/groom-marketplace/refresh
[2025-12-27 23:19:37] warn: [MemoryMonitoring] Memory threshold exceeded: 874MB
[2025-12-27 23:19:37] warn: [auth] Access token is required for POST /groom-marketplace/refresh from ::ffff:127.0.0.1
[2025-12-27 23:19:37] info: [POST] /api/groom-marketplace/refresh - 401
[2025-12-27 23:19:37] info: [POST] /api/groom-marketplace/hire
[2025-12-27 23:19:37] warn: [MemoryMonitoring] Memory threshold exceeded: 885MB
[2025-12-27 23:19:37] warn: [auth] Access token is required for POST /groom-marketplace/hire from ::ffff:127.0.0.1
[2025-12-27 23:19:37] info: [POST] /api/groom-marketplace/hire - 401
[2025-12-27 23:19:37] info: [GET] /api/groom-marketplace/stats
[2025-12-27 23:19:37] warn: [MemoryMonitoring] Memory threshold exceeded: 881MB
[2025-12-27 23:19:37] warn: [auth] Access token is required for GET /groom-marketplace/stats from ::ffff:127.0.0.1
[2025-12-27 23:19:37] info: [GET] /api/groom-marketplace/stats - 401
[2025-12-27 23:19:37] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:37] warn: [MemoryMonitoring] Memory threshold exceeded: 877MB
[2025-12-27 23:19:37] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace
[2025-12-27 23:19:37] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /
[2025-12-27 23:19:37] info: [groomMarketplace] Getting marketplace for user 89735401-05b6-485d-babb-71ffe793999f
[2025-12-27 23:19:37] info: [groomMarketplace] Generated new marketplace for user 89735401-05b6-485d-babb-71ffe793999f with 12 grooms
[2025-12-27 23:19:37] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:37] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:37] warn: [MemoryMonitoring] Memory threshold exceeded: 882MB
[2025-12-27 23:19:37] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace
[2025-12-27 23:19:37] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /
[2025-12-27 23:19:37] info: [groomMarketplace] Getting marketplace for user 89735401-05b6-485d-babb-71ffe793999f
[2025-12-27 23:19:37] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:37] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:37] warn: [MemoryMonitoring] Memory threshold exceeded: 881MB
[2025-12-27 23:19:37] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace
[2025-12-27 23:19:37] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /
[2025-12-27 23:19:37] info: [groomMarketplace] Getting marketplace for user 89735401-05b6-485d-babb-71ffe793999f
[2025-12-27 23:19:37] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:37] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:37] warn: [MemoryMonitoring] Memory threshold exceeded: 882MB
[2025-12-27 23:19:37] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace
[2025-12-27 23:19:37] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /
[2025-12-27 23:19:37] info: [groomMarketplace] Getting marketplace for user 89735401-05b6-485d-babb-71ffe793999f
[2025-12-27 23:19:37] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/refresh
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 882MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /groom-marketplace/refresh
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /refresh
[2025-12-27 23:19:38] info: [groomMarketplace] Refreshing marketplace for user 89735401-05b6-485d-babb-71ffe793999f, force: false
[2025-12-27 23:19:38] info: [groomMarketplace] Refreshed marketplace for user 89735401-05b6-485d-babb-71ffe793999f with 12 new grooms
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/refresh - 200
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/refresh
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 886MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /groom-marketplace/refresh
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/refresh - 403
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/refresh
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 882MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /groom-marketplace/refresh
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /refresh
[2025-12-27 23:19:38] info: [groomMarketplace] Refreshing marketplace for user 89735401-05b6-485d-babb-71ffe793999f, force: false
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/refresh - 400
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/refresh
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 881MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /groom-marketplace/refresh
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /refresh
[2025-12-27 23:19:38] info: [groomMarketplace] Refreshing marketplace for user 89735401-05b6-485d-babb-71ffe793999f, force: false
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/refresh - 400
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/refresh
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 880MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /groom-marketplace/refresh
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /refresh
[2025-12-27 23:19:38] info: [groomMarketplace] Refreshing marketplace for user 89735401-05b6-485d-babb-71ffe793999f, force: true
[2025-12-27 23:19:38] info: [groomMarketplace] Charged user 89735401-05b6-485d-babb-71ffe793999f $100 for premium refresh
[2025-12-27 23:19:38] info: [groomMarketplace] Refreshed marketplace for user 89735401-05b6-485d-babb-71ffe793999f with 12 new grooms
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/refresh - 200
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 884MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /
[2025-12-27 23:19:38] info: [groomMarketplace] Getting marketplace for user 89735401-05b6-485d-babb-71ffe793999f
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/hire
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 884MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /groom-marketplace/hire
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /hire
[2025-12-27 23:19:38] info: [groomMarketplace] User 89735401-05b6-485d-babb-71ffe793999f attempting to hire groom mkt_b2602f30-68a1-4de3-8bb5-3764c2a97f24
[2025-12-27 23:19:38] info: [groomMarketplace] User 89735401-05b6-485d-babb-71ffe793999f hired groom 46670 for $210
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/hire - 201
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 883MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /
[2025-12-27 23:19:38] info: [groomMarketplace] Getting marketplace for user 89735401-05b6-485d-babb-71ffe793999f
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 883MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /
[2025-12-27 23:19:38] info: [groomMarketplace] Getting marketplace for user 89735401-05b6-485d-babb-71ffe793999f
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/hire
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 883MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /groom-marketplace/hire
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /hire
[2025-12-27 23:19:38] info: [groomMarketplace] User 89735401-05b6-485d-babb-71ffe793999f attempting to hire groom mkt_9e6f977e-3284-4551-8fce-a95f99a6422b
[2025-12-27 23:19:38] info: [groomMarketplace] User 89735401-05b6-485d-babb-71ffe793999f hired groom 46671 for $126
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/hire - 201
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 882MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /
[2025-12-27 23:19:38] info: [groomMarketplace] Getting marketplace for user 89735401-05b6-485d-babb-71ffe793999f
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 884MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /
[2025-12-27 23:19:38] info: [groomMarketplace] Getting marketplace for user 89735401-05b6-485d-babb-71ffe793999f
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 883MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 129ca70f-a5ca-4855-a0a9-d5b36f874c7d for GET /groom-marketplace
[2025-12-27 23:19:38] info: [auth] Authenticated user 129ca70f-a5ca-4855-a0a9-d5b36f874c7d for GET /
[2025-12-27 23:19:38] info: [groomMarketplace] Getting marketplace for user 129ca70f-a5ca-4855-a0a9-d5b36f874c7d
[2025-12-27 23:19:38] info: [groomMarketplace] Generated new marketplace for user 129ca70f-a5ca-4855-a0a9-d5b36f874c7d with 12 grooms
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/hire
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 885MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 129ca70f-a5ca-4855-a0a9-d5b36f874c7d for POST /groom-marketplace/hire
[2025-12-27 23:19:38] info: [auth] Authenticated user 129ca70f-a5ca-4855-a0a9-d5b36f874c7d for POST /hire
[2025-12-27 23:19:38] info: [groomMarketplace] User 129ca70f-a5ca-4855-a0a9-d5b36f874c7d attempting to hire groom mkt_8159fc54-0577-472c-bd35-4a51c67744f0
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/hire - 400
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 883MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /
[2025-12-27 23:19:38] info: [groomMarketplace] Getting marketplace for user 89735401-05b6-485d-babb-71ffe793999f
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/hire
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 884MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /groom-marketplace/hire
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /hire
[2025-12-27 23:19:38] info: [groomMarketplace] User 89735401-05b6-485d-babb-71ffe793999f attempting to hire groom non-existent-id
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/hire - 404
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 884MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /
[2025-12-27 23:19:38] info: [groomMarketplace] Getting marketplace for user 89735401-05b6-485d-babb-71ffe793999f
[2025-12-27 23:19:38] info: [groomMarketplace] Generated new marketplace for user 89735401-05b6-485d-babb-71ffe793999f with 12 grooms
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/hire
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 885MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /groom-marketplace/hire
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for POST /hire
[2025-12-27 23:19:38] info: [POST] /api/groom-marketplace/hire - 400
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 883MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /
[2025-12-27 23:19:38] info: [groomMarketplace] Getting marketplace for user 89735401-05b6-485d-babb-71ffe793999f
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace - 200
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace/stats
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 884MB
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /groom-marketplace/stats
[2025-12-27 23:19:38] info: [auth] Authenticated user 89735401-05b6-485d-babb-71ffe793999f for GET /stats
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace/stats - 200
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace/stats
[2025-12-27 23:19:38] warn: [MemoryMonitoring] Memory threshold exceeded: 883MB
[2025-12-27 23:19:38] info: [auth] Authenticated user e0bdef43-fff9-49c1-ba34-91e4cc3fdb9f for GET /groom-marketplace/stats
[2025-12-27 23:19:38] info: [auth] Authenticated user e0bdef43-fff9-49c1-ba34-91e4cc3fdb9f for GET /stats
[2025-12-27 23:19:38] info: [groomMarketplace.getStats] Returning empty stats: {"totalGrooms":0,"lastRefresh":"never","refreshCount":0,"qualityDistribution":{},"specialtyDistribution":{}}
[2025-12-27 23:19:38] info: [GET] /api/groom-marketplace/stats - 200
PASS tests/integration/groomMarketplaceAPI.test.mjs
  üè™ INTEGRATION: Groom Marketplace API
    Authentication
      ‚àö should require authentication for all marketplace endpoints (148 ms)
    GET /api/groom-marketplace
      ‚àö should get marketplace with available grooms (62 ms)
      ‚àö should return same marketplace on subsequent calls (82 ms)
    POST /api/groom-marketplace/refresh
      ‚àö should refresh marketplace when free refresh available (591 ms)
      ‚àö should require payment for premium refresh when not enough time passed (54 ms)
      ‚àö should allow premium refresh with force=true (69 ms)
    POST /api/groom-marketplace/hire
      ‚àö should hire groom from marketplace successfully (71 ms)
      ‚àö should remove hired groom from marketplace (126 ms)
      ‚àö should reject hiring with insufficient funds (99 ms)
      ‚àö should reject hiring non-existent groom (60 ms)
      ‚àö should require marketplaceId (62 ms)
    GET /api/groom-marketplace/stats
      ‚àö should return marketplace statistics (61 ms)
      ‚àö should return empty stats for user with no marketplace (47 ms)

[2025-12-27 23:19:39] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:39] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:39] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:39] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:39] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:19:39] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:19:39] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:19:39] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:19:39] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 931MB
[2025-12-27 23:19:40] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:19:40] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:19:40] error: Error Invalid credentials
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 401
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 933MB
[2025-12-27 23:19:40] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:19:40] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:19:40] error: Error Invalid credentials
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 401
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 932MB
[2025-12-27 23:19:40] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:19:40] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:19:40] error: Error Invalid credentials
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 401
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 929MB
[2025-12-27 23:19:40] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:19:40] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:19:40] error: Error Invalid credentials
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 401
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 925MB
[2025-12-27 23:19:40] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:19:40] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:19:40] error: Error Invalid credentials
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 401
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 925MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 933MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 928MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 936MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 929MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 937MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 931MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 939MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 931MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 927MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 935MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 929MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 937MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 930MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 938MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 931MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 939MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 932MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 927MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 935MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 930MB
[2025-12-27 23:19:40] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:40] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:40] info: [POST] /api/auth/login
[2025-12-27 23:19:40] warn: [MemoryMonitoring] Memory threshold exceeded: 939MB
[2025-12-27 23:19:41] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:19:41] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:19:41] error: Error Invalid credentials
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 401
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 935MB
[2025-12-27 23:19:41] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:19:41] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:19:41] error: Error Invalid credentials
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 401
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 931MB
[2025-12-27 23:19:41] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:19:41] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:19:41] error: Error Invalid credentials
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 401
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 928MB
[2025-12-27 23:19:41] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:19:41] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:19:41] error: Error Invalid credentials
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 401
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 940MB
[2025-12-27 23:19:41] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:19:41] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:19:41] error: Error Invalid credentials
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 401
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 936MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 929MB
[2025-12-27 23:19:41] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:19:41] error: [POST] /api/auth/login - ERROR
[2025-12-27 23:19:41] error: Error Invalid credentials
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 401
[2025-12-27 23:19:41] info: [POST] /api/auth/register
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 941MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/register - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/register
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 934MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/register - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 929MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 938MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 932MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 941MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 933MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 942MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 936MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 930MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 938MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 932MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 940MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:41] info: [POST] /api/auth/login
[2025-12-27 23:19:41] warn: [MemoryMonitoring] Memory threshold exceeded: 933MB
[2025-12-27 23:19:41] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:41] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:43] info: [POST] /api/auth/login
[2025-12-27 23:19:43] warn: [MemoryMonitoring] Memory threshold exceeded: 941MB
[2025-12-27 23:19:43] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:43] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:43] info: [POST] /api/auth/login
[2025-12-27 23:19:43] warn: [MemoryMonitoring] Memory threshold exceeded: 932MB
[2025-12-27 23:19:43] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:43] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:43] info: [POST] /api/auth/login
[2025-12-27 23:19:43] warn: [MemoryMonitoring] Memory threshold exceeded: 938MB
[2025-12-27 23:19:43] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:43] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:43] info: [POST] /api/auth/login
[2025-12-27 23:19:43] warn: [MemoryMonitoring] Memory threshold exceeded: 944MB
[2025-12-27 23:19:43] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:43] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:43] info: [POST] /api/auth/login
[2025-12-27 23:19:43] warn: [MemoryMonitoring] Memory threshold exceeded: 934MB
[2025-12-27 23:19:43] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:43] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:43] info: [POST] /api/auth/login
[2025-12-27 23:19:43] warn: [MemoryMonitoring] Memory threshold exceeded: 940MB
[2025-12-27 23:19:43] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:43] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:43] info: [POST] /api/auth/login
[2025-12-27 23:19:43] warn: [MemoryMonitoring] Memory threshold exceeded: 930MB
[2025-12-27 23:19:43] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:43] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:43] info: [POST] /api/auth/login
[2025-12-27 23:19:43] warn: [MemoryMonitoring] Memory threshold exceeded: 936MB
[2025-12-27 23:19:43] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:43] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:43] info: [POST] /api/auth/login
[2025-12-27 23:19:43] warn: [MemoryMonitoring] Memory threshold exceeded: 942MB
[2025-12-27 23:19:43] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:43] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:43] info: [POST] /api/auth/login
[2025-12-27 23:19:43] warn: [MemoryMonitoring] Memory threshold exceeded: 932MB
[2025-12-27 23:19:43] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:43] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:43] info: [POST] /api/auth/login
[2025-12-27 23:19:43] warn: [MemoryMonitoring] Memory threshold exceeded: 938MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 944MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 938MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 932MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 940MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 934MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 942MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 935MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 944MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 937MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 945MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 938MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 933MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
[2025-12-27 23:19:44] info: [POST] /api/auth/login
[2025-12-27 23:19:44] warn: [MemoryMonitoring] Memory threshold exceeded: 941MB
[2025-12-27 23:19:44] warn: [RateLimit] Limit exceeded
[2025-12-27 23:19:44] info: [POST] /api/auth/login - 429
PASS __tests__/integration/rate-limiting.test.mjs (5.472 s)
  Rate Limiting System
    Login Rate Limiting (Brute Force Protection)
      ‚àö should_allow_up_to_5_failed_login_attempts (527 ms)
      ‚àö should_block_6th_failed_login_attempt_with_429 (121 ms)
      ‚àö should_reset_rate_limit_after_successful_authentication (171 ms)
      ‚àö should_include_retry_after_in_rate_limit_response (114 ms)
      ‚àö should_track_rate_limits_per_ip_address (605 ms)
    Registration Rate Limiting
      ‚àö should_rate_limit_registration_attempts (21 ms)
      ‚àö should_include_rate_limit_headers_on_registration (17 ms)
    Token Refresh Rate Limiting
      ‚àö should_rate_limit_token_refresh_attempts (1 ms)
    Rate Limit Headers
      ‚àö should_include_standard_rate_limit_headers (33 ms)
      ‚àö should_update_ratelimit_remaining_with_each_request (69 ms)
      ‚àö should_provide_accurate_reset_timestamp (21 ms)
    Rate Limit Reset Mechanism
      ‚àö should_reset_rate_limit_after_time_window (2141 ms)
    Concurrent Request Handling
      ‚àö should_handle_concurrent_requests_correctly (172 ms)
    Edge Cases
      ‚àö should_handle_missing_ip_address_gracefully (26 ms)
      ‚àö should_handle_malformed_requests_with_rate_limiting (114 ms)
      ‚àö should_not_leak_user_existence_through_rate_limiting (118 ms)
    Test Environment Configuration
      ‚àö should_respect_test_environment_rate_limit_config (1 ms)

[2025-12-27 23:19:44] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:44] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:44] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:45] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:45] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:19:45] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:19:45] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:19:45] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:19:45] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/94185
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 982MB
[2025-12-27 23:19:45] info: [traitController.discoverTraits] Triggering trait discovery for horse 94185
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 94185
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Found 5 hidden traits for horse 94185
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Successfully revealed 3 traits for horse 94185: bold, resilient, athletic
[2025-12-27 23:19:45] info: [traitController.discoverTraits] Discovered 3 traits for horse 94185 (High Bond Foal)
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/94185 - 200
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/94186
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 988MB
[2025-12-27 23:19:45] info: [traitController.discoverTraits] Triggering trait discovery for horse 94186
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 94186
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Found 3 hidden traits for horse 94186
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] No discovery conditions met for horse 94186
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/94186 - 200
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/94187
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 986MB
[2025-12-27 23:19:45] info: [traitController.discoverTraits] Triggering trait discovery for horse 94187
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 94187
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Found 0 hidden traits for horse 94187
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] No hidden traits to reveal for horse 94187
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/94187 - 200
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/99999
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 986MB
[2025-12-27 23:19:45] warn: [ownership] horse 99999 not found or not owned by user test@example.com
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/99999 - 404
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/invalid
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 984MB
[2025-12-27 23:19:45] warn: [Validation] Input validation failed
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/invalid - 400
[2025-12-27 23:19:45] info: [GET] /api/trait-discovery/progress/94185
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 981MB
[2025-12-27 23:19:45] info: [traitDiscoveryRoutes] GET /progress/94185 - Getting discovery progress
[2025-12-27 23:19:45] info: [GET] /api/trait-discovery/progress/94185 - 200
[2025-12-27 23:19:45] info: [GET] /api/trait-discovery/progress/99999
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 981MB
[2025-12-27 23:19:45] warn: [ownership] horse 99999 not found or not owned by user test@example.com
[2025-12-27 23:19:45] info: [GET] /api/trait-discovery/progress/99999 - 404
  console.log
    Batch test foal IDs: [ 94185, 94186 ]

      at Object.<anonymous> (tests/traitDiscoveryIntegration.test.mjs:284:15)

[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/batch
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 979MB
[2025-12-27 23:19:45] info: [traitDiscoveryRoutes] POST /discover/batch - Processing 2 horses for user test@example.com
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 94185
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Found 2 hidden traits for horse 94185
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Successfully revealed 2 traits for horse 94185: calm, intelligent
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 94186
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Found 3 hidden traits for horse 94186
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] No discovery conditions met for horse 94186
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/batch - 200
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/batch
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 982MB
[2025-12-27 23:19:45] info: [traitDiscoveryRoutes] POST /discover/batch - Processing 3 horses for user test@example.com
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 94185
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Found 0 hidden traits for horse 94185
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] No hidden traits to reveal for horse 94185
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 99999
[2025-12-27 23:19:45] error: [traitDiscovery.revealTraits] Error revealing traits for horse 99999: Horse with ID 99999 not found
[2025-12-27 23:19:45] error: [traitDiscovery.batchRevealTraits] Error for horse 99999: Horse with ID 99999 not found
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 94187
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] Found 0 hidden traits for horse 94187
[2025-12-27 23:19:45] info: [traitDiscovery.revealTraits] No hidden traits to reveal for horse 94187
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/batch - 200
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/batch
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 985MB
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/discover/batch - 400
[2025-12-27 23:19:45] info: [GET] /api/trait-discovery/conditions
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 980MB
[2025-12-27 23:19:45] info: [traitDiscoveryRoutes] GET /conditions - Getting discovery conditions
[2025-12-27 23:19:45] info: [GET] /api/trait-discovery/conditions - 200
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/check-conditions/94185
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 980MB
[2025-12-27 23:19:45] info: [traitDiscoveryRoutes] POST /check-conditions/94185 - Checking conditions without discovery
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/check-conditions/94185 - 200
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/check-conditions/99999
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 982MB
[2025-12-27 23:19:45] warn: [ownership] horse 99999 not found or not owned by user test@example.com
[2025-12-27 23:19:45] info: [POST] /api/trait-discovery/check-conditions/99999 - 404
[2025-12-27 23:19:45] info: [GET] /api/trait-discovery/progress/94188
[2025-12-27 23:19:45] warn: [MemoryMonitoring] Memory threshold exceeded: 981MB
[2025-12-27 23:19:46] info: [traitDiscoveryRoutes] GET /progress/94188 - Getting discovery progress
[2025-12-27 23:19:46] info: [GET] /api/trait-discovery/progress/94188 - 200
  console.log
    Initial hidden count: 5

      at Object.<anonymous> (tests/traitDiscoveryIntegration.test.mjs:473:15)

  console.log
    Progress response: {
      "horseId": 94188,
      "horseName": "Fresh Workflow Foal",
      "discoveredTraits": 5,
      "totalPossibleTraits": 7,
      "progressPercentage": 71,
      "traits": [
        "intelligent",
        "calm",
        "athletic",
        "resilient",
        "bold"
      ],
      "hiddenTraitsCount": 5,
      "visibleTraitsCount": 0,
      "currentStats": {
        "bondScore": 85,
        "stressLevel": 15,
        "developmentDay": 3
      },
      "conditions": {
        "high_bond": {
          "name": "High Bond",
          "description": "Strong bond formed",
          "met": true,
          "progress": 100,
          "revealableTraits": [
            "loyal",
            "trusting",
            "calm"
          ]
        },
        "excellent_bond": {
          "name": "Excellent Bond",
          "description": "Exceptional bond achieved",
          "met": false,
          "progress": 0,
          "revealableTraits": [
            "devoted",
            "empathetic",
            "intuitive"
          ]
        },
        "low_stress": {
          "name": "Low Stress",
          "description": "Stress levels minimized",
          "met": true,
          "progress": 100,
          "revealableTraits": [
            "calm",
            "relaxed",
            "confident"
          ]
        },
        "minimal_stress": {
          "name": "Minimal Stress",
          "description": "Perfect stress management",
          "met": false,
          "progress": 0,
          "revealableTraits": [
            "zen",
            "unflappable",
            "serene"
          ]
        },
        "perfect_care": {
          "name": "Perfect Care",
          "description": "Perfect care conditions achieved",
          "met": true,
          "progress": 100,
          "revealableTraits": [
            "exceptional",
            "thriving",
            "balanced"
          ]
        },
        "mature_bond": {
          "name": "Mature Bond",
          "description": "Mature relationship developed with adult horse",
          "met": false,
          "progress": 0,
          "revealableTraits": [
            "resilient",
            "calm",
            "confident",
            "bonded"
          ]
        },
        "consistent_training": {
          "name": "Consistent Training",
          "description": "Consistent training regimen maintained",
          "met": false,
          "progress": 0,
          "revealableTraits": [
            "disciplined",
            "focused",
            "trainable"
          ]
        }
      }
    }

      at Object.<anonymous> (tests/traitDiscoveryIntegration.test.mjs:474:15)

[2025-12-27 23:19:46] info: [POST] /api/trait-discovery/check-conditions/94188
[2025-12-27 23:19:46] warn: [MemoryMonitoring] Memory threshold exceeded: 993MB
[2025-12-27 23:19:46] info: [traitDiscoveryRoutes] POST /check-conditions/94188 - Checking conditions without discovery
[2025-12-27 23:19:46] info: [POST] /api/trait-discovery/check-conditions/94188 - 200
[2025-12-27 23:19:46] info: [POST] /api/trait-discovery/discover/94188
[2025-12-27 23:19:46] warn: [MemoryMonitoring] Memory threshold exceeded: 990MB
[2025-12-27 23:19:46] info: [traitController.discoverTraits] Triggering trait discovery for horse 94188
[2025-12-27 23:19:46] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 94188
[2025-12-27 23:19:46] info: [traitDiscovery.revealTraits] Found 5 hidden traits for horse 94188
[2025-12-27 23:19:46] info: [traitDiscovery.revealTraits] Successfully revealed 3 traits for horse 94188: bold, calm, intelligent
[2025-12-27 23:19:46] info: [traitController.discoverTraits] Discovered 3 traits for horse 94188 (Fresh Workflow Foal)
[2025-12-27 23:19:46] info: [POST] /api/trait-discovery/discover/94188 - 200
[2025-12-27 23:19:46] info: [GET] /api/trait-discovery/progress/94188
[2025-12-27 23:19:46] warn: [MemoryMonitoring] Memory threshold exceeded: 992MB
[2025-12-27 23:19:46] info: [traitDiscoveryRoutes] GET /progress/94188 - Getting discovery progress
[2025-12-27 23:19:46] info: [GET] /api/trait-discovery/progress/94188 - 200
PASS tests/traitDiscoveryIntegration.test.mjs
  Trait Discovery API Integration Tests
    POST /api/trait-discovery/discover/:foalId
      ‚àö should discover traits for foal with high bonding (83 ms)
      ‚àö should handle foal with no discoverable traits (64 ms)
      ‚àö should allow trait discovery for adult horses (61 ms)
      ‚àö should return 404 for non-existent foal (59 ms)
      ‚àö should return 400 for invalid foal ID (47 ms)
    GET /api/trait-discovery/progress/:foalId
      ‚àö should return discovery progress for foal (62 ms)
      ‚àö should return 404 for non-existent foal (39 ms)
    POST /api/trait-discovery/discover/batch
      ‚àö should process multiple foals in batch (66 ms)
      ‚àö should handle mixed valid and invalid foals (48 ms)
      ‚àö should return 400 for invalid request body (27 ms)
    GET /api/trait-discovery/conditions
      ‚àö should return all discovery conditions (39 ms)
    POST /api/trait-discovery/check-conditions/:foalId
      ‚àö should check conditions without triggering discovery (45 ms)
      ‚àö should return 404 for non-existent foal (31 ms)
    Real-time trait discovery workflow
      ‚àö should demonstrate complete trait discovery workflow (160 ms)

[2025-12-27 23:19:46] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:46] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:46] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:47] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:47] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:47] info: [EmailVerification] Created verification token
[2025-12-27 23:19:47] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authtest-register@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=217bdd850b581ea3be63ff0dc1293fa75f53e54b20afea3ade803606c7f4407c

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:47] info: [authController.register] Verification email sent
[2025-12-27 23:19:47] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:47] info: [EmailVerification] Created verification token
[2025-12-27 23:19:47] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authtest-duplicate@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=e709a3931e5e13176a6fc9cb34314e990c4d975c88df920db3480e5678be95b8

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:47] info: [authController.register] Verification email sent
[2025-12-27 23:19:48] error: [authController.register] Error registering user: User with this email or username already exists
[2025-12-27 23:19:48] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:48] info: [EmailVerification] Created verification token
[2025-12-27 23:19:48] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authtest-login@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=0e049ad08e3fa8a206c24d3eb25f54f9c5653cd8c6be995e864786a9e34447b9

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:48] info: [authController.register] Verification email sent
[2025-12-27 23:19:48] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:48] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
[2025-12-27 23:19:48] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:48] info: [EmailVerification] Created verification token
[2025-12-27 23:19:48] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authtest-login@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=0748678f61816c625c59bf8ba0fd99faab889117b1a747c087726815f29b8a19

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:48] info: [authController.register] Verification email sent
[2025-12-27 23:19:49] error: [authController.login] Error logging in user: Invalid credentials
[2025-12-27 23:19:49] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:49] info: [EmailVerification] Created verification token
[2025-12-27 23:19:49] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authtest-token@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=2d20f58ea58418f295994fb447e51bcb19f3bc19a9a9c63dd44ad7c636a6b182

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:49] info: [authController.register] Verification email sent
[2025-12-27 23:19:49] info: [TokenRotation] Token rotation successful
[2025-12-27 23:19:49] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:19:49] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:49] info: [EmailVerification] Created verification token
[2025-12-27 23:19:49] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authtest-token@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=60ce971e99f90be47613761268061a4817b8e6d13aec4f3eb2a7163164ac42f1

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:49] info: [authController.register] Verification email sent
[2025-12-27 23:19:49] warn: [TokenRotation] Token reuse detected during rotation
[2025-12-27 23:19:49] warn: [authController.refreshToken] Token family invalidated due to reuse detection
[2025-12-27 23:19:49] error: [authController.refreshToken] Error refreshing token: Token reuse detected - please login again
[2025-12-27 23:19:50] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:50] info: [EmailVerification] Created verification token
[2025-12-27 23:19:50] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authtest-protected@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=6721cf9477013c995359cd372e85d54442a37e41646fa2631fe0d08a47df9dbe

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:50] info: [authController.register] Verification email sent
[2025-12-27 23:19:50] info: [auth] Authenticated user 85132dd5-e391-4965-ba1b-dba4e82687db for GET /api/auth/me
[2025-12-27 23:19:50] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:50] info: [EmailVerification] Created verification token
[2025-12-27 23:19:50] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authtest-protected@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=6edfe60f283f5207ee007a78645e212bfd49602fd1e35c975d1b95b8b4101baf

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:50] info: [authController.register] Verification email sent
[2025-12-27 23:19:50] warn: [auth] Access token is required for GET /api/auth/me from ::ffff:127.0.0.1
[2025-12-27 23:19:50] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:50] info: [EmailVerification] Created verification token
[2025-12-27 23:19:50] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authtest-protected@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=c1514b62dc14e91b3b7c9aa31f9f87b0cb813eed0b7d0983d654e9dff92d479b

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:50] info: [authController.register] Verification email sent
[2025-12-27 23:19:50] info: [auth] Authenticated user e3945bb4-3735-45f6-90f3-1bc663f34430 for POST /api/auth/logout
PASS tests/auth-working.test.mjs
  üîê INTEGRATION: Authentication System - Complete Auth Workflow Validation
    User Registration
      ‚àö should register a new user successfully (503 ms)
      ‚àö should reject duplicate email registration (397 ms)
    User Login
      ‚àö should login successfully with valid credentials (649 ms)
      ‚àö should reject login with invalid credentials (622 ms)
    Token Management
      ‚àö should refresh token successfully (353 ms)
      ‚àö should reject invalid refresh token (333 ms)
    Protected Routes
      ‚àö should get user profile with valid token (340 ms)
      ‚àö should reject profile request without token (335 ms)
      ‚àö should logout successfully (340 ms)

[2025-12-27 23:19:51] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:51] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:51] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:51] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:51] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:19:51] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:19:51] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:19:51] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:19:51] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:19:52] info: [POST] /api/auth/register
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 833MB
[2025-12-27 23:19:52] info: [TokenRotation] Created new token pair
[2025-12-27 23:19:52] info: [EmailVerification] Created verification token
[2025-12-27 23:19:52] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: integration1766895592028@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=8388b879c4e8e6e5bc469ca99c412d0f34fa2dc6128245e8a219e2e1d6637e40

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:19:52] info: [authController.register] Verification email sent
[2025-12-27 23:19:52] info: [POST] /api/auth/register - 201
[2025-12-27 23:19:52] info: [GET] /api/user-docs
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 840MB
[2025-12-27 23:19:52] info: [UserDocRoutes] Getting all documentation list
[2025-12-27 23:19:52] info: [UserDocService] Loaded 1 documentation files
[2025-12-27 23:19:52] info: [UserDocService] Built search index with 34 terms
[2025-12-27 23:19:52] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:19:52] info: [GET] /api/user-docs - 200
[2025-12-27 23:19:52] info: [GET] /api-docs/swagger.json
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 842MB
[2025-12-27 23:19:52] info: [GET] /api-docs/swagger.json - 200
[2025-12-27 23:19:52] info: [GET] /api/memory/status
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 838MB
[2025-12-27 23:19:52] info: [auth] Authenticated user ffb987e5-fd62-4b2d-87b9-37c63a7d6434 for GET /memory/status
[2025-12-27 23:19:52] info: [auth] Authenticated user ffb987e5-fd62-4b2d-87b9-37c63a7d6434 for GET /status
[2025-12-27 23:19:52] info: [MemoryManagement] Getting memory status
[2025-12-27 23:19:52] info: [GET] /api/memory/status - 200
[2025-12-27 23:19:52] info: [GET] /api/users/ffb987e5-fd62-4b2d-87b9-37c63a7d6434/progress
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 835MB
[2025-12-27 23:19:52] info: [auth] Authenticated user ffb987e5-fd62-4b2d-87b9-37c63a7d6434 for GET /users/ffb987e5-fd62-4b2d-87b9-37c63a7d6434/progress
[2025-12-27 23:19:52] info: [auth] Authenticated user ffb987e5-fd62-4b2d-87b9-37c63a7d6434 for GET /ffb987e5-fd62-4b2d-87b9-37c63a7d6434/progress
[2025-12-27 23:19:52] info: [userRoutes] Self-access validated: user ffb987e5-fd62-4b2d-87b9-37c63a7d6434 accessing own data
[2025-12-27 23:19:52] info: [userController.getUserProgressAPI] Getting comprehensive progress for user ffb987e5-fd62-4b2d-87b9-37c63a7d6434
[2025-12-27 23:19:52] info: [userController.getUserProgressAPI] Successfully retrieved progress for user inttest592028 (Level 1, XP: 0/200, 0% progress)
[2025-12-27 23:19:52] info: [GET] /api/users/ffb987e5-fd62-4b2d-87b9-37c63a7d6434/progress - 200
[2025-12-27 23:19:52] info: [GET] /api/user-docs/search?q=horse
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 835MB
[2025-12-27 23:19:52] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:52] info: [GET] /api/user-docs/search?q=horse - 200
[2025-12-27 23:19:52] info: [GET] /health
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 831MB
[2025-12-27 23:19:52] info: [GET] /health - 200
[2025-12-27 23:19:52] info: [GET] /api/user-docs/health
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 841MB
[2025-12-27 23:19:52] info: [GET] /api/user-docs/health - 200
[2025-12-27 23:19:52] info: [GET] /api/user-docs/analytics
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 835MB
[2025-12-27 23:19:52] info: [UserDocRoutes] Getting documentation analytics
[2025-12-27 23:19:52] info: [GET] /api/user-docs/analytics - 200
[2025-12-27 23:19:52] info: [POST] /api/grooms/interact
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 832MB
[2025-12-27 23:19:52] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for POST /grooms/interact
[2025-12-27 23:19:52] info: [groomController.recordInteraction] Recording early_touch interaction for foal 94189
[2025-12-27 23:19:52] warn: [groomPersonalityEffects.calculatePersonalityEffects] Unknown personality: calm
[2025-12-27 23:19:52] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for calm: none
[2025-12-27 23:19:52] info: [groomController.recordInteraction] Interaction recorded: 4 bonding, -2 stress
[2025-12-27 23:19:52] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46673 for interaction_completed
[2025-12-27 23:19:52] info: [groomProgressionService.awardGroomXP] Groom 46673 gained 2 XP: 0 ‚Üí 2 (Level 1 ‚Üí 1)
[2025-12-27 23:19:52] info: [groomController.recordInteraction] Awarded 2 XP to groom 46673 for interaction
[2025-12-27 23:19:52] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:19:52] info: [GET] /api/grooms/user/aacab161-0047-4d02-8b1e-ea1892e68bf3
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 836MB
[2025-12-27 23:19:52] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /grooms/user/aacab161-0047-4d02-8b1e-ea1892e68bf3
[2025-12-27 23:19:52] info: [groomController.getUserGrooms] Getting grooms for user aacab161-0047-4d02-8b1e-ea1892e68bf3
[2025-12-27 23:19:52] info: [GET] /api/grooms/user/aacab161-0047-4d02-8b1e-ea1892e68bf3 - 200
[2025-12-27 23:19:52] info: [GET] /api-docs/swagger.json
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 835MB
[2025-12-27 23:19:52] info: [GET] /api-docs/swagger.json - 200
[2025-12-27 23:19:52] info: [GET] /api/user-docs
[2025-12-27 23:19:52] warn: [MemoryMonitoring] Memory threshold exceeded: 833MB
[2025-12-27 23:19:52] info: [UserDocRoutes] Getting all documentation list
[2025-12-27 23:19:52] info: [GET] /api/user-docs - 200
[2025-12-27 23:19:52] info: [GET] /api/user-docs/search?q=horse
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 832MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/analytics
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 840MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Getting documentation analytics
[2025-12-27 23:19:53] info: [GET] /api/user-docs/analytics - 200
[2025-12-27 23:19:53] info: [GET] /api/horses
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 834MB
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /horses
[2025-12-27 23:19:53] info: [GET] /api/horses
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 839MB
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /horses
[2025-12-27 23:19:53] info: [GET] /api/horses
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 845MB
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /horses
[2025-12-27 23:19:53] info: [GET] /api/horses
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 835MB
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /horses
[2025-12-27 23:19:53] info: [GET] /api/horses
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 841MB
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /horses
[2025-12-27 23:19:53] info: [GET] /api/horses
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 846MB
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /horses
[2025-12-27 23:19:53] info: [GET] /api/horses
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 837MB
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /horses
[2025-12-27 23:19:53] info: [GET] /api/horses
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 842MB
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /horses
[2025-12-27 23:19:53] info: [GET] /api/horses
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 832MB
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /horses
[2025-12-27 23:19:53] info: [GET] /api/horses
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 838MB
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /horses
[2025-12-27 23:19:53] info: [GET] /api/horses - 200
[2025-12-27 23:19:53] info: [GET] /api/horses - 200
[2025-12-27 23:19:53] info: [GET] /api/horses - 200
[2025-12-27 23:19:53] info: [GET] /api/horses - 200
[2025-12-27 23:19:53] info: [GET] /api/horses - 200
[2025-12-27 23:19:53] info: [GET] /api/horses - 200
[2025-12-27 23:19:53] info: [GET] /api/horses - 200
[2025-12-27 23:19:53] info: [GET] /api/horses - 200
[2025-12-27 23:19:53] info: [GET] /api/horses - 200
[2025-12-27 23:19:53] info: [GET] /api/horses - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 839MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 845MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 836MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 842MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 847MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 838MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 844MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 834MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 840MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 846MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 836MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 842MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 848MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 838MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 844MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 835MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 840MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 846MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 837MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 843MB
[2025-12-27 23:19:53] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:19:53] info: [GET] /api/user-docs/search?q=horse&includeContent=true - 200
[2025-12-27 23:19:53] info: [POST] /api/horses
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 845MB
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for POST /horses
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for POST /
[2025-12-27 23:19:53] info: [horseModel.createHorse] Successfully created horse: Consistency Test Horse (ID: 94190)
[2025-12-27 23:19:53] info: [horseRoutes] Created new horse: Consistency Test Horse (ID: 94190)
[2025-12-27 23:19:53] info: [POST] /api/horses - 201
[2025-12-27 23:19:53] info: [GET] /api/users/aacab161-0047-4d02-8b1e-ea1892e68bf3/progress
[2025-12-27 23:19:53] warn: [MemoryMonitoring] Memory threshold exceeded: 844MB
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /users/aacab161-0047-4d02-8b1e-ea1892e68bf3/progress
[2025-12-27 23:19:53] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /aacab161-0047-4d02-8b1e-ea1892e68bf3/progress
[2025-12-27 23:19:53] info: [userRoutes] Self-access validated: user aacab161-0047-4d02-8b1e-ea1892e68bf3 accessing own data
[2025-12-27 23:19:53] info: [userController.getUserProgressAPI] Getting comprehensive progress for user aacab161-0047-4d02-8b1e-ea1892e68bf3
[2025-12-27 23:19:53] info: [userController.getUserProgressAPI] Successfully retrieved progress for user globaltest592008 (Level 1, XP: 0/200, 0% progress)
[2025-12-27 23:19:53] info: [GET] /api/users/aacab161-0047-4d02-8b1e-ea1892e68bf3/progress - 200
[2025-12-27 23:19:54] info: [POST] /api/training/train
[2025-12-27 23:19:54] warn: [MemoryMonitoring] Memory threshold exceeded: 843MB
[2025-12-27 23:19:54] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for POST /training/train
[2025-12-27 23:19:54] info: [ownership] Found owned horse 94191 for user aacab161-0047-4d02-8b1e-ea1892e68bf3
[2025-12-27 23:19:54] info: [trainingController.trainRouteHandler] Training request for horse 94191 in Dressage
[2025-12-27 23:19:54] info: [trainingController.trainHorse] Attempting to train horse 94191 in Dressage
[2025-12-27 23:19:54] info: [trainingController.canTrain] Checking training eligibility for horse 94191 in Dressage
[2025-12-27 23:19:54] info: [trainingModel.getHorseAge] Getting age for horse 94191
[2025-12-27 23:19:54] info: [trainingModel.getHorseAge] Horse 94191 is 5 years old
[2025-12-27 23:19:54] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94191 across all disciplines
[2025-12-27 23:19:54] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94191
[2025-12-27 23:19:54] info: [trainingController.canTrain] Horse 94191 is eligible to train in Dressage
[2025-12-27 23:19:54] info: [horseModel.getHorseById] Successfully found horse: Progress Test Horse (ID: 94191)
[2025-12-27 23:19:54] info: [trainingController.trainHorse] Horse 94191 has traits: 
[2025-12-27 23:19:54] info: [trainingModel.logTrainingSession] Logging training session for horse 94191 in Dressage
[2025-12-27 23:19:54] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4812
[2025-12-27 23:19:54] info: [horseModel.updateHorseStat] Updating focus by 2 for horse 94191
[2025-12-27 23:19:54] info: [horseModel.updateHorseStat] Updated focus for horse 94191: 0 -> 2 (+2)
[2025-12-27 23:19:54] info: [trainingController.trainHorse] Stat gain: focus +2
[2025-12-27 23:19:54] info: [horseModel.incrementDisciplineScore] Incrementing Dressage score for horse 94191 by +5
[2025-12-27 23:19:54] info: [horseModel.updateDisciplineScore] Updating Dressage score for horse 94191 by +5
[2025-12-27 23:19:54] info: [horseModel.updateDisciplineScore] Successfully updated Dressage score for horse 94191: 0 -> 5
[2025-12-27 23:19:54] info: [horseModel.incrementDisciplineScore] Successfully incremented Dressage score for horse 94191
[2025-12-27 23:19:54] info: [xpLogModel.logXpEvent] Logging XP event: User aacab161-0047-4d02-8b1e-ea1892e68bf3, Amount: 5, Reason: Trained horse Progress Test Horse in Dressage
[2025-12-27 23:19:54] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2339, User aacab161-0047-4d02-8b1e-ea1892e68bf3, Amount: 5
[2025-12-27 23:19:54] info: [trainingController.trainHorse] Awarded 5 XP to user aacab161-0047-4d02-8b1e-ea1892e68bf3 for training
[2025-12-27 23:19:54] info: [trainingController.trainHorse] Successfully trained horse 94191 in Dressage (Log ID: 4812, Score +5)
[2025-12-27 23:19:54] info: [POST] /api/training/train - 200
[2025-12-27 23:19:55] info: [GET] /api/users/aacab161-0047-4d02-8b1e-ea1892e68bf3/progress
[2025-12-27 23:19:55] warn: [MemoryMonitoring] Memory threshold exceeded: 840MB
[2025-12-27 23:19:55] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /users/aacab161-0047-4d02-8b1e-ea1892e68bf3/progress
[2025-12-27 23:19:55] info: [auth] Authenticated user aacab161-0047-4d02-8b1e-ea1892e68bf3 for GET /aacab161-0047-4d02-8b1e-ea1892e68bf3/progress
[2025-12-27 23:19:55] info: [userRoutes] Self-access validated: user aacab161-0047-4d02-8b1e-ea1892e68bf3 accessing own data
[2025-12-27 23:19:55] info: [userController.getUserProgressAPI] Getting comprehensive progress for user aacab161-0047-4d02-8b1e-ea1892e68bf3
[2025-12-27 23:19:55] info: [userController.getUserProgressAPI] Successfully retrieved progress for user globaltest592008 (Level 1, XP: 5/200, 3% progress)
[2025-12-27 23:19:55] info: [GET] /api/users/aacab161-0047-4d02-8b1e-ea1892e68bf3/progress - 200
PASS __tests__/integration/systemWideIntegration.test.mjs
  System-Wide Integration Tests
    Complete User Journey: Registration to Competition
      ‚àö End-to-end user workflow: registration ‚Üí horse purchase ‚Üí training ‚Üí competition (578 ms)
    System Integration Validation
      ‚àö Documentation system integration (93 ms)
      ‚àö Groom career progression and talent system integration (237 ms)
      ‚àö Documentation system integration with API endpoints (109 ms)
    Performance and Load Testing
      ‚àö API response times under load (300 ms)
      ‚àö Memory usage monitoring during operations (397 ms)
    Data Consistency Validation
      ‚àö Database transaction integrity across systems (82 ms)
      ‚àö User progress tracking accuracy (1309 ms)

[2025-12-27 23:19:55] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:55] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:55] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:56] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:56] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:19:56] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:19:56] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:19:56] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:19:56] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:19:56] info: [GET] /api/horses/1'%20OR%20'1'='1
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 883MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 74de1b43-3a94-443d-8dfb-cde19c4d9cc8 for GET /horses/1'%20OR%20'1'='1
[2025-12-27 23:19:56] info: [GET] /api/horses/1'%20OR%20'1'='1 - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/1;%20DROP%20TABLE%20horses;%20--
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 884MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 4bf772c5-68d1-4d93-bc9c-e1d45961ecc8 for GET /horses/1;%20DROP%20TABLE%20horses;%20--
[2025-12-27 23:19:56] info: [GET] /api/horses/1;%20DROP%20TABLE%20horses;%20-- - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/1%20UNION%20SELECT%20*%20FROM%20users
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 882MB
[2025-12-27 23:19:56] info: [auth] Authenticated user e640f14e-f449-497a-ba87-5f34bbc14e98 for GET /horses/1%20UNION%20SELECT%20*%20FROM%20users
[2025-12-27 23:19:56] info: [GET] /api/horses/1%20UNION%20SELECT%20*%20FROM%20users - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/1%20AND%20(SELECT%20COUNT(*)%20FROM%20users)%20%3E%200
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 880MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 536f7543-0019-4df0-9493-15ea3fe5a501 for GET /horses/1%20AND%20(SELECT%20COUNT(*)%20FROM%20users)%20%3E%200
[2025-12-27 23:19:56] info: [GET] /api/horses/1%20AND%20(SELECT%20COUNT(*)%20FROM%20users)%20%3E%200 - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/0x31
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 891MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 807094bb-ee1e-485d-a4d5-7a37d42b1ded for GET /horses/0x31
[2025-12-27 23:19:56] info: [GET] /api/horses/0x31 - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/94197'%20AND%201=1%20AND%20'1'='1
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 887MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 5a0857d8-b531-4ccd-aa57-d3bd16a02cad for GET /horses/94197'%20AND%201=1%20AND%20'1'='1
[2025-12-27 23:19:56] info: [GET] /api/horses/94197'%20AND%201=1%20AND%20'1'='1 - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/1;%20WAITFOR%20DELAY%20'00:00:05';%20--
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 884MB
[2025-12-27 23:19:56] info: [auth] Authenticated user aaf5f18d-1c52-4f5b-980c-2d7fc4edad0f for GET /horses/1;%20WAITFOR%20DELAY%20'00:00:05';%20--
[2025-12-27 23:19:56] info: [GET] /api/horses/1;%20WAITFOR%20DELAY%20'00:00:05';%20-- - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/1;%20SELECT%20pg_sleep(5);%20--
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 882MB
[2025-12-27 23:19:56] info: [auth] Authenticated user e3364271-288d-4e82-a69e-90e4e2008fbf for GET /horses/1;%20SELECT%20pg_sleep(5);%20--
[2025-12-27 23:19:56] info: [GET] /api/horses/1;%20SELECT%20pg_sleep(5);%20-- - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/1'%20AND%20(SELECT%201/0)
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 881MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 5b9ac92a-f3a9-4b92-a0b8-c48cd32fc1a6 for GET /horses/1'%20AND%20(SELECT%201/0)
[2025-12-27 23:19:56] warn: 404 - Route not found: GET /api/horses/1'%20AND%20(SELECT%201/0) from ::ffff:127.0.0.1
[2025-12-27 23:19:56] info: [GET] /api/horses/1'%20AND%20(SELECT%201/0) - 404
[2025-12-27 23:19:56] info: [GET] /api/horses/1%20UNION%20SELECT%20id,email,password,NULL,NULL,NULL%20FROM%20users
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 881MB
[2025-12-27 23:19:56] info: [auth] Authenticated user c94c76aa-9370-4a37-87c8-a0723313c40d for GET /horses/1%20UNION%20SELECT%20id,email,password,NULL,NULL,NULL%20FROM%20users
[2025-12-27 23:19:56] info: [GET] /api/horses/1%20UNION%20SELECT%20id,email,password,NULL,NULL,NULL%20FROM%20users - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/1%20UNION%20ALL%20SELECT%20*%20FROM%20users%20WHERE%201=1
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 892MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 01ebdafa-42a0-4138-865b-b2fb614ef644 for GET /horses/1%20UNION%20ALL%20SELECT%20*%20FROM%20users%20WHERE%201=1
[2025-12-27 23:19:56] info: [GET] /api/horses/1%20UNION%20ALL%20SELECT%20*%20FROM%20users%20WHERE%201=1 - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/1%20ORDER%20BY%20100
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 888MB
[2025-12-27 23:19:56] info: [auth] Authenticated user b1e449b2-0011-4a9d-825e-11e4c081b570 for GET /horses/1%20ORDER%20BY%20100
[2025-12-27 23:19:56] info: [GET] /api/horses/1%20ORDER%20BY%20100 - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/1%20UNION%20SELECT%20NULL,NULL,NULL,NULL,NULL
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 886MB
[2025-12-27 23:19:56] info: [auth] Authenticated user cc1edec3-088c-451c-890b-140b32299164 for GET /horses/1%20UNION%20SELECT%20NULL,NULL,NULL,NULL,NULL
[2025-12-27 23:19:56] info: [GET] /api/horses/1%20UNION%20SELECT%20NULL,NULL,NULL,NULL,NULL - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/1;%20DELETE%20FROM%20horses%20WHERE%20id%20%3E%200
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 884MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 7686823f-aa43-43ee-860d-b2abf40fef18 for GET /horses/1;%20DELETE%20FROM%20horses%20WHERE%20id%20%3E%200
[2025-12-27 23:19:56] info: [GET] /api/horses/1;%20DELETE%20FROM%20horses%20WHERE%20id%20%3E%200 - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/1;%20UPDATE%20users%20SET%20role='ADMIN'%20WHERE%20id=c1276735-a4d0-4c6c-a43f-61f3cd596b7c
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 882MB
[2025-12-27 23:19:56] info: [auth] Authenticated user c1276735-a4d0-4c6c-a43f-61f3cd596b7c for GET /horses/1;%20UPDATE%20users%20SET%20role='ADMIN'%20WHERE%20id=c1276735-a4d0-4c6c-a43f-61f3cd596b7c
[2025-12-27 23:19:56] info: [GET] /api/horses/1;%20UPDATE%20users%20SET%20role='ADMIN'%20WHERE%20id=c1276735-a4d0-4c6c-a43f-61f3cd596b7c - 400
[2025-12-27 23:19:56] info: [GET] /api/horses/1;%20INSERT%20INTO%20horses%20(name,%20userId)%20VALUES%20('Hacked',%201)
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 894MB
[2025-12-27 23:19:56] info: [auth] Authenticated user d4c589c7-1dfa-4f18-a316-68140e6db3fb for GET /horses/1;%20INSERT%20INTO%20horses%20(name,%20userId)%20VALUES%20('Hacked',%201)
[2025-12-27 23:19:56] info: [GET] /api/horses/1;%20INSERT%20INTO%20horses%20(name,%20userId)%20VALUES%20('Hacked',%201) - 400
[2025-12-27 23:19:56] info: [GET] /api/horses?breed=Thoroughbred%27%20OR%20%271%27=%271
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 890MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 51c034ef-8c6a-4890-ae66-d51dc5acdde5 for GET /horses
[2025-12-27 23:19:56] info: [GET] /api/horses?breed=Thoroughbred%27%20OR%20%271%27=%271 - 400
[2025-12-27 23:19:56] info: [GET] /api/horses?name=Test%27;%20DROP%20TABLE%20horses;%20--
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 887MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 14847638-b812-4798-9577-ca6e44eaaa60 for GET /horses
[2025-12-27 23:19:56] info: [GET] /api/horses?name=Test%27;%20DROP%20TABLE%20horses;%20-- - 200
[2025-12-27 23:19:56] info: [GET] /api/horses?sort=name;%20UPDATE%20horses%20SET%20name=%27Hacked%27
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 887MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 039748e6-7bb1-4b54-bb11-25071af36532 for GET /horses
[2025-12-27 23:19:56] info: [GET] /api/horses?sort=name;%20UPDATE%20horses%20SET%20name=%27Hacked%27 - 200
[2025-12-27 23:19:56] info: [GET] /api/horses?name=%%27%20OR%20%271%27=%271
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 887MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 3155e4a4-5d90-4ba1-b677-a7823f075c14 for GET /horses
[2025-12-27 23:19:56] info: [GET] /api/horses?name=%%27%20OR%20%271%27=%271 - 200
[2025-12-27 23:19:56] info: [GET] /api/horses?ids=1,2,3)%20OR%201=1%20--
[2025-12-27 23:19:56] warn: [MemoryMonitoring] Memory threshold exceeded: 887MB
[2025-12-27 23:19:56] info: [auth] Authenticated user 6469cd93-c0dd-402b-b112-e1868f2830dd for GET /horses
[2025-12-27 23:19:57] info: [GET] /api/horses?ids=1,2,3)%20OR%201=1%20-- - 200
[2025-12-27 23:19:57] info: [GET] /api/horses?traits.strength=50%27;%20DROP%20TABLE%20horses;%20--
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 888MB
[2025-12-27 23:19:57] info: [auth] Authenticated user f9ea5c21-76a0-4bae-8257-a4cabde09cd7 for GET /horses
[2025-12-27 23:19:57] info: [GET] /api/horses?traits.strength=50%27;%20DROP%20TABLE%20horses;%20-- - 200
[2025-12-27 23:19:57] info: [GET] /api/horses?traits-%3E%3E%27color%27=%27Bay%27%20OR%20%271%27=%271
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 888MB
[2025-12-27 23:19:57] info: [auth] Authenticated user 8763bbdd-bb48-4b4c-849b-68bb0128066a for GET /horses
[2025-12-27 23:19:57] info: [GET] /api/horses?traits-%3E%3E%27color%27=%27Bay%27%20OR%20%271%27=%271 - 400
[2025-12-27 23:19:57] info: [GET] /api/horses?achievements[0]=Win%27;%20DELETE%20FROM%20horses;%20--
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 887MB
[2025-12-27 23:19:57] info: [auth] Authenticated user b8ac89d7-5e6e-47d2-ac7d-3c814a8aee03 for GET /horses
[2025-12-27 23:19:57] info: [GET] /api/horses?achievements[0]=Win%27;%20DELETE%20FROM%20horses;%20-- - 200
[2025-12-27 23:19:57] info: [POST] /api/horses
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 889MB
[2025-12-27 23:19:57] info: [auth] Authenticated user a052b69e-2e0e-4861-85fe-d98fa91bba82 for POST /horses
[2025-12-27 23:19:57] info: [POST] /api/horses - 403
[2025-12-27 23:19:57] info: [PUT] /api/auth/profile
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 889MB
[2025-12-27 23:19:57] info: [auth] Authenticated user d02dbbc8-b10a-40e6-8e1b-8ef5f99278dd for PUT /profile
[2025-12-27 23:19:57] warn: [Validation] Input validation failed
[2025-12-27 23:19:57] info: [PUT] /api/auth/profile - 400
[2025-12-27 23:19:57] info: [POST] /api/horses/query
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 888MB
[2025-12-27 23:19:57] info: [auth] Authenticated user 0f2a499a-fb28-4d85-8d10-8bb62756052c for POST /horses/query
[2025-12-27 23:19:57] info: [POST] /api/horses/query - 403
[2025-12-27 23:19:57] info: [GET] /api/horses?raw={%22sql%22:%22SELECT%20*%20FROM%20users%22}
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 888MB
[2025-12-27 23:19:57] info: [auth] Authenticated user ec16ab41-84f6-4567-b93f-a21963872ac7 for GET /horses
[2025-12-27 23:19:57] info: [GET] /api/horses?raw={%22sql%22:%22SELECT%20*%20FROM%20users%22} - 200
[2025-12-27 23:19:57] info: [POST] /api/horses/search
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 890MB
[2025-12-27 23:19:57] info: [auth] Authenticated user 67e4e7d1-9428-4699-a164-cea0cb7cb220 for POST /horses/search
[2025-12-27 23:19:57] info: [POST] /api/horses/search - 403
[2025-12-27 23:19:57] info: [GET] /api/horses/1;%20SELECT%20version()
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 889MB
[2025-12-27 23:19:57] info: [auth] Authenticated user a4799a1e-734d-4519-8623-5740f40e9c9b for GET /horses/1;%20SELECT%20version()
[2025-12-27 23:19:57] info: [GET] /api/horses/1;%20SELECT%20version() - 400
[2025-12-27 23:19:57] info: [GET] /api/horses/1;%20COPY%20users%20TO%20'/tmp/users.csv'
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 887MB
[2025-12-27 23:19:57] info: [auth] Authenticated user 9e03205e-b9c1-4623-964d-1f5784b45620 for GET /horses/1;%20COPY%20users%20TO%20'/tmp/users.csv'
[2025-12-27 23:19:57] warn: 404 - Route not found: GET /api/horses/1;%20COPY%20users%20TO%20'/tmp/users.csv' from ::ffff:127.0.0.1
[2025-12-27 23:19:57] info: [GET] /api/horses/1;%20COPY%20users%20TO%20'/tmp/users.csv' - 404
[2025-12-27 23:19:57] info: [GET] /api/horses/1;%20SELECT%20pg_read_file('/etc/passwd')
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 887MB
[2025-12-27 23:19:57] info: [auth] Authenticated user a0f29451-e947-48b7-a2f3-cacc888bd3d7 for GET /horses/1;%20SELECT%20pg_read_file('/etc/passwd')
[2025-12-27 23:19:57] warn: 404 - Route not found: GET /api/horses/1;%20SELECT%20pg_read_file('/etc/passwd') from ::ffff:127.0.0.1
[2025-12-27 23:19:57] info: [GET] /api/horses/1;%20SELECT%20pg_read_file('/etc/passwd') - 404
[2025-12-27 23:19:57] info: [GET] /api/horses/1;%20SELECT%20lo_create(1234)
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 888MB
[2025-12-27 23:19:57] info: [auth] Authenticated user 86c799b8-7d7f-4cbe-a227-678510ce7918 for GET /horses/1;%20SELECT%20lo_create(1234)
[2025-12-27 23:19:57] info: [GET] /api/horses/1;%20SELECT%20lo_create(1234) - 400
[2025-12-27 23:19:57] info: [GET] /api/horses/1;%20CALL%20malicious_procedure()
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 899MB
[2025-12-27 23:19:57] info: [auth] Authenticated user a779d0b0-3fc2-4c8d-81e9-15e862f7519d for GET /horses/1;%20CALL%20malicious_procedure()
[2025-12-27 23:19:57] info: [GET] /api/horses/1;%20CALL%20malicious_procedure() - 400
[2025-12-27 23:19:57] info: [POST] /api/horses/batch-update
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 895MB
[2025-12-27 23:19:57] info: [auth] Authenticated user dbafffc9-05f6-47f1-8e0b-103060082dfb for POST /horses/batch-update
[2025-12-27 23:19:57] info: [POST] /api/horses/batch-update - 403
[2025-12-27 23:19:57] info: [POST] /api/grooms/batch-delete
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 893MB
[2025-12-27 23:19:57] info: [auth] Authenticated user 91a4f11d-b8b7-41d1-9f70-299a81b0b2da for POST /grooms/batch-delete
[2025-12-27 23:19:57] info: [POST] /api/grooms/batch-delete - 403
[2025-12-27 23:19:57] info: [GET] /api/horses/invalid-sql-injection
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 891MB
[2025-12-27 23:19:57] info: [auth] Authenticated user ff9355d2-d7cb-482b-bdbe-5318417ac887 for GET /horses/invalid-sql-injection
[2025-12-27 23:19:57] info: [GET] /api/horses/invalid-sql-injection - 400
[2025-12-27 23:19:57] info: [GET] /api/horses/1'%20OR%20'1'='1
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 893MB
[2025-12-27 23:19:57] info: [auth] Authenticated user c4cb5c91-bd5a-4e11-9a1a-81f644f55bf9 for GET /horses/1'%20OR%20'1'='1
[2025-12-27 23:19:57] info: [GET] /api/horses/1'%20OR%20'1'='1 - 400
[2025-12-27 23:19:57] info: [GET] /api/horses/1;%20DROP%20TABLE%20horses
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 900MB
[2025-12-27 23:19:57] info: [auth] Authenticated user c4cb5c91-bd5a-4e11-9a1a-81f644f55bf9 for GET /horses/1;%20DROP%20TABLE%20horses
[2025-12-27 23:19:57] info: [GET] /api/horses/1;%20DROP%20TABLE%20horses - 400
[2025-12-27 23:19:57] info: [GET] /api/horses/1%20UNION%20SELECT%20*%20FROM%20users
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 892MB
[2025-12-27 23:19:57] info: [auth] Authenticated user c4cb5c91-bd5a-4e11-9a1a-81f644f55bf9 for GET /horses/1%20UNION%20SELECT%20*%20FROM%20users
[2025-12-27 23:19:57] info: [GET] /api/horses/1%20UNION%20SELECT%20*%20FROM%20users - 400
[2025-12-27 23:19:57] info: [GET] /api/horses/1%20AND%20(SELECT%201%20FROM%20users)
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 899MB
[2025-12-27 23:19:57] info: [auth] Authenticated user c4cb5c91-bd5a-4e11-9a1a-81f644f55bf9 for GET /horses/1%20AND%20(SELECT%201%20FROM%20users)
[2025-12-27 23:19:57] info: [GET] /api/horses/1%20AND%20(SELECT%201%20FROM%20users) - 400
[2025-12-27 23:19:57] info: [GET] /api/horses/94230
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 899MB
[2025-12-27 23:19:57] info: [auth] Authenticated user 9d9ae64f-fab7-4421-984e-bcf39b83d203 for GET /horses/94230
[2025-12-27 23:19:57] info: [ownership] Validated ownership: user 9d9ae64f-fab7-4421-984e-bcf39b83d203 owns horse 94230
[2025-12-27 23:19:57] info: [GET] /api/horses/94230 - 200
[2025-12-27 23:19:57] info: [POST] /api/horses
[2025-12-27 23:19:57] warn: [MemoryMonitoring] Memory threshold exceeded: 898MB
[2025-12-27 23:19:57] info: [auth] Authenticated user 8867a7db-a02b-4217-87b7-27fce778f506 for POST /horses
[2025-12-27 23:19:57] info: [POST] /api/horses - 403
PASS __tests__/integration/security/sql-injection-attempts.test.mjs
  SQL Injection Attempts Integration Tests
    Classic SQL Injection in ID Parameters
      ‚àö should reject SQL injection in horse ID (111 ms)
      ‚àö should reject SQL injection with comment syntax (34 ms)
      ‚àö should reject SQL injection with union select (32 ms)
      ‚àö should reject SQL injection with nested queries (31 ms)
      ‚àö should reject SQL injection with hex encoding (32 ms)
    Blind SQL Injection Attempts
      ‚àö should reject boolean-based blind injection (32 ms)
      ‚àö should reject time-based blind injection (31 ms)
      ‚àö should reject PostgreSQL-specific time injection (34 ms)
      ‚àö should reject error-based blind injection (41 ms)
    Union-Based SQL Injection
      ‚àö should reject UNION SELECT attacks (34 ms)
      ‚àö should reject UNION ALL attacks (31 ms)
      ‚àö should reject UNION with ORDER BY column enumeration (32 ms)
      ‚àö should reject UNION with NULL padding (29 ms)
    Stacked Queries
      ‚àö should reject semicolon-separated queries (32 ms)
      ‚àö should reject multiple statements in ownership check (36 ms)
      ‚àö should reject batch operations via stacking (36 ms)
    SQL Injection in Search/Filter Parameters
      ‚àö should reject SQL injection in breed filter (37 ms)
      ‚àö should reject SQL injection in name search (51 ms)
      ‚àö should reject SQL injection in sort parameter (44 ms)
      ‚àö should reject SQL injection in LIKE wildcards (44 ms)
      ‚àö should reject SQL injection in IN clause (48 ms)
    SQL Injection in JSON/JSONB Queries
      ‚àö should reject SQL injection in JSONB path (43 ms)
      ‚àö should reject SQL injection in JSON operators (28 ms)
      ‚àö should reject SQL injection in JSON array queries (45 ms)
    Second-Order SQL Injection
      ‚àö should sanitize stored data used in subsequent queries (43 ms)
      ‚àö should prevent injection via profile data used in ownership checks (32 ms)
    ORM Bypass Attempts (Prisma)
      ‚àö should reject raw query injection via Prisma (30 ms)
      ‚àö should reject Prisma findRaw injection attempts (45 ms)
      ‚àö should reject $queryRaw parameter injection (27 ms)
    PostgreSQL-Specific Injection Attacks
      ‚àö should reject PostgreSQL function calls (31 ms)
      ‚àö should reject PostgreSQL COPY command (33 ms)
      ‚àö should reject pg_read_file attempts (35 ms)
      ‚àö should reject large object manipulation (35 ms)
      ‚àö should reject PostgreSQL stored procedure execution (35 ms)
    SQL Injection in Batch Operations
      ‚àö should reject SQL injection in batch horse updates (53 ms)
      ‚àö should reject SQL injection in batch groom deletion (49 ms)
    SQL Injection Error Handling
      ‚àö should not leak database structure in error messages (41 ms)
      ‚àö should return consistent error format for all injection attempts (92 ms)
    Parameterized Query Validation
      ‚àö should use parameterized queries for ownership checks (41 ms)
      ‚àö should properly escape special characters in valid data (30 ms)

[2025-12-27 23:19:58] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:58] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:58] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:19:58] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:19:58] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:19:58] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:19:58] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:19:58] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:19:58] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:19:58] info: [groomPerformanceService] Updated metrics for groom 46714
[2025-12-27 23:19:58] info: [groomPerformanceService] Recorded performance for groom 46714: grooming
[2025-12-27 23:19:58] info: [groomPerformanceService] Updated metrics for groom 46714
[2025-12-27 23:19:58] info: [groomPerformanceService] Recorded performance for groom 46714: training
[2025-12-27 23:19:58] info: [groomPerformanceService] Updated metrics for groom 46714
[2025-12-27 23:19:58] info: [groomPerformanceService] Recorded performance for groom 46714: training
[2025-12-27 23:19:58] info: [groomPerformanceService] Updated metrics for groom 46714
[2025-12-27 23:19:58] info: [groomPerformanceService] Recorded performance for groom 46714: training
[2025-12-27 23:19:58] info: [POST] /api/groom-performance/record
[2025-12-27 23:19:58] warn: [MemoryMonitoring] Memory threshold exceeded: 938MB
[2025-12-27 23:19:58] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for POST /groom-performance/record
[2025-12-27 23:19:58] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for POST /record
[2025-12-27 23:19:58] info: [groomPerformanceController] Recording performance for groom 46714
[2025-12-27 23:19:58] info: [ownership] Found owned groom 46714 for user 02821a9c-2975-4c28-9aab-a617b3c493c0
[2025-12-27 23:19:58] info: [ownership] Found owned horse 94232 for user 02821a9c-2975-4c28-9aab-a617b3c493c0
[2025-12-27 23:19:58] info: [groomPerformanceService] Updated metrics for groom 46714
[2025-12-27 23:19:58] info: [groomPerformanceService] Recorded performance for groom 46714: enrichment
[2025-12-27 23:19:58] info: [POST] /api/groom-performance/record - 201
[2025-12-27 23:19:58] info: [GET] /api/groom-performance/groom/46714
[2025-12-27 23:19:58] warn: [MemoryMonitoring] Memory threshold exceeded: 939MB
[2025-12-27 23:19:58] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for GET /groom-performance/groom/46714
[2025-12-27 23:19:58] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for GET /groom/46714
[2025-12-27 23:19:58] info: [ownership] Validated ownership: user 02821a9c-2975-4c28-9aab-a617b3c493c0 owns groom 46714
[2025-12-27 23:19:58] info: [groomPerformanceController] Getting performance for groom 46714
[2025-12-27 23:19:58] info: [GET] /api/groom-performance/groom/46714 - 200
[2025-12-27 23:19:58] info: [GET] /api/groom-performance/top?limit=5
[2025-12-27 23:19:58] warn: [MemoryMonitoring] Memory threshold exceeded: 940MB
[2025-12-27 23:19:58] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for GET /groom-performance/top
[2025-12-27 23:19:58] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for GET /top
[2025-12-27 23:19:58] info: [groomPerformanceController] Getting top performers for user 02821a9c-2975-4c28-9aab-a617b3c493c0
[2025-12-27 23:19:58] info: [GET] /api/groom-performance/top?limit=5 - 200
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/config
[2025-12-27 23:19:59] warn: [MemoryMonitoring] Memory threshold exceeded: 938MB
[2025-12-27 23:19:59] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for GET /groom-performance/config
[2025-12-27 23:19:59] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for GET /config
[2025-12-27 23:19:59] info: [groomPerformanceController] Getting performance config for user 02821a9c-2975-4c28-9aab-a617b3c493c0
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/config - 200
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/analytics/46714?days=30
[2025-12-27 23:19:59] warn: [MemoryMonitoring] Memory threshold exceeded: 938MB
[2025-12-27 23:19:59] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for GET /groom-performance/analytics/46714
[2025-12-27 23:19:59] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for GET /analytics/46714
[2025-12-27 23:19:59] info: [ownership] Validated ownership: user 02821a9c-2975-4c28-9aab-a617b3c493c0 owns groom 46714
[2025-12-27 23:19:59] info: [groomPerformanceController] Getting analytics for groom 46714, last 30 days
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/analytics/46714?days=30 - 200
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/groom/46715
[2025-12-27 23:19:59] warn: [MemoryMonitoring] Memory threshold exceeded: 941MB
[2025-12-27 23:19:59] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for GET /groom-performance/groom/46715
[2025-12-27 23:19:59] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for GET /groom/46715
[2025-12-27 23:19:59] warn: [ownership] groom 46715 not found or not owned by user 02821a9c-2975-4c28-9aab-a617b3c493c0
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/groom/46715 - 404
[2025-12-27 23:19:59] info: [POST] /api/groom-performance/record
[2025-12-27 23:19:59] warn: [MemoryMonitoring] Memory threshold exceeded: 938MB
[2025-12-27 23:19:59] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for POST /groom-performance/record
[2025-12-27 23:19:59] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for POST /record
[2025-12-27 23:19:59] warn: [Validation] Input validation failed
[2025-12-27 23:19:59] info: [POST] /api/groom-performance/record - 400
[2025-12-27 23:19:59] info: [POST] /api/groom-performance/record
[2025-12-27 23:19:59] warn: [MemoryMonitoring] Memory threshold exceeded: 935MB
[2025-12-27 23:19:59] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for POST /groom-performance/record
[2025-12-27 23:19:59] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for POST /record
[2025-12-27 23:19:59] warn: [Validation] Input validation failed
[2025-12-27 23:19:59] info: [POST] /api/groom-performance/record - 400
[2025-12-27 23:19:59] info: [POST] /api/groom-performance/record
[2025-12-27 23:19:59] warn: [MemoryMonitoring] Memory threshold exceeded: 933MB
[2025-12-27 23:19:59] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for POST /groom-performance/record
[2025-12-27 23:19:59] info: [auth] Authenticated user 02821a9c-2975-4c28-9aab-a617b3c493c0 for POST /record
[2025-12-27 23:19:59] warn: [Validation] Input validation failed
[2025-12-27 23:19:59] info: [POST] /api/groom-performance/record - 400
[2025-12-27 23:19:59] info: [POST] /api/groom-performance/record
[2025-12-27 23:19:59] warn: [MemoryMonitoring] Memory threshold exceeded: 935MB
[2025-12-27 23:19:59] warn: [auth] Access token is required for POST /groom-performance/record from ::ffff:127.0.0.1
[2025-12-27 23:19:59] info: [POST] /api/groom-performance/record - 401
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/groom/46714
[2025-12-27 23:19:59] warn: [MemoryMonitoring] Memory threshold exceeded: 933MB
[2025-12-27 23:19:59] warn: [auth] Access token is required for GET /groom-performance/groom/46714 from ::ffff:127.0.0.1
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/groom/46714 - 401
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/top
[2025-12-27 23:19:59] warn: [MemoryMonitoring] Memory threshold exceeded: 945MB
[2025-12-27 23:19:59] warn: [auth] Access token is required for GET /groom-performance/top from ::ffff:127.0.0.1
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/top - 401
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/config
[2025-12-27 23:19:59] warn: [MemoryMonitoring] Memory threshold exceeded: 941MB
[2025-12-27 23:19:59] warn: [auth] Access token is required for GET /groom-performance/config from ::ffff:127.0.0.1
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/config - 401
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/analytics/46714
[2025-12-27 23:19:59] warn: [MemoryMonitoring] Memory threshold exceeded: 937MB
[2025-12-27 23:19:59] warn: [auth] Access token is required for GET /groom-performance/analytics/46714 from ::ffff:127.0.0.1
[2025-12-27 23:19:59] info: [GET] /api/groom-performance/analytics/46714 - 401
PASS tests/integration/groomPerformanceSystem.test.mjs
  Groom Performance System
    Performance Recording
      ‚àö should record groom performance successfully (14 ms)
      ‚àö should update groom metrics after recording performance (31 ms)
    API Endpoints
      ‚àö should record performance via API (69 ms)
      ‚àö should get groom performance summary (46 ms)
      ‚àö should get top performing grooms (31 ms)
      ‚àö should get performance configuration (31 ms)
      ‚àö should get groom analytics (40 ms)
      ‚àö should validate groom ownership (46 ms)
      ‚àö should validate input parameters (95 ms)
    Service Functions
      ‚àö should calculate performance summary correctly (10 ms)
      ‚àö should get top performing grooms correctly (6 ms)
    Authentication
      ‚àö should require authentication for POST /api/groom-performance/record (29 ms)
      ‚àö should require authentication for GET /api/groom-performance/groom/:groomId (37 ms)
      ‚àö should require authentication for GET /api/groom-performance/top (34 ms)
      ‚àö should require authentication for GET /api/groom-performance/config (28 ms)
      ‚àö should require authentication for GET /api/groom-performance/analytics/:groomId (23 ms)

[2025-12-27 23:19:59] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:19:59] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:19:59] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:00] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:00] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:00] info: [EmailVerification] Created verification token
[2025-12-27 23:20:00] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=7962927f11c50e034ce8c8e3f98298cf1dfc95b538e10bb14c7bd00b90d9a97d

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:20:00] info: [authController.register] Verification email sent
[2025-12-27 23:20:00] info: [auth] Authenticated user b070562a-5afc-48ec-8a96-252a588c4bbf for GET /api/auth/profile
[2025-12-27 23:20:00] info: [auth] Authenticated user b070562a-5afc-48ec-8a96-252a588c4bbf for GET /api/horses
[2025-12-27 23:20:00] info: [auth] Authenticated user b070562a-5afc-48ec-8a96-252a588c4bbf for GET /api/competition/my-entries
[2025-12-27 23:20:00] info: [auth] Authenticated user b070562a-5afc-48ec-8a96-252a588c4bbf for GET /api/training/status
[2025-12-27 23:20:00] info: [auth] Authenticated user b070562a-5afc-48ec-8a96-252a588c4bbf for GET /api/grooms/my-grooms
[2025-12-27 23:20:00] info: [auth] Authenticated user b070562a-5afc-48ec-8a96-252a588c4bbf for GET /api/traits/my-discoveries
[2025-12-27 23:20:00] info: [auth] Authenticated user b070562a-5afc-48ec-8a96-252a588c4bbf for GET /api/dashboard/overview
[2025-12-27 23:20:00] info: [auth] Authenticated user b070562a-5afc-48ec-8a96-252a588c4bbf for GET /api/health/protected
[2025-12-27 23:20:01] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:01] info: [EmailVerification] Created verification token
[2025-12-27 23:20:01] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=2434c8a224f9d4772822684589dac0a4c1f40c3038fdb1273460690457add1ab

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:20:01] info: [authController.register] Verification email sent
[2025-12-27 23:20:01] warn: [auth] Access token is required for GET /api/auth/profile from ::ffff:127.0.0.1
[2025-12-27 23:20:01] warn: [auth] Access token is required for GET /api/horses from ::ffff:127.0.0.1
[2025-12-27 23:20:01] warn: [auth] Access token is required for GET /api/competition/my-entries from ::ffff:127.0.0.1
[2025-12-27 23:20:01] warn: [auth] Access token is required for GET /api/training/status from ::ffff:127.0.0.1
[2025-12-27 23:20:01] warn: [auth] Access token is required for GET /api/grooms/my-grooms from ::ffff:127.0.0.1
[2025-12-27 23:20:01] warn: [auth] Access token is required for GET /api/traits/my-discoveries from ::ffff:127.0.0.1
[2025-12-27 23:20:01] warn: [auth] Access token is required for GET /api/dashboard/overview from ::ffff:127.0.0.1
[2025-12-27 23:20:01] warn: [auth] Access token is required for GET /api/health/protected from ::ffff:127.0.0.1
[2025-12-27 23:20:01] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:01] info: [EmailVerification] Created verification token
[2025-12-27 23:20:01] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=9c63d3907d4f00729353c3d07a5dbe97b79a9f1a9bf031a1dba309814580c47f

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:20:01] info: [authController.register] Verification email sent
[2025-12-27 23:20:01] warn: [auth] Invalid or expired token for GET /api/auth/profile from ::ffff:127.0.0.1
[2025-12-27 23:20:01] warn: [auth] Invalid or expired token for GET /api/horses from ::ffff:127.0.0.1
[2025-12-27 23:20:01] warn: [auth] Invalid or expired token for GET /api/competition/my-entries from ::ffff:127.0.0.1
[2025-12-27 23:20:01] warn: [auth] Invalid or expired token for GET /api/training/status from ::ffff:127.0.0.1
[2025-12-27 23:20:02] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:02] info: [EmailVerification] Created verification token
[2025-12-27 23:20:02] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=908cc9cad6ab425b5fec65ca5097d6f4b344c99a90053afe9c60b345f07289b9

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:20:02] info: [authController.register] Verification email sent
[2025-12-27 23:20:03] info: [TokenRotation] Token rotation successful
[2025-12-27 23:20:03] info: [authController.refreshToken] Token rotation successful
[2025-12-27 23:20:03] info: [auth] Authenticated user ccd0b638-506e-480c-9884-a84c5f96a53f for GET /api/auth/profile
[2025-12-27 23:20:03] info: [auth] Authenticated user ccd0b638-506e-480c-9884-a84c5f96a53f for GET /api/horses
[2025-12-27 23:20:03] info: [auth] Authenticated user ccd0b638-506e-480c-9884-a84c5f96a53f for GET /api/dashboard/overview
[2025-12-27 23:20:03] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:03] info: [EmailVerification] Created verification token
[2025-12-27 23:20:03] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=10249a4cb2a179b687a9c920308563430049741d3418061a276f4ea787d8af96

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:20:03] info: [authController.register] Verification email sent
[2025-12-27 23:20:03] warn: [auth] Access token is required for GET /api/auth/profile from ::ffff:127.0.0.1
[2025-12-27 23:20:03] warn: [auth] Access token is required for GET /api/horses from ::ffff:127.0.0.1
[2025-12-27 23:20:03] warn: [auth] Access token is required for GET /api/competition/my-entries from ::ffff:127.0.0.1
[2025-12-27 23:20:03] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:03] info: [EmailVerification] Created verification token
[2025-12-27 23:20:03] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: authintegration@test.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=233b0ba8b4aea68bd4229e58fa57913f34e34526d896259ec9d7e0b8c9e90c3d

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:20:03] info: [authController.register] Verification email sent
[2025-12-27 23:20:03] warn: [auth] Access token is required for GET /api/auth/profile from ::ffff:127.0.0.1
[2025-12-27 23:20:03] warn: [auth] Access token is required for GET /api/auth/profile from ::ffff:127.0.0.1
[2025-12-27 23:20:03] warn: [auth] Access token is required for GET /api/auth/profile from ::ffff:127.0.0.1
[2025-12-27 23:20:03] warn: [auth] Access token is required for GET /api/auth/profile from ::ffff:127.0.0.1
PASS tests/integration/auth-system-integration.test.mjs
  üîê Authentication System Integration Tests
    üåê Cross-System Authentication Validation
      ‚àö should authenticate successfully across all protected endpoints (558 ms)
      ‚àö should reject access to all protected endpoints without token (487 ms)
      ‚àö should reject access with invalid token across all systems (419 ms)
    üîÑ Token Refresh Integration
      ‚àö should refresh token and maintain access across systems (1457 ms)
    üõ°Ô∏è Security Validation
      ‚àö should maintain consistent error responses across systems (402 ms)
      ‚àö should handle malformed authorization headers consistently (415 ms)

[2025-12-27 23:20:04] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:04] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:04] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:04] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:05] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:05] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:05] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:05] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:05] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:05] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:05] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:05] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:05] info: [POST] /api/auth/login
[2025-12-27 23:20:05] warn: [MemoryMonitoring] Memory threshold exceeded: 1007MB
[2025-12-27 23:20:05] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:05] info: [POST] /api/auth/login - 200
[2025-12-27 23:20:05] info: [POST] /api/auth/login
[2025-12-27 23:20:05] warn: [MemoryMonitoring] Memory threshold exceeded: 1018MB
[2025-12-27 23:20:05] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:05] info: [POST] /api/auth/login - 200
[2025-12-27 23:20:05] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:05] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:05] info: [POST] /api/auth/login
[2025-12-27 23:20:05] warn: [MemoryMonitoring] Memory threshold exceeded: 1016MB
[2025-12-27 23:20:05] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:05] info: [POST] /api/auth/login - 200
[2025-12-27 23:20:05] info: [POST] /api/auth/logout
[2025-12-27 23:20:05] warn: [MemoryMonitoring] Memory threshold exceeded: 1012MB
[2025-12-27 23:20:05] info: [auth] Authenticated user 70c54894-2f88-46ec-a2e8-77c37bc14cd3 for POST /logout
[2025-12-27 23:20:05] info: [POST] /api/auth/logout - 200
[2025-12-27 23:20:05] info: [POST] /api/auth/login
[2025-12-27 23:20:05] warn: [MemoryMonitoring] Memory threshold exceeded: 1010MB
[2025-12-27 23:20:05] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:05] info: [POST] /api/auth/login - 200
[2025-12-27 23:20:05] info: [POST] /api/auth/logout
[2025-12-27 23:20:05] warn: [MemoryMonitoring] Memory threshold exceeded: 1019MB
[2025-12-27 23:20:05] info: [auth] Authenticated user 70c54894-2f88-46ec-a2e8-77c37bc14cd3 for POST /logout
[2025-12-27 23:20:05] info: [POST] /api/auth/logout - 200
[2025-12-27 23:20:05] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:05] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:05] info: [POST] /api/auth/login
[2025-12-27 23:20:05] warn: [MemoryMonitoring] Memory threshold exceeded: 1017MB
[2025-12-27 23:20:05] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:05] info: [POST] /api/auth/login - 200
[2025-12-27 23:20:05] info: [POST] /api/auth/change-password
[2025-12-27 23:20:05] warn: [MemoryMonitoring] Memory threshold exceeded: 1013MB
[2025-12-27 23:20:05] info: [auth] Authenticated user 70c54894-2f88-46ec-a2e8-77c37bc14cd3 for POST /change-password
[2025-12-27 23:20:05] info: [authController.changePassword] Password changed successfully
[2025-12-27 23:20:05] info: [POST] /api/auth/change-password - 200
[2025-12-27 23:20:06] info: [POST] /api/auth/login
[2025-12-27 23:20:06] warn: [MemoryMonitoring] Memory threshold exceeded: 1014MB
[2025-12-27 23:20:06] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:06] info: [POST] /api/auth/login - 200
[2025-12-27 23:20:06] info: [POST] /api/auth/change-password
[2025-12-27 23:20:06] warn: [MemoryMonitoring] Memory threshold exceeded: 1009MB
[2025-12-27 23:20:06] info: [auth] Authenticated user 70c54894-2f88-46ec-a2e8-77c37bc14cd3 for POST /change-password
[2025-12-27 23:20:06] error: [authController.changePassword] Error changing password: Current password is incorrect
[2025-12-27 23:20:06] error: [POST] /api/auth/change-password - ERROR
[2025-12-27 23:20:06] error: Error Current password is incorrect
[2025-12-27 23:20:06] info: [POST] /api/auth/change-password - 401
[2025-12-27 23:20:06] info: [POST] /api/auth/login
[2025-12-27 23:20:06] warn: [MemoryMonitoring] Memory threshold exceeded: 1011MB
[2025-12-27 23:20:06] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:06] info: [POST] /api/auth/login - 200
[2025-12-27 23:20:06] info: [POST] /api/auth/change-password
[2025-12-27 23:20:06] warn: [MemoryMonitoring] Memory threshold exceeded: 1020MB
[2025-12-27 23:20:06] info: [auth] Authenticated user 70c54894-2f88-46ec-a2e8-77c37bc14cd3 for POST /change-password
[2025-12-27 23:20:06] warn: [Validation] Input validation failed
[2025-12-27 23:20:06] info: [POST] /api/auth/change-password - 400
[2025-12-27 23:20:06] info: [POST] /api/auth/login
[2025-12-27 23:20:06] warn: [MemoryMonitoring] Memory threshold exceeded: 1016MB
[2025-12-27 23:20:06] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:06] info: [POST] /api/auth/login - 200
[2025-12-27 23:20:06] info: [GET] /api/auth/profile
[2025-12-27 23:20:06] warn: [MemoryMonitoring] Memory threshold exceeded: 1012MB
[2025-12-27 23:20:06] warn: [auth] Session expired due to age for GET /profile from ::ffff:127.0.0.1 (8 days old)
[2025-12-27 23:20:06] warn: [auth] Session expired. Please login again. for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:06] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:06] info: [POST] /api/auth/login
[2025-12-27 23:20:06] warn: [MemoryMonitoring] Memory threshold exceeded: 1012MB
[2025-12-27 23:20:06] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:06] info: [POST] /api/auth/login - 200
[2025-12-27 23:20:06] info: [GET] /api/auth/profile
[2025-12-27 23:20:06] warn: [MemoryMonitoring] Memory threshold exceeded: 1021MB
[2025-12-27 23:20:06] info: [auth] Authenticated user 70c54894-2f88-46ec-a2e8-77c37bc14cd3 for GET /profile
[2025-12-27 23:20:06] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:06] info: [POST] /api/auth/login
[2025-12-27 23:20:06] warn: [MemoryMonitoring] Memory threshold exceeded: 1017MB
[2025-12-27 23:20:06] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:06] info: [POST] /api/auth/login - 200
[2025-12-27 23:20:06] info: [GET] /api/auth/profile
[2025-12-27 23:20:06] warn: [MemoryMonitoring] Memory threshold exceeded: 1013MB
[2025-12-27 23:20:06] info: [auth] Authenticated user 70c54894-2f88-46ec-a2e8-77c37bc14cd3 for GET /profile
[2025-12-27 23:20:06] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:06] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:06] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:20:06] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:20:06] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:20:06] info: [cronJobService] Token cleanup completed. Removed 1 expired/invalidated tokens
[2025-12-27 23:20:06] info: [cronJobService] Manual token cleanup completed: {"removed":1,"expired":1,"invalidated":0,"timestamp":"2025-12-28T04:20:06.722Z"}
[2025-12-27 23:20:06] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:20:06] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:20:06] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:20:06] info: [cronJobService] Token cleanup completed. Removed 1 expired/invalidated tokens
[2025-12-27 23:20:06] info: [cronJobService] Manual token cleanup completed: {"removed":1,"expired":1,"invalidated":0,"timestamp":"2025-12-28T04:20:06.738Z"}
[2025-12-27 23:20:06] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:06] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:06] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:20:06] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:20:06] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:20:06] info: [cronJobService] Token cleanup completed. Removed 0 expired/invalidated tokens
[2025-12-27 23:20:06] info: [cronJobService] Manual token cleanup completed: {"removed":0,"expired":0,"invalidated":0,"timestamp":"2025-12-28T04:20:06.765Z"}
[2025-12-27 23:20:06] info: [POST] /api/auth/register
[2025-12-27 23:20:06] warn: [MemoryMonitoring] Memory threshold exceeded: 1013MB
[2025-12-27 23:20:06] warn: [Validation] Input validation failed
[2025-12-27 23:20:06] info: [POST] /api/auth/register - 400
PASS __tests__/integration/session-lifecycle.test.mjs
  Session Lifecycle Management
    CWE-384: Token Regeneration on Login
      ‚àö should delete all existing refresh tokens on login (89 ms)
      ‚àö should create fresh token pair on login (36 ms)
    CWE-613: Token Cleanup on Logout
      ‚àö should delete all refresh tokens on logout (75 ms)
      ‚àö should clear auth cookies on logout (60 ms)
    Force Logout on Password Change
      ‚àö should invalidate all sessions when password is changed (769 ms)
      ‚àö should reject password change with incorrect old password (170 ms)
      ‚àö should validate new password requirements (90 ms)
    CWE-613: Absolute Session Expiry
      ‚àö should reject tokens older than 7 days (82 ms)
      ‚àö should accept tokens less than 7 days old (63 ms)
      ‚àö should calculate token age correctly at the boundary (exactly 7 days) (59 ms)
    Token Cleanup Cron Job
      ‚àö should remove expired refresh tokens (27 ms)
      ‚àö should remove old invalidated tokens (30+ days) (12 ms)
      ‚àö should not remove valid active tokens (29 ms)
    Integration: Complete Session Lifecycle
      ‚àö should handle complete user journey: register -> login -> use session -> change password -> re-login (21 ms)

[2025-12-27 23:20:07] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:07] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:07] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:07] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:07] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:07] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:07] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:07] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:07] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:07] info: [POST] /api/grooms/interact
[2025-12-27 23:20:07] warn: [MemoryMonitoring] Memory threshold exceeded: 1056MB
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Recording trust_building interaction for foal 94233
[2025-12-27 23:20:08] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying patient personality effects for task trust_building
[2025-12-27 23:20:08] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied patient effects: category_match
[2025-12-27 23:20:08] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for patient: category_match
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Interaction recorded: 5 bonding, -1 stress
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Personality effects applied (patient): category_match - Reduces burnout risk and failure chance on enrichment tasks
[2025-12-27 23:20:08] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46716 for interaction_completed
[2025-12-27 23:20:08] info: [groomProgressionService.awardGroomXP] Groom 46716 gained 2 XP: 3 ‚Üí 5 (Level 1 ‚Üí 1)
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Awarded 2 XP to groom 46716 for interaction
[2025-12-27 23:20:08] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:08] info: [POST] /api/grooms/interact
[2025-12-27 23:20:08] warn: [MemoryMonitoring] Memory threshold exceeded: 1057MB
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Recording trust_building interaction for foal 94234
[2025-12-27 23:20:08] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying patient personality effects for task trust_building
[2025-12-27 23:20:08] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied patient effects: category_match
[2025-12-27 23:20:08] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for patient: category_match
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Interaction recorded: 10 bonding, -6 stress
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Personality effects applied (patient): category_match - Reduces burnout risk and failure chance on enrichment tasks
[2025-12-27 23:20:08] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46717 for interaction_completed
[2025-12-27 23:20:08] info: [groomProgressionService.awardGroomXP] Groom 46717 gained 2 XP: 3 ‚Üí 5 (Level 1 ‚Üí 1)
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Awarded 2 XP to groom 46717 for interaction
[2025-12-27 23:20:08] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:08] info: [POST] /api/grooms/interact
[2025-12-27 23:20:08] warn: [MemoryMonitoring] Memory threshold exceeded: 1064MB
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Recording hoof_handling interaction for foal 94235
[2025-12-27 23:20:08] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying patient personality effects for task hoof_handling
[2025-12-27 23:20:08] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied patient effects: task_specialty
[2025-12-27 23:20:08] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for patient: task_specialty
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Interaction recorded: 5 bonding, -2 stress
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Personality effects applied (patient): task_specialty - Reduces burnout risk and failure chance on enrichment tasks
[2025-12-27 23:20:08] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46718 for interaction_completed
[2025-12-27 23:20:08] info: [groomProgressionService.awardGroomXP] Groom 46718 gained 2 XP: 3 ‚Üí 5 (Level 1 ‚Üí 1)
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Awarded 2 XP to groom 46718 for interaction
[2025-12-27 23:20:08] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:08] info: [POST] /api/grooms/interact
[2025-12-27 23:20:08] warn: [MemoryMonitoring] Memory threshold exceeded: 1059MB
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Recording trust_building interaction for foal 94237
[2025-12-27 23:20:08] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying patient personality effects for task trust_building
[2025-12-27 23:20:08] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied patient effects: category_match
[2025-12-27 23:20:08] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for patient: category_match
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Interaction recorded: 5 bonding, -4 stress
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Personality effects applied (patient): category_match - Reduces burnout risk and failure chance on enrichment tasks
[2025-12-27 23:20:08] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46719 for interaction_completed
[2025-12-27 23:20:08] info: [groomProgressionService.awardGroomXP] Groom 46719 gained 2 XP: 3 ‚Üí 5 (Level 1 ‚Üí 1)
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Awarded 2 XP to groom 46719 for interaction
[2025-12-27 23:20:08] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:08] info: [POST] /api/grooms/interact
[2025-12-27 23:20:08] warn: [MemoryMonitoring] Memory threshold exceeded: 1065MB
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Recording desensitization interaction for foal 94238
[2025-12-27 23:20:08] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying patient personality effects for task desensitization
[2025-12-27 23:20:08] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied patient effects: category_match
[2025-12-27 23:20:08] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for patient: category_match
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Interaction recorded: 7 bonding, -2 stress
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Personality effects applied (patient): category_match - Reduces burnout risk and failure chance on enrichment tasks
[2025-12-27 23:20:08] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46719 for interaction_completed
[2025-12-27 23:20:08] info: [groomProgressionService.awardGroomXP] Groom 46719 gained 2 XP: 5 ‚Üí 7 (Level 1 ‚Üí 1)
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Awarded 2 XP to groom 46719 for interaction
[2025-12-27 23:20:08] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:08] info: [POST] /api/grooms/interact
[2025-12-27 23:20:08] warn: [MemoryMonitoring] Memory threshold exceeded: 1057MB
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Recording hoof_handling interaction for foal 94239
[2025-12-27 23:20:08] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying patient personality effects for task hoof_handling
[2025-12-27 23:20:08] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied patient effects: task_specialty
[2025-12-27 23:20:08] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for patient: task_specialty
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Interaction recorded: 10 bonding, -2 stress
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Personality effects applied (patient): task_specialty - Reduces burnout risk and failure chance on enrichment tasks
[2025-12-27 23:20:08] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46719 for interaction_completed
[2025-12-27 23:20:08] info: [groomProgressionService.awardGroomXP] Groom 46719 gained 2 XP: 7 ‚Üí 9 (Level 1 ‚Üí 1)
[2025-12-27 23:20:08] info: [groomController.recordInteraction] Awarded 2 XP to groom 46719 for interaction
[2025-12-27 23:20:08] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:09] info: [POST] /api/grooms/interact
[2025-12-27 23:20:09] warn: [MemoryMonitoring] Memory threshold exceeded: 1063MB
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Recording early_touch interaction for foal 94240
[2025-12-27 23:20:09] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying patient personality effects for task early_touch
[2025-12-27 23:20:09] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied patient effects: 
[2025-12-27 23:20:09] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for patient: none
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Interaction recorded: 10 bonding, -2 stress
[2025-12-27 23:20:09] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46719 for interaction_completed
[2025-12-27 23:20:09] info: [groomProgressionService.awardGroomXP] Groom 46719 gained 2 XP: 9 ‚Üí 11 (Level 1 ‚Üí 1)
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Awarded 2 XP to groom 46719 for interaction
[2025-12-27 23:20:09] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:09] info: [POST] /api/grooms/interact
[2025-12-27 23:20:09] warn: [MemoryMonitoring] Memory threshold exceeded: 1059MB
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Recording trust_building interaction for foal 94241
[2025-12-27 23:20:09] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying patient personality effects for task trust_building
[2025-12-27 23:20:09] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied patient effects: category_match
[2025-12-27 23:20:09] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for patient: category_match
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Interaction recorded: 5 bonding, -4 stress
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Personality effects applied (patient): category_match - Reduces burnout risk and failure chance on enrichment tasks
[2025-12-27 23:20:09] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46720 for interaction_completed
[2025-12-27 23:20:09] info: [groomProgressionService.awardGroomXP] Groom 46720 gained 2 XP: 3 ‚Üí 5 (Level 1 ‚Üí 1)
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Awarded 2 XP to groom 46720 for interaction
[2025-12-27 23:20:09] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:09] info: [POST] /api/grooms/interact
[2025-12-27 23:20:09] warn: [MemoryMonitoring] Memory threshold exceeded: 1068MB
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Recording trust_building interaction for foal 94242
[2025-12-27 23:20:09] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying patient personality effects for task trust_building
[2025-12-27 23:20:09] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied patient effects: category_match
[2025-12-27 23:20:09] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for patient: category_match
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Interaction recorded: 8 bonding, -4 stress
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Personality effects applied (patient): category_match - Reduces burnout risk and failure chance on enrichment tasks
[2025-12-27 23:20:09] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46721 for interaction_completed
[2025-12-27 23:20:09] info: [groomProgressionService.awardGroomXP] Groom 46721 gained 2 XP: 3 ‚Üí 5 (Level 1 ‚Üí 1)
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Awarded 2 XP to groom 46721 for interaction
[2025-12-27 23:20:09] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:09] info: [POST] /api/grooms/interact
[2025-12-27 23:20:09] warn: [MemoryMonitoring] Memory threshold exceeded: 1058MB
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Recording desensitization interaction for foal 94242
[2025-12-27 23:20:09] info: [POST] /api/grooms/interact - 400
[2025-12-27 23:20:09] info: [POST] /api/grooms/interact
[2025-12-27 23:20:09] warn: [MemoryMonitoring] Memory threshold exceeded: 1060MB
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Recording early_touch interaction for foal 94243
[2025-12-27 23:20:09] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying patient personality effects for task early_touch
[2025-12-27 23:20:09] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied patient effects: 
[2025-12-27 23:20:09] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for patient: none
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Interaction recorded: 10 bonding, -4 stress
[2025-12-27 23:20:09] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46722 for interaction_completed
[2025-12-27 23:20:09] info: [groomProgressionService.awardGroomXP] Groom 46722 gained 2 XP: 3 ‚Üí 5 (Level 1 ‚Üí 1)
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Awarded 2 XP to groom 46722 for interaction
[2025-12-27 23:20:09] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:09] info: [POST] /api/grooms/interact
[2025-12-27 23:20:09] warn: [MemoryMonitoring] Memory threshold exceeded: 1068MB
[2025-12-27 23:20:09] info: [groomController.recordInteraction] Recording hoof_handling interaction for foal 94244
[2025-12-27 23:20:09] info: [POST] /api/grooms/interact - 400
PASS tests/foalTaskLoggingIntegration.test.mjs
  Foal Task Logging Integration
    Task Log JSON Updates
      ‚àö should initialize task log with first enrichment task (392 ms)
      ‚àö should increment existing task count in task log (159 ms)
      ‚àö should add new task to existing task log (156 ms)
      ‚àö should handle multiple task types across different foals (596 ms)
    Streak Tracking Integration
      ‚àö should update lastGroomed timestamp on each interaction (163 ms)
      ‚àö should enforce daily interaction limits correctly (312 ms)
    Age-Based Task Eligibility Enforcement
      ‚àö should reject enrichment tasks for horses too old (154 ms)
      ‚àö should reject grooming tasks for horses too young (138 ms)

[2025-12-27 23:20:10] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:10] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:10] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:10] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:11] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:11] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:11] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:11] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:11] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:11] info: [POST] /api/auth/register
[2025-12-27 23:20:11] warn: [MemoryMonitoring] Memory threshold exceeded: 1098MB
[2025-12-27 23:20:11] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:11] info: [EmailVerification] Created verification token
[2025-12-27 23:20:11] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: competition-integration@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=a5888cb0769e7192d21f8e49fcdc495d84b8d138262d96efa482a08045129e6e

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:20:11] info: [authController.register] Verification email sent
[2025-12-27 23:20:11] info: [POST] /api/auth/register - 201
[2025-12-27 23:20:11] info: [GET] /api/competition/eligibility/94245/Racing
[2025-12-27 23:20:11] warn: [MemoryMonitoring] Memory threshold exceeded: 1103MB
[2025-12-27 23:20:11] info: [auth] Authenticated user fff6c703-fa94-4c60-95f6-e09e88023270 for GET /competition/eligibility/94245/Racing
[2025-12-27 23:20:11] info: [auth] Authenticated user fff6c703-fa94-4c60-95f6-e09e88023270 for GET /eligibility/94245/Racing
[2025-12-27 23:20:11] info: [ownership] Validated ownership: user fff6c703-fa94-4c60-95f6-e09e88023270 owns horse 94245
[2025-12-27 23:20:11] info: [competitionRoutes.GET /eligibility] Checking eligibility for horse 94245 in Racing
[2025-12-27 23:20:11] info: [competitionRoutes.GET /eligibility] Horse 94245 eligibility checked for Racing
[2025-12-27 23:20:11] info: [GET] /api/competition/eligibility/94245/Racing - 200
[2025-12-27 23:20:11] info: [POST] /api/competition/enter
[2025-12-27 23:20:11] warn: [MemoryMonitoring] Memory threshold exceeded: 1103MB
[2025-12-27 23:20:11] info: [auth] Authenticated user fff6c703-fa94-4c60-95f6-e09e88023270 for POST /competition/enter
[2025-12-27 23:20:11] info: [auth] Authenticated user fff6c703-fa94-4c60-95f6-e09e88023270 for POST /enter
[2025-12-27 23:20:11] info: [competitionRoutes.POST /enter] User fff6c703-fa94-4c60-95f6-e09e88023270 entering horse 94245 in show 5466
[2025-12-27 23:20:11] info: [ownership] Found owned horse 94245 for user fff6c703-fa94-4c60-95f6-e09e88023270
[2025-12-27 23:20:11] info: [competitionRoutes.POST /enter] Successfully entered horse 94245 in show 5466
[2025-12-27 23:20:11] info: [POST] /api/competition/enter - 201
[2025-12-27 23:20:11] info: [GET] /api/leaderboards/competition?metric=wins&limit=10
[2025-12-27 23:20:11] warn: [MemoryMonitoring] Memory threshold exceeded: 1110MB
[2025-12-27 23:20:11] info: [auth] Authenticated user fff6c703-fa94-4c60-95f6-e09e88023270 for GET /leaderboards/competition
[2025-12-27 23:20:11] info: [auth] Authenticated user fff6c703-fa94-4c60-95f6-e09e88023270 for GET /competition
[2025-12-27 23:20:11] info: [leaderboardRoutes.GET /competition] Getting competition leaderboard: discipline=undefined, period=all, metric=wins
[2025-12-27 23:20:11] info: [leaderboardRoutes.GET /competition] Retrieved 1 leaderboard entries
[2025-12-27 23:20:11] info: [GET] /api/leaderboards/competition?metric=wins&limit=10 - 200
PASS tests/integration/competitionWorkflow.integration.test.mjs
  üèÜ INTEGRATION: Complete Competition Workflow
    üîê STEP 1: User & Horse Setup
      ‚àö should create user and prepare competition-ready horse (427 ms)
    üèüÔ∏è STEP 2: Competition Setup & Show Creation
      ‚àö should create competition show with proper configuration (4 ms)
    üìù STEP 3: Competition Entry & Validation
      ‚àö should validate horse meets competition requirements using API (43 ms)
      ‚àö should successfully enter horse in competition using API endpoint (48 ms)
    üèÅ STEP 4: Competition Execution & Scoring
      ‚àö should execute competition and calculate results (7 ms)
    üí∞ STEP 5: Prize Distribution & XP Awards
      ‚àö should award prize money and XP for competition performance (14 ms)
    üìä STEP 6: Leaderboard & Rankings
      ‚àö should update leaderboards with competition results using API (39 ms)
      ‚àö should track historical performance (4 ms)
    üéØ STEP 7: Performance Impact on Horse Value
      ‚àö should increase horse value based on competition success (6 ms)
    üèÜ STEP 8: Multi-Discipline Competition Readiness
      ‚àö should validate horse can compete in multiple disciplines (5 ms)
    üéä STEP 9: End-to-End Competition Workflow Validation
      ‚àö should validate complete competition workflow integrity (8 ms)
      ‚àö should validate all business rules enforced throughout competition (3 ms)

[2025-12-27 23:20:12] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:12] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:12] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:12] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:12] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:12] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:12] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:12] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:12] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:12] info: [GET] /api/horses/94246?id=94246&id=999
[2025-12-27 23:20:12] warn: [MemoryMonitoring] Memory threshold exceeded: 1145MB
[2025-12-27 23:20:12] info: [auth] Authenticated user 61542a90-f869-422b-be25-f1860d22fba0 for GET /horses/94246
[2025-12-27 23:20:12] info: [GET] /api/horses/94246?id=94246&id=999 - 400
[2025-12-27 23:20:12] info: [GET] /api/horses?id=1&id=2&id=3
[2025-12-27 23:20:12] warn: [MemoryMonitoring] Memory threshold exceeded: 1145MB
[2025-12-27 23:20:12] info: [auth] Authenticated user dc514450-b358-40e5-a9df-6d9717ddea4f for GET /horses
[2025-12-27 23:20:12] info: [GET] /api/horses?id=1&id=2&id=3 - 400
[2025-12-27 23:20:12] info: [GET] /api/horses/94248?sort=name&sort=age
[2025-12-27 23:20:12] warn: [MemoryMonitoring] Memory threshold exceeded: 1143MB
[2025-12-27 23:20:12] info: [auth] Authenticated user 41fd8fd2-9b97-4379-911a-b2ad495c507e for GET /horses/94248
[2025-12-27 23:20:12] info: [ownership] Validated ownership: user 41fd8fd2-9b97-4379-911a-b2ad495c507e owns horse 94248
[2025-12-27 23:20:12] info: [GET] /api/horses/94248?sort=name&sort=age - 200
[2025-12-27 23:20:12] info: [PUT] /api/horses/94249
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1144MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 94009054-ef4f-46fb-bc81-2933acd2fcbb for PUT /horses/94249
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 94009054-ef4f-46fb-bc81-2933acd2fcbb owns horse 94249
[2025-12-27 23:20:13] info: [PUT] /api/horses/94249 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94250
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1144MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 82395095-6904-4d85-9b89-53a5ea5a70c5 for PUT /horses/94250
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 82395095-6904-4d85-9b89-53a5ea5a70c5 owns horse 94250
[2025-12-27 23:20:13] info: [PUT] /api/horses/94250 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94251
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1143MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 4321eba8-b8cf-4d49-b312-0d17a78123a5 for PUT /horses/94251
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 4321eba8-b8cf-4d49-b312-0d17a78123a5 owns horse 94251
[2025-12-27 23:20:13] info: [PUT] /api/horses/94251 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94252
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1156MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 72f794b9-568d-43d4-9d17-0023d1832861 for PUT /horses/94252
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 72f794b9-568d-43d4-9d17-0023d1832861 owns horse 94252
[2025-12-27 23:20:13] info: [PUT] /api/horses/94252 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94253
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1152MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 307f497d-e287-4659-abdf-a4150ec56bc0 for PUT /horses/94253
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 307f497d-e287-4659-abdf-a4150ec56bc0 owns horse 94253
[2025-12-27 23:20:13] info: [PUT] /api/horses/94253 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94254
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1149MB
[2025-12-27 23:20:13] info: [auth] Authenticated user bcb29be7-e004-47e0-aef5-225684343b02 for PUT /horses/94254
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user bcb29be7-e004-47e0-aef5-225684343b02 owns horse 94254
[2025-12-27 23:20:13] info: [PUT] /api/horses/94254 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94255
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1148MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 9760a8f1-87ed-479e-b05d-fdd5578b516a for PUT /horses/94255
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 9760a8f1-87ed-479e-b05d-fdd5578b516a owns horse 94255
[2025-12-27 23:20:13] info: [PUT] /api/horses/94255 - 400
[2025-12-27 23:20:13] info: [POST] /api/horses/batch-update
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1146MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 22b9136e-9adf-4314-ba54-893ee8368620 for POST /horses/batch-update
[2025-12-27 23:20:13] info: [auth] Authenticated user 22b9136e-9adf-4314-ba54-893ee8368620 for POST /batch-update
[2025-12-27 23:20:13] info: [POST] /api/horses/batch-update - 400
[2025-12-27 23:20:13] info: [POST] /api/horses/batch-update
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1145MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 6c7fde0f-5cf0-473e-94b5-ac3ae3fba8bc for POST /horses/batch-update
[2025-12-27 23:20:13] info: [auth] Authenticated user 6c7fde0f-5cf0-473e-94b5-ac3ae3fba8bc for POST /batch-update
[2025-12-27 23:20:13] info: [POST] /api/horses/batch-update - 400
[2025-12-27 23:20:13] info: [POST] /api/horses/batch-update
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1157MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 96a8dbd0-347c-4ba5-bdb6-c31fe938b09a for POST /horses/batch-update
[2025-12-27 23:20:13] info: [auth] Authenticated user 96a8dbd0-347c-4ba5-bdb6-c31fe938b09a for POST /batch-update
[2025-12-27 23:20:13] info: [POST] /api/horses/batch-update - 400
[2025-12-27 23:20:13] info: [POST] /api/horses/batch-update
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1153MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 074cd802-5b65-43b7-811d-b1812dd0aa9f for POST /horses/batch-update
[2025-12-27 23:20:13] info: [auth] Authenticated user 074cd802-5b65-43b7-811d-b1812dd0aa9f for POST /batch-update
[2025-12-27 23:20:13] info: [POST] /api/horses/batch-update - 400
[2025-12-27 23:20:13] info: [POST] /api/horses/batch-update
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1149MB
[2025-12-27 23:20:13] info: [auth] Authenticated user a67592f4-a5c4-4e56-8e35-c1210d190639 for POST /horses/batch-update
[2025-12-27 23:20:13] info: [auth] Authenticated user a67592f4-a5c4-4e56-8e35-c1210d190639 for POST /batch-update
[2025-12-27 23:20:13] info: [POST] /api/horses/batch-update - 400
[2025-12-27 23:20:13] info: [GET] /api/horses?breed=Thoroughbred%27%20OR%20%271%27=%271
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1147MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 161c7329-126f-4619-bcb4-b5d953f40ba2 for GET /horses
[2025-12-27 23:20:13] info: [GET] /api/horses?breed=Thoroughbred%27%20OR%20%271%27=%271 - 400
[2025-12-27 23:20:13] info: [GET] /api/horses?name[$ne]=null
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1146MB
[2025-12-27 23:20:13] info: [auth] Authenticated user d72205cf-f835-4a8e-ad11-d049ff3093b2 for GET /horses
[2025-12-27 23:20:13] info: [GET] /api/horses?name[$ne]=null - 400
[2025-12-27 23:20:13] info: [GET] /api/horses?name=%3Cscript%3Ealert(1)%3C/script%3E
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1156MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 34548458-7dcb-4070-aaf2-add3dd35463b for GET /horses
[2025-12-27 23:20:13] info: [GET] /api/horses?name=%3Cscript%3Ealert(1)%3C/script%3E - 400
[2025-12-27 23:20:13] info: [GET] /api/horses?name=Horse%00Admin
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1152MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 150bc385-2ab2-4bd4-bfa1-d6f68a4b3a70 for GET /horses
[2025-12-27 23:20:13] info: [GET] /api/horses?name=Horse%00Admin - 400
[2025-12-27 23:20:13] info: [GET] /api/horses?name=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1148MB
[2025-12-27 23:20:13] info: [auth] Authenticated user c8ba5332-7c2d-4cc4-8c26-3c99994bfe0e for GET /horses
[2025-12-27 23:20:13] info: [GET] /api/horses?name=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa - 414
[2025-12-27 23:20:13] error: [PUT] /api/horses/94266 - ERROR
[2025-12-27 23:20:13] error: Error Unexpected token 'n', "name=HackedName" is not valid JSON
[2025-12-27 23:20:13] info: [PUT] /api/horses/94267
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1157MB
[2025-12-27 23:20:13] info: [auth] Authenticated user ceb15493-dd97-48f8-b34f-5f4f6ed1568c for PUT /horses/94267
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user ceb15493-dd97-48f8-b34f-5f4f6ed1568c owns horse 94267
[2025-12-27 23:20:13] info: [PUT] /api/horses/94267 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94268
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1153MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 0883191d-4cb4-46a5-ae8b-228244161a43 for PUT /horses/94268
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 0883191d-4cb4-46a5-ae8b-228244161a43 owns horse 94268
[2025-12-27 23:20:13] info: [PUT] /api/horses/94268 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94269
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1151MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 01f1fc38-987c-4ab8-aad2-f2b6dc8475b0 for PUT /horses/94269
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 01f1fc38-987c-4ab8-aad2-f2b6dc8475b0 owns horse 94269
[2025-12-27 23:20:13] info: [PUT] /api/horses/94269 - 415
[2025-12-27 23:20:13] info: [PUT] /api/horses/94270
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1150MB
[2025-12-27 23:20:13] info: [auth] Authenticated user c45b0daa-5a07-4f56-af97-bc11dd487ee3 for PUT /horses/94270
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user c45b0daa-5a07-4f56-af97-bc11dd487ee3 owns horse 94270
[2025-12-27 23:20:13] info: [PUT] /api/horses/94270 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94271
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1148MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 4312bc98-73c6-4ce8-ae38-3b62af561a95 for PUT /horses/94271
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 4312bc98-73c6-4ce8-ae38-3b62af561a95 owns horse 94271
[2025-12-27 23:20:13] info: [PUT] /api/horses/94271 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94272
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1160MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 59d2c2b9-819e-4127-af08-069b3bcc3517 for PUT /horses/94272
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 59d2c2b9-819e-4127-af08-069b3bcc3517 owns horse 94272
[2025-12-27 23:20:13] info: [PUT] /api/horses/94272 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94273
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1156MB
[2025-12-27 23:20:13] info: [auth] Authenticated user dadfa5f0-9ccd-460e-ad33-bb8a0ded18db for PUT /horses/94273
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user dadfa5f0-9ccd-460e-ad33-bb8a0ded18db owns horse 94273
[2025-12-27 23:20:13] info: [PUT] /api/horses/94273 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94274
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1154MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 3165f6e7-2615-4bbb-90f1-7e62147333a9 for PUT /horses/94274
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 3165f6e7-2615-4bbb-90f1-7e62147333a9 owns horse 94274
[2025-12-27 23:20:13] info: [PUT] /api/horses/94274 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94275
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1153MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 5ee1bcfa-8465-4ce6-803e-780261024727 for PUT /horses/94275
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 5ee1bcfa-8465-4ce6-803e-780261024727 owns horse 94275
[2025-12-27 23:20:13] info: [PUT] /api/horses/94275 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94276
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1151MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 10771c43-abed-4fcb-945a-4ecc56826972 for PUT /horses/94276
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 10771c43-abed-4fcb-945a-4ecc56826972 owns horse 94276
[2025-12-27 23:20:13] info: [PUT] /api/horses/94276 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94277
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1150MB
[2025-12-27 23:20:13] info: [auth] Authenticated user a6952ab0-791f-49a7-b14d-070646f73499 for PUT /horses/94277
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user a6952ab0-791f-49a7-b14d-070646f73499 owns horse 94277
[2025-12-27 23:20:13] info: [PUT] /api/horses/94277 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94278
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1161MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 4afc4e2c-2009-4b93-89b7-40ce4cf01718 for PUT /horses/94278
[2025-12-27 23:20:13] info: [ownership] Validated ownership: user 4afc4e2c-2009-4b93-89b7-40ce4cf01718 owns horse 94278
[2025-12-27 23:20:13] info: [PUT] /api/horses/94278 - 400
[2025-12-27 23:20:13] info: [PUT] /api/horses/94279
[2025-12-27 23:20:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1158MB
[2025-12-27 23:20:13] info: [auth] Authenticated user 025611a4-8a77-4c11-a80c-14619e35bbf3 for PUT /horses/94279
[2025-12-27 23:20:14] info: [ownership] Validated ownership: user 025611a4-8a77-4c11-a80c-14619e35bbf3 owns horse 94279
[2025-12-27 23:20:14] info: [PUT] /api/horses/94279 - 400
[2025-12-27 23:20:14] info: [PUT] /api/horses/94280
[2025-12-27 23:20:14] warn: [MemoryMonitoring] Memory threshold exceeded: 1156MB
[2025-12-27 23:20:14] info: [auth] Authenticated user 6549c02e-d3cd-4c0c-b845-ebfd6e30be87 for PUT /horses/94280
[2025-12-27 23:20:14] info: [ownership] Validated ownership: user 6549c02e-d3cd-4c0c-b845-ebfd6e30be87 owns horse 94280
[2025-12-27 23:20:14] info: [PUT] /api/horses/94280 - 400
[2025-12-27 23:20:14] info: [PUT] /api/horses/94281
[2025-12-27 23:20:14] warn: [MemoryMonitoring] Memory threshold exceeded: 1155MB
[2025-12-27 23:20:14] info: [auth] Authenticated user 006ec8c0-ea47-4b8f-8973-7d400f0ef9c0 for PUT /horses/94281
[2025-12-27 23:20:14] info: [ownership] Validated ownership: user 006ec8c0-ea47-4b8f-8973-7d400f0ef9c0 owns horse 94281
[2025-12-27 23:20:14] info: [PUT] /api/horses/94281 - 400
[2025-12-27 23:20:14] info: [PUT] /api/horses/94282
[2025-12-27 23:20:14] warn: [MemoryMonitoring] Memory threshold exceeded: 1152MB
[2025-12-27 23:20:14] info: [auth] Authenticated user 316c6351-717f-4ab0-b9b3-60a1f7681426 for PUT /horses/94282
[2025-12-27 23:20:14] info: [ownership] Validated ownership: user 316c6351-717f-4ab0-b9b3-60a1f7681426 owns horse 94282
[2025-12-27 23:20:14] info: [PUT] /api/horses/94282 - 400
[2025-12-27 23:20:14] info: [PUT] /api/horses/94283
[2025-12-27 23:20:14] warn: [MemoryMonitoring] Memory threshold exceeded: 1151MB
[2025-12-27 23:20:14] info: [auth] Authenticated user e3fb3f27-7621-4502-b7eb-1444f7adc99c for PUT /horses/94283
[2025-12-27 23:20:14] info: [ownership] Validated ownership: user e3fb3f27-7621-4502-b7eb-1444f7adc99c owns horse 94283
[2025-12-27 23:20:14] info: [PUT] /api/horses/94283 - 400
[2025-12-27 23:20:14] info: [GET] /api/horses/94284
[2025-12-27 23:20:14] warn: [MemoryMonitoring] Memory threshold exceeded: 1162MB
[2025-12-27 23:20:14] info: [auth] Authenticated user 408f4ead-6682-4873-8cad-5466e2e0568f for GET /horses/94284
[2025-12-27 23:20:14] info: [ownership] Validated ownership: user 408f4ead-6682-4873-8cad-5466e2e0568f owns horse 94284
[2025-12-27 23:20:14] info: [GET] /api/horses/94284 - 200
[2025-12-27 23:20:14] info: [GET] /api/horses
[2025-12-27 23:20:14] warn: [MemoryMonitoring] Memory threshold exceeded: 1161MB
[2025-12-27 23:20:14] info: [auth] Authenticated user b7d3021e-ec05-46e8-b8e6-a8f3a583a40a for GET /horses
[2025-12-27 23:20:14] info: [GET] /api/horses - 400
[2025-12-27 23:20:14] info: [GET] /api/horses/94286
[2025-12-27 23:20:14] warn: [MemoryMonitoring] Memory threshold exceeded: 1156MB
[2025-12-27 23:20:14] info: [auth] Authenticated user d65b33f7-accb-43d2-82a9-ce6f27129f2e for GET /horses/94286
[2025-12-27 23:20:14] info: [GET] /api/horses/94286 - 406
[2025-12-27 23:20:14] info: [PUT] /api/horses/94287
[2025-12-27 23:20:14] warn: [MemoryMonitoring] Memory threshold exceeded: 1155MB
[2025-12-27 23:20:14] info: [auth] Authenticated user e1235271-aed9-4d4e-89ac-947664c4ca37 for PUT /horses/94287
[2025-12-27 23:20:14] info: [PUT] /api/horses/94287
[2025-12-27 23:20:14] warn: [MemoryMonitoring] Memory threshold exceeded: 1161MB
[2025-12-27 23:20:14] info: [auth] Authenticated user e1235271-aed9-4d4e-89ac-947664c4ca37 for PUT /horses/94287
[2025-12-27 23:20:14] info: [ownership] Validated ownership: user e1235271-aed9-4d4e-89ac-947664c4ca37 owns horse 94287
[2025-12-27 23:20:14] info: [PUT] /api/horses/94287 - 400
[2025-12-27 23:20:14] info: [ownership] Validated ownership: user e1235271-aed9-4d4e-89ac-947664c4ca37 owns horse 94287
[2025-12-27 23:20:14] info: [PUT] /api/horses/94287 - 400
PASS __tests__/integration/security/parameter-pollution.test.mjs
  Parameter Pollution Attack Integration Tests
    HTTP Parameter Pollution (HPP)
      ‚àö should reject duplicate id parameters in query string (109 ms)
      ‚àö should reject duplicate id parameters in different positions (27 ms)
      ‚àö should use first parameter value when duplicates present (48 ms)
      ‚àö should reject array-syntax parameters where not expected (42 ms)
      ‚àö should reject mixed type parameters (33 ms)
    JSON Parameter Pollution
      ‚àö should reject duplicate keys in JSON payload (38 ms)
      ‚àö should reject nested parameter pollution (33 ms)
      ‚àö should reject prototype pollution attempts (32 ms)
      ‚àö should reject constructor pollution attempts (36 ms)
      ‚àö should sanitize JSON keys with special characters (34 ms)
    Array Parameter Manipulation
      ‚àö should reject oversized arrays in batch operations (29 ms)
      ‚àö should reject mixed-type arrays (31 ms)
      ‚àö should reject negative indices in array parameters (30 ms)
      ‚àö should reject sparse arrays with undefined holes (34 ms)
      ‚àö should enforce maximum array nesting depth (31 ms)
    Query String Pollution
      ‚àö should reject SQL injection in query parameters (30 ms)
      ‚àö should reject NoSQL injection in query parameters (29 ms)
      ‚àö should reject encoded special characters in parameters (28 ms)
      ‚àö should reject null bytes in query strings (27 ms)
      ‚àö should enforce query string length limits (30 ms)
    Content-Type Manipulation
      ‚àö should reject mismatched Content-Type and body format (28 ms)
      ‚àö should reject Content-Type charset manipulation (35 ms)
      ‚àö should reject multipart/form-data without proper boundaries (32 ms)
      ‚àö should accept only allowed Content-Types (32 ms)
    Nested Object Pollution
      ‚àö should reject excessive nesting depth (35 ms)
      ‚àö should reject circular references in objects (33 ms)
      ‚àö should sanitize nested object keys (31 ms)
      ‚àö should reject objects with numeric string keys (32 ms)
    Type Coercion Attacks
      ‚àö should reject boolean as string (33 ms)
      ‚àö should reject object as number (33 ms)
      ‚àö should reject array as string (45 ms)
      ‚àö should reject numeric string with leading zeros (45 ms)
      ‚àö should reject scientific notation where integers expected (34 ms)
      ‚àö should reject Infinity and NaN values (32 ms)
    Mass Assignment Vulnerabilities
      ‚àö should reject attempts to modify protected fields (35 ms)
      ‚àö should reject attempts to set createdAt/updatedAt manually (28 ms)
      ‚àö should only allow whitelisted fields in updates (34 ms)
      ‚àö should reject attempts to add new fields (33 ms)
    Parameter Injection via Headers
      ‚àö should reject parameter injection via custom headers (40 ms)
      ‚àö should reject SQL injection in custom headers (31 ms)
      ‚àö should reject malicious values in Accept header (28 ms)
    Race Condition via Parameter Timing
      ‚àö should prevent race conditions in concurrent updates (60 ms)

[2025-12-27 23:20:14] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:14] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:14] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:15] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:15] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:15] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:15] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:15] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:15] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:15] info: [GET] /api/competition/disciplines
[2025-12-27 23:20:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1193MB
[2025-12-27 23:20:15] info: [GET] /api/competition/disciplines - 200
[2025-12-27 23:20:15] info: [GET] /api/competition/eligibility/94288/Racing
[2025-12-27 23:20:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1193MB
[2025-12-27 23:20:15] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /competition/eligibility/94288/Racing
[2025-12-27 23:20:15] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /eligibility/94288/Racing
[2025-12-27 23:20:15] info: [ownership] Validated ownership: user 3932b183-4d66-40bd-aec5-72cc5db57150 owns horse 94288
[2025-12-27 23:20:15] info: [competitionRoutes.GET /eligibility] Checking eligibility for horse 94288 in Racing
[2025-12-27 23:20:15] info: [competitionRoutes.GET /eligibility] Horse 94288 eligibility checked for Racing
[2025-12-27 23:20:15] info: [GET] /api/competition/eligibility/94288/Racing - 200
[2025-12-27 23:20:15] info: [GET] /api/competition/eligibility/94288/Gaited
[2025-12-27 23:20:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1194MB
[2025-12-27 23:20:15] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /competition/eligibility/94288/Gaited
[2025-12-27 23:20:15] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /eligibility/94288/Gaited
[2025-12-27 23:20:15] info: [ownership] Validated ownership: user 3932b183-4d66-40bd-aec5-72cc5db57150 owns horse 94288
[2025-12-27 23:20:15] info: [competitionRoutes.GET /eligibility] Checking eligibility for horse 94288 in Gaited
[2025-12-27 23:20:15] info: [competitionRoutes.GET /eligibility] Horse 94288 eligibility checked for Gaited
[2025-12-27 23:20:15] info: [GET] /api/competition/eligibility/94288/Gaited - 200
[2025-12-27 23:20:15] info: [GET] /api/competition/eligibility/94288/InvalidDiscipline
[2025-12-27 23:20:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1194MB
[2025-12-27 23:20:15] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /competition/eligibility/94288/InvalidDiscipline
[2025-12-27 23:20:15] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /eligibility/94288/InvalidDiscipline
[2025-12-27 23:20:15] info: [ownership] Validated ownership: user 3932b183-4d66-40bd-aec5-72cc5db57150 owns horse 94288
[2025-12-27 23:20:15] info: [competitionRoutes.GET /eligibility] Checking eligibility for horse 94288 in InvalidDiscipline
[2025-12-27 23:20:15] info: [GET] /api/competition/eligibility/94288/InvalidDiscipline - 400
[2025-12-27 23:20:15] info: [GET] /api/competition/eligibility/94288/Racing
[2025-12-27 23:20:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1194MB
[2025-12-27 23:20:15] warn: [auth] Access token is required for GET /competition/eligibility/94288/Racing from ::ffff:127.0.0.1
[2025-12-27 23:20:15] info: [GET] /api/competition/eligibility/94288/Racing - 401
[2025-12-27 23:20:15] info: [GET] /api/competition/eligibility/94289/Racing
[2025-12-27 23:20:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1206MB
[2025-12-27 23:20:15] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /competition/eligibility/94289/Racing
[2025-12-27 23:20:15] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /eligibility/94289/Racing
[2025-12-27 23:20:15] warn: [ownership] horse 94289 not found or not owned by user 3932b183-4d66-40bd-aec5-72cc5db57150
[2025-12-27 23:20:15] info: [GET] /api/competition/eligibility/94289/Racing - 404
[2025-12-27 23:20:15] info: [POST] /api/competition/enter
[2025-12-27 23:20:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1205MB
[2025-12-27 23:20:15] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for POST /competition/enter
[2025-12-27 23:20:15] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for POST /enter
[2025-12-27 23:20:15] info: [competitionRoutes.POST /enter] User 3932b183-4d66-40bd-aec5-72cc5db57150 entering horse 94288 in show 5467
[2025-12-27 23:20:15] info: [ownership] Found owned horse 94288 for user 3932b183-4d66-40bd-aec5-72cc5db57150
[2025-12-27 23:20:15] info: [competitionRoutes.POST /enter] Successfully entered horse 94288 in show 5467
[2025-12-27 23:20:15] info: [POST] /api/competition/enter - 201
[2025-12-27 23:20:15] info: [POST] /api/competition/enter
[2025-12-27 23:20:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1205MB
[2025-12-27 23:20:15] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for POST /competition/enter
[2025-12-27 23:20:15] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for POST /enter
[2025-12-27 23:20:15] info: [competitionRoutes.POST /enter] User 3932b183-4d66-40bd-aec5-72cc5db57150 entering horse 94288 in show 5467
[2025-12-27 23:20:15] info: [ownership] Found owned horse 94288 for user 3932b183-4d66-40bd-aec5-72cc5db57150
[2025-12-27 23:20:15] info: [POST] /api/competition/enter - 400
[2025-12-27 23:20:15] info: [POST] /api/competition/enter
[2025-12-27 23:20:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1205MB
[2025-12-27 23:20:16] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for POST /competition/enter
[2025-12-27 23:20:16] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for POST /enter
[2025-12-27 23:20:16] warn: [competitionRoutes.POST /enter] Validation errors: [{"type":"field","value":"invalid","msg":"Horse ID must be a positive integer","path":"horseId","location":"body"}]
[2025-12-27 23:20:16] info: [POST] /api/competition/enter - 400
[2025-12-27 23:20:16] info: [POST] /api/competition/enter
[2025-12-27 23:20:16] warn: [MemoryMonitoring] Memory threshold exceeded: 1202MB
[2025-12-27 23:20:16] warn: [auth] Access token is required for POST /competition/enter from ::ffff:127.0.0.1
[2025-12-27 23:20:16] info: [POST] /api/competition/enter - 401
[2025-12-27 23:20:16] info: [POST] /api/competition/execute
[2025-12-27 23:20:16] warn: [MemoryMonitoring] Memory threshold exceeded: 1199MB
[2025-12-27 23:20:16] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for POST /competition/execute
[2025-12-27 23:20:16] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for POST /execute
[2025-12-27 23:20:16] info: [competitionRoutes.POST /execute] User 3932b183-4d66-40bd-aec5-72cc5db57150 executing competition for show 5467
[2025-12-27 23:20:16] info: [competitionRoutes.POST /execute] Executing competition with 1 entries
[2025-12-27 23:20:16] info: [enhancedCompetitionSimulation] Executing competition: API Test Racing Show_1766895615493_596_41752 (Racing)
[2025-12-27 23:20:16] info: [calculateCompetitionScore] Horse API Test Horse: Base score for Racing: 205
[2025-12-27 23:20:16] info: [calculateCompetitionScore] Horse API Test Horse: Luck modifier: -4.5%, adjustment: -9.2
[2025-12-27 23:20:16] info: [calculateCompetitionScore] Horse API Test Horse: Final score: 196 (base: 205, trait: +0, luck: -9.2)
[2025-12-27 23:20:16] info: [enhancedCompetitionSimulation] Horse API Test Horse (ID: 94288) scored 196 in Racing
[2025-12-27 23:20:16] info: [resultModel.saveResult] Successfully updated placeholder result for horse 94288 in show 5467 with score 196
[2025-12-27 23:20:16] info: [horseXpModel.addXpToHorse] Added 30 XP to horse API Test Horse (ID: 94288). New XP: 30, Stat points gained: 0, Available: 0
[2025-12-27 23:20:16] info: [enhancedCompetitionSimulation] Awarded 30 Horse XP to API Test Horse for 1st place
[2025-12-27 23:20:16] info: [enhancedCompetitionSimulation] Competition completed. 1 entries processed.
[2025-12-27 23:20:16] info: [competitionRoutes.POST /execute] Competition executed successfully for show 5467
[2025-12-27 23:20:16] info: [POST] /api/competition/execute - 200
[2025-12-27 23:20:16] info: [POST] /api/competition/execute
[2025-12-27 23:20:16] warn: [MemoryMonitoring] Memory threshold exceeded: 1206MB
[2025-12-27 23:20:16] info: [auth] Authenticated user 0411c928-81ff-4354-bd9b-c47bca995e09 for POST /competition/execute
[2025-12-27 23:20:16] info: [auth] Authenticated user 0411c928-81ff-4354-bd9b-c47bca995e09 for POST /execute
[2025-12-27 23:20:16] info: [competitionRoutes.POST /execute] User 0411c928-81ff-4354-bd9b-c47bca995e09 executing competition for show 5467
[2025-12-27 23:20:16] info: [POST] /api/competition/execute - 403
[2025-12-27 23:20:16] info: [POST] /api/competition/execute
[2025-12-27 23:20:16] warn: [MemoryMonitoring] Memory threshold exceeded: 1204MB
[2025-12-27 23:20:16] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for POST /competition/execute
[2025-12-27 23:20:16] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for POST /execute
[2025-12-27 23:20:16] info: [competitionRoutes.POST /execute] User 3932b183-4d66-40bd-aec5-72cc5db57150 executing competition for show 99999
[2025-12-27 23:20:16] info: [POST] /api/competition/execute - 404
[2025-12-27 23:20:16] info: [GET] /api/leaderboards/competition?metric=wins&limit=10
[2025-12-27 23:20:16] warn: [MemoryMonitoring] Memory threshold exceeded: 1201MB
[2025-12-27 23:20:16] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /leaderboards/competition
[2025-12-27 23:20:16] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /competition
[2025-12-27 23:20:16] info: [leaderboardRoutes.GET /competition] Getting competition leaderboard: discipline=undefined, period=all, metric=wins
[2025-12-27 23:20:16] info: [leaderboardRoutes.GET /competition] Retrieved 0 leaderboard entries
[2025-12-27 23:20:16] info: [GET] /api/leaderboards/competition?metric=wins&limit=10 - 200
[2025-12-27 23:20:16] info: [GET] /api/leaderboards/competition?metric=earnings&discipline=Racing
[2025-12-27 23:20:16] warn: [MemoryMonitoring] Memory threshold exceeded: 1201MB
[2025-12-27 23:20:16] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /leaderboards/competition
[2025-12-27 23:20:16] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /competition
[2025-12-27 23:20:16] info: [leaderboardRoutes.GET /competition] Getting competition leaderboard: discipline=Racing, period=all, metric=earnings
[2025-12-27 23:20:16] info: [leaderboardRoutes.GET /competition] Retrieved 1 leaderboard entries
[2025-12-27 23:20:16] info: [GET] /api/leaderboards/competition?metric=earnings&discipline=Racing - 200
[2025-12-27 23:20:16] info: [GET] /api/leaderboards/competition?metric=invalid
[2025-12-27 23:20:16] warn: [MemoryMonitoring] Memory threshold exceeded: 1201MB
[2025-12-27 23:20:16] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /leaderboards/competition
[2025-12-27 23:20:16] info: [auth] Authenticated user 3932b183-4d66-40bd-aec5-72cc5db57150 for GET /competition
[2025-12-27 23:20:16] warn: [leaderboardRoutes.GET /competition] Validation errors: [{"type":"field","value":"invalid","msg":"Metric must be one of: wins, earnings, placements, average_placement","path":"metric","location":"query"}]
[2025-12-27 23:20:16] info: [GET] /api/leaderboards/competition?metric=invalid - 400
[2025-12-27 23:20:16] info: [GET] /api/leaderboards/competition
[2025-12-27 23:20:16] warn: [MemoryMonitoring] Memory threshold exceeded: 1198MB
[2025-12-27 23:20:16] warn: [auth] Access token is required for GET /leaderboards/competition from ::ffff:127.0.0.1
[2025-12-27 23:20:16] info: [GET] /api/leaderboards/competition - 401
PASS tests/integration/competitionAPIEndpoints.integration.test.mjs
  üöÄ INTEGRATION: Competition API Endpoints
    üéØ GET /api/competition/disciplines
      ‚àö should return all available disciplines (162 ms)
    üîç GET /api/competition/eligibility/:horseId/:discipline
      ‚àö should check horse eligibility for Racing discipline (54 ms)
      ‚àö should check horse eligibility for Gaited discipline (44 ms)
      ‚àö should reject invalid discipline (44 ms)
      ‚àö should reject unauthorized access (32 ms)
      ‚àö should reject access to horse not owned by user (49 ms)
    üìù POST /api/competition/enter
      ‚àö should successfully enter horse in competition (66 ms)
      ‚àö should reject duplicate entry (36 ms)
      ‚àö should reject invalid input (30 ms)
      ‚àö should reject unauthorized access (26 ms)
    üèÅ POST /api/competition/execute
      ‚àö should successfully execute competition (72 ms)
      ‚àö should reject execution by non-host user (31 ms)
      ‚àö should reject invalid show ID (29 ms)
    üèÜ GET /api/leaderboard/competition
      ‚àö should get competition leaderboard by wins (39 ms)
      ‚àö should get competition leaderboard by earnings (36 ms)
      ‚àö should reject invalid metric (25 ms)
      ‚àö should reject unauthorized access (22 ms)

[2025-12-27 23:20:16] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:16] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:16] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:17] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:17] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:17] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:17] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:17] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:17] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:17] info: [POST] /api/training/train
[2025-12-27 23:20:17] warn: [MemoryMonitoring] Memory threshold exceeded: 1026MB
[2025-12-27 23:20:17] info: [auth] Authenticated user d43a96da-896e-4729-a4bf-b9b85b30f0d7 for POST /training/train
[2025-12-27 23:20:17] info: [ownership] Found owned horse 94291 for user d43a96da-896e-4729-a4bf-b9b85b30f0d7
[2025-12-27 23:20:17] info: [trainingController.trainRouteHandler] Training request for horse 94291 in Racing
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Attempting to train horse 94291 in Racing
[2025-12-27 23:20:17] info: [trainingController.canTrain] Checking training eligibility for horse 94291 in Racing
[2025-12-27 23:20:17] info: [trainingModel.getHorseAge] Getting age for horse 94291
[2025-12-27 23:20:17] info: [trainingModel.getHorseAge] Horse 94291 is 2 years old
[2025-12-27 23:20:17] info: [trainingController.canTrain] Horse 94291 is too young (2 years old)
[2025-12-27 23:20:17] warn: [trainingController.trainHorse] Training rejected: Horse is under age
[2025-12-27 23:20:17] info: [POST] /api/training/train - 400
[2025-12-27 23:20:17] info: [POST] /api/training/train
[2025-12-27 23:20:17] warn: [MemoryMonitoring] Memory threshold exceeded: 1028MB
[2025-12-27 23:20:17] info: [auth] Authenticated user d43a96da-896e-4729-a4bf-b9b85b30f0d7 for POST /training/train
[2025-12-27 23:20:17] info: [ownership] Found owned horse 94290 for user d43a96da-896e-4729-a4bf-b9b85b30f0d7
[2025-12-27 23:20:17] info: [trainingController.trainRouteHandler] Training request for horse 94290 in Dressage
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Attempting to train horse 94290 in Dressage
[2025-12-27 23:20:17] info: [trainingController.canTrain] Checking training eligibility for horse 94290 in Dressage
[2025-12-27 23:20:17] info: [trainingModel.getHorseAge] Getting age for horse 94290
[2025-12-27 23:20:17] info: [trainingModel.getHorseAge] Horse 94290 is 4 years old
[2025-12-27 23:20:17] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94290 across all disciplines
[2025-12-27 23:20:17] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94290
[2025-12-27 23:20:17] info: [trainingController.canTrain] Horse 94290 is eligible to train in Dressage
[2025-12-27 23:20:17] info: [horseModel.getHorseById] Successfully found horse: Test Adult Horse (ID: 94290)
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Horse 94290 has traits: 
[2025-12-27 23:20:17] info: [trainingModel.logTrainingSession] Logging training session for horse 94290 in Dressage
[2025-12-27 23:20:17] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4814
[2025-12-27 23:20:17] info: [horseModel.incrementDisciplineScore] Incrementing Dressage score for horse 94290 by +5
[2025-12-27 23:20:17] info: [horseModel.updateDisciplineScore] Updating Dressage score for horse 94290 by +5
[2025-12-27 23:20:17] info: [horseModel.updateDisciplineScore] Successfully updated Dressage score for horse 94290: 0 -> 5
[2025-12-27 23:20:17] info: [horseModel.incrementDisciplineScore] Successfully incremented Dressage score for horse 94290
[2025-12-27 23:20:17] info: [xpLogModel.logXpEvent] Logging XP event: User c596fcde-2570-4630-b173-69015d432001, Amount: 5, Reason: Trained horse Test Adult Horse in Dressage
[2025-12-27 23:20:17] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2342, User c596fcde-2570-4630-b173-69015d432001, Amount: 5
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Awarded 5 XP to user c596fcde-2570-4630-b173-69015d432001 for training
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Successfully trained horse 94290 in Dressage (Log ID: 4814, Score +5)
[2025-12-27 23:20:17] info: [POST] /api/training/train - 200
[2025-12-27 23:20:17] info: [POST] /api/training/train
[2025-12-27 23:20:17] warn: [MemoryMonitoring] Memory threshold exceeded: 1028MB
[2025-12-27 23:20:17] info: [auth] Authenticated user d43a96da-896e-4729-a4bf-b9b85b30f0d7 for POST /training/train
[2025-12-27 23:20:17] info: [ownership] Found owned horse 94293 for user d43a96da-896e-4729-a4bf-b9b85b30f0d7
[2025-12-27 23:20:17] info: [trainingController.trainRouteHandler] Training request for horse 94293 in Show Jumping
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Attempting to train horse 94293 in Show Jumping
[2025-12-27 23:20:17] info: [trainingController.canTrain] Checking training eligibility for horse 94293 in Show Jumping
[2025-12-27 23:20:17] info: [trainingModel.getHorseAge] Getting age for horse 94293
[2025-12-27 23:20:17] info: [trainingModel.getHorseAge] Horse 94293 is 4 years old
[2025-12-27 23:20:17] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94293 across all disciplines
[2025-12-27 23:20:17] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94293
[2025-12-27 23:20:17] info: [trainingController.canTrain] Horse 94293 is eligible to train in Show Jumping
[2025-12-27 23:20:17] info: [horseModel.getHorseById] Successfully found horse: Score Test Horse (ID: 94293)
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Horse 94293 has traits: 
[2025-12-27 23:20:17] info: [trainingModel.logTrainingSession] Logging training session for horse 94293 in Show Jumping
[2025-12-27 23:20:17] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4815
[2025-12-27 23:20:17] info: [horseModel.incrementDisciplineScore] Incrementing Show Jumping score for horse 94293 by +5
[2025-12-27 23:20:17] info: [horseModel.updateDisciplineScore] Updating Show Jumping score for horse 94293 by +5
[2025-12-27 23:20:17] info: [horseModel.updateDisciplineScore] Successfully updated Show Jumping score for horse 94293: 0 -> 5
[2025-12-27 23:20:17] info: [horseModel.incrementDisciplineScore] Successfully incremented Show Jumping score for horse 94293
[2025-12-27 23:20:17] info: [xpLogModel.logXpEvent] Logging XP event: User c596fcde-2570-4630-b173-69015d432001, Amount: 5, Reason: Trained horse Score Test Horse in Show Jumping
[2025-12-27 23:20:17] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2343, User c596fcde-2570-4630-b173-69015d432001, Amount: 5
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Awarded 5 XP to user c596fcde-2570-4630-b173-69015d432001 for training
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Successfully trained horse 94293 in Show Jumping (Log ID: 4815, Score +5)
[2025-12-27 23:20:17] info: [POST] /api/training/train - 200
[2025-12-27 23:20:17] info: [POST] /api/training/train
[2025-12-27 23:20:17] warn: [MemoryMonitoring] Memory threshold exceeded: 1028MB
[2025-12-27 23:20:17] info: [auth] Authenticated user d43a96da-896e-4729-a4bf-b9b85b30f0d7 for POST /training/train
[2025-12-27 23:20:17] info: [ownership] Found owned horse 94294 for user d43a96da-896e-4729-a4bf-b9b85b30f0d7
[2025-12-27 23:20:17] info: [trainingController.trainRouteHandler] Training request for horse 94294 in Cross Country
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Attempting to train horse 94294 in Cross Country
[2025-12-27 23:20:17] info: [trainingController.canTrain] Checking training eligibility for horse 94294 in Cross Country
[2025-12-27 23:20:17] info: [trainingModel.getHorseAge] Getting age for horse 94294
[2025-12-27 23:20:17] info: [trainingModel.getHorseAge] Horse 94294 is 5 years old
[2025-12-27 23:20:17] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94294 across all disciplines
[2025-12-27 23:20:17] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94294
[2025-12-27 23:20:17] info: [trainingController.canTrain] Horse 94294 is eligible to train in Cross Country
[2025-12-27 23:20:17] info: [horseModel.getHorseById] Successfully found horse: Accumulation Test Horse 1 (ID: 94294)
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Horse 94294 has traits: 
[2025-12-27 23:20:17] info: [trainingModel.logTrainingSession] Logging training session for horse 94294 in Cross Country
[2025-12-27 23:20:17] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4816
[2025-12-27 23:20:17] info: [horseModel.incrementDisciplineScore] Incrementing Cross Country score for horse 94294 by +5
[2025-12-27 23:20:17] info: [horseModel.updateDisciplineScore] Updating Cross Country score for horse 94294 by +5
[2025-12-27 23:20:17] info: [horseModel.updateDisciplineScore] Successfully updated Cross Country score for horse 94294: 0 -> 5
[2025-12-27 23:20:17] info: [horseModel.incrementDisciplineScore] Successfully incremented Cross Country score for horse 94294
[2025-12-27 23:20:17] info: [xpLogModel.logXpEvent] Logging XP event: User c596fcde-2570-4630-b173-69015d432001, Amount: 5, Reason: Trained horse Accumulation Test Horse 1 in Cross Country
[2025-12-27 23:20:17] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2344, User c596fcde-2570-4630-b173-69015d432001, Amount: 5
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Awarded 5 XP to user c596fcde-2570-4630-b173-69015d432001 for training
[2025-12-27 23:20:17] info: [trainingController.trainHorse] Successfully trained horse 94294 in Cross Country (Log ID: 4816, Score +5)
[2025-12-27 23:20:17] info: [POST] /api/training/train - 200
[2025-12-27 23:20:18] info: [POST] /api/training/train
[2025-12-27 23:20:18] warn: [MemoryMonitoring] Memory threshold exceeded: 1027MB
[2025-12-27 23:20:18] info: [auth] Authenticated user d43a96da-896e-4729-a4bf-b9b85b30f0d7 for POST /training/train
[2025-12-27 23:20:18] info: [ownership] Found owned horse 94292 for user d43a96da-896e-4729-a4bf-b9b85b30f0d7
[2025-12-27 23:20:18] info: [trainingController.trainRouteHandler] Training request for horse 94292 in Dressage
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Attempting to train horse 94292 in Dressage
[2025-12-27 23:20:18] info: [trainingController.canTrain] Checking training eligibility for horse 94292 in Dressage
[2025-12-27 23:20:18] info: [trainingModel.getHorseAge] Getting age for horse 94292
[2025-12-27 23:20:18] info: [trainingModel.getHorseAge] Horse 94292 is 5 years old
[2025-12-27 23:20:18] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94292 across all disciplines
[2025-12-27 23:20:18] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94292: Sat Dec 27 2025 23:20:17 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:20:18] info: [trainingController.canTrain] Horse 94292 still in cooldown for any training (7 days remaining)
[2025-12-27 23:20:18] warn: [trainingController.trainHorse] Training rejected: Training cooldown active for this horse
[2025-12-27 23:20:18] info: [POST] /api/training/train - 400
[2025-12-27 23:20:18] info: [POST] /api/training/train
[2025-12-27 23:20:18] warn: [MemoryMonitoring] Memory threshold exceeded: 1030MB
[2025-12-27 23:20:18] info: [auth] Authenticated user d43a96da-896e-4729-a4bf-b9b85b30f0d7 for POST /training/train
[2025-12-27 23:20:18] info: [ownership] Found owned horse 94296 for user d43a96da-896e-4729-a4bf-b9b85b30f0d7
[2025-12-27 23:20:18] info: [trainingController.trainRouteHandler] Training request for horse 94296 in Endurance
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Attempting to train horse 94296 in Endurance
[2025-12-27 23:20:18] info: [trainingController.canTrain] Checking training eligibility for horse 94296 in Endurance
[2025-12-27 23:20:18] info: [trainingModel.getHorseAge] Getting age for horse 94296
[2025-12-27 23:20:18] info: [trainingModel.getHorseAge] Horse 94296 is 6 years old
[2025-12-27 23:20:18] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94296 across all disciplines
[2025-12-27 23:20:18] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94296: Fri Dec 19 2025 23:20:18 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:20:18] info: [trainingController.canTrain] Horse 94296 is eligible to train in Endurance
[2025-12-27 23:20:18] info: [horseModel.getHorseById] Successfully found horse: Old Trained Horse (ID: 94296)
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Horse 94296 has traits: 
[2025-12-27 23:20:18] info: [trainingModel.logTrainingSession] Logging training session for horse 94296 in Endurance
[2025-12-27 23:20:18] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4818
[2025-12-27 23:20:18] info: [horseModel.incrementDisciplineScore] Incrementing Endurance score for horse 94296 by +5
[2025-12-27 23:20:18] info: [horseModel.updateDisciplineScore] Updating Endurance score for horse 94296 by +5
[2025-12-27 23:20:18] info: [horseModel.updateDisciplineScore] Successfully updated Endurance score for horse 94296: 0 -> 5
[2025-12-27 23:20:18] info: [horseModel.incrementDisciplineScore] Successfully incremented Endurance score for horse 94296
[2025-12-27 23:20:18] info: [xpLogModel.logXpEvent] Logging XP event: User c596fcde-2570-4630-b173-69015d432001, Amount: 5, Reason: Trained horse Old Trained Horse in Endurance
[2025-12-27 23:20:18] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2345, User c596fcde-2570-4630-b173-69015d432001, Amount: 5
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Awarded 5 XP to user c596fcde-2570-4630-b173-69015d432001 for training
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Successfully trained horse 94296 in Endurance (Log ID: 4818, Score +5)
[2025-12-27 23:20:18] info: [POST] /api/training/train - 200
[2025-12-27 23:20:18] info: [POST] /api/training/train
[2025-12-27 23:20:18] warn: [MemoryMonitoring] Memory threshold exceeded: 1029MB
[2025-12-27 23:20:18] info: [auth] Authenticated user d43a96da-896e-4729-a4bf-b9b85b30f0d7 for POST /training/train
[2025-12-27 23:20:18] info: [ownership] Found owned horse 94297 for user d43a96da-896e-4729-a4bf-b9b85b30f0d7
[2025-12-27 23:20:18] info: [trainingController.trainRouteHandler] Training request for horse 94297 in Trail
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Attempting to train horse 94297 in Trail
[2025-12-27 23:20:18] info: [trainingController.canTrain] Checking training eligibility for horse 94297 in Trail
[2025-12-27 23:20:18] info: [trainingModel.getHorseAge] Getting age for horse 94297
[2025-12-27 23:20:18] info: [trainingModel.getHorseAge] Horse 94297 is 4 years old
[2025-12-27 23:20:18] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94297 across all disciplines
[2025-12-27 23:20:18] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94297
[2025-12-27 23:20:18] info: [trainingController.canTrain] Horse 94297 is eligible to train in Trail
[2025-12-27 23:20:18] info: [horseModel.getHorseById] Successfully found horse: XP Test Horse (ID: 94297)
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Horse 94297 has traits: 
[2025-12-27 23:20:18] info: [trainingModel.logTrainingSession] Logging training session for horse 94297 in Trail
[2025-12-27 23:20:18] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4819
[2025-12-27 23:20:18] info: [horseModel.incrementDisciplineScore] Incrementing Trail score for horse 94297 by +5
[2025-12-27 23:20:18] info: [horseModel.updateDisciplineScore] Updating Trail score for horse 94297 by +5
[2025-12-27 23:20:18] info: [horseModel.updateDisciplineScore] Successfully updated Trail score for horse 94297: 0 -> 5
[2025-12-27 23:20:18] info: [horseModel.incrementDisciplineScore] Successfully incremented Trail score for horse 94297
[2025-12-27 23:20:18] info: [xpLogModel.logXpEvent] Logging XP event: User c596fcde-2570-4630-b173-69015d432001, Amount: 5, Reason: Trained horse XP Test Horse in Trail
[2025-12-27 23:20:18] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2346, User c596fcde-2570-4630-b173-69015d432001, Amount: 5
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Awarded 5 XP to user c596fcde-2570-4630-b173-69015d432001 for training
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Successfully trained horse 94297 in Trail (Log ID: 4819, Score +5)
[2025-12-27 23:20:18] info: [POST] /api/training/train - 200
[2025-12-27 23:20:18] info: [POST] /api/training/train
[2025-12-27 23:20:18] warn: [MemoryMonitoring] Memory threshold exceeded: 1029MB
[2025-12-27 23:20:18] info: [auth] Authenticated user d43a96da-896e-4729-a4bf-b9b85b30f0d7 for POST /training/train
[2025-12-27 23:20:18] info: [ownership] Found owned horse 94298 for user d43a96da-896e-4729-a4bf-b9b85b30f0d7
[2025-12-27 23:20:18] info: [trainingController.trainRouteHandler] Training request for horse 94298 in Reining
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Attempting to train horse 94298 in Reining
[2025-12-27 23:20:18] info: [trainingController.canTrain] Checking training eligibility for horse 94298 in Reining
[2025-12-27 23:20:18] info: [trainingModel.getHorseAge] Getting age for horse 94298
[2025-12-27 23:20:18] info: [trainingModel.getHorseAge] Horse 94298 is 5 years old
[2025-12-27 23:20:18] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94298 across all disciplines
[2025-12-27 23:20:18] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94298
[2025-12-27 23:20:18] info: [trainingController.canTrain] Horse 94298 is eligible to train in Reining
[2025-12-27 23:20:18] info: [horseModel.getHorseById] Successfully found horse: Log Test Horse (ID: 94298)
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Horse 94298 has traits: 
[2025-12-27 23:20:18] info: [trainingModel.logTrainingSession] Logging training session for horse 94298 in Reining
[2025-12-27 23:20:18] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4820
[2025-12-27 23:20:18] info: [horseModel.incrementDisciplineScore] Incrementing Reining score for horse 94298 by +5
[2025-12-27 23:20:18] info: [horseModel.updateDisciplineScore] Updating Reining score for horse 94298 by +5
[2025-12-27 23:20:18] info: [horseModel.updateDisciplineScore] Successfully updated Reining score for horse 94298: 0 -> 5
[2025-12-27 23:20:18] info: [horseModel.incrementDisciplineScore] Successfully incremented Reining score for horse 94298
[2025-12-27 23:20:18] info: [xpLogModel.logXpEvent] Logging XP event: User c596fcde-2570-4630-b173-69015d432001, Amount: 5, Reason: Trained horse Log Test Horse in Reining
[2025-12-27 23:20:18] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2347, User c596fcde-2570-4630-b173-69015d432001, Amount: 5
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Awarded 5 XP to user c596fcde-2570-4630-b173-69015d432001 for training
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Successfully trained horse 94298 in Reining (Log ID: 4820, Score +5)
[2025-12-27 23:20:18] info: [POST] /api/training/train - 200
[2025-12-27 23:20:18] info: [POST] /api/training/train
[2025-12-27 23:20:18] warn: [MemoryMonitoring] Memory threshold exceeded: 1029MB
[2025-12-27 23:20:18] info: [auth] Authenticated user d43a96da-896e-4729-a4bf-b9b85b30f0d7 for POST /training/train
[2025-12-27 23:20:18] warn: [ownership] horse 99999 not found or not owned by user d43a96da-896e-4729-a4bf-b9b85b30f0d7
[2025-12-27 23:20:18] info: [POST] /api/training/train - 404
[2025-12-27 23:20:18] info: [POST] /api/training/train
[2025-12-27 23:20:18] warn: [MemoryMonitoring] Memory threshold exceeded: 1027MB
[2025-12-27 23:20:18] info: [auth] Authenticated user d43a96da-896e-4729-a4bf-b9b85b30f0d7 for POST /training/train
[2025-12-27 23:20:18] warn: [trainingRoutes] Validation errors: [{"type":"field","value":"invalid","msg":"Horse ID must be a positive integer","path":"horseId","location":"body"},{"type":"field","value":"","msg":"Discipline is required","path":"discipline","location":"body"},{"type":"field","value":"","msg":"Discipline must be between 1 and 50 characters","path":"discipline","location":"body"}]
[2025-12-27 23:20:18] info: [POST] /api/training/train - 400
[2025-12-27 23:20:18] info: [POST] /api/training/train
[2025-12-27 23:20:18] warn: [MemoryMonitoring] Memory threshold exceeded: 1038MB
[2025-12-27 23:20:18] info: [auth] Authenticated user d43a96da-896e-4729-a4bf-b9b85b30f0d7 for POST /training/train
[2025-12-27 23:20:18] info: [ownership] Found owned horse 94299 for user d43a96da-896e-4729-a4bf-b9b85b30f0d7
[2025-12-27 23:20:18] info: [trainingController.trainRouteHandler] Training request for horse 94299 in Driving
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Attempting to train horse 94299 in Driving
[2025-12-27 23:20:18] info: [trainingController.canTrain] Checking training eligibility for horse 94299 in Driving
[2025-12-27 23:20:18] info: [trainingModel.getHorseAge] Getting age for horse 94299
[2025-12-27 23:20:18] info: [trainingModel.getHorseAge] Horse 94299 is 4 years old
[2025-12-27 23:20:18] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94299 across all disciplines
[2025-12-27 23:20:18] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94299
[2025-12-27 23:20:18] info: [trainingController.canTrain] Horse 94299 is eligible to train in Driving
[2025-12-27 23:20:18] info: [horseModel.getHorseById] Successfully found horse: Date Test Horse (ID: 94299)
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Horse 94299 has traits: 
[2025-12-27 23:20:18] info: [trainingModel.logTrainingSession] Logging training session for horse 94299 in Driving
[2025-12-27 23:20:18] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4821
[2025-12-27 23:20:18] info: [horseModel.incrementDisciplineScore] Incrementing Driving score for horse 94299 by +5
[2025-12-27 23:20:18] info: [horseModel.updateDisciplineScore] Updating Driving score for horse 94299 by +5
[2025-12-27 23:20:18] info: [horseModel.updateDisciplineScore] Successfully updated Driving score for horse 94299: 0 -> 5
[2025-12-27 23:20:18] info: [horseModel.incrementDisciplineScore] Successfully incremented Driving score for horse 94299
[2025-12-27 23:20:18] info: [xpLogModel.logXpEvent] Logging XP event: User c596fcde-2570-4630-b173-69015d432001, Amount: 5, Reason: Trained horse Date Test Horse in Driving
[2025-12-27 23:20:18] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2348, User c596fcde-2570-4630-b173-69015d432001, Amount: 5
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Awarded 5 XP to user c596fcde-2570-4630-b173-69015d432001 for training
[2025-12-27 23:20:18] info: [trainingController.trainHorse] Successfully trained horse 94299 in Driving (Log ID: 4821, Score +5)
[2025-12-27 23:20:18] info: [POST] /api/training/train - 200
PASS tests/training.test.mjs
  üèãÔ∏è INTEGRATION: Training System - Complete Business Logic Validation
    BUSINESS RULE: Age Requirements (3+ years old)
      ‚àö BLOCKS training for horses under 3 years old (91 ms)
      ‚àö ALLOWS training for horses 3+ years old (102 ms)
    BUSINESS RULE: Discipline Score Progression (+5 base)
      ‚àö INCREASES discipline scores by +5 for first-time training (105 ms)
      ‚àö ACCUMULATES discipline scores across multiple training sessions (different horses) (91 ms)
    BUSINESS RULE: Global Cooldown (One Discipline Per Week)
      ‚àö BLOCKS training when horse has trained ANY discipline within 7 days (44 ms)
      ‚àö ALLOWS training after 7-day cooldown expires (90 ms)
    BUSINESS RULE: XP Award for Training
      ‚àö AWARDS XP to horse owner (Player) when training succeeds (90 ms)
    BUSINESS RULE: Training Log Creation
      ‚àö CREATES training log entry for successful training (88 ms)
    BUSINESS RULE: Error Handling and Data Integrity
      ‚àö MAINTAINS database integrity when training non-existent horse (29 ms)
      ‚àö VALIDATES input parameters and rejects invalid requests (27 ms)
    BUSINESS RULE: Next Training Date Calculation
      ‚àö PROVIDES accurate next training date (7 days from training) (90 ms)

[2025-12-27 23:20:18] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:18] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:18] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:19] info: [EmailVerification] Created verification token
[2025-12-27 23:20:19] info: [EmailVerification] Created verification token
[2025-12-27 23:20:19] info: [EmailVerification] Created verification token
[2025-12-27 23:20:19] info: [EmailVerification] Created verification token
[2025-12-27 23:20:19] error: [EmailVerification] Error creating verification token: Maximum pending verification tokens (5) reached
[2025-12-27 23:20:19] info: [EmailVerification] Created verification token
[2025-12-27 23:20:19] error: [EmailVerification] Error creating verification token: Please wait 300 seconds before requesting another verification email
[2025-12-27 23:20:19] info: [EmailVerification] Created verification token
[2025-12-27 23:20:19] info: [EmailVerification] Created verification token
[2025-12-27 23:20:20] info: [EmailVerification] Created verification token
[2025-12-27 23:20:20] info: [EmailVerification] Email verified successfully
[2025-12-27 23:20:20] info: [EmailVerification] Created verification token
[2025-12-27 23:20:20] info: [EmailVerification] Email verified successfully
[2025-12-27 23:20:20] info: [EmailVerification] Created verification token
[2025-12-27 23:20:20] info: [EmailVerification] Email verified successfully
[2025-12-27 23:20:20] info: [EmailVerification] Created verification token
[2025-12-27 23:20:20] info: [EmailVerification] Email verified successfully
[2025-12-27 23:20:20] error: [EmailVerification] Error verifying email token: Verification token has already been used
[2025-12-27 23:20:20] info: [EmailVerification] Created verification token
[2025-12-27 23:20:21] info: [EmailVerification] Created verification token
[2025-12-27 23:20:21] info: [EmailVerification] Email verified successfully
[2025-12-27 23:20:21] info: [EmailVerification] Created verification token
[2025-12-27 23:20:21] info: [EmailVerification] Email verified successfully
[2025-12-27 23:20:21] info: [EmailVerification] Verification status check
[2025-12-27 23:20:21] info: [EmailVerification] Verification status check
[2025-12-27 23:20:21] info: [EmailVerification] Created verification token
[2025-12-27 23:20:21] info: [EmailVerification] Resent verification email
[2025-12-27 23:20:21] info: [EmailVerification] Created verification token
[2025-12-27 23:20:21] info: [EmailVerification] Email verified successfully
[2025-12-27 23:20:21] error: [EmailVerification] Error resending verification email: Email is already verified
[2025-12-27 23:20:21] info: [EmailVerification] Created verification token
[2025-12-27 23:20:21] info: [EmailVerification] Created verification token
[2025-12-27 23:20:21] info: [EmailVerification] Resent verification email
[2025-12-27 23:20:22] info: [EmailVerification] Created verification token
[2025-12-27 23:20:22] info: [EmailVerification] Resent verification email
[2025-12-27 23:20:22] error: [EmailVerification] Error creating verification token: Please wait 300 seconds before requesting another verification email
[2025-12-27 23:20:22] error: [EmailVerification] Error resending verification email: Please wait 300 seconds before requesting another verification email
[2025-12-27 23:20:22] info: [EmailVerification] Created verification token
[2025-12-27 23:20:22] info: [EmailVerification] Token cleanup completed
[2025-12-27 23:20:22] info: [EmailVerification] Created verification token
[2025-12-27 23:20:22] info: [EmailVerification] Email verified successfully
[2025-12-27 23:20:22] info: [EmailVerification] Token cleanup completed
[2025-12-27 23:20:22] info: [EmailVerification] Created verification token
[2025-12-27 23:20:22] info: [EmailVerification] Token cleanup completed
[2025-12-27 23:20:22] info: [EmailVerification] Created verification token
[2025-12-27 23:20:22] info: [EmailVerification] Created verification token
[2025-12-27 23:20:22] info: [EmailVerification] Email verified successfully
[2025-12-27 23:20:22] info: [EmailVerification] Created verification token
PASS __tests__/unit/email-verification.test.mjs
  Email Verification Service - Unit Tests
    generateVerificationToken()
      ‚àö should_generate_unique_tokens (170 ms)
      ‚àö should_generate_64_character_hex_tokens (86 ms)
      ‚àö should_generate_cryptographically_secure_tokens (97 ms)
    createVerificationToken()
      ‚àö should_create_token_with_valid_user_id (101 ms)
      ‚àö should_store_token_in_database (102 ms)
      ‚àö should_set_expiration_to_24_hours (99 ms)
      ‚àö should_store_ip_address_and_user_agent (93 ms)
      ‚àö should_enforce_maximum_pending_tokens_limit (95 ms)
      ‚àö should_enforce_rate_limiting_cooldown (90 ms)
      ‚àö should_allow_token_creation_after_cooldown (96 ms)
    verifyEmailToken()
      ‚àö should_verify_valid_token (97 ms)
      ‚àö should_mark_user_email_as_verified (105 ms)
      ‚àö should_mark_token_as_used (115 ms)
      ‚àö should_reject_invalid_token (188 ms)
      ‚àö should_reject_already_used_token (391 ms)
      ‚àö should_reject_expired_token (127 ms)
      ‚àö should_use_atomic_transaction_for_verification (193 ms)
      ‚àö should_implement_timing_safe_response_for_invalid_tokens (198 ms)
    checkVerificationStatus()
      ‚àö should_return_verification_status_for_verified_user (114 ms)
      ‚àö should_return_verification_status_for_unverified_user (89 ms)
      ‚àö should_handle_non_existent_user (89 ms)
    resendVerificationEmail()
      ‚àö should_create_new_token_for_unverified_user (110 ms)
      ‚àö should_reject_resend_for_verified_user (125 ms)
      ‚àö should_cleanup_expired_tokens_before_creating_new (108 ms)
      ‚àö should_enforce_rate_limiting_on_resend (112 ms)
    cleanupExpiredTokens()
      ‚àö should_delete_expired_tokens (99 ms)
      ‚àö should_delete_old_used_tokens (99 ms)
      ‚àö should_keep_active_valid_tokens (93 ms)
    getTokenInfo()
      ‚àö should_return_token_information (92 ms)
      ‚àö should_indicate_used_token (95 ms)
      ‚àö should_indicate_expired_token (90 ms)
      ‚àö should_return_null_for_invalid_token (79 ms)

[2025-12-27 23:20:22] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:22] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:22] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:23] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:23] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:23] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:23] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:23] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:24] warn: [TokenRotation] Token reuse detected
[2025-12-27 23:20:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:24] warn: [TokenRotation] Token reuse detected
[2025-12-27 23:20:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:24] info: [TokenRotation] Token rotation successful
[2025-12-27 23:20:24] warn: [TokenRotation] Token reuse detected during rotation
[2025-12-27 23:20:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:24] warn: [TokenRotation] Token reuse detected
[2025-12-27 23:20:24] warn: [TokenRotation] Token family invalidated
[2025-12-27 23:20:24] warn: [TokenRotation] Token reuse detected during rotation
[2025-12-27 23:20:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:24] info: [TokenRotation] Token rotation successful
[2025-12-27 23:20:24] warn: [TokenRotation] Token reuse detected
[2025-12-27 23:20:24] warn: [TokenRotation] Token reuse detected
[2025-12-27 23:20:24] warn: [TokenRotation] Token family invalidated
[2025-12-27 23:20:24] warn: [TokenRotation] Token reuse detected during rotation
[2025-12-27 23:20:24] warn: [TokenRotation] Token family invalidated
[2025-12-27 23:20:24] warn: [TokenRotation] Token reuse detected during rotation
[2025-12-27 23:20:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:24] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:24] warn: [TokenRotation] Token family invalidated
[2025-12-27 23:20:25] warn: [TokenRotation] Token family invalidated
[2025-12-27 23:20:25] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:25] warn: [TokenRotation] Token family invalidated
[2025-12-27 23:20:25] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:25] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:20:25] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:20:25] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:20:25] warn: [TokenRotation] Skipping refresh token persistence in test env
[2025-12-27 23:20:25] info: [TokenRotation] Created new token pair
PASS __tests__/unit/token-rotation.test.mjs
  Token Rotation Service - Unit Tests
    generateTokenFamily()
      ‚àö should_create_unique_family_id (150 ms)
      ‚àö should_include_timestamp_in_family_id (89 ms)
    createTokenPair()
      ‚àö should_create_access_and_refresh_token_pair (94 ms)
      ‚àö should_create_refresh_token_with_family_id (90 ms)
      ‚àö should_store_refresh_token_in_database (92 ms)
      ‚àö should_set_correct_expiration_times (90 ms)
    validateRefreshToken()
      ‚àö should_validate_legitimate_refresh_token (92 ms)
      ‚àö should_reject_expired_refresh_token (102 ms)
      ‚àö should_reject_token_with_invalid_signature (84 ms)
      ‚àö should_reject_inactive_token_from_database (94 ms)
      ‚àö should_reject_malformed_token (82 ms)
    detectTokenReuse()
      ‚àö should_detect_reuse_of_invalidated_token (96 ms)
      ‚àö should_not_flag_first_use_as_reuse (88 ms)
      ‚àö should_identify_family_for_invalidation (100 ms)
    rotateRefreshToken()
      ‚àö should_create_new_token_and_invalidate_old (106 ms)
      ‚àö should_fail_rotation_for_invalid_token (82 ms)
      ‚àö should_fail_rotation_if_reuse_detected (100 ms)
      ‚àö should_handle_concurrent_rotation_attempts (166 ms)
    invalidateTokenFamily()
      ‚àö should_invalidate_all_tokens_in_family (117 ms)
      ‚àö should_handle_family_that_does_not_exist (87 ms)
      ‚àö should_log_invalidation_for_security_audit (96 ms)
    cleanupExpiredTokens()
      ‚àö should_remove_expired_tokens_from_database (98 ms)
      ‚àö should_remove_old_invalidated_tokens (91 ms)
      ‚àö should_return_cleanup_statistics (87 ms)
    Error Handling and Edge Cases
      ‚àö should_handle_database_connection_errors (84 ms)
      ‚àö should_handle_jwt_verification_errors_gracefully (81 ms)
      ‚àö should_validate_token_family_id_format (84 ms)

[2025-12-27 23:20:25] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:25] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:25] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:25] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 210
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 8.5%, adjustment: 17.8
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 228 (base: 210, trait: +0, luck: 17.8)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 210
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 5.6%, adjustment: 11.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 222 (base: 210, trait: +0, luck: 11.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 210
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 2.6%, adjustment: 5.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 216 (base: 210, trait: +0, luck: 5.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 210
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -7.6%, adjustment: -16.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 194 (base: 210, trait: +0, luck: -16.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.9%, adjustment: 20.6
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 321 (base: 300, trait: +0, luck: 20.6)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -2.0%, adjustment: -5.9
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 294 (base: 300, trait: +0, luck: -5.9)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.5%, adjustment: 19.6
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 320 (base: 300, trait: +0, luck: 19.6)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -5.0%, adjustment: -15.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 285 (base: 300, trait: +0, luck: -15.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -7.9%, adjustment: -23.6
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 276 (base: 300, trait: +0, luck: -23.6)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.2%, adjustment: 3.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 303 (base: 300, trait: +0, luck: 3.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 4.3%, adjustment: 12.9
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 313 (base: 300, trait: +0, luck: 12.9)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.9%, adjustment: -11.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 288 (base: 300, trait: +0, luck: -11.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -10.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 289 (base: 300, trait: +0, luck: -10.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -7.6%, adjustment: -22.8
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 277 (base: 300, trait: +0, luck: -22.8)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.9%, adjustment: -14.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 285 (base: 300, trait: +0, luck: -14.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 4.1%, adjustment: 12.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 312 (base: 300, trait: +0, luck: 12.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -7.9%, adjustment: -23.8
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 276 (base: 300, trait: +0, luck: -23.8)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.1%, adjustment: -12.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 288 (base: 300, trait: +0, luck: -12.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.7%, adjustment: 2.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 302 (base: 300, trait: +0, luck: 2.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 2.5%, adjustment: 7.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 307 (base: 300, trait: +0, luck: 7.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.4%, adjustment: -10.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 290 (base: 300, trait: +0, luck: -10.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -8.6%, adjustment: -25.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 274 (base: 300, trait: +0, luck: -25.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 8.4%, adjustment: 25.1
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 325 (base: 300, trait: +0, luck: 25.1)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -6.3%, adjustment: -18.9
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 281 (base: 300, trait: +0, luck: -18.9)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.5%, adjustment: 1.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 301 (base: 300, trait: +0, luck: 1.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.6%, adjustment: 4.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 305 (base: 300, trait: +0, luck: 4.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.2%, adjustment: -9.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 290 (base: 300, trait: +0, luck: -9.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -6.2%, adjustment: -18.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 281 (base: 300, trait: +0, luck: -18.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.1%, adjustment: 9.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 309 (base: 300, trait: +0, luck: 9.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.7%, adjustment: -14.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 286 (base: 300, trait: +0, luck: -14.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 5.5%, adjustment: 16.6
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 317 (base: 300, trait: +0, luck: 16.6)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -0.6%, adjustment: -1.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 298 (base: 300, trait: +0, luck: -1.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.2%, adjustment: 9.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 310 (base: 300, trait: +0, luck: 9.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 8.7%, adjustment: 26.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 326 (base: 300, trait: +0, luck: 26.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.8%, adjustment: 2.4
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 302 (base: 300, trait: +0, luck: 2.4)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -0.8%, adjustment: -2.4
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 298 (base: 300, trait: +0, luck: -2.4)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.6%, adjustment: 4.9
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 305 (base: 300, trait: +0, luck: 4.9)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.6%, adjustment: 19.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 320 (base: 300, trait: +0, luck: 19.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -9.0%, adjustment: -26.9
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 273 (base: 300, trait: +0, luck: -26.9)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.3%, adjustment: -9.9
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 290 (base: 300, trait: +0, luck: -9.9)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.1%, adjustment: 9.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 309 (base: 300, trait: +0, luck: 9.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.9%, adjustment: 5.6
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 306 (base: 300, trait: +0, luck: 5.6)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -6.4%, adjustment: -19.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 281 (base: 300, trait: +0, luck: -19.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 7.0%, adjustment: 20.9
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 321 (base: 300, trait: +0, luck: 20.9)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -2.3%, adjustment: -7.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 293 (base: 300, trait: +0, luck: -7.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.1%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 297 (base: 300, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -6.7%, adjustment: -20.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 280 (base: 300, trait: +0, luck: -20.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.0%, adjustment: 8.9
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 309 (base: 300, trait: +0, luck: 8.9)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -8.5%, adjustment: -25.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 274 (base: 300, trait: +0, luck: -25.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -8.0%, adjustment: -24.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 276 (base: 300, trait: +0, luck: -24.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.1%, adjustment: -9.4
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 291 (base: 300, trait: +0, luck: -9.4)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.9%, adjustment: -14.6
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 285 (base: 300, trait: +0, luck: -14.6)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -7.9%, adjustment: -23.8
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 276 (base: 300, trait: +0, luck: -23.8)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 2.3%, adjustment: 6.9
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 307 (base: 300, trait: +0, luck: 6.9)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 80
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 2.0%, adjustment: 1.6
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 82 (base: 80, trait: +0, luck: 1.6)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -8.8%, adjustment: -11.4
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 119 (base: 130, trait: +0, luck: -11.4)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -6.2%, adjustment: -8.1
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 122 (base: 130, trait: +0, luck: -8.1)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.4%, adjustment: -5.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 124 (base: 130, trait: +0, luck: -5.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 7.8%, adjustment: 10.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 140 (base: 130, trait: +0, luck: 10.2)
[2025-12-27 23:20:26] error: [calculateCompetitionScore] Error calculating score for horse undefined: Horse object is required
[2025-12-27 23:20:26] error: [calculateCompetitionScore] Error calculating score for horse undefined: Horse object is required
[2025-12-27 23:20:26] error: [calculateCompetitionScore] Error calculating score for horse undefined: Horse object is required
[2025-12-27 23:20:26] error: [calculateCompetitionScore] Error calculating score for horse Test Horse: Event type is required and must be a string
[2025-12-27 23:20:26] error: [calculateCompetitionScore] Error calculating score for horse Test Horse: Event type is required and must be a string
[2025-12-27 23:20:26] error: [calculateCompetitionScore] Error calculating score for horse Test Horse: Event type is required and must be a string
[2025-12-27 23:20:26] warn: [calculateCompetitionScore] Unknown event type: Unknown Event, using default calculation
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Unknown Event: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.8%, adjustment: 6.9
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 187 (base: 180, trait: +0, luck: 6.9)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.6%, adjustment: 11.9
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +0, luck: 11.9)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 178 (base: 180, trait: +5, luck: -6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.7
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 192 (base: 180, trait: +5, luck: 6.7)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.6%, adjustment: -6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 180, trait: +0, luck: -6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 182 (base: 180, trait: +5, luck: -3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.3
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 188 (base: 180, trait: +5, luck: 3.3)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 6.5
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 180, trait: +0, luck: 6.5)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:26] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Luck modifier: 1.8%, adjustment: 3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse No Modifiers Horse: Final score: 183 (base: 180, trait: +0, luck: 3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.8%, adjustment: -3.2
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 180, trait: +0, luck: -3.2)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -9.0%, adjustment: -27.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 273 (base: 300, trait: +0, luck: -27.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 300
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 9.0%, adjustment: 27.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 327 (base: 300, trait: +0, luck: 27.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 185 (base: 180, trait: +5, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 180
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:20:27] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 180, trait: +0, luck: 0.0)
PASS tests/competitionScore.test.mjs
  üèÜ UNIT: Competition Score Calculation - Scoring Algorithm Validation
    calculateCompetitionScore
      ‚àö should calculate correct base score for Racing discipline (9 ms)
      ‚àö should calculate correct base score for Show Jumping discipline (5 ms)
      ‚àö should calculate correct base score for Dressage discipline (11 ms)
      ‚àö should calculate correct base score for Cross Country discipline (4 ms)
      ‚àö should apply +5 trait bonus for matching discipline affinity (9 ms)
      ‚àö should NOT apply trait bonus for non-matching discipline (10 ms)
      ‚àö should apply ¬±9% random luck modifier (166 ms)
      ‚àö should handle missing stats by defaulting to 0 (3 ms)
      ‚àö should handle missing epigeneticModifiers gracefully (8 ms)
      ‚àö should handle null epigeneticModifiers.positive gracefully (10 ms)
      ‚àö should throw error for invalid horse input (8 ms)
      ‚àö should throw error for invalid event type (5 ms)
      ‚àö should handle unknown event types with default calculation (4 ms)
      ‚àö should return rounded integer scores (3 ms)
    Trait Match Logic - 20 Competition Simulation Tests
      ‚àö should demonstrate trait advantage in Show Jumping competitions (discipline_affinity_show_jumping) (150 ms)
      ‚àö should demonstrate trait advantage in Racing competitions (discipline_affinity_racing) (157 ms)
      ‚àö should demonstrate trait advantage in Dressage competitions (discipline_affinity_dressage) (146 ms)
      ‚àö should demonstrate trait advantage in Cross Country competitions (discipline_affinity_cross_country) (145 ms)
      ‚àö should show no advantage when trait does not match discipline (130 ms)
      ‚àö should handle horse missing epigeneticModifiers without throwing error (207 ms)
    Deterministic Tests with Controlled Randomness
      ‚àö should apply exact +5 bonus with controlled randomness (9 ms)
      ‚àö should handle minimum luck modifier (0) (3 ms)
      ‚àö should handle maximum luck modifier (1) (4 ms)
      ‚àö should demonstrate consistent trait advantage with controlled randomness (76 ms)
      ‚àö should verify trait bonus is applied correctly across all disciplines (36 ms)
      ‚àö should verify no bonus when trait does not match discipline (8 ms)
    getDisciplineStatWeights
      ‚àö should return correct weights for Racing (1 ms)
      ‚àö should return correct weights for Show Jumping (1 ms)
      ‚àö should return default weights for unknown discipline (1 ms)
    validateHorseForCompetition
      ‚àö should return true for valid horse with required stats
      ‚àö should return false for invalid horse input
      ‚àö should return true if horse has at least one required stat
      ‚àö should return false if horse has no valid stats (1 ms)

[2025-12-27 23:20:27] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:27] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:27] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:27] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:27] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:27] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse CrossCountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:20:28] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:20:28] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:20:28] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
PASS tests/competition.test.mjs
  üèÜ UNIT: Competition Trait Match Fairness - Statistical Validation
    ‚àö should demonstrate trait match fairness for Show Jumping competition (210 ms)
    ‚àö should demonstrate trait match fairness for Racing competition (198 ms)
    ‚àö should demonstrate trait match fairness for Dressage competition (247 ms)
    ‚àö should demonstrate trait match fairness for Cross Country competition (249 ms)
    ‚àö should verify trait advantage is consistent across multiple test runs (402 ms)

[2025-12-27 23:20:29] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:29] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:29] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:29] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:30] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:30] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:30] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:30] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:30] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1149MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /
[2025-12-27 23:20:30] info: [groomAssignmentController] Creating assignment: groom 46724 -> horse 94300
[2025-12-27 23:20:30] info: [groomAssignmentService] Created assignment: Assignment Test Groom 1 -> Assignment Test Horse 1
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments - 201
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1153MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /
[2025-12-27 23:20:30] info: [groomAssignmentController] Creating assignment: groom 46724 -> horse 94301
[2025-12-27 23:20:30] info: [groomAssignmentService] Created assignment: Assignment Test Groom 1 -> Assignment Test Horse 2
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments - 201
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1152MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /
[2025-12-27 23:20:30] info: [groomAssignmentController] Creating assignment: groom 46724 -> horse 94300
[2025-12-27 23:20:30] error: [groomAssignmentService] Error creating assignment: Groom is already assigned to this horse
[2025-12-27 23:20:30] error: [groomAssignmentController] Error creating assignment: Groom is already assigned to this horse
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments - 400
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1151MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /
[2025-12-27 23:20:30] warn: [groomAssignmentRoutes] Validation errors: [{"type":"field","msg":"Horse ID must be a positive integer","path":"horseId","location":"body"}]
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments - 400
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1149MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /
[2025-12-27 23:20:30] info: [groomAssignmentController] Creating assignment: groom 46724 -> horse 94302
[2025-12-27 23:20:30] error: [groomAssignmentService] Error creating assignment: You do not own this horse
[2025-12-27 23:20:30] error: [groomAssignmentController] Error creating assignment: You do not own this horse
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments - 400
[2025-12-27 23:20:30] info: [GET] /api/groom-assignments
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1150MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /
[2025-12-27 23:20:30] info: [groomAssignmentController] Getting assignments for user 594aaef5-5478-47eb-9536-64ce6bdcb5b9
[2025-12-27 23:20:30] info: [GET] /api/groom-assignments - 200
[2025-12-27 23:20:30] info: [GET] /api/groom-assignments?groomId=46724
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1151MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /
[2025-12-27 23:20:30] info: [groomAssignmentController] Getting assignments for user 594aaef5-5478-47eb-9536-64ce6bdcb5b9
[2025-12-27 23:20:30] info: [GET] /api/groom-assignments?groomId=46724 - 200
[2025-12-27 23:20:30] info: [GET] /api/groom-assignments/dashboard
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1151MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /groom-assignments/dashboard
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /dashboard
[2025-12-27 23:20:30] info: [groomAssignmentController] Getting assignment dashboard for user 594aaef5-5478-47eb-9536-64ce6bdcb5b9
[2025-12-27 23:20:30] info: [GET] /api/groom-assignments/dashboard - 200
[2025-12-27 23:20:30] info: [GET] /api/groom-assignments/groom/46724/limits
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1152MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /groom-assignments/groom/46724/limits
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /groom/46724/limits
[2025-12-27 23:20:30] info: [ownership] Validated ownership: user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 owns groom 46724
[2025-12-27 23:20:30] info: [groomAssignmentController] Getting limits for groom 46724
[2025-12-27 23:20:30] info: [GET] /api/groom-assignments/groom/46724/limits - 200
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1154MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /
[2025-12-27 23:20:30] info: [groomAssignmentController] Creating assignment: groom 46724 -> horse 94303
[2025-12-27 23:20:30] info: [groomAssignmentService] Created assignment: Assignment Test Groom 1 -> Limit Test Horse 1
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments - 201
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1153MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /
[2025-12-27 23:20:30] info: [groomAssignmentController] Creating assignment: groom 46724 -> horse 94304
[2025-12-27 23:20:30] error: [groomAssignmentService] Error creating assignment: Groom Assignment Test Groom 1 has reached maximum assignments (3)
[2025-12-27 23:20:30] error: [groomAssignmentController] Error creating assignment: Groom Assignment Test Groom 1 has reached maximum assignments (3)
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments - 400
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1151MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /
[2025-12-27 23:20:30] info: [groomAssignmentController] Creating assignment: groom 46724 -> horse 94305
[2025-12-27 23:20:30] error: [groomAssignmentService] Error creating assignment: Groom Assignment Test Groom 1 has reached maximum assignments (3)
[2025-12-27 23:20:30] error: [groomAssignmentController] Error creating assignment: Groom Assignment Test Groom 1 has reached maximum assignments (3)
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments - 400
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1151MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /
[2025-12-27 23:20:30] info: [groomAssignmentController] Creating assignment: groom 46724 -> horse 94306
[2025-12-27 23:20:30] error: [groomAssignmentService] Error creating assignment: Groom Assignment Test Groom 1 has reached maximum assignments (3)
[2025-12-27 23:20:30] error: [groomAssignmentController] Error creating assignment: Groom Assignment Test Groom 1 has reached maximum assignments (3)
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments - 400
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1151MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /
[2025-12-27 23:20:30] info: [groomAssignmentController] Creating assignment: groom 46724 -> horse 94307
[2025-12-27 23:20:30] error: [groomAssignmentService] Error creating assignment: Groom Assignment Test Groom 1 has reached maximum assignments (3)
[2025-12-27 23:20:30] error: [groomAssignmentController] Error creating assignment: Groom Assignment Test Groom 1 has reached maximum assignments (3)
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments - 400
[2025-12-27 23:20:30] info: [GET] /api/groom-assignments/salary-costs
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1154MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /groom-assignments/salary-costs
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /salary-costs
[2025-12-27 23:20:30] info: [groomAssignmentController] Calculating salary costs for user 594aaef5-5478-47eb-9536-64ce6bdcb5b9
[2025-12-27 23:20:30] info: [GET] /api/groom-assignments/salary-costs - 200
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments/validate
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1153MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /groom-assignments/validate
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for POST /validate
[2025-12-27 23:20:30] info: [groomAssignmentController] Validating assignment: groom 46725 -> horse 94300
[2025-12-27 23:20:30] info: [POST] /api/groom-assignments/validate - 200
[2025-12-27 23:20:30] info: [GET] /api/groom-assignments
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1152MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /groom-assignments
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /
[2025-12-27 23:20:30] info: [groomAssignmentController] Getting assignments for user 594aaef5-5478-47eb-9536-64ce6bdcb5b9
[2025-12-27 23:20:30] info: [GET] /api/groom-assignments - 200
[2025-12-27 23:20:30] info: [DELETE] /api/groom-assignments/6426
[2025-12-27 23:20:30] warn: [MemoryMonitoring] Memory threshold exceeded: 1153MB
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for DELETE /groom-assignments/6426
[2025-12-27 23:20:30] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for DELETE /6426
[2025-12-27 23:20:31] info: [ownership] Validated ownership: user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 owns groom-assignment 6426
[2025-12-27 23:20:31] info: [groomAssignmentController] Removing assignment 6426
[2025-12-27 23:20:31] info: [groomAssignmentService] Removed assignment: Assignment Test Groom 1 -> Assignment Test Horse 1
[2025-12-27 23:20:31] info: [DELETE] /api/groom-assignments/6426 - 200
[2025-12-27 23:20:31] info: [DELETE] /api/groom-assignments/99999
[2025-12-27 23:20:31] warn: [MemoryMonitoring] Memory threshold exceeded: 1154MB
[2025-12-27 23:20:31] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for DELETE /groom-assignments/99999
[2025-12-27 23:20:31] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for DELETE /99999
[2025-12-27 23:20:31] warn: [ownership] groom-assignment 99999 not found or not owned by user 594aaef5-5478-47eb-9536-64ce6bdcb5b9
[2025-12-27 23:20:31] info: [DELETE] /api/groom-assignments/99999 - 404
[2025-12-27 23:20:31] info: [GET] /api/groom-assignments/config
[2025-12-27 23:20:31] warn: [MemoryMonitoring] Memory threshold exceeded: 1152MB
[2025-12-27 23:20:31] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /groom-assignments/config
[2025-12-27 23:20:31] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /config
[2025-12-27 23:20:31] info: [GET] /api/groom-assignments/config - 200
[2025-12-27 23:20:31] info: [GET] /api/groom-assignments/statistics
[2025-12-27 23:20:31] warn: [MemoryMonitoring] Memory threshold exceeded: 1149MB
[2025-12-27 23:20:31] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /groom-assignments/statistics
[2025-12-27 23:20:31] info: [auth] Authenticated user 594aaef5-5478-47eb-9536-64ce6bdcb5b9 for GET /statistics
[2025-12-27 23:20:31] info: [groomAssignmentRoutes] Getting assignment statistics for user 594aaef5-5478-47eb-9536-64ce6bdcb5b9
[2025-12-27 23:20:31] info: [GET] /api/groom-assignments/statistics - 200
[2025-12-27 23:20:31] info: [GET] /api/groom-assignments
[2025-12-27 23:20:31] warn: [MemoryMonitoring] Memory threshold exceeded: 1148MB
[2025-12-27 23:20:31] warn: [auth] Access token is required for GET /groom-assignments from ::ffff:127.0.0.1
[2025-12-27 23:20:31] info: [GET] /api/groom-assignments - 401
[2025-12-27 23:20:31] info: [POST] /api/groom-assignments
[2025-12-27 23:20:31] warn: [MemoryMonitoring] Memory threshold exceeded: 1159MB
[2025-12-27 23:20:31] warn: [auth] Access token is required for POST /groom-assignments from ::ffff:127.0.0.1
[2025-12-27 23:20:31] info: [POST] /api/groom-assignments - 401
[2025-12-27 23:20:31] info: [GET] /api/groom-assignments/dashboard
[2025-12-27 23:20:31] warn: [MemoryMonitoring] Memory threshold exceeded: 1154MB
[2025-12-27 23:20:31] warn: [auth] Access token is required for GET /groom-assignments/dashboard from ::ffff:127.0.0.1
[2025-12-27 23:20:31] info: [GET] /api/groom-assignments/dashboard - 401
[2025-12-27 23:20:31] info: [GET] /api/groom-assignments/salary-costs
[2025-12-27 23:20:31] warn: [MemoryMonitoring] Memory threshold exceeded: 1150MB
[2025-12-27 23:20:31] warn: [auth] Access token is required for GET /groom-assignments/salary-costs from ::ffff:127.0.0.1
[2025-12-27 23:20:31] info: [GET] /api/groom-assignments/salary-costs - 401
PASS tests/integration/groomAssignmentSystem.test.mjs
  Enhanced Groom Assignment System Integration Tests
    1. Assignment Creation
      ‚àö should create a new groom assignment (132 ms)
      ‚àö should create multiple assignments for different horses (49 ms)
      ‚àö should prevent duplicate assignments (41 ms)
      ‚àö should validate required fields (41 ms)
      ‚àö should prevent assignment to non-owned horses (68 ms)
    2. Assignment Retrieval
      ‚àö should get all assignments for user (46 ms)
      ‚àö should filter assignments by groom (39 ms)
      ‚àö should get assignment dashboard (44 ms)
    3. Assignment Limits
      ‚àö should get groom assignment limits (40 ms)
      ‚àö should enforce assignment limits (217 ms)
    4. Salary Calculations
      ‚àö should calculate weekly salary costs (31 ms)
    5. Assignment Validation
      ‚àö should validate assignment eligibility (34 ms)
    6. Assignment Removal
      ‚àö should remove an assignment (85 ms)
      ‚àö should validate assignment ownership for removal (41 ms)
    7. Configuration and Statistics
      ‚àö should get assignment configuration (35 ms)
      ‚àö should get assignment statistics (98 ms)
    8. Authentication and Authorization
      ‚àö should require authentication for all endpoints (108 ms)

[2025-12-27 23:20:31] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:31] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:31] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:32] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:32] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:32] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:32] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:32] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:32] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:32] info: [GET] /api/epigenetic-traits/definitions
[2025-12-27 23:20:32] warn: [MemoryMonitoring] Memory threshold exceeded: 1194MB
[2025-12-27 23:20:32] info: [GET] /api/epigenetic-traits/definitions - 200
[2025-12-27 23:20:32] info: [POST] /api/epigenetic-traits/evaluate-milestone/94308
[2025-12-27 23:20:32] warn: [MemoryMonitoring] Memory threshold exceeded: 1199MB
[2025-12-27 23:20:32] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for POST /epigenetic-traits/evaluate-milestone/94308
[2025-12-27 23:20:32] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for POST /evaluate-milestone/94308
[2025-12-27 23:20:32] info: [ownership] Validated ownership: user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 owns horse 94308
[2025-12-27 23:20:33] info: [ultraRareTriggerEngine] Evaluating ultra-rare triggers for horse 94308
[2025-12-27 23:20:33] info: [ultraRareTriggerEngine] Evaluating exotic unlocks for horse 94308
[2025-12-27 23:20:33] error: [ultraRareTriggerEngine] Error evaluating Soulbonded conditions: Cannot read properties of undefined (reading 'map')
[2025-12-27 23:20:33] info: [POST] /api/epigenetic-traits/evaluate-milestone/94308 - 200
[2025-12-27 23:20:33] info: [POST] /api/epigenetic-traits/log-trait
[2025-12-27 23:20:33] warn: [MemoryMonitoring] Memory threshold exceeded: 1202MB
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for POST /epigenetic-traits/log-trait
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for POST /log-trait
[2025-12-27 23:20:33] info: [ownership] Found owned horse 94308 for user db11fa8c-40b0-42e2-ba40-7d9d7798bf88
[2025-12-27 23:20:33] info: [POST] /api/epigenetic-traits/log-trait - 201
[2025-12-27 23:20:33] info: [GET] /api/epigenetic-traits/history/94308?limit=10&isEpigenetic=true
[2025-12-27 23:20:33] warn: [MemoryMonitoring] Memory threshold exceeded: 1201MB
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for GET /epigenetic-traits/history/94308
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for GET /history/94308
[2025-12-27 23:20:33] info: [ownership] Validated ownership: user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 owns horse 94308
[2025-12-27 23:20:33] info: [GET] /api/epigenetic-traits/history/94308?limit=10&isEpigenetic=true - 200
[2025-12-27 23:20:33] info: [GET] /api/epigenetic-traits/summary/94308
[2025-12-27 23:20:33] warn: [MemoryMonitoring] Memory threshold exceeded: 1200MB
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for GET /epigenetic-traits/summary/94308
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for GET /summary/94308
[2025-12-27 23:20:33] info: [ownership] Validated ownership: user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 owns horse 94308
[2025-12-27 23:20:33] info: [GET] /api/epigenetic-traits/summary/94308 - 200
[2025-12-27 23:20:33] info: [GET] /api/epigenetic-traits/breeding-insights/94308
[2025-12-27 23:20:33] warn: [MemoryMonitoring] Memory threshold exceeded: 1199MB
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for GET /epigenetic-traits/breeding-insights/94308
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for GET /breeding-insights/94308
[2025-12-27 23:20:33] info: [ownership] Validated ownership: user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 owns horse 94308
[2025-12-27 23:20:33] info: [GET] /api/epigenetic-traits/breeding-insights/94308 - 200
[2025-12-27 23:20:33] info: [GET] /api/epigenetic-traits/history/94308
[2025-12-27 23:20:33] warn: [MemoryMonitoring] Memory threshold exceeded: 1198MB
[2025-12-27 23:20:33] warn: [auth] Access token is required for GET /epigenetic-traits/history/94308 from ::ffff:127.0.0.1
[2025-12-27 23:20:33] info: [GET] /api/epigenetic-traits/history/94308 - 401
[2025-12-27 23:20:33] info: [POST] /api/epigenetic-traits/evaluate-milestone/94308
[2025-12-27 23:20:33] warn: [MemoryMonitoring] Memory threshold exceeded: 1194MB
[2025-12-27 23:20:33] warn: [auth] Access token is required for POST /epigenetic-traits/evaluate-milestone/94308 from ::ffff:127.0.0.1
[2025-12-27 23:20:33] info: [POST] /api/epigenetic-traits/evaluate-milestone/94308 - 401
[2025-12-27 23:20:33] info: [GET] /api/epigenetic-traits/history/94308
[2025-12-27 23:20:33] warn: [MemoryMonitoring] Memory threshold exceeded: 1192MB
[2025-12-27 23:20:33] info: [auth] Authenticated user f74a6bdf-6ba7-485b-b7ea-cf73693de505 for GET /epigenetic-traits/history/94308
[2025-12-27 23:20:33] info: [auth] Authenticated user f74a6bdf-6ba7-485b-b7ea-cf73693de505 for GET /history/94308
[2025-12-27 23:20:33] warn: [ownership] horse 94308 not found or not owned by user f74a6bdf-6ba7-485b-b7ea-cf73693de505
[2025-12-27 23:20:33] info: [GET] /api/epigenetic-traits/history/94308 - 404
[2025-12-27 23:20:33] info: [GET] /api/epigenetic-traits/history/invalid
[2025-12-27 23:20:33] warn: [MemoryMonitoring] Memory threshold exceeded: 1193MB
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for GET /epigenetic-traits/history/invalid
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for GET /history/invalid
[2025-12-27 23:20:33] warn: [ownership] Invalid horse ID: invalid
[2025-12-27 23:20:33] info: [GET] /api/epigenetic-traits/history/invalid - 400
[2025-12-27 23:20:33] info: [POST] /api/epigenetic-traits/log-trait
[2025-12-27 23:20:33] warn: [MemoryMonitoring] Memory threshold exceeded: 1204MB
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for POST /epigenetic-traits/log-trait
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for POST /log-trait
[2025-12-27 23:20:33] info: [POST] /api/epigenetic-traits/log-trait - 400
[2025-12-27 23:20:33] info: [POST] /api/epigenetic-traits/evaluate-milestone/94308
[2025-12-27 23:20:33] warn: [MemoryMonitoring] Memory threshold exceeded: 1202MB
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for POST /epigenetic-traits/evaluate-milestone/94308
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for POST /evaluate-milestone/94308
[2025-12-27 23:20:33] info: [ownership] Validated ownership: user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 owns horse 94308
[2025-12-27 23:20:33] info: [ultraRareTriggerEngine] Evaluating ultra-rare triggers for horse 94308
[2025-12-27 23:20:33] info: [ultraRareTriggerEngine] Evaluating exotic unlocks for horse 94308
[2025-12-27 23:20:33] error: [ultraRareTriggerEngine] Error evaluating Soulbonded conditions: Cannot read properties of undefined (reading 'map')
[2025-12-27 23:20:33] info: [POST] /api/epigenetic-traits/evaluate-milestone/94308 - 200
[2025-12-27 23:20:33] info: [POST] /api/epigenetic-traits/evaluate-milestone/94308
[2025-12-27 23:20:33] warn: [MemoryMonitoring] Memory threshold exceeded: 1204MB
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for POST /epigenetic-traits/evaluate-milestone/94308
[2025-12-27 23:20:33] info: [auth] Authenticated user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 for POST /evaluate-milestone/94308
[2025-12-27 23:20:33] info: [ownership] Validated ownership: user db11fa8c-40b0-42e2-ba40-7d9d7798bf88 owns horse 94308
[2025-12-27 23:20:33] info: [ultraRareTriggerEngine] Evaluating ultra-rare triggers for horse 94308
[2025-12-27 23:20:33] info: [ultraRareTriggerEngine] Evaluating exotic unlocks for horse 94308
[2025-12-27 23:20:33] error: [ultraRareTriggerEngine] Error evaluating Soulbonded conditions: Cannot read properties of undefined (reading 'map')
[2025-12-27 23:20:33] info: [POST] /api/epigenetic-traits/evaluate-milestone/94308 - 200
PASS tests/integration/epigeneticTraitSystem.test.mjs
  Epigenetic Trait System Integration Tests
    API Endpoints
      ‚àö GET /api/epigenetic-traits/definitions should return flag and personality definitions (204 ms)
      ‚àö POST /api/epigenetic-traits/evaluate-milestone/:horseId should evaluate enhanced milestone (178 ms)
      ‚àö POST /api/epigenetic-traits/log-trait should log trait assignment (114 ms)
      ‚àö GET /api/epigenetic-traits/history/:horseId should return trait history (46 ms)
      ‚àö GET /api/epigenetic-traits/summary/:horseId should return development summary (52 ms)
      ‚àö GET /api/epigenetic-traits/breeding-insights/:horseId should return breeding insights (52 ms)
      ‚àö Should handle authentication errors properly (64 ms)
      ‚àö Should handle horse ownership validation (49 ms)
      ‚àö Should validate input parameters properly (56 ms)
    Epigenetic Flag System
      ‚àö Should apply epigenetic flags based on care patterns (75 ms)
    Enhanced Milestone Evaluation
      ‚àö Should factor in groom personality bonuses (61 ms)
  Trait History Service
    ‚àö Should log and retrieve trait assignments correctly (11 ms)

[2025-12-27 23:20:34] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:34] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:34] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:34] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:35] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:35] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:35] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:35] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:35] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:35] info: [GET] /api/flags/health
[2025-12-27 23:20:35] warn: [MemoryMonitoring] Memory threshold exceeded: 1238MB
[2025-12-27 23:20:35] info: [GET] /api/flags/health - 200
[2025-12-27 23:20:35] info: [POST] /api/flags/evaluate
[2025-12-27 23:20:35] warn: [MemoryMonitoring] Memory threshold exceeded: 1242MB
[2025-12-27 23:20:35] warn: [auth] Access token is required for POST /flags/evaluate from ::ffff:127.0.0.1
[2025-12-27 23:20:35] info: [POST] /api/flags/evaluate - 401
[2025-12-27 23:20:35] info: [GET] /api/flags/horses/123/flags
[2025-12-27 23:20:35] warn: [MemoryMonitoring] Memory threshold exceeded: 1238MB
[2025-12-27 23:20:35] warn: [auth] Access token is required for GET /flags/horses/123/flags from ::ffff:127.0.0.1
[2025-12-27 23:20:35] info: [GET] /api/flags/horses/123/flags - 401
[2025-12-27 23:20:35] info: [GET] /api/flags/definitions
[2025-12-27 23:20:35] warn: [MemoryMonitoring] Memory threshold exceeded: 1236MB
[2025-12-27 23:20:35] warn: [auth] Access token is required for GET /flags/definitions from ::ffff:127.0.0.1
[2025-12-27 23:20:35] info: [GET] /api/flags/definitions - 401
[2025-12-27 23:20:35] info: [POST] /api/flags/batch-evaluate
[2025-12-27 23:20:35] warn: [MemoryMonitoring] Memory threshold exceeded: 1247MB
[2025-12-27 23:20:35] warn: [auth] Access token is required for POST /flags/batch-evaluate from ::ffff:127.0.0.1
[2025-12-27 23:20:35] info: [POST] /api/flags/batch-evaluate - 401
[2025-12-27 23:20:35] info: [GET] /api/flags/horses/123/care-patterns
[2025-12-27 23:20:35] warn: [MemoryMonitoring] Memory threshold exceeded: 1243MB
[2025-12-27 23:20:35] warn: [auth] Access token is required for GET /flags/horses/123/care-patterns from ::ffff:127.0.0.1
[2025-12-27 23:20:35] info: [GET] /api/flags/horses/123/care-patterns - 401
[2025-12-27 23:20:35] info: [POST] /api/flags/evaluate
[2025-12-27 23:20:35] warn: [MemoryMonitoring] Memory threshold exceeded: 1239MB
[2025-12-27 23:20:35] info: [POST] /api/flags/evaluate - 400
[2025-12-27 23:20:35] info: [GET] /api/flags/horses/123/flags
[2025-12-27 23:20:35] warn: [MemoryMonitoring] Memory threshold exceeded: 1236MB
[2025-12-27 23:20:35] warn: [ownership] horse 123 not found or not owned by user test@example.com
[2025-12-27 23:20:35] info: [GET] /api/flags/horses/123/flags - 404
[2025-12-27 23:20:35] info: [GET] /api/flags/definitions
[2025-12-27 23:20:35] warn: [MemoryMonitoring] Memory threshold exceeded: 1247MB
[2025-12-27 23:20:35] info: [GET] /api/flags/definitions - 200
[2025-12-27 23:20:36] info: [POST] /api/flags/batch-evaluate
[2025-12-27 23:20:36] warn: [MemoryMonitoring] Memory threshold exceeded: 1244MB
[2025-12-27 23:20:36] info: [POST] /api/flags/batch-evaluate - 400
[2025-12-27 23:20:36] info: [GET] /api/flags/horses/123/care-patterns
[2025-12-27 23:20:36] warn: [MemoryMonitoring] Memory threshold exceeded: 1242MB
[2025-12-27 23:20:36] warn: [ownership] horse 123 not found or not owned by user test@example.com
[2025-12-27 23:20:36] info: [GET] /api/flags/horses/123/care-patterns - 404
[2025-12-27 23:20:36] info: [GET] /api/flags/health
[2025-12-27 23:20:36] warn: [MemoryMonitoring] Memory threshold exceeded: 1238MB
[2025-12-27 23:20:36] info: [GET] /api/flags/health - 200
[2025-12-27 23:20:36] info: [GET] /api/flags/health
[2025-12-27 23:20:36] warn: [MemoryMonitoring] Memory threshold exceeded: 1248MB
[2025-12-27 23:20:36] info: [GET] /api/flags/health - 200
[2025-12-27 23:20:36] info: [GET] /api/flags/health
[2025-12-27 23:20:36] warn: [MemoryMonitoring] Memory threshold exceeded: 1244MB
[2025-12-27 23:20:36] info: [GET] /api/flags/health - 200
PASS tests/integration/epigeneticFlagRoutes.test.mjs
  Epigenetic Flag Routes Integration Tests
    Health Check
      ‚àö should return system health status (182 ms)
    Authentication Requirements
      ‚àö should require authentication for flag evaluation (34 ms)
      ‚àö should require authentication for horse flags (23 ms)
      ‚àö should require authentication for flag definitions (38 ms)
      ‚àö should require authentication for batch evaluation (36 ms)
      ‚àö should require authentication for care patterns (36 ms)
    Route Structure
      ‚àö should have all required endpoints mounted (1022 ms)
    System Integration
      ‚àö should have epigenetic flag routes mounted in main app (99 ms)
      ‚àö should handle CORS and security headers (97 ms)

[2025-12-27 23:20:36] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:36] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:36] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:37] info: [MemoryManager] Starting memory and resource monitoring
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /status
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory status
[2025-12-27 23:20:37] warn: [auth] Access token is required for GET /status from ::ffff:127.0.0.1
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /metrics
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory metrics for timeframe: 1h
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /metrics
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory metrics for timeframe: 1h
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /metrics
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory metrics for timeframe: 6h
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /metrics
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory metrics for timeframe: 24h
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /metrics
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory metrics for timeframe: 7d
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /metrics
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory metrics for timeframe: 1h
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /metrics
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /resources
[2025-12-27 23:20:37] info: [MemoryManagement] Getting resource analytics
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for POST /gc
[2025-12-27 23:20:37] info: [MemoryManagement] Manual GC trigger requested (force: false)
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for POST /gc
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for POST /cleanup
[2025-12-27 23:20:37] info: [MemoryManagement] Resource cleanup requested for: all
[2025-12-27 23:20:37] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:20:37] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for POST /cleanup
[2025-12-27 23:20:37] info: [MemoryManagement] Resource cleanup requested for: timers, intervals
[2025-12-27 23:20:37] warn: [MemoryManagement] Selective cleanup not yet implemented
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for POST /cleanup
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /alerts
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory alerts
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /alerts
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory alerts
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /alerts
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory alerts
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /alerts
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory alerts
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /alerts
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory alerts
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /alerts
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /alerts
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /health
[2025-12-27 23:20:37] info: [MemoryManagement] Getting system health assessment
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /health
[2025-12-27 23:20:37] info: [MemoryManagement] Getting system health assessment
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /health
[2025-12-27 23:20:37] info: [MemoryManagement] Getting system health assessment
[2025-12-27 23:20:37] warn: [auth] Invalid or expired token for GET /status from ::ffff:127.0.0.1
[2025-12-27 23:20:37] warn: [auth] Access token is required for GET /status from ::ffff:127.0.0.1
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /metrics
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory metrics for timeframe: 1h
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /resources
[2025-12-27 23:20:37] info: [MemoryManagement] Getting resource analytics
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /health
[2025-12-27 23:20:37] info: [MemoryManagement] Getting system health assessment
[2025-12-27 23:20:37] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /status
[2025-12-27 23:20:37] info: [MemoryManagement] Getting memory status
[2025-12-27 23:20:38] warn: [MemoryManager] Memory threshold alert: 1272MB used
[2025-12-27 23:20:39] warn: [MemoryManager] Memory threshold alert: 1273MB used
[2025-12-27 23:20:39] info: [auth] Authenticated user feca24d5-72e3-495f-8084-0f9fc512143d for GET /metrics
[2025-12-27 23:20:39] info: [MemoryManagement] Getting memory metrics for timeframe: 1h
[2025-12-27 23:20:39] info: [MemoryManager] Stopping memory and resource monitoring
[2025-12-27 23:20:39] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:20:39] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
PASS __tests__/routes/memoryManagementRoutes.test.mjs
  Memory Management Routes
    GET /api/memory/status
      ‚àö retrieves memory status successfully (35 ms)
      ‚àö requires authentication (16 ms)
    GET /api/memory/metrics
      ‚àö retrieves memory metrics with default timeframe (24 ms)
      ‚àö accepts different timeframe parameters (69 ms)
      ‚àö includes GC data when requested (22 ms)
      ‚àö validates timeframe parameter (15 ms)
    GET /api/memory/resources
      ‚àö retrieves resource analytics successfully (25 ms)
    POST /api/memory/gc
      ‚àö triggers garbage collection when available
      ‚àö handles GC unavailability gracefully (25 ms)
      ‚àö validates request body (19 ms)
    POST /api/memory/cleanup
      ‚àö performs resource cleanup successfully (18 ms)
      ‚àö handles selective cleanup request (19 ms)
      ‚àö validates resource types parameter (15 ms)
    GET /api/memory/alerts
      ‚àö retrieves memory alerts successfully (16 ms)
      ‚àö filters alerts by severity (55 ms)
      ‚àö limits alert results (19 ms)
      ‚àö validates severity parameter (16 ms)
      ‚àö validates limit parameter (18 ms)
    GET /api/memory/health
      ‚àö retrieves system health assessment successfully (19 ms)
      ‚àö provides memory utilization status (21 ms)
      ‚àö provides resource efficiency metrics (17 ms)
    Error Handling
      ‚àö handles invalid authentication tokens (17 ms)
      ‚àö handles missing authorization header (14 ms)
    Performance Validation
      ‚àö memory metrics show realistic values (22 ms)
      ‚àö resource analytics show meaningful data (20 ms)
      ‚àö health assessment provides actionable insights (21 ms)
    Real-time Monitoring Integration
      ‚àö status endpoint reflects current monitoring state (19 ms)
      ‚àö metrics endpoint provides recent data (1528 ms)

[2025-12-27 23:20:39] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:39] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:39] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:40] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:40] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:40] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:40] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:40] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:40] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateInheritanceProbabilities] Calculating inheritance for stallion 94310 and mare 94311
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateInheritanceProbabilities] Calculated 6 trait probabilities
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateFlagInheritanceScore] Calculating flag inheritance for stallion 94312 and mare 94313
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateInheritanceProbabilities] Calculating inheritance for stallion 94312 and mare 94313
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateInheritanceProbabilities] Calculated 2 trait probabilities
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateFlagInheritanceScore] Calculated flag inheritance score: 13.3
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateInheritanceProbabilities] Calculating inheritance for stallion 94314 and mare 94315
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateInheritanceProbabilities] Calculated 0 trait probabilities
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateTemperamentInfluence] Calculating temperament influence for stallion 94316 and mare 94317
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateTemperamentInfluence] Calculated temperament compatibility: 70
[2025-12-27 23:20:40] info: [breedingPredictionService.predictOffspringTraits] Predicting offspring traits for stallion 94318 and mare 94319
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateInheritanceProbabilities] Calculating inheritance for stallion 94318 and mare 94319
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateInheritanceProbabilities] Calculated 4 trait probabilities
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateFlagInheritanceScore] Calculating flag inheritance for stallion 94318 and mare 94319
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateInheritanceProbabilities] Calculating inheritance for stallion 94318 and mare 94319
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateInheritanceProbabilities] Calculated 4 trait probabilities
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateFlagInheritanceScore] Calculated flag inheritance score: 26.7
[2025-12-27 23:20:40] info: [breedingPredictionService.predictOffspringTraits] Predicted 2 traits with medium confidence
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateInheritanceProbabilities] Calculating inheritance for stallion 94320 and mare 94321
[2025-12-27 23:20:40] info: [breedingPredictionService.calculateInheritanceProbabilities] Calculated 2 trait probabilities
[2025-12-27 23:20:40] info: [GET] /api/horses/94322/breeding-data
[2025-12-27 23:20:40] warn: [MemoryMonitoring] Memory threshold exceeded: 1309MB
[2025-12-27 23:20:40] info: [auth] Authenticated user 2f73c41d-64d4-4cce-ac96-16b3a2119032 for GET /horses/94322/breeding-data
[2025-12-27 23:20:40] info: [ownership] Validated ownership: user 2f73c41d-64d4-4cce-ac96-16b3a2119032 owns horse 94322
[2025-12-27 23:20:40] info: [breedingPredictionService.generateBreedingData] Generating breeding data for horse 94322
[2025-12-27 23:20:40] info: [breedingPredictionService.generateBreedingData] Generated breeding data for horse 94322 with 1 traits
[2025-12-27 23:20:40] info: [GET] /api/horses/94322/breeding-data - 200
[2025-12-27 23:20:40] info: [GET] /api/horses/94324/breeding-data
[2025-12-27 23:20:40] warn: [MemoryMonitoring] Memory threshold exceeded: 1313MB
[2025-12-27 23:20:40] warn: [auth] Access token is required for GET /horses/94324/breeding-data from ::ffff:127.0.0.1
[2025-12-27 23:20:40] info: [GET] /api/horses/94324/breeding-data - 401
[2025-12-27 23:20:40] info: [GET] /api/horses/94326/breeding-data
[2025-12-27 23:20:40] warn: [MemoryMonitoring] Memory threshold exceeded: 1313MB
[2025-12-27 23:20:40] info: [auth] Authenticated user a2eb2481-a8a6-4c9c-b693-a4d3ca657a10 for GET /horses/94326/breeding-data
[2025-12-27 23:20:40] info: [ownership] Validated ownership: user a2eb2481-a8a6-4c9c-b693-a4d3ca657a10 owns horse 94326
[2025-12-27 23:20:40] info: [breedingPredictionService.generateBreedingData] Generating breeding data for horse 94326
[2025-12-27 23:20:40] info: [breedingPredictionService.generateBreedingData] Generated breeding data for horse 94326 with 0 traits
[2025-12-27 23:20:40] info: [GET] /api/horses/94326/breeding-data - 200
PASS tests/breedingPrediction.test.mjs
  Breeding Prediction System
    Inheritance Probability Logic
      ‚àö should calculate trait inheritance probabilities from parent history (132 ms)
      ‚àö should calculate flag inheritance scores (42 ms)
      ‚àö should handle horses with no trait history (35 ms)
      ‚àö should calculate temperament influence modifiers (37 ms)
    Child Prediction Algorithms
      ‚àö should predict trait categories with probability ranges (53 ms)
      ‚àö should handle epigenetic flag inheritance with stacking limits (35 ms)
    API Extension
      ‚àö should extend breeding-data endpoint with prediction data (81 ms)
      ‚àö should require authentication for breeding-data endpoint (51 ms)
      ‚àö should handle horses with minimal breeding data (69 ms)

[2025-12-27 23:20:41] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:41] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:41] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:41] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:41] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:41] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:41] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:41] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:41] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:42] info: [GET] /api/users/793809d9-7817-4e8e-885f-7bd5653be3b1/progress
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1349MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /users/793809d9-7817-4e8e-885f-7bd5653be3b1/progress
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /793809d9-7817-4e8e-885f-7bd5653be3b1/progress
[2025-12-27 23:20:42] info: [userRoutes] Self-access validated: user 793809d9-7817-4e8e-885f-7bd5653be3b1 accessing own data
[2025-12-27 23:20:42] info: [userController.getUserProgressAPI] Getting comprehensive progress for user 793809d9-7817-4e8e-885f-7bd5653be3b1
[2025-12-27 23:20:42] info: [userController.getUserProgressAPI] Successfully retrieved progress for user userroutes_1766895641935 (Level 2, XP: 100/300, -100% progress)
[2025-12-27 23:20:42] info: [GET] /api/users/793809d9-7817-4e8e-885f-7bd5653be3b1/progress - 200
[2025-12-27 23:20:42] info: [GET] /api/users/550e8400-e29b-41d4-a716-446655440999/progress
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1349MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /users/550e8400-e29b-41d4-a716-446655440999/progress
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /550e8400-e29b-41d4-a716-446655440999/progress
[2025-12-27 23:20:42] warn: [userRoutes] Self-access violation: user 793809d9-7817-4e8e-885f-7bd5653be3b1 attempted to access user 550e8400-e29b-41d4-a716-446655440999
[2025-12-27 23:20:42] info: [GET] /api/users/550e8400-e29b-41d4-a716-446655440999/progress - 403
[2025-12-27 23:20:42] info: [GET] /api/users//progress
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1361MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /users//progress
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /progress
[2025-12-27 23:20:42] warn: [userRoutes] Validation errors for /:id: [{"type":"field","value":"progress","msg":"User ID must be a valid UUID","path":"id","location":"params"}]
[2025-12-27 23:20:42] info: [GET] /api/users//progress - 400
[2025-12-27 23:20:42] info: [GET] /api/users/a/progress
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1358MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /users/a/progress
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /a/progress
[2025-12-27 23:20:42] warn: [userRoutes] Validation errors for /:id: [{"type":"field","value":"a","msg":"User ID must be a valid UUID","path":"id","location":"params"}]
[2025-12-27 23:20:42] info: [GET] /api/users/a/progress - 400
[2025-12-27 23:20:42] info: [GET] /api/users/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/progress
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1355MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /users/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/progress
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/progress
[2025-12-27 23:20:42] warn: [userRoutes] Validation errors for /:id: [{"type":"field","value":"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa","msg":"User ID must be a valid UUID","path":"id","location":"params"}]
[2025-12-27 23:20:42] info: [GET] /api/users/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/progress - 400
[2025-12-27 23:20:42] info: [GET] /api/users/550e8400-e29b-41d4-a716-446655440998/progress
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1353MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /users/550e8400-e29b-41d4-a716-446655440998/progress
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /550e8400-e29b-41d4-a716-446655440998/progress
[2025-12-27 23:20:42] warn: [userRoutes] Self-access violation: user 793809d9-7817-4e8e-885f-7bd5653be3b1 attempted to access user 550e8400-e29b-41d4-a716-446655440998
[2025-12-27 23:20:42] info: [GET] /api/users/550e8400-e29b-41d4-a716-446655440998/progress - 403
[2025-12-27 23:20:42] info: [GET] /api/users/793809d9-7817-4e8e-885f-7bd5653be3b1/progress
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1350MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /users/793809d9-7817-4e8e-885f-7bd5653be3b1/progress
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /793809d9-7817-4e8e-885f-7bd5653be3b1/progress
[2025-12-27 23:20:42] info: [userRoutes] Self-access validated: user 793809d9-7817-4e8e-885f-7bd5653be3b1 accessing own data
[2025-12-27 23:20:42] info: [userController.getUserProgressAPI] Getting comprehensive progress for user 793809d9-7817-4e8e-885f-7bd5653be3b1
[2025-12-27 23:20:42] info: [userController.getUserProgressAPI] Successfully retrieved progress for user userroutes_1766895641935 (Level 2, XP: 100/300, -100% progress)
[2025-12-27 23:20:42] info: [GET] /api/users/793809d9-7817-4e8e-885f-7bd5653be3b1/progress - 200
[2025-12-27 23:20:42] info: [GET] /api/users/793809d9-7817-4e8e-885f-7bd5653be3b1/progress
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1351MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /users/793809d9-7817-4e8e-885f-7bd5653be3b1/progress
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /793809d9-7817-4e8e-885f-7bd5653be3b1/progress
[2025-12-27 23:20:42] info: [userRoutes] Self-access validated: user 793809d9-7817-4e8e-885f-7bd5653be3b1 accessing own data
[2025-12-27 23:20:42] info: [userController.getUserProgressAPI] Getting comprehensive progress for user 793809d9-7817-4e8e-885f-7bd5653be3b1
[2025-12-27 23:20:42] info: [userController.getUserProgressAPI] Successfully retrieved progress for user userroutes_1766895641935 (Level 2, XP: 100/300, -100% progress)
[2025-12-27 23:20:42] info: [GET] /api/users/793809d9-7817-4e8e-885f-7bd5653be3b1/progress - 200
[2025-12-27 23:20:42] info: [GET] /api/users/user-123_test/progress
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1351MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /users/user-123_test/progress
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /user-123_test/progress
[2025-12-27 23:20:42] warn: [userRoutes] Validation errors for /:id: [{"type":"field","value":"user-123_test","msg":"User ID must be a valid UUID","path":"id","location":"params"}]
[2025-12-27 23:20:42] info: [GET] /api/users/user-123_test/progress - 400
[2025-12-27 23:20:42] info: [GET] /api/users/67ae44e5-146f-494c-b27f-366808959e7e
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1363MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 67ae44e5-146f-494c-b27f-366808959e7e for GET /users/67ae44e5-146f-494c-b27f-366808959e7e
[2025-12-27 23:20:42] info: [auth] Authenticated user 67ae44e5-146f-494c-b27f-366808959e7e for GET /67ae44e5-146f-494c-b27f-366808959e7e
[2025-12-27 23:20:42] info: [userRoutes] Self-access validated: user 67ae44e5-146f-494c-b27f-366808959e7e accessing own data
[2025-12-27 23:20:42] info: [userController.getUser] Getting user 67ae44e5-146f-494c-b27f-366808959e7e
[2025-12-27 23:20:42] info: [GET] /api/users/67ae44e5-146f-494c-b27f-366808959e7e - 200
[2025-12-27 23:20:42] info: [GET] /api/users/550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1362MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /users/550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for GET /550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] warn: [userRoutes] Self-access violation: user 793809d9-7817-4e8e-885f-7bd5653be3b1 attempted to access user 550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] info: [GET] /api/users/550e8400-e29b-41d4-a716-446655440001 - 403
[2025-12-27 23:20:42] info: [POST] /api/users
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1360MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for POST /users
[2025-12-27 23:20:42] info: [userController.createUser] Creating user NewUser_1766895642366
[2025-12-27 23:20:42] info: [createUser] User created: NewUser_1766895642366
[2025-12-27 23:20:42] info: [POST] /api/users - 201
[2025-12-27 23:20:42] info: [POST] /api/users
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1358MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for POST /users
[2025-12-27 23:20:42] info: [POST] /api/users - 400
[2025-12-27 23:20:42] info: [PUT] /api/users/67ae44e5-146f-494c-b27f-366808959e7e
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1353MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 67ae44e5-146f-494c-b27f-366808959e7e for PUT /users/67ae44e5-146f-494c-b27f-366808959e7e
[2025-12-27 23:20:42] info: [auth] Authenticated user 67ae44e5-146f-494c-b27f-366808959e7e for PUT /67ae44e5-146f-494c-b27f-366808959e7e
[2025-12-27 23:20:42] info: [userRoutes] Self-access validated: user 67ae44e5-146f-494c-b27f-366808959e7e accessing own data
[2025-12-27 23:20:42] info: [userController.updateUser] Updating user 67ae44e5-146f-494c-b27f-366808959e7e
[2025-12-27 23:20:42] info: [PUT] /api/users/67ae44e5-146f-494c-b27f-366808959e7e - 200
[2025-12-27 23:20:42] info: [PUT] /api/users/550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1353MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for PUT /users/550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for PUT /550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] warn: [userRoutes] Self-access violation: user 793809d9-7817-4e8e-885f-7bd5653be3b1 attempted to access user 550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] info: [PUT] /api/users/550e8400-e29b-41d4-a716-446655440001 - 403
[2025-12-27 23:20:42] info: [DELETE] /api/users/b5cd31b0-d248-4308-80d7-332c23323a80
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1365MB
[2025-12-27 23:20:42] info: [auth] Authenticated user b5cd31b0-d248-4308-80d7-332c23323a80 for DELETE /users/b5cd31b0-d248-4308-80d7-332c23323a80
[2025-12-27 23:20:42] info: [auth] Authenticated user b5cd31b0-d248-4308-80d7-332c23323a80 for DELETE /b5cd31b0-d248-4308-80d7-332c23323a80
[2025-12-27 23:20:42] info: [userRoutes] Self-access validated: user b5cd31b0-d248-4308-80d7-332c23323a80 accessing own data
[2025-12-27 23:20:42] info: [userController.deleteUser] Deleting user b5cd31b0-d248-4308-80d7-332c23323a80
[2025-12-27 23:20:42] info: [DELETE] /api/users/b5cd31b0-d248-4308-80d7-332c23323a80 - 200
[2025-12-27 23:20:42] info: [DELETE] /api/users/550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1363MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for DELETE /users/550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for DELETE /550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] warn: [userRoutes] Self-access violation: user 793809d9-7817-4e8e-885f-7bd5653be3b1 attempted to access user 550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] info: [DELETE] /api/users/550e8400-e29b-41d4-a716-446655440001 - 403
[2025-12-27 23:20:42] info: [POST] /api/users/793809d9-7817-4e8e-885f-7bd5653be3b1/add-xp
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1360MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for POST /users/793809d9-7817-4e8e-885f-7bd5653be3b1/add-xp
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for POST /793809d9-7817-4e8e-885f-7bd5653be3b1/add-xp
[2025-12-27 23:20:42] info: [userRoutes] Self-access validated: user 793809d9-7817-4e8e-885f-7bd5653be3b1 accessing own data
[2025-12-27 23:20:42] info: [userController.addXp] Adding 50 XP to user 793809d9-7817-4e8e-885f-7bd5653be3b1
[2025-12-27 23:20:42] info: [POST] /api/users/793809d9-7817-4e8e-885f-7bd5653be3b1/add-xp - 200
[2025-12-27 23:20:42] info: [POST] /api/users/550e8400-e29b-41d4-a716-446655440001/add-xp
[2025-12-27 23:20:42] warn: [MemoryMonitoring] Memory threshold exceeded: 1359MB
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for POST /users/550e8400-e29b-41d4-a716-446655440001/add-xp
[2025-12-27 23:20:42] info: [auth] Authenticated user 793809d9-7817-4e8e-885f-7bd5653be3b1 for POST /550e8400-e29b-41d4-a716-446655440001/add-xp
[2025-12-27 23:20:42] warn: [userRoutes] Self-access violation: user 793809d9-7817-4e8e-885f-7bd5653be3b1 attempted to access user 550e8400-e29b-41d4-a716-446655440001
[2025-12-27 23:20:42] info: [POST] /api/users/550e8400-e29b-41d4-a716-446655440001/add-xp - 403
PASS tests/integration/userRoutes.test.mjs
  üåê INTEGRATION: User Routes - HTTP API Endpoints
    GET /api/users/:id/progress
      ‚àö should return user progress successfully (57 ms)
      ‚àö should return 403 for non-existent user (unauthorized access) (30 ms)
      ‚àö should return validation error for empty user ID (30 ms)
      ‚àö should return validation error for invalid user ID format (29 ms)
      ‚àö should return validation error for extremely long user ID (29 ms)
      ‚àö should return 403 when attempting to access a different user (database error path blocked) (27 ms)
      ‚àö should calculate xpToNextLevel correctly for edge cases (37 ms)
      ‚àö should only return required fields in response (35 ms)
      ‚àö should handle invalid special characters in user ID (29 ms)
    GET /api/users/:id
      ‚àö should return a user by ID (35 ms)
      ‚àö should return 403 if user not authorized (matches different user) (29 ms)
    POST /api/users
      ‚àö should create a new user (40 ms)
      ‚àö should return 400 for invalid user data (22 ms)
    PUT /api/users/:id
      ‚àö should update an existing user (34 ms)
      ‚àö should return 403 if user to update is not authorized (28 ms)
    DELETE /api/users/:id
      ‚àö should delete a user (40 ms)
      ‚àö should return 403 if user to delete is not authorized (26 ms)
    POST /api/users/:id/add-xp
      ‚àö should add XP to a user and potentially level them up (34 ms)
      ‚àö should return 404 if user not found for XP addition (matches authorized user check) (28 ms)

[2025-12-27 23:20:42] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:42] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:42] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:43] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:43] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:43] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:43] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:43] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:43] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:43] info: [GET] /api/auth/profile
[2025-12-27 23:20:43] warn: [MemoryMonitoring] Memory threshold exceeded: 1399MB
[2025-12-27 23:20:43] warn: [auth] Access token is required for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:43] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:43] info: [PUT] /api/auth/profile
[2025-12-27 23:20:43] warn: [MemoryMonitoring] Memory threshold exceeded: 1399MB
[2025-12-27 23:20:43] warn: [auth] Access token is required for PUT /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:43] info: [PUT] /api/auth/profile - 401
[2025-12-27 23:20:43] info: [DELETE] /api/users/account
[2025-12-27 23:20:43] warn: [MemoryMonitoring] Memory threshold exceeded: 1397MB
[2025-12-27 23:20:43] warn: [auth] Access token is required for DELETE /users/account from ::ffff:127.0.0.1
[2025-12-27 23:20:43] info: [DELETE] /api/users/account - 401
[2025-12-27 23:20:43] info: [GET] /api/horses
[2025-12-27 23:20:43] warn: [MemoryMonitoring] Memory threshold exceeded: 1396MB
[2025-12-27 23:20:43] warn: [auth] Access token is required for GET /horses from ::ffff:127.0.0.1
[2025-12-27 23:20:43] info: [GET] /api/horses - 401
[2025-12-27 23:20:43] info: [POST] /api/horses
[2025-12-27 23:20:43] warn: [MemoryMonitoring] Memory threshold exceeded: 1408MB
[2025-12-27 23:20:43] warn: [auth] Access token is required for POST /horses from ::ffff:127.0.0.1
[2025-12-27 23:20:43] info: [POST] /api/horses - 401
[2025-12-27 23:20:43] info: [GET] /api/auth/profile
[2025-12-27 23:20:43] warn: [MemoryMonitoring] Memory threshold exceeded: 1405MB
[2025-12-27 23:20:43] warn: [auth] Invalid token for GET /profile from ::ffff:127.0.0.1: invalid signature
[2025-12-27 23:20:43] warn: [auth] Invalid or expired token for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:43] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:43] info: [GET] /api/auth/profile
[2025-12-27 23:20:43] warn: [MemoryMonitoring] Memory threshold exceeded: 1400MB
[2025-12-27 23:20:43] warn: [auth] Invalid token for GET /profile from ::ffff:127.0.0.1: invalid algorithm
[2025-12-27 23:20:43] warn: [auth] Invalid or expired token for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:43] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:43] info: [GET] /api/auth/profile
[2025-12-27 23:20:43] warn: [MemoryMonitoring] Memory threshold exceeded: 1397MB
[2025-12-27 23:20:43] warn: [auth] Invalid or expired token for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:43] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:43] info: [GET] /api/auth/profile
[2025-12-27 23:20:43] warn: [MemoryMonitoring] Memory threshold exceeded: 1406MB
[2025-12-27 23:20:43] warn: [auth] Invalid or expired token for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:43] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:43] info: [GET] /api/auth/profile
[2025-12-27 23:20:43] warn: [MemoryMonitoring] Memory threshold exceeded: 1401MB
[2025-12-27 23:20:43] warn: [auth] Invalid or expired token for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:43] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1410MB
[2025-12-27 23:20:44] warn: [auth] Token expired (precheck) for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:44] warn: [auth] Token expired for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1404MB
[2025-12-27 23:20:44] warn: [auth] Session expired due to age for GET /profile from ::ffff:127.0.0.1 (8 days old)
[2025-12-27 23:20:44] warn: [auth] Session expired. Please login again. for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1400MB
[2025-12-27 23:20:44] info: [auth] Authenticated user b5f0833e-4448-4a04-95a7-35f643935e5e for GET /profile
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1409MB
[2025-12-27 23:20:44] info: [auth] Authenticated user bf7c874c-1940-4bfb-93bc-dfeb5906c0ae for GET /profile
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1402MB
[2025-12-27 23:20:44] info: [auth] Authenticated user bf7c874c-1940-4bfb-93bc-dfeb5906c0ae for GET /profile
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1399MB
[2025-12-27 23:20:44] info: [auth] Authenticated user 20c475c1-a933-4a26-b5b1-fbfb3f36f88f for GET /profile
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1408MB
[2025-12-27 23:20:44] warn: [auth] Access token is required for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1402MB
[2025-12-27 23:20:44] warn: [auth] Access token is required for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1411MB
[2025-12-27 23:20:44] warn: [auth] Access token is required for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1405MB
[2025-12-27 23:20:44] warn: [auth] Access token is required for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1401MB
[2025-12-27 23:20:44] info: [auth] Authenticated user 84cefffa-0538-491c-92b7-528a0bb0fd36 for GET /profile
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1410MB
[2025-12-27 23:20:44] info: [auth] Authenticated user eabeb76d-edea-43f4-9de4-6f75818cf27f for GET /profile
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1404MB
[2025-12-27 23:20:44] info: [auth] Authenticated user eabeb76d-edea-43f4-9de4-6f75818cf27f for GET /profile
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1400MB
[2025-12-27 23:20:44] info: [auth] Authenticated user 7216de57-37e1-4387-9adf-495fd56eba58 for GET /profile
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:44] info: [GET] /api/users/f418d65a-af11-4f34-aa5e-5ec2b38c75e4
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1410MB
[2025-12-27 23:20:44] info: [auth] Authenticated user 053978df-8c8e-4dca-a9a2-e1766c6dc73b for GET /users/f418d65a-af11-4f34-aa5e-5ec2b38c75e4
[2025-12-27 23:20:44] info: [auth] Authenticated user 053978df-8c8e-4dca-a9a2-e1766c6dc73b for GET /f418d65a-af11-4f34-aa5e-5ec2b38c75e4
[2025-12-27 23:20:44] warn: [userRoutes] Self-access violation: user 053978df-8c8e-4dca-a9a2-e1766c6dc73b attempted to access user f418d65a-af11-4f34-aa5e-5ec2b38c75e4
[2025-12-27 23:20:44] info: [GET] /api/users/f418d65a-af11-4f34-aa5e-5ec2b38c75e4 - 403
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1407MB
[2025-12-27 23:20:44] info: [auth] Authenticated user 78c3223e-b40b-4bf3-ae92-a62cc97b0823 for GET /profile
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1402MB
[2025-12-27 23:20:44] info: [auth] Authenticated user 2e374e43-a529-4e04-b685-db23210e181c for GET /profile
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1411MB
[2025-12-27 23:20:44] info: [auth] Authenticated user 2e374e43-a529-4e04-b685-db23210e181c for GET /profile
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 200
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1406MB
[2025-12-27 23:20:44] warn: [auth] Invalid token for GET /profile from ::ffff:127.0.0.1: invalid signature
[2025-12-27 23:20:44] warn: [auth] Invalid or expired token for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1403MB
[2025-12-27 23:20:44] warn: [auth] Invalid or expired token for GET /profile from ::ffff:127.0.0.1
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1412MB
[2025-12-27 23:20:44] info: [auth] Authenticated user 1' OR '1'='1 for GET /profile
[2025-12-27 23:20:44] error: [authController.getProfile] Error retrieving profile: User not found
[2025-12-27 23:20:44] error: [GET] /api/auth/profile - ERROR
[2025-12-27 23:20:44] error: Error User not found
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 404
[2025-12-27 23:20:44] info: [GET] /api/auth/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1410MB
[2025-12-27 23:20:44] info: [auth] Authenticated user undefined for GET /profile
[2025-12-27 23:20:44] error: [authController.getProfile] Error retrieving profile: Authentication error, user not found in request
[2025-12-27 23:20:44] error: [GET] /api/auth/profile - ERROR
[2025-12-27 23:20:44] error: Error Authentication error, user not found in request
[2025-12-27 23:20:44] info: [GET] /api/auth/profile - 401
[2025-12-27 23:20:44] info: [GET] /api/users/profile
[2025-12-27 23:20:44] warn: [MemoryMonitoring] Memory threshold exceeded: 1408MB
[2025-12-27 23:20:44] info: [auth] Authenticated user not-a-number for GET /users/profile
[2025-12-27 23:20:44] info: [auth] Authenticated user not-a-number for GET /profile
[2025-12-27 23:20:44] warn: [userRoutes] Validation errors for /:id: [{"type":"field","value":"profile","msg":"User ID must be a valid UUID","path":"id","location":"params"}]
[2025-12-27 23:20:44] info: [GET] /api/users/profile - 400
PASS __tests__/integration/security/auth-bypass-attempts.test.mjs
  Authentication Bypass Attempts Integration Tests
    Direct Endpoint Access Without Authentication
      ‚àö should reject GET /api/users/profile without token (95 ms)
      ‚àö should reject PUT /api/users/profile without token (33 ms)
      ‚àö should reject DELETE /api/users/account without token (27 ms)
      ‚àö should reject GET /api/horses without token (26 ms)
      ‚àö should reject POST /api/horses without token (31 ms)
    Forged JWT Tokens
      ‚àö should reject token with wrong signature (29 ms)
      ‚àö should reject token signed with different algorithm (26 ms)
      ‚àö should reject token with modified payload (27 ms)
      ‚àö should reject token with algorithm none (32 ms)
      ‚àö should reject completely malformed token (23 ms)
    Expired Token Usage
      ‚àö should reject JWT token past expiration time (37 ms)
      ‚àö should reject token older than 7 days (CWE-613) (23 ms)
      ‚àö should accept token exactly 7 days old (29 ms)
    Token Replay Attacks
      ‚àö should allow same token for multiple valid requests (expected behavior) (46 ms)
      ‚àö should accept token from both cookie and header (cookie preferred) (27 ms)
    Authorization Header Manipulation
      ‚àö should reject token without Bearer prefix (25 ms)
      ‚àö should reject token with wrong scheme (20 ms)
      ‚àö should reject empty Authorization header (23 ms)
      ‚àö should reject Authorization header with only Bearer (18 ms)
      ‚àö should reject multiple Authorization headers (25 ms)
    Cookie Theft Simulation
      ‚àö should reject stolen cookie with different IP (if IP binding enabled) (43 ms)
      ‚àö should reject cookie with HttpOnly flag missing (client-side) (27 ms)
    Multi-User Session Conflicts
      ‚àö should prevent user A from accessing user B resources with valid token (44 ms)
      ‚àö should allow user to access their own resources only (22 ms)
      ‚àö should prevent concurrent logins from invalidating each other (stateless tokens) (49 ms)
    Edge Cases and Attack Vectors
      ‚àö should reject token with null bytes in payload (22 ms)
      ‚àö should reject extremely long token (DoS prevention) (21 ms)
      ‚àö should reject token with SQL injection in payload (30 ms)
      ‚àö should handle token with missing userId gracefully (31 ms)
      ‚àö should reject token with non-numeric userId (35 ms)

[2025-12-27 23:20:44] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:44] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:44] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/traitEvaluation.test.mjs
  üî¨ UNIT: Trait Evaluation System - Trait Revelation & Validation
    evaluateTraitRevelation
      ‚àö should evaluate traits for a foal with good bonding and low stress (4 ms)
      ‚àö should not reveal traits that do not meet age requirements (7 ms)
      ‚àö should not reveal traits that do not meet bonding requirements (2 ms)
      ‚àö should not reveal traits that do not meet stress requirements (1 ms)
      ‚àö should not reveal duplicate traits (2 ms)
      ‚àö should respect trait conflicts (2 ms)
      ‚àö should handle foals with null bond_score and stress_level (3 ms)
      ‚àö should use development age for young foals (2 ms)
      ‚àö should not reveal traits when random chance is too high (1 ms)
    getTraitDefinition
      ‚àö should return trait definition for valid trait key (3 ms)
      ‚àö should return null for invalid trait key (1 ms)
      ‚àö should find traits in all categories (1 ms)
    getAllTraitDefinitions
      ‚àö should return all trait definitions (3 ms)
      ‚àö should have consistent structure for all traits (15 ms)
    TRAIT_DEFINITIONS
      ‚àö should have valid reveal conditions for all traits (8 ms)
    TRAIT_CONFLICTS
      ‚àö should have symmetric conflicts (2 ms)
      ‚àö should only reference valid traits (3 ms)
    Error Handling
      ‚àö should handle errors gracefully (5 ms)
      ‚àö should handle missing foal properties (2 ms)

[2025-12-27 23:20:45] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:45] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:45] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:46] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:46] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:46] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:46] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:46] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:46] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:46] info: [POST] /api/grooms/interact
[2025-12-27 23:20:46] warn: [MemoryMonitoring] Memory threshold exceeded: 1228MB
[2025-12-27 23:20:46] info: [groomController.recordInteraction] Recording brushing interaction for foal 94328
[2025-12-27 23:20:46] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task brushing
[2025-12-27 23:20:46] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: task_specialty
[2025-12-27 23:20:46] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: task_specialty
[2025-12-27 23:20:46] info: [groomController.recordInteraction] Interaction recorded: 4 bonding, -4 stress
[2025-12-27 23:20:46] info: [groomController.recordInteraction] Personality effects applied (gentle): task_specialty - 10% increased success rate on nervous or timid horses
[2025-12-27 23:20:46] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46737 for interaction_completed
[2025-12-27 23:20:46] info: [groomProgressionService.awardGroomXP] Groom 46737 gained 2 XP: 5 ‚Üí 7 (Level 1 ‚Üí 1)
[2025-12-27 23:20:46] info: [groomController.recordInteraction] Awarded 2 XP to groom 46737 for interaction
[2025-12-27 23:20:46] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:46] info: [POST] /api/grooms/interact
[2025-12-27 23:20:46] warn: [MemoryMonitoring] Memory threshold exceeded: 1228MB
[2025-12-27 23:20:46] info: [groomController.recordInteraction] Recording hand-walking interaction for foal 94329
[2025-12-27 23:20:46] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task hand-walking
[2025-12-27 23:20:46] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:20:46] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:20:46] info: [groomController.recordInteraction] Interaction recorded: 10 bonding, -4 stress
[2025-12-27 23:20:46] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46738 for interaction_completed
[2025-12-27 23:20:46] info: [groomProgressionService.awardGroomXP] Groom 46738 gained 2 XP: 5 ‚Üí 7 (Level 1 ‚Üí 1)
[2025-12-27 23:20:46] info: [groomController.recordInteraction] Awarded 2 XP to groom 46738 for interaction
[2025-12-27 23:20:46] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:46] info: [POST] /api/grooms/interact
[2025-12-27 23:20:46] warn: [MemoryMonitoring] Memory threshold exceeded: 1235MB
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Recording stall_care interaction for foal 94330
[2025-12-27 23:20:47] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task stall_care
[2025-12-27 23:20:47] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: task_specialty
[2025-12-27 23:20:47] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: task_specialty
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Interaction recorded: 4 bonding, -1 stress
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Personality effects applied (gentle): task_specialty - 10% increased success rate on nervous or timid horses
[2025-12-27 23:20:47] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46739 for interaction_completed
[2025-12-27 23:20:47] info: [groomProgressionService.awardGroomXP] Groom 46739 gained 2 XP: 5 ‚Üí 7 (Level 1 ‚Üí 1)
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Awarded 2 XP to groom 46739 for interaction
[2025-12-27 23:20:47] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:47] info: [POST] /api/grooms/interact
[2025-12-27 23:20:47] warn: [MemoryMonitoring] Memory threshold exceeded: 1228MB
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Recording brushing interaction for foal 94332
[2025-12-27 23:20:47] info: [POST] /api/grooms/interact - 400
[2025-12-27 23:20:47] info: [POST] /api/grooms/interact
[2025-12-27 23:20:47] warn: [MemoryMonitoring] Memory threshold exceeded: 1229MB
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Recording brushing interaction for foal 94333
[2025-12-27 23:20:47] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task brushing
[2025-12-27 23:20:47] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: task_specialty
[2025-12-27 23:20:47] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: task_specialty
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Interaction recorded: 4 bonding, -1 stress
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Personality effects applied (gentle): task_specialty - 10% increased success rate on nervous or timid horses
[2025-12-27 23:20:47] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46741 for interaction_completed
[2025-12-27 23:20:47] info: [groomProgressionService.awardGroomXP] Groom 46741 gained 2 XP: 5 ‚Üí 7 (Level 1 ‚Üí 1)
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Awarded 2 XP to groom 46741 for interaction
[2025-12-27 23:20:47] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:47] info: [POST] /api/grooms/interact
[2025-12-27 23:20:47] warn: [MemoryMonitoring] Memory threshold exceeded: 1225MB
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Recording brushing interaction for foal 94334
[2025-12-27 23:20:47] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task brushing
[2025-12-27 23:20:47] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: task_specialty
[2025-12-27 23:20:47] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: task_specialty
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Interaction recorded: 6 bonding, -1 stress
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Personality effects applied (gentle): task_specialty - 10% increased success rate on nervous or timid horses
[2025-12-27 23:20:47] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46742 for interaction_completed
[2025-12-27 23:20:47] info: [groomProgressionService.awardGroomXP] Groom 46742 gained 2 XP: 5 ‚Üí 7 (Level 1 ‚Üí 1)
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Awarded 2 XP to groom 46742 for interaction
[2025-12-27 23:20:47] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:47] info: [POST] /api/grooms/interact
[2025-12-27 23:20:47] warn: [MemoryMonitoring] Memory threshold exceeded: 1231MB
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Recording brushing interaction for foal 94335
[2025-12-27 23:20:47] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task brushing
[2025-12-27 23:20:47] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: task_specialty
[2025-12-27 23:20:47] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: task_specialty
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Interaction recorded: 6 bonding, -1 stress
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Personality effects applied (gentle): task_specialty - 10% increased success rate on nervous or timid horses
[2025-12-27 23:20:47] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46743 for interaction_completed
[2025-12-27 23:20:47] info: [groomProgressionService.awardGroomXP] Groom 46743 gained 2 XP: 5 ‚Üí 7 (Level 1 ‚Üí 1)
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Awarded 2 XP to groom 46743 for interaction
[2025-12-27 23:20:47] info: [POST] /api/grooms/interact - 200
[2025-12-27 23:20:47] info: [POST] /api/grooms/interact
[2025-12-27 23:20:47] warn: [MemoryMonitoring] Memory threshold exceeded: 1233MB
[2025-12-27 23:20:47] info: [groomController.recordInteraction] Recording hand-walking interaction for foal 94335
[2025-12-27 23:20:47] info: [POST] /api/grooms/interact - 400
PASS tests/groomBondingIntegration.test.mjs
  Groom Bonding System Integration
    New Grooming Tasks for Horses 3+ Years Old
      ‚àö should successfully process brushing interaction (343 ms)
      ‚àö should successfully process hand-walking interaction (86 ms)
      ‚àö should successfully process stall_care interaction (77 ms)
    Age Restrictions
      ‚àö should reject new grooming tasks for horses under 3 years old (71 ms)
    Bond Score Updates
      ‚àö should update horse bond score after grooming (113 ms)
      ‚àö should grant burnout immunity after 7 consecutive days (130 ms)
    Daily Interaction Limits
      ‚àö should enforce one grooming session per horse per day (136 ms)

[2025-12-27 23:20:47] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:47] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:47] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:48] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:48] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:48] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:48] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:48] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:48] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:48] info: [GET] /api/leaderboards/players/level?limit=10&offset=0
[2025-12-27 23:20:48] warn: [MemoryMonitoring] Memory threshold exceeded: 1269MB
[2025-12-27 23:20:48] info: [auth] Authenticated user aa42d1a6-eb49-4e24-8853-9f5f880e6dd4 for GET /leaderboards/players/level
[2025-12-27 23:20:48] info: [auth] Authenticated user aa42d1a6-eb49-4e24-8853-9f5f880e6dd4 for GET /players/level
[2025-12-27 23:20:48] info: [GET] /api/leaderboards/players/level?limit=10&offset=0 - 200
[2025-12-27 23:20:48] info: [GET] /api/leaderboards/players/level
[2025-12-27 23:20:48] warn: [MemoryMonitoring] Memory threshold exceeded: 1273MB
[2025-12-27 23:20:48] warn: [auth] Access token is required for GET /leaderboards/players/level from ::ffff:127.0.0.1
[2025-12-27 23:20:48] info: [GET] /api/leaderboards/players/level - 401
[2025-12-27 23:20:48] info: [GET] /api/leaderboards/horses/earnings
[2025-12-27 23:20:48] warn: [MemoryMonitoring] Memory threshold exceeded: 1275MB
[2025-12-27 23:20:48] info: [auth] Authenticated user 9bdbe7cc-2174-448d-82da-390d09629bd2 for GET /leaderboards/horses/earnings
[2025-12-27 23:20:48] info: [auth] Authenticated user 9bdbe7cc-2174-448d-82da-390d09629bd2 for GET /horses/earnings
[2025-12-27 23:20:48] info: [GET] /api/leaderboards/horses/earnings - 200
[2025-12-27 23:20:48] info: [GET] /api/leaderboards/recent-winners
[2025-12-27 23:20:48] warn: [MemoryMonitoring] Memory threshold exceeded: 1278MB
[2025-12-27 23:20:48] info: [auth] Authenticated user 40abbf97-ecc3-4fcc-80ef-b45fe24f339f for GET /leaderboards/recent-winners
[2025-12-27 23:20:48] info: [auth] Authenticated user 40abbf97-ecc3-4fcc-80ef-b45fe24f339f for GET /recent-winners
[2025-12-27 23:20:48] info: [GET] /api/leaderboards/recent-winners - 200
[2025-12-27 23:20:49] info: [GET] /api/leaderboards/recent-winners?discipline=Dressage
[2025-12-27 23:20:49] warn: [MemoryMonitoring] Memory threshold exceeded: 1268MB
[2025-12-27 23:20:49] info: [auth] Authenticated user 3140c71f-c0ac-463d-986c-64f806d65776 for GET /leaderboards/recent-winners
[2025-12-27 23:20:49] info: [auth] Authenticated user 3140c71f-c0ac-463d-986c-64f806d65776 for GET /recent-winners
[2025-12-27 23:20:49] info: [GET] /api/leaderboards/recent-winners?discipline=Dressage - 200
[2025-12-27 23:20:49] info: [GET] /api/leaderboards/stats
[2025-12-27 23:20:49] warn: [MemoryMonitoring] Memory threshold exceeded: 1273MB
[2025-12-27 23:20:49] info: [auth] Authenticated user 7f826615-43b9-4d4f-9875-a1f1b3ad41fd for GET /leaderboards/stats
[2025-12-27 23:20:49] info: [auth] Authenticated user 7f826615-43b9-4d4f-9875-a1f1b3ad41fd for GET /stats
[2025-12-27 23:20:49] info: [GET] /api/leaderboards/stats - 200
PASS tests/integration/leaderboardRoutes.test.mjs
  üèÜ INTEGRATION: Leaderboard API - Real Database Integration
    GET /api/leaderboards/players/level
      ‚àö should return top players by level (219 ms)
      ‚àö should handle unauthorized access (65 ms)
    GET /api/leaderboards/horses/earnings
      ‚àö should return top horses by earnings (81 ms)
    GET /api/leaderboards/recent-winners
      ‚àö should return recent competition winners (70 ms)
      ‚àö should filter by discipline (65 ms)
    GET /api/leaderboards/stats
      ‚àö should return comprehensive leaderboard statistics (68 ms)

[2025-12-27 23:20:49] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:49] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:49] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:49] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:50] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:50] info: [EmailVerification] Created verification token
[2025-12-27 23:20:50] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: test@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=07e6e3eb935381d440dbd852acc665e93ef152a42fdee0e884f89283f59f9d80

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:20:50] info: [authController.register] Verification email sent
[2025-12-27 23:20:50] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:50] info: [EmailVerification] Created verification token
[2025-12-27 23:20:50] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: login-test@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=1e2cc02e97c784679a3bb43bd2bc34246f7df5269447c941171fcb3953b48efc

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:20:50] info: [authController.register] Verification email sent
[2025-12-27 23:20:51] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:51] warn: [AuthRateLimiter] resetAuthRateLimit() is deprecated with Redis
PASS tests/auth-simple.test.mjs
  üîê INTEGRATION: Authentication Controller Simple - Core Auth Workflow Testing
    ‚àö should register a new user (438 ms)
    ‚àö should login with valid credentials (669 ms)

[2025-12-27 23:20:51] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:51] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:51] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:51] warn: [Session] Session expired due to inactivity
[2025-12-27 23:20:51] warn: [Session] Session expired due to inactivity
[2025-12-27 23:20:51] error: [Session] Error tracking session activity: Database connection error
[2025-12-27 23:20:51] warn: [Session] Too many concurrent sessions
[2025-12-27 23:20:51] info: [Session] Removed oldest sessions to enforce limit
[2025-12-27 23:20:52] warn: [Session] Too many concurrent sessions
[2025-12-27 23:20:52] info: [Session] Removed oldest sessions to enforce limit
[2025-12-27 23:20:52] warn: [Session] Too many concurrent sessions
[2025-12-27 23:20:52] info: [Session] Removed oldest sessions to enforce limit
[2025-12-27 23:20:52] error: [Session] Error enforcing concurrent sessions: Database query failed
[2025-12-27 23:20:52] error: [Session] Error fetching active sessions: Database connection lost
[2025-12-27 23:20:52] info: [Session] Session revoked by user
[2025-12-27 23:20:52] error: [Session] Error revoking session: 
Invalid `prisma.refreshToken.deleteMany()` invocation:

{
  where: {
    userId: "invalid-user",
+   id: {
+     equals: Int | IntFieldRefInput,
+     in: Int[] | ListIntFieldRefInput,
+     notIn: Int[] | ListIntFieldRefInput,
+     lt: Int | IntFieldRefInput,
+     lte: Int | IntFieldRefInput,
+     gt: Int | IntFieldRefInput,
+     gte: Int | IntFieldRefInput,
+     not: Int | NestedIntFilter
+   }
  }
}

Argument `id` is missing.
PASS __tests__/middleware/sessionManagement.test.mjs
  Session Management Middleware
    trackSessionActivity()
      ‚àö should skip tracking for unauthenticated requests (5 ms)
      ‚àö should skip tracking when no user ID (1 ms)
      ‚àö should skip tracking when no refresh token cookie (7 ms)
      Active session tracking
        ‚àö should update lastActivityAt for valid session (20 ms)
        ‚àö should allow session within timeout window (14 minutes) (21 ms)
        ‚àö should expire session after 15 minutes of inactivity (20 ms)
        ‚àö should clear cookies when session expires (15 ms)
        ‚àö should use createdAt if lastActivityAt is null (13 ms)
        ‚àö should handle database errors gracefully (11 ms)
        ‚àö should catch and log Prisma errors during activity tracking (13 ms)
      Custom timeout configuration
        ‚àö should respect custom SESSION_TIMEOUT_MS (12 ms)
    enforceConcurrentSessions()
      ‚àö should skip enforcement for unauthenticated requests (2 ms)
      ‚àö should allow user with 1 session (12 ms)
      ‚àö should allow user with exactly MAX_CONCURRENT_SESSIONS (5) (20 ms)
      ‚àö should delete oldest session when limit exceeded (6 sessions) (120 ms)
      ‚àö should delete multiple oldest sessions when far over limit (10 sessions) (179 ms)
      ‚àö should keep most recent sessions (138 ms)
      ‚àö should handle database errors gracefully (3 ms)
      ‚àö should catch and log Prisma errors during session enforcement (5 ms)
      Custom limit configuration
        ‚àö should respect custom MAX_CONCURRENT_SESSIONS (82 ms)
    addSessionSecurityHeaders()
      ‚àö should add cache control headers (1 ms)
      ‚àö should add pragma header (2 ms)
      ‚àö should add expires header (2 ms)
      ‚àö should call next() to continue middleware chain (2 ms)
    getActiveSessions()
      ‚àö should return 401 for unauthenticated requests (7 ms)
      ‚àö should return empty array for user with no sessions (6 ms)
      ‚àö should return all active sessions for user (8 ms)
      ‚àö should NOT expose token values in response (6 ms)
      ‚àö should handle database errors (2 ms)
    revokeSession()
      ‚àö should return 401 for unauthenticated requests (2 ms)
      ‚àö should return 400 when sessionId missing (3 ms)
      ‚àö should successfully revoke own session (10 ms)
      ‚àö should return 404 when session not found (10 ms)
      ‚àö should NOT allow revoking another user's session (10 ms)
      ‚àö should handle database errors (8 ms)

[2025-12-27 23:20:52] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:52] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:52] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:53] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:53] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:53] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:53] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:53] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:53] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:53] info: [GET] /api/users/dashboard/fe78f90e-e6b9-4c06-8ea7-c716378cabe3
[2025-12-27 23:20:53] warn: [MemoryMonitoring] Memory threshold exceeded: 1353MB
[2025-12-27 23:20:53] info: [auth] Authenticated user fe78f90e-e6b9-4c06-8ea7-c716378cabe3 for GET /users/dashboard/fe78f90e-e6b9-4c06-8ea7-c716378cabe3
[2025-12-27 23:20:53] info: [auth] Authenticated user fe78f90e-e6b9-4c06-8ea7-c716378cabe3 for GET /dashboard/fe78f90e-e6b9-4c06-8ea7-c716378cabe3
[2025-12-27 23:20:53] info: [userRoutes] Self-access validated: user fe78f90e-e6b9-4c06-8ea7-c716378cabe3 accessing own data
[2025-12-27 23:20:53] info: [trainingController.getTrainableHorses] Getting trainable horses for user fe78f90e-e6b9-4c06-8ea7-c716378cabe3
[2025-12-27 23:20:53] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94354 across all disciplines
[2025-12-27 23:20:53] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94354: Sat Dec 27 2025 21:20:53 GMT-0500 (Eastern Standard Time) (discipline: Dressage)
[2025-12-27 23:20:53] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94355 across all disciplines
[2025-12-27 23:20:53] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94355
[2025-12-27 23:20:53] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94356 across all disciplines
[2025-12-27 23:20:53] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94356
[2025-12-27 23:20:53] info: [trainingController.getTrainableHorses] Found 2 trainable horses for user fe78f90e-e6b9-4c06-8ea7-c716378cabe3
[2025-12-27 23:20:53] info: [userController.getDashboardData] Successfully retrieved dashboard data for user testdashboarduser (3 horses, 2 trainable)
[2025-12-27 23:20:53] info: [GET] /api/users/dashboard/fe78f90e-e6b9-4c06-8ea7-c716378cabe3 - 200
[2025-12-27 23:20:53] info: [GET] /api/users/dashboard/nonexistent-user
[2025-12-27 23:20:53] warn: [MemoryMonitoring] Memory threshold exceeded: 1353MB
[2025-12-27 23:20:53] info: [auth] Authenticated user 9d340ac3-10ed-4efb-903f-9242e7803ab2 for GET /users/dashboard/nonexistent-user
[2025-12-27 23:20:53] info: [auth] Authenticated user 9d340ac3-10ed-4efb-903f-9242e7803ab2 for GET /dashboard/nonexistent-user
[2025-12-27 23:20:53] warn: [userRoutes] Validation errors for /dashboard/:userId: [{"type":"field","value":"nonexistent-user","msg":"User ID must be a valid UUID","path":"userId","location":"params"}]
[2025-12-27 23:20:53] info: [GET] /api/users/dashboard/nonexistent-user - 400
[2025-12-27 23:20:54] info: [GET] /api/users/dashboard/998af282-65f7-41a0-87be-b2a123750a4c
[2025-12-27 23:20:54] warn: [MemoryMonitoring] Memory threshold exceeded: 1357MB
[2025-12-27 23:20:54] warn: [auth] Access token is required for GET /users/dashboard/998af282-65f7-41a0-87be-b2a123750a4c from ::ffff:127.0.0.1
[2025-12-27 23:20:54] info: [GET] /api/users/dashboard/998af282-65f7-41a0-87be-b2a123750a4c - 401
[2025-12-27 23:20:54] info: [GET] /api/users/dashboard/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
[2025-12-27 23:20:54] warn: [MemoryMonitoring] Memory threshold exceeded: 1359MB
[2025-12-27 23:20:54] info: [auth] Authenticated user de2ecdfd-d3df-4e83-b6c4-39b5d0446ab0 for GET /users/dashboard/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
[2025-12-27 23:20:54] info: [auth] Authenticated user de2ecdfd-d3df-4e83-b6c4-39b5d0446ab0 for GET /dashboard/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
[2025-12-27 23:20:54] warn: [userRoutes] Validation errors for /dashboard/:userId: [{"type":"field","value":"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx","msg":"User ID must be a valid UUID","path":"userId","location":"params"}]
[2025-12-27 23:20:54] info: [GET] /api/users/dashboard/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx - 400
[2025-12-27 23:20:54] info: [GET] /api/users/dashboard/62781196-bfaa-40d2-aab7-ee1b55c95de9
[2025-12-27 23:20:54] warn: [MemoryMonitoring] Memory threshold exceeded: 1361MB
[2025-12-27 23:20:54] info: [auth] Authenticated user 62781196-bfaa-40d2-aab7-ee1b55c95de9 for GET /users/dashboard/62781196-bfaa-40d2-aab7-ee1b55c95de9
[2025-12-27 23:20:54] info: [auth] Authenticated user 62781196-bfaa-40d2-aab7-ee1b55c95de9 for GET /dashboard/62781196-bfaa-40d2-aab7-ee1b55c95de9
[2025-12-27 23:20:54] info: [userRoutes] Self-access validated: user 62781196-bfaa-40d2-aab7-ee1b55c95de9 accessing own data
[2025-12-27 23:20:54] info: [trainingController.getTrainableHorses] Getting trainable horses for user 62781196-bfaa-40d2-aab7-ee1b55c95de9
[2025-12-27 23:20:54] info: [trainingController.getTrainableHorses] User 62781196-bfaa-40d2-aab7-ee1b55c95de9 has no horses
[2025-12-27 23:20:54] info: [userController.getDashboardData] Successfully retrieved dashboard data for user emptydashboarduser (0 horses, 0 trainable)
[2025-12-27 23:20:54] info: [GET] /api/users/dashboard/62781196-bfaa-40d2-aab7-ee1b55c95de9 - 200
[2025-12-27 23:20:54] info: [GET] /api/users/dashboard/01ae5ee8-ef48-4177-a975-9caa8231808e
[2025-12-27 23:20:54] warn: [MemoryMonitoring] Memory threshold exceeded: 1353MB
[2025-12-27 23:20:54] info: [auth] Authenticated user 01ae5ee8-ef48-4177-a975-9caa8231808e for GET /users/dashboard/01ae5ee8-ef48-4177-a975-9caa8231808e
[2025-12-27 23:20:54] info: [auth] Authenticated user 01ae5ee8-ef48-4177-a975-9caa8231808e for GET /dashboard/01ae5ee8-ef48-4177-a975-9caa8231808e
[2025-12-27 23:20:54] info: [userRoutes] Self-access validated: user 01ae5ee8-ef48-4177-a975-9caa8231808e accessing own data
[2025-12-27 23:20:54] info: [trainingController.getTrainableHorses] Getting trainable horses for user 01ae5ee8-ef48-4177-a975-9caa8231808e
[2025-12-27 23:20:54] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94372 across all disciplines
[2025-12-27 23:20:54] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94372
[2025-12-27 23:20:54] info: [trainingController.getTrainableHorses] Found 1 trainable horses for user 01ae5ee8-ef48-4177-a975-9caa8231808e
[2025-12-27 23:20:54] info: [userController.getDashboardData] Successfully retrieved dashboard data for user inactivedashboarduser (1 horses, 1 trainable)
[2025-12-27 23:20:54] info: [GET] /api/users/dashboard/01ae5ee8-ef48-4177-a975-9caa8231808e - 200
PASS tests/integration/dashboardRoutes.test.mjs
  üè† INTEGRATION: Dashboard API - Real Database Integration
    GET /api/user/dashboard/:userId
      ‚àö should return complete dashboard data successfully (342 ms)
      ‚àö should return 400 for invalid user ID format (76 ms)
      ‚àö should return 401 for missing authentication (60 ms)
      ‚àö should return validation error for invalid user ID format (63 ms)
      ‚àö should handle user with no horses gracefully (99 ms)
      ‚àö should handle user with horses but no activity gracefully (89 ms)

[2025-12-27 23:20:54] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:54] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:54] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:55] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
[2025-12-27 23:20:55] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:55] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:55] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:55] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:55] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/discover/1
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1398MB
[2025-12-27 23:20:55] info: [traitController.discoverTraits] Triggering trait discovery for horse 1
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 1
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Found 2 hidden traits for horse 1
[2025-12-27 23:20:55] warn: [traitDiscovery.checkDiscoveryConditions] Error checking condition CONSISTENT_TRAINING: Cannot read properties of undefined (reading 'count')
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Successfully revealed 1 traits for horse 1: bold
[2025-12-27 23:20:55] info: [traitController.discoverTraits] Discovered 1 traits for horse 1 (Test Discovery Horse 1766895655253)
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/discover/1 - 200
[2025-12-27 23:20:55] info: [POST] /api/traits/discover/2
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1401MB
[2025-12-27 23:20:55] info: [traitController.discoverTraits] Triggering trait discovery for horse 2
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 2
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Found 2 hidden traits for horse 2
[2025-12-27 23:20:55] warn: [traitDiscovery.checkDiscoveryConditions] Error checking condition CONSISTENT_TRAINING: Cannot read properties of undefined (reading 'count')
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Successfully revealed 2 traits for horse 2: resilient, calm
[2025-12-27 23:20:55] info: [traitController.discoverTraits] Discovered 2 traits for horse 2 (Adult Test Horse)
[2025-12-27 23:20:55] info: [POST] /api/traits/discover/2 - 200
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/discover/invalid
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1401MB
[2025-12-27 23:20:55] warn: [Validation] Input validation failed
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/discover/invalid - 400
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/discover/99999
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1395MB
[2025-12-27 23:20:55] warn: [ownership] horse 99999 not found or not owned by user test@example.com
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/discover/99999 - 404
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/discover/1
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1404MB
[2025-12-27 23:20:55] info: [traitController.discoverTraits] Triggering trait discovery for horse 1
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 1
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Found 2 hidden traits for horse 1
[2025-12-27 23:20:55] warn: [traitDiscovery.checkDiscoveryConditions] Error checking condition CONSISTENT_TRAINING: Cannot read properties of undefined (reading 'count')
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Successfully revealed 1 traits for horse 1: bold
[2025-12-27 23:20:55] info: [traitController.discoverTraits] Discovered 1 traits for horse 1 (Test Discovery Horse 1766895655253)
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/discover/1 - 200
[2025-12-27 23:20:55] info: [GET] /api/traits/horse/1
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1402MB
[2025-12-27 23:20:55] info: [traitController.getHorseTraits] Getting traits for horse 1
[2025-12-27 23:20:55] info: [GET] /api/traits/horse/1 - 200
[2025-12-27 23:20:55] info: [GET] /api/traits/horse/invalid
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1396MB
[2025-12-27 23:20:55] warn: [traitRoutes] Validation errors: [{"type":"field","value":"invalid","msg":"Horse ID must be a positive integer","path":"horseId","location":"params"}]
[2025-12-27 23:20:55] info: [GET] /api/traits/horse/invalid - 400
[2025-12-27 23:20:55] info: [GET] /api/traits/horse/99999
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1405MB
[2025-12-27 23:20:55] warn: [ownership] horse 99999 not found or not owned by user test@example.com
[2025-12-27 23:20:55] info: [GET] /api/traits/horse/99999 - 404
[2025-12-27 23:20:55] info: [GET] /api/traits/definitions
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1399MB
[2025-12-27 23:20:55] info: [traitController.getTraitDefinitions] Getting trait definitions
[2025-12-27 23:20:55] info: [GET] /api/traits/definitions - 200
[2025-12-27 23:20:55] info: [GET] /api/traits/definitions?type=positive
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1396MB
[2025-12-27 23:20:55] info: [traitController.getTraitDefinitions] Getting trait definitions for type: positive
[2025-12-27 23:20:55] info: [GET] /api/traits/definitions?type=positive - 200
[2025-12-27 23:20:55] info: [GET] /api/traits/definitions?type=invalid
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1408MB
[2025-12-27 23:20:55] warn: [traitRoutes] Validation errors: [{"type":"field","value":"invalid","msg":"Type must be either \"all\", \"positive\", or \"negative\"","path":"type","location":"query"}]
[2025-12-27 23:20:55] info: [GET] /api/traits/definitions?type=invalid - 400
[2025-12-27 23:20:55] info: [GET] /api/trait-discovery/discovery-status/1
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1402MB
[2025-12-27 23:20:55] info: [traitController.getDiscoveryStatus] Getting discovery status for horse 1
[2025-12-27 23:20:55] warn: [traitDiscovery.checkDiscoveryConditions] Error checking condition CONSISTENT_TRAINING: Cannot read properties of undefined (reading 'count')
[2025-12-27 23:20:55] info: [GET] /api/trait-discovery/discovery-status/1 - 200
[2025-12-27 23:20:55] info: [GET] /api/trait-discovery/discovery-status/invalid
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1397MB
[2025-12-27 23:20:55] warn: [Validation] Input validation failed
[2025-12-27 23:20:55] info: [GET] /api/trait-discovery/discovery-status/invalid - 400
[2025-12-27 23:20:55] info: [GET] /api/trait-discovery/discovery-status/99999
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1407MB
[2025-12-27 23:20:55] warn: [ownership] horse 99999 not found or not owned by user test@example.com
[2025-12-27 23:20:55] info: [GET] /api/trait-discovery/discovery-status/99999 - 404
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/batch-discover
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1401MB
[2025-12-27 23:20:55] info: [traitController.batchDiscoverTraits] Processing batch discovery for 1 horses
[2025-12-27 23:20:55] info: [ownership] Found owned horse 1 for user test@example.com
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 1
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Found 2 hidden traits for horse 1
[2025-12-27 23:20:55] warn: [traitDiscovery.checkDiscoveryConditions] Error checking condition CONSISTENT_TRAINING: Cannot read properties of undefined (reading 'count')
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Successfully revealed 1 traits for horse 1: bold
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/batch-discover - 200
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/batch-discover
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1401MB
[2025-12-27 23:20:55] warn: [Validation] Input validation failed
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/batch-discover - 400
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/batch-discover
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1410MB
[2025-12-27 23:20:55] warn: [Validation] Input validation failed
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/batch-discover - 400
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/batch-discover
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1404MB
[2025-12-27 23:20:55] warn: [Validation] Input validation failed
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/batch-discover - 400
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/batch-discover
[2025-12-27 23:20:55] warn: [MemoryMonitoring] Memory threshold exceeded: 1399MB
[2025-12-27 23:20:55] info: [traitController.batchDiscoverTraits] Processing batch discovery for 2 horses
[2025-12-27 23:20:55] info: [ownership] Found owned horse 1 for user test@example.com
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Starting trait discovery for horse 1
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Found 2 hidden traits for horse 1
[2025-12-27 23:20:55] warn: [traitDiscovery.checkDiscoveryConditions] Error checking condition CONSISTENT_TRAINING: Cannot read properties of undefined (reading 'count')
[2025-12-27 23:20:55] info: [traitDiscovery.revealTraits] Successfully revealed 1 traits for horse 1: bold
[2025-12-27 23:20:55] warn: [ownership] horse 99999 not found or not owned by user test@example.com
[2025-12-27 23:20:55] info: [POST] /api/trait-discovery/batch-discover - 200
PASS tests/integration/traitRoutes.test.mjs
  Trait Routes Integration Tests
    POST /api/trait-discovery/discover/:horseId
      ‚àö should trigger trait discovery successfully (67 ms)
      ‚àö should trigger mature bond discovery for adult horses (31 ms)
      ‚àö should return validation error for invalid horse ID (21 ms)
      ‚àö should return 404 for non-existent horse (22 ms)
      ‚àö should handle optional parameters correctly (31 ms)
    GET /api/traits/horse/:horseId
      ‚àö should get horse traits successfully (20 ms)
      ‚àö should return validation error for invalid horse ID (21 ms)
      ‚àö should return 404 for non-existent horse (22 ms)
    GET /api/traits/definitions
      ‚àö should get all trait definitions (26 ms)
      ‚àö should filter traits by type (30 ms)
      ‚àö should return validation error for invalid type (21 ms)
    GET /api/trait-discovery/discovery-status/:horseId
      ‚àö should get discovery status successfully (22 ms)
      ‚àö should return validation error for invalid horse ID (22 ms)
      ‚àö should return 404 for non-existent horse (21 ms)
    POST /api/trait-discovery/batch-discover
      ‚àö should process batch discovery successfully (31 ms)
      ‚àö should return validation error for empty horse IDs array (20 ms)
      ‚àö should return validation error for too many horse IDs (22 ms)
      ‚àö should return validation error for invalid horse IDs (20 ms)
      ‚àö should handle mix of valid and invalid horse IDs (29 ms)

[2025-12-27 23:20:55] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:55] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:55] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:56] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:56] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:56] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:56] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:56] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:56] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:56] info: [GET] /api/horses/94374
[2025-12-27 23:20:56] warn: [MemoryMonitoring] Memory threshold exceeded: 1443MB
[2025-12-27 23:20:56] info: [auth] Authenticated user ad47b17f-f2c2-4443-926a-da1beddfa1a0 for GET /horses/94374
[2025-12-27 23:20:56] warn: [ownership] horse 94374 not found or not owned by user ad47b17f-f2c2-4443-926a-da1beddfa1a0
[2025-12-27 23:20:56] info: [GET] /api/horses/94374 - 404
[2025-12-27 23:20:56] info: [GET] /api/horses/94375
[2025-12-27 23:20:56] warn: [MemoryMonitoring] Memory threshold exceeded: 1446MB
[2025-12-27 23:20:56] info: [auth] Authenticated user a2a36bd6-bc78-4006-8a9c-af12f43c005b for GET /horses/94375
[2025-12-27 23:20:56] info: [ownership] Validated ownership: user a2a36bd6-bc78-4006-8a9c-af12f43c005b owns horse 94375
[2025-12-27 23:20:56] info: [GET] /api/horses/94375 - 200
[2025-12-27 23:20:56] info: [PUT] /api/horses/94378
[2025-12-27 23:20:56] warn: [MemoryMonitoring] Memory threshold exceeded: 1450MB
[2025-12-27 23:20:56] info: [auth] Authenticated user fd04c452-f7e6-473c-b4c6-a94ea44722c6 for PUT /horses/94378
[2025-12-27 23:20:56] warn: [ownership] horse 94378 not found or not owned by user fd04c452-f7e6-473c-b4c6-a94ea44722c6
[2025-12-27 23:20:57] info: [PUT] /api/horses/94378 - 404
[2025-12-27 23:20:57] info: [PUT] /api/horses/94379
[2025-12-27 23:20:57] warn: [MemoryMonitoring] Memory threshold exceeded: 1450MB
[2025-12-27 23:20:57] info: [auth] Authenticated user 4467f3f8-7bae-40c0-9aca-7999d1b50ea4 for PUT /horses/94379
[2025-12-27 23:20:57] info: [ownership] Validated ownership: user 4467f3f8-7bae-40c0-9aca-7999d1b50ea4 owns horse 94379
[2025-12-27 23:20:57] info: [horseRoutes] User 4467f3f8-7bae-40c0-9aca-7999d1b50ea4 updated horse: Updated Horse Name (ID: 94379)
[2025-12-27 23:20:57] info: [PUT] /api/horses/94379 - 200
[2025-12-27 23:20:57] info: [DELETE] /api/horses/94382
[2025-12-27 23:20:57] warn: [MemoryMonitoring] Memory threshold exceeded: 1452MB
[2025-12-27 23:20:57] info: [auth] Authenticated user 303b6171-0a5b-43a5-8704-c2407dbe200c for DELETE /horses/94382
[2025-12-27 23:20:57] warn: [ownership] horse 94382 not found or not owned by user 303b6171-0a5b-43a5-8704-c2407dbe200c
[2025-12-27 23:20:57] info: [DELETE] /api/horses/94382 - 404
[2025-12-27 23:20:57] info: [DELETE] /api/horses/94381
[2025-12-27 23:20:57] warn: [MemoryMonitoring] Memory threshold exceeded: 1447MB
[2025-12-27 23:20:57] info: [auth] Authenticated user 303b6171-0a5b-43a5-8704-c2407dbe200c for DELETE /horses/94381
[2025-12-27 23:20:57] info: [ownership] Validated ownership: user 303b6171-0a5b-43a5-8704-c2407dbe200c owns horse 94381
[2025-12-27 23:20:57] info: [horseRoutes] User 303b6171-0a5b-43a5-8704-c2407dbe200c deleted horse ID: 94381
[2025-12-27 23:20:57] info: [DELETE] /api/horses/94381 - 200
[2025-12-27 23:20:57] info: [GET] /api/grooms/46755/profile
[2025-12-27 23:20:57] warn: [MemoryMonitoring] Memory threshold exceeded: 1450MB
[2025-12-27 23:20:57] info: [auth] Authenticated user 276dc8ca-06e2-4e8a-81b3-3d8c695ed103 for GET /grooms/46755/profile
[2025-12-27 23:20:57] warn: [ownership] groom 46755 not found or not owned by user 276dc8ca-06e2-4e8a-81b3-3d8c695ed103
[2025-12-27 23:20:57] info: [GET] /api/grooms/46755/profile - 404
[2025-12-27 23:20:57] info: [GET] /api/grooms/46756/profile
[2025-12-27 23:20:57] warn: [MemoryMonitoring] Memory threshold exceeded: 1450MB
[2025-12-27 23:20:57] info: [auth] Authenticated user 37103f9b-9aa0-4c71-b014-42285b48e629 for GET /grooms/46756/profile
[2025-12-27 23:20:57] info: [ownership] Validated ownership: user 37103f9b-9aa0-4c71-b014-42285b48e629 owns groom 46756
[2025-12-27 23:20:57] info: [groomController.getGroomProfile] Retrieved profile for groom 46756
[2025-12-27 23:20:57] info: [GET] /api/grooms/46756/profile - 200
[2025-12-27 23:20:57] info: [GET] /api/horses/abc
[2025-12-27 23:20:57] warn: [MemoryMonitoring] Memory threshold exceeded: 1451MB
[2025-12-27 23:20:57] info: [auth] Authenticated user 24d08ba4-8b84-4459-96b0-ac42b9236f88 for GET /horses/abc
[2025-12-27 23:20:57] info: [GET] /api/horses/abc - 400
[2025-12-27 23:20:57] info: [GET] /api/horses/999999
[2025-12-27 23:20:57] warn: [MemoryMonitoring] Memory threshold exceeded: 1449MB
[2025-12-27 23:20:57] info: [auth] Authenticated user fdc6c423-1872-4ccf-8efa-fecbe4480b29 for GET /horses/999999
[2025-12-27 23:20:57] warn: [ownership] horse 999999 not found or not owned by user fdc6c423-1872-4ccf-8efa-fecbe4480b29
[2025-12-27 23:20:57] info: [GET] /api/horses/999999 - 404
[2025-12-27 23:20:57] info: [GET] /api/horses/94390
[2025-12-27 23:20:57] warn: [MemoryMonitoring] Memory threshold exceeded: 1447MB
[2025-12-27 23:20:57] info: [auth] Authenticated user fdc6c423-1872-4ccf-8efa-fecbe4480b29 for GET /horses/94390
[2025-12-27 23:20:57] warn: [ownership] horse 94390 not found or not owned by user fdc6c423-1872-4ccf-8efa-fecbe4480b29
[2025-12-27 23:20:57] info: [GET] /api/horses/94390 - 404
PASS __tests__/integration/security/ownership-violations.test.mjs
  Ownership Violation Attempts Integration Tests
    Cross-user horse access
      ‚àö denies access to an unowned horse (162 ms)
      ‚àö allows owners to fetch their own horse (63 ms)
      ‚àö blocks cross-user updates and preserves data integrity (68 ms)
      ‚àö allows owners to update their horse with a valid payload (62 ms)
      ‚àö blocks cross-user deletes and allows owner deletes (80 ms)
    Groom ownership
      ‚àö denies access to an unowned groom profile (47 ms)
      ‚àö allows owners to view their groom profile (53 ms)
    Parameter validation and enumeration safety
      ‚àö rejects invalid horse identifiers (48 ms)
      ‚àö returns the same 404 for missing and unowned horses (72 ms)

[2025-12-27 23:20:57] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:57] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:57] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:20:58] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:20:58] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:20:58] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:20:58] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:20:58] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:20:58] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:20:58] info: [POST] /api/auth/register
[2025-12-27 23:20:58] warn: [MemoryMonitoring] Memory threshold exceeded: 1489MB
[2025-12-27 23:20:58] info: [TokenRotation] Created new token pair
[2025-12-27 23:20:58] info: [EmailVerification] Created verification token
[2025-12-27 23:20:58] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: training-integration@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=fdecbe26aac9b18a4c722494865150fbfa763ea197759c467d433b2da38404fc

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:20:58] info: [authController.register] Verification email sent
[2025-12-27 23:20:58] info: [POST] /api/auth/register - 201
[2025-12-27 23:20:58] info: [POST] /api/training/train
[2025-12-27 23:20:58] warn: [MemoryMonitoring] Memory threshold exceeded: 1486MB
[2025-12-27 23:20:58] info: [auth] Authenticated user 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941 for POST /training/train
[2025-12-27 23:20:58] info: [ownership] Found owned horse 94391 for user 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941
[2025-12-27 23:20:58] info: [trainingController.trainRouteHandler] Training request for horse 94391 in Racing
[2025-12-27 23:20:58] info: [trainingController.trainHorse] Attempting to train horse 94391 in Racing
[2025-12-27 23:20:58] info: [trainingController.canTrain] Checking training eligibility for horse 94391 in Racing
[2025-12-27 23:20:58] info: [trainingModel.getHorseAge] Getting age for horse 94391
[2025-12-27 23:20:58] info: [trainingModel.getHorseAge] Horse 94391 is 2 years old
[2025-12-27 23:20:58] info: [trainingController.canTrain] Horse 94391 is too young (2 years old)
[2025-12-27 23:20:58] warn: [trainingController.trainHorse] Training rejected: Horse is under age
[2025-12-27 23:20:58] info: [POST] /api/training/train - 400
[2025-12-27 23:20:58] info: [POST] /api/training/train
[2025-12-27 23:20:58] warn: [MemoryMonitoring] Memory threshold exceeded: 1488MB
[2025-12-27 23:20:58] info: [auth] Authenticated user 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941 for POST /training/train
[2025-12-27 23:20:58] info: [ownership] Found owned horse 94392 for user 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941
[2025-12-27 23:20:58] info: [trainingController.trainRouteHandler] Training request for horse 94392 in Racing
[2025-12-27 23:20:58] info: [trainingController.trainHorse] Attempting to train horse 94392 in Racing
[2025-12-27 23:20:58] info: [trainingController.canTrain] Checking training eligibility for horse 94392 in Racing
[2025-12-27 23:20:58] info: [trainingModel.getHorseAge] Getting age for horse 94392
[2025-12-27 23:20:58] info: [trainingModel.getHorseAge] Horse 94392 is 4 years old
[2025-12-27 23:20:58] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94392 across all disciplines
[2025-12-27 23:20:58] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94392
[2025-12-27 23:20:58] info: [trainingController.canTrain] Horse 94392 is eligible to train in Racing
[2025-12-27 23:20:58] info: [horseModel.getHorseById] Successfully found horse: Training Integration Mature Horse (ID: 94392)
[2025-12-27 23:20:58] info: [trainingController.trainHorse] Horse 94392 has traits: 
[2025-12-27 23:20:58] info: [trainingModel.logTrainingSession] Logging training session for horse 94392 in Racing
[2025-12-27 23:20:58] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4828
[2025-12-27 23:20:58] info: [horseModel.incrementDisciplineScore] Incrementing Racing score for horse 94392 by +5
[2025-12-27 23:20:58] info: [horseModel.updateDisciplineScore] Updating Racing score for horse 94392 by +5
[2025-12-27 23:20:58] info: [horseModel.updateDisciplineScore] Successfully updated Racing score for horse 94392: 0 -> 5
[2025-12-27 23:20:58] info: [horseModel.incrementDisciplineScore] Successfully incremented Racing score for horse 94392
[2025-12-27 23:20:58] info: [xpLogModel.logXpEvent] Logging XP event: User 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941, Amount: 5, Reason: Trained horse Training Integration Mature Horse in Racing
[2025-12-27 23:20:58] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2349, User 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941, Amount: 5
[2025-12-27 23:20:58] info: [trainingController.trainHorse] Awarded 5 XP to user 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941 for training
[2025-12-27 23:20:58] info: [trainingController.trainHorse] Successfully trained horse 94392 in Racing (Log ID: 4828, Score +5)
[2025-12-27 23:20:58] info: [POST] /api/training/train - 200
[2025-12-27 23:20:58] info: [POST] /api/training/train
[2025-12-27 23:20:58] warn: [MemoryMonitoring] Memory threshold exceeded: 1489MB
[2025-12-27 23:20:58] info: [auth] Authenticated user 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941 for POST /training/train
[2025-12-27 23:20:58] info: [ownership] Found owned horse 94392 for user 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941
[2025-12-27 23:20:58] info: [trainingController.trainRouteHandler] Training request for horse 94392 in Dressage
[2025-12-27 23:20:58] info: [trainingController.trainHorse] Attempting to train horse 94392 in Dressage
[2025-12-27 23:20:58] info: [trainingController.canTrain] Checking training eligibility for horse 94392 in Dressage
[2025-12-27 23:20:58] info: [trainingModel.getHorseAge] Getting age for horse 94392
[2025-12-27 23:20:58] info: [trainingModel.getHorseAge] Horse 94392 is 4 years old
[2025-12-27 23:20:58] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94392 across all disciplines
[2025-12-27 23:20:58] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94392: Sat Dec 27 2025 23:20:58 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:20:58] info: [trainingController.canTrain] Horse 94392 still in cooldown for any training (7 days remaining)
[2025-12-27 23:20:58] warn: [trainingController.trainHorse] Training rejected: Training cooldown active for this horse
[2025-12-27 23:20:58] info: [POST] /api/training/train - 400
[2025-12-27 23:20:59] info: [POST] /api/training/train
[2025-12-27 23:20:59] warn: [MemoryMonitoring] Memory threshold exceeded: 1493MB
[2025-12-27 23:20:59] info: [auth] Authenticated user 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941 for POST /training/train
[2025-12-27 23:20:59] info: [ownership] Found owned horse 94392 for user 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941
[2025-12-27 23:20:59] info: [trainingController.trainRouteHandler] Training request for horse 94392 in Dressage
[2025-12-27 23:20:59] info: [trainingController.trainHorse] Attempting to train horse 94392 in Dressage
[2025-12-27 23:20:59] info: [trainingController.canTrain] Checking training eligibility for horse 94392 in Dressage
[2025-12-27 23:20:59] info: [trainingModel.getHorseAge] Getting age for horse 94392
[2025-12-27 23:20:59] info: [trainingModel.getHorseAge] Horse 94392 is 4 years old
[2025-12-27 23:20:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94392 across all disciplines
[2025-12-27 23:20:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94392: Sat Dec 27 2025 23:20:58 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:20:59] info: [trainingController.canTrain] Horse 94392 still in cooldown for any training (7 days remaining)
[2025-12-27 23:20:59] warn: [trainingController.trainHorse] Training rejected: Training cooldown active for this horse
[2025-12-27 23:20:59] info: [POST] /api/training/train - 400
[2025-12-27 23:20:59] info: [POST] /api/training/train
[2025-12-27 23:20:59] warn: [MemoryMonitoring] Memory threshold exceeded: 1496MB
[2025-12-27 23:20:59] info: [auth] Authenticated user 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941 for POST /training/train
[2025-12-27 23:20:59] info: [ownership] Found owned horse 94392 for user 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941
[2025-12-27 23:20:59] info: [trainingController.trainRouteHandler] Training request for horse 94392 in Dressage
[2025-12-27 23:20:59] info: [trainingController.trainHorse] Attempting to train horse 94392 in Dressage
[2025-12-27 23:20:59] info: [trainingController.canTrain] Checking training eligibility for horse 94392 in Dressage
[2025-12-27 23:20:59] info: [trainingModel.getHorseAge] Getting age for horse 94392
[2025-12-27 23:20:59] info: [trainingModel.getHorseAge] Horse 94392 is 4 years old
[2025-12-27 23:20:59] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94392 across all disciplines
[2025-12-27 23:20:59] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94392: Fri Dec 19 2025 23:20:59 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:20:59] info: [trainingController.canTrain] Horse 94392 is eligible to train in Dressage
[2025-12-27 23:20:59] info: [horseModel.getHorseById] Successfully found horse: Training Integration Mature Horse (ID: 94392)
[2025-12-27 23:20:59] info: [trainingController.trainHorse] Horse 94392 has traits: 
[2025-12-27 23:20:59] info: [trainingModel.logTrainingSession] Logging training session for horse 94392 in Dressage
[2025-12-27 23:20:59] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4829
[2025-12-27 23:20:59] info: [horseModel.incrementDisciplineScore] Incrementing Dressage score for horse 94392 by +5
[2025-12-27 23:20:59] info: [horseModel.updateDisciplineScore] Updating Dressage score for horse 94392 by +5
[2025-12-27 23:20:59] info: [horseModel.updateDisciplineScore] Successfully updated Dressage score for horse 94392: 0 -> 5
[2025-12-27 23:20:59] info: [horseModel.incrementDisciplineScore] Successfully incremented Dressage score for horse 94392
[2025-12-27 23:20:59] info: [xpLogModel.logXpEvent] Logging XP event: User 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941, Amount: 5, Reason: Trained horse Training Integration Mature Horse in Dressage
[2025-12-27 23:20:59] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2350, User 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941, Amount: 5
[2025-12-27 23:20:59] info: [trainingController.trainHorse] Awarded 5 XP to user 6fdebc4f-67cb-4e4d-8b0a-937e58ba5941 for training
[2025-12-27 23:20:59] info: [trainingController.trainHorse] Successfully trained horse 94392 in Dressage (Log ID: 4829, Score +5)
[2025-12-27 23:20:59] info: [POST] /api/training/train - 200
PASS tests/integration/trainingProgression.integration.test.mjs
  üèãÔ∏è INTEGRATION: Complete Training Progression Workflow
    üîê STEP 1: User Setup & Authentication
      ‚àö should create user for training progression testing (389 ms)
    üê¥ STEP 2: Horse Creation & Age Validation
      ‚àö should create young horse (under training age) (9 ms)
      ‚àö should create mature horse (training eligible) (6 ms)
    üö´ STEP 3: Age Restriction Enforcement
      ‚àö should block training for young horse (under 3 years) (50 ms)
    üèãÔ∏è STEP 4: First Training Session
      ‚àö should successfully train mature horse for first time (86 ms)
    ‚è∞ STEP 5: Training Cooldown Management
      ‚àö should enforce 7-day cooldown period (40 ms)
      ‚àö should allow training after cooldown expires (using test data manipulation) (112 ms)
    üéØ STEP 6: User Progression Tracking
      ‚àö should track user XP and level progression from training (5 ms)
    üèÜ STEP 7: Competition Readiness Validation
      ‚àö should validate horse is ready for competition (4 ms)
    üéä STEP 8: End-to-End Workflow Validation
      ‚àö should validate complete training progression integrity (11 ms)
      ‚àö should validate all business rules were enforced throughout progression (4 ms)

[2025-12-27 23:20:59] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:20:59] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:20:59] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:00] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:00] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:21:00] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:21:00] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:21:00] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:21:00] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:21:00] info: [GET] /api/horses
[2025-12-27 23:21:00] warn: [MemoryMonitoring] Memory threshold exceeded: 1528MB
[2025-12-27 23:21:00] info: [GET] /api/horses - 200
PASS __tests__/integration/horse-rate-limiting.test.mjs
  Horse routes rate limiting
    ‚àö should apply query rate limiter to GET /api/horses (300 ms)

[2025-12-27 23:21:00] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:00] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:00] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for GET /health
[2025-12-27 23:21:01] info: [DocumentationRoutes] Getting documentation health status
[2025-12-27 23:21:01] info: [ApiDocService] OpenAPI specification validation passed
[2025-12-27 23:21:01] warn: [auth] Access token is required for GET /health from ::ffff:127.0.0.1
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for GET /metrics
[2025-12-27 23:21:01] info: [DocumentationRoutes] Getting documentation metrics
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for GET /metrics
[2025-12-27 23:21:01] info: [DocumentationRoutes] Getting documentation metrics
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for GET /validation
[2025-12-27 23:21:01] info: [DocumentationRoutes] Validating OpenAPI specification
[2025-12-27 23:21:01] info: [ApiDocService] OpenAPI specification validation passed
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /generate
[2025-12-27 23:21:01] info: [DocumentationRoutes] Generating API documentation
[2025-12-27 23:21:01] info: [ApiDocService] OpenAPI specification saved successfully
[2025-12-27 23:21:01] info: [ApiDocService] Documentation generated for 1 endpoints
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /endpoints
[2025-12-27 23:21:01] info: [DocumentationRoutes] Registering endpoint: POST /api/horses
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /endpoints
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /endpoints
[2025-12-27 23:21:01] info: [DocumentationRoutes] Registering endpoint: GET /api/test-get
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /endpoints
[2025-12-27 23:21:01] info: [DocumentationRoutes] Registering endpoint: POST /api/test-post
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /endpoints
[2025-12-27 23:21:01] info: [DocumentationRoutes] Registering endpoint: PUT /api/test-put
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /endpoints
[2025-12-27 23:21:01] info: [DocumentationRoutes] Registering endpoint: DELETE /api/test-delete
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /endpoints
[2025-12-27 23:21:01] info: [DocumentationRoutes] Registering endpoint: PATCH /api/test-patch
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /schemas
[2025-12-27 23:21:01] info: [DocumentationRoutes] Registering schema: Horse
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /schemas
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for GET /coverage
[2025-12-27 23:21:01] info: [DocumentationRoutes] Getting documentation coverage analysis
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for GET /analytics
[2025-12-27 23:21:01] info: [DocumentationRoutes] Getting documentation analytics for timeframe: 30d
[2025-12-27 23:21:01] info: [ApiDocService] OpenAPI specification validation passed
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for GET /analytics
[2025-12-27 23:21:01] info: [DocumentationRoutes] Getting documentation analytics for timeframe: 1d
[2025-12-27 23:21:01] info: [ApiDocService] OpenAPI specification validation passed
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for GET /analytics
[2025-12-27 23:21:01] info: [DocumentationRoutes] Getting documentation analytics for timeframe: 7d
[2025-12-27 23:21:01] info: [ApiDocService] OpenAPI specification validation passed
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for GET /analytics
[2025-12-27 23:21:01] info: [DocumentationRoutes] Getting documentation analytics for timeframe: 30d
[2025-12-27 23:21:01] info: [ApiDocService] OpenAPI specification validation passed
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for GET /analytics
[2025-12-27 23:21:01] warn: [auth] Invalid or expired token for GET /health from ::ffff:127.0.0.1
[2025-12-27 23:21:01] warn: [auth] Access token is required for GET /health from ::ffff:127.0.0.1
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /endpoints
[2025-12-27 23:21:01] info: [DocumentationRoutes] Registering endpoint: GET /api/users
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /endpoints
[2025-12-27 23:21:01] info: [DocumentationRoutes] Registering endpoint: POST /api/users
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /endpoints
[2025-12-27 23:21:01] info: [DocumentationRoutes] Registering endpoint: GET /api/horses
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for GET /metrics
[2025-12-27 23:21:01] info: [DocumentationRoutes] Getting documentation metrics
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /schemas
[2025-12-27 23:21:01] info: [DocumentationRoutes] Registering schema: User
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /schemas
[2025-12-27 23:21:01] info: [DocumentationRoutes] Registering schema: Horse
[2025-12-27 23:21:01] info: [auth] Authenticated user d36ccf32-45bc-40a8-8bf0-00a22a38590a for POST /generate
[2025-12-27 23:21:01] info: [DocumentationRoutes] Generating API documentation
[2025-12-27 23:21:01] info: [ApiDocService] OpenAPI specification saved successfully
[2025-12-27 23:21:01] info: [ApiDocService] Documentation generated for 0 endpoints
PASS __tests__/routes/documentationRoutes.test.mjs
  Documentation Routes
    GET /api/docs/health
      ‚àö retrieves documentation health successfully (38 ms)
      ‚àö requires authentication (18 ms)
    GET /api/docs/metrics
      ‚àö retrieves documentation metrics successfully (20 ms)
      ‚àö provides meaningful analytics data (23 ms)
    GET /api/docs/validation
      ‚àö validates OpenAPI specification successfully (23 ms)
    POST /api/docs/generate
      ‚àö generates documentation successfully (30 ms)
    POST /api/docs/endpoints
      ‚àö registers endpoint successfully (35 ms)
      ‚àö validates endpoint data (16 ms)
      ‚àö accepts valid HTTP methods (80 ms)
    POST /api/docs/schemas
      ‚àö registers schema successfully (19 ms)
      ‚àö validates schema data (14 ms)
    GET /api/docs/coverage
      ‚àö retrieves coverage analysis successfully (26 ms)
    GET /api/docs/analytics
      ‚àö retrieves analytics with default timeframe (25 ms)
      ‚àö accepts different timeframe parameters (69 ms)
      ‚àö validates timeframe parameter (16 ms)
    Error Handling
      ‚àö handles invalid authentication tokens (14 ms)
      ‚àö handles missing authorization header (13 ms)
    Integration with Documentation Service
      ‚àö endpoints registration reflects in metrics (64 ms)
      ‚àö schema registration reflects in generation (61 ms)

[2025-12-27 23:21:01] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:01] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:01] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:02] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:02] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:21:02] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:21:02] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:21:02] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:21:02] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:21:02] info: [groomPersonalityTraitBonus] Compatibility: Calm + Spirited = MATCH (bond: 65)
[2025-12-27 23:21:02] info: [groomPersonalityTraitBonus] Compatibility: Reserved + Playful = MISMATCH (bond: 40)
[2025-12-27 23:21:02] info: [groomPersonalityTraitBonus] Compatibility: Energetic + Lazy = MATCH (bond: 45)
[2025-12-27 23:21:02] info: [groomPersonalityTraitBonus] Compatibility: Calm + Spirited = MATCH (bond: 70)
[2025-12-27 23:21:02] info: [personalityModifierEngine] Applied personality effects: Calm + Spirited = 2 trait modifier, 4.5 stress reduction, 10 bonding bonus
[2025-12-27 23:21:02] info: [enhancedMilestoneEvaluationSystem.evaluateEnhancedMilestone] Starting evaluation for horse 94398, milestone imprinting
[2025-12-27 23:21:02] info: [groomPersonalityTraitBonus] Compatibility: Calm + Spirited = MATCH (bond: 65)
[2025-12-27 23:21:02] info: [personalityModifierEngine] Applied personality effects: Calm + Spirited = 2 trait modifier, 3.0 stress reduction, 10 bonding bonus
[2025-12-27 23:21:02] info: [enhancedMilestoneEvaluationSystem] Applied personality effects: Calm + Spirited = 2 modifier
[2025-12-27 23:21:02] info: [enhancedMilestoneEvaluationSystem.evaluateEnhancedMilestone] Completed evaluation for horse 94398: withdrawn (score: 0)
[2025-12-27 23:21:02] info: [enhancedMilestoneEvaluationSystem.evaluateEnhancedMilestone] Starting evaluation for horse 94399, milestone imprinting
[2025-12-27 23:21:02] info: [enhancedMilestoneEvaluationSystem] No personality effects applied - missing groom personality or horse temperament
[2025-12-27 23:21:02] info: [enhancedMilestoneEvaluationSystem.evaluateEnhancedMilestone] Completed evaluation for horse 94399: trusting (score: -2)
[2025-12-27 23:21:03] info: [GET] /api/grooms/46771/profile
[2025-12-27 23:21:03] warn: [MemoryMonitoring] Memory threshold exceeded: 1604MB
[2025-12-27 23:21:03] info: [auth] Authenticated user a3e89244-97a2-454a-951e-133013dc88af for GET /grooms/46771/profile
[2025-12-27 23:21:03] info: [ownership] Validated ownership: user a3e89244-97a2-454a-951e-133013dc88af owns groom 46771
[2025-12-27 23:21:03] info: [groomController.getGroomProfile] Retrieved profile for groom 46771
[2025-12-27 23:21:03] info: [GET] /api/grooms/46771/profile - 200
[2025-12-27 23:21:03] info: [GET] /api/grooms/99999/profile
[2025-12-27 23:21:03] warn: [MemoryMonitoring] Memory threshold exceeded: 1607MB
[2025-12-27 23:21:03] info: [auth] Authenticated user 2b1b16fb-2a81-4658-ba8b-a70c0d1eeece for GET /grooms/99999/profile
[2025-12-27 23:21:03] warn: [ownership] groom 99999 not found or not owned by user 2b1b16fb-2a81-4658-ba8b-a70c0d1eeece
[2025-12-27 23:21:03] info: [GET] /api/grooms/99999/profile - 404
[2025-12-27 23:21:03] info: [GET] /api/grooms/invalid/profile
[2025-12-27 23:21:03] warn: [MemoryMonitoring] Memory threshold exceeded: 1607MB
[2025-12-27 23:21:03] info: [auth] Authenticated user eef05a27-25af-424c-acf9-57ff15c794b0 for GET /grooms/invalid/profile
[2025-12-27 23:21:03] warn: [ownership] Invalid groom ID: invalid
[2025-12-27 23:21:03] info: [GET] /api/grooms/invalid/profile - 400
[2025-12-27 23:21:03] info: [GET] /api/horses/94405/personality-impact
[2025-12-27 23:21:03] warn: [MemoryMonitoring] Memory threshold exceeded: 1608MB
[2025-12-27 23:21:03] info: [auth] Authenticated user 4b2d84dd-b784-4b09-b4f7-36bf6933ff2c for GET /horses/94405/personality-impact
[2025-12-27 23:21:03] info: [ownership] Validated ownership: user 4b2d84dd-b784-4b09-b4f7-36bf6933ff2c owns horse 94405
[2025-12-27 23:21:03] info: [groomPersonalityTraitBonus] Compatibility: Calm + Spirited = MATCH (bond: 65)
[2025-12-27 23:21:03] info: [horseController.getHorsePersonalityImpact] Retrieved personality compatibility for horse 94405 (Spirited)
[2025-12-27 23:21:03] info: [GET] /api/horses/94405/personality-impact - 200
[2025-12-27 23:21:03] info: [GET] /api/horses/99999/personality-impact
[2025-12-27 23:21:03] warn: [MemoryMonitoring] Memory threshold exceeded: 1613MB
[2025-12-27 23:21:03] info: [auth] Authenticated user 2eed6c94-a271-40fc-b95e-0017f17f7b34 for GET /horses/99999/personality-impact
[2025-12-27 23:21:03] warn: [ownership] horse 99999 not found or not owned by user 2eed6c94-a271-40fc-b95e-0017f17f7b34
[2025-12-27 23:21:03] info: [GET] /api/horses/99999/personality-impact - 404
[2025-12-27 23:21:03] info: [GET] /api/horses/94408/personality-impact
[2025-12-27 23:21:03] warn: [MemoryMonitoring] Memory threshold exceeded: 1612MB
[2025-12-27 23:21:03] info: [auth] Authenticated user e39826b5-d6d7-469f-bf30-8c6d76b155a2 for GET /horses/94408/personality-impact
[2025-12-27 23:21:03] info: [ownership] Validated ownership: user e39826b5-d6d7-469f-bf30-8c6d76b155a2 owns horse 94408
[2025-12-27 23:21:03] info: [GET] /api/horses/94408/personality-impact - 400
[2025-12-27 23:21:03] info: [GET] /auth/csrf-token
[2025-12-27 23:21:03] warn: [MemoryMonitoring] Memory threshold exceeded: 1614MB
[2025-12-27 23:21:03] info: [CSRF] Token generated
[2025-12-27 23:21:03] info: [GET] /auth/csrf-token - 200
[2025-12-27 23:21:03] info: [POST] /api/milestones/evaluate-milestone
[2025-12-27 23:21:03] warn: [MemoryMonitoring] Memory threshold exceeded: 1611MB
[2025-12-27 23:21:03] info: [auth] Authenticated user 275de64e-c1e5-4d89-a029-9e0473c72157 for POST /milestones/evaluate-milestone
[2025-12-27 23:21:03] info: [auth] Authenticated user 275de64e-c1e5-4d89-a029-9e0473c72157 for POST /evaluate-milestone
[2025-12-27 23:21:03] info: [enhancedMilestoneController.evaluateMilestone] Evaluating milestone imprinting for horse 94409
[2025-12-27 23:21:03] info: [ownership] Found owned horse 94409 for user 275de64e-c1e5-4d89-a029-9e0473c72157
[2025-12-27 23:21:03] info: [enhancedMilestoneEvaluationSystem.evaluateEnhancedMilestone] Starting evaluation for horse 94409, milestone imprinting
[2025-12-27 23:21:03] info: [groomPersonalityTraitBonus] Compatibility: Calm + Spirited = MATCH (bond: 65)
[2025-12-27 23:21:03] info: [personalityModifierEngine] Applied personality effects: Calm + Spirited = 2 trait modifier, 3.0 stress reduction, 10 bonding bonus
[2025-12-27 23:21:03] info: [enhancedMilestoneEvaluationSystem] Applied personality effects: Calm + Spirited = 2 modifier
[2025-12-27 23:21:03] info: [enhancedMilestoneEvaluationSystem.evaluateEnhancedMilestone] Completed evaluation for horse 94409: bonded (score: 0)
[2025-12-27 23:21:03] info: [POST] /api/milestones/evaluate-milestone - 200
PASS tests/groomPersonalityTraitBonus.test.mjs
  Groom Personality Trait Bonus System - REAL SYSTEM TESTS
    Personality Compatibility Matrix
      ‚àö should correctly identify compatible personality-temperament pairs (105 ms)
      ‚àö should correctly identify incompatible personality-temperament pairs (31 ms)
      ‚àö should handle regular matches without high bond (29 ms)
    Personality Modifier Engine
      ‚àö should apply personality effects to milestone evaluation (30 ms)
      ‚àö should handle missing personality or temperament gracefully (27 ms)
    Enhanced Milestone Evaluation Integration
      ‚àö should integrate personality effects into milestone evaluation (48 ms)
      ‚àö should handle milestone evaluation without groom assignment (39 ms)
    Compatible Grooms Utility
      ‚àö should return all compatible grooms for a temperament (21 ms)
      ‚àö should return empty array for unknown temperament (22 ms)
    API Endpoints - REAL HTTP TESTS
      GET /api/grooms/:id/profile
        ‚àö should return groom profile with personality information (111 ms)
        ‚àö should return 404 for non-existent groom (54 ms)
        ‚àö should return 400 for invalid groom ID (43 ms)
      GET /api/horses/:id/personality-impact
        ‚àö should return personality compatibility for horse (62 ms)
        ‚àö should return 404 for non-existent horse (44 ms)
        ‚àö should return 400 for horse without temperament (53 ms)
      POST /api/milestones/evaluate-milestone (with personality impact)
        ‚àö should evaluate milestone with personality effects (105 ms)

[2025-12-27 23:21:03] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:03] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:03] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:04] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:04] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:21:04] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:21:04] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:21:04] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:21:04] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:21:04] info: [GET] /api/admin/cron/status
[2025-12-27 23:21:04] warn: [MemoryMonitoring] Memory threshold exceeded: 1437MB
[2025-12-27 23:21:04] info: [auth] Authorized user test@example.com with role 'admin' for GET /cron/status
[2025-12-27 23:21:04] info: [adminRoutes] GET /api/admin/cron/status
[2025-12-27 23:21:04] info: [GET] /api/admin/cron/status - 200
[2025-12-27 23:21:04] info: [POST] /api/admin/traits/evaluate
[2025-12-27 23:21:04] warn: [MemoryMonitoring] Memory threshold exceeded: 1436MB
[2025-12-27 23:21:04] info: [auth] Authorized user test@example.com with role 'admin' for POST /traits/evaluate
[2025-12-27 23:21:04] info: [adminRoutes] POST /api/admin/traits/evaluate - Manual trait evaluation triggered
[2025-12-27 23:21:04] info: [POST] /api/admin/traits/evaluate - 200
[2025-12-27 23:21:05] info: [GET] /api/admin/foals/development
[2025-12-27 23:21:05] warn: [MemoryMonitoring] Memory threshold exceeded: 1433MB
[2025-12-27 23:21:05] info: [auth] Authorized user test@example.com with role 'admin' for GET /foals/development
[2025-12-27 23:21:05] info: [adminRoutes] GET /api/admin/foals/development
[2025-12-27 23:21:05] info: [GET] /api/admin/foals/development - 200
[2025-12-27 23:21:05] info: [GET] /api/admin/traits/definitions
[2025-12-27 23:21:05] warn: [MemoryMonitoring] Memory threshold exceeded: 1443MB
[2025-12-27 23:21:05] info: [auth] Authorized user test@example.com with role 'admin' for GET /traits/definitions
[2025-12-27 23:21:05] info: [adminRoutes] GET /api/admin/traits/definitions
[2025-12-27 23:21:05] info: [GET] /api/admin/traits/definitions - 200
[2025-12-27 23:21:05] info: [POST] /api/admin/cron/start
[2025-12-27 23:21:05] warn: [MemoryMonitoring] Memory threshold exceeded: 1445MB
[2025-12-27 23:21:05] info: [auth] Authorized user test@example.com with role 'admin' for POST /cron/start
[2025-12-27 23:21:05] info: [adminRoutes] POST /api/admin/cron/start
[2025-12-27 23:21:05] info: [POST] /api/admin/cron/start - 200
[2025-12-27 23:21:05] info: [POST] /api/admin/cron/stop
[2025-12-27 23:21:05] warn: [MemoryMonitoring] Memory threshold exceeded: 1440MB
[2025-12-27 23:21:05] info: [auth] Authorized user test@example.com with role 'admin' for POST /cron/stop
[2025-12-27 23:21:05] info: [adminRoutes] POST /api/admin/cron/stop
[2025-12-27 23:21:05] info: [POST] /api/admin/cron/stop - 200
PASS tests/cronJobsIntegration.test.mjs
  ‚è∞ INTEGRATION: Cron Jobs System - Automated Trait Evaluation & Admin API
    Daily Trait Evaluation
      ‚àö should evaluate traits for foals with good bonding and low stress (4 ms)
      ‚àö should evaluate traits for foals with poor bonding and high stress (1 ms)
      ‚àö should not evaluate foals that have completed development (9 ms)
      ‚àö should handle foals without development records (2 ms)
      ‚àö should not reveal duplicate traits (1 ms)
      ‚àö should handle multiple foals in single evaluation (1 ms)
    Admin API Endpoints
      ‚àö should get cron job status (41 ms)
      ‚àö should manually trigger trait evaluation (21 ms)
      ‚àö should get foals in development (35 ms)
      ‚àö should get trait definitions (53 ms)
      ‚àö should start and stop cron job service (45 ms)
    Error Handling
      ‚àö should handle database errors gracefully (1 ms)
      ‚àö should handle missing epigeneticModifiers field (4 ms)

[2025-12-27 23:21:05] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:05] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:05] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:05] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:06] info: [TokenRotation] Created new token pair
[2025-12-27 23:21:06] info: [EmailVerification] Created verification token
[2025-12-27 23:21:06] info: [EmailService] Email verification (DEV MODE - not sent)
  console.log
    
    === EMAIL VERIFICATION (DEV MODE) ===

      at sendVerificationEmail (utils/emailService.mjs:227:15)

  console.log
    To: training-test@example.com

      at sendVerificationEmail (utils/emailService.mjs:228:15)

  console.log
    Subject: Verify Your Email Address - Equoria

      at sendVerificationEmail (utils/emailService.mjs:229:15)

  console.log
    Verification URL: http://localhost:3000/verify-email?token=e79c3a5a856f559630af4a25062d927d6571655bdc3585446cd7feaf880c306e

      at sendVerificationEmail (utils/emailService.mjs:230:15)

  console.log
    =====================================

      at sendVerificationEmail (utils/emailService.mjs:231:15)

[2025-12-27 23:21:06] info: [authController.register] Verification email sent
  console.log
    Created test user 347cbeb3-ce85-4ee2-97c1-7dbb0c44bcb7 with 3 horses

      at Object.<anonymous> (tests/training-complete.test.mjs:220:13)

[2025-12-27 23:21:06] info: [auth] Authenticated user 347cbeb3-ce85-4ee2-97c1-7dbb0c44bcb7 for GET /api/horses/trainable/347cbeb3-ce85-4ee2-97c1-7dbb0c44bcb7
  console.log
    Trainable horses: [
      {
        "horseId": 94412,
        "name": "Training Horse 2",
        "age": 5,
        "breed": "Test Breed",
        "trainableDisciplines": [
          "Racing",
          "Dressage",
          "Show Jumping",
          "Cross Country",
          "Western"
        ]
      },
      {
        "horseId": 94410,
        "name": "Training Horse 1",
        "age": 4,
        "breed": "Test Breed",
        "trainableDisciplines": [
          "Racing",
          "Dressage",
          "Show Jumping",
          "Cross Country",
          "Western"
        ]
      }
    ]

      at Object.<anonymous> (tests/training-complete.test.mjs:272:15)

[2025-12-27 23:21:06] info: [auth] Authenticated user 347cbeb3-ce85-4ee2-97c1-7dbb0c44bcb7 for GET /api/horses/trainable/347cbeb3-ce85-4ee2-97c1-7dbb0c44bcb7
[2025-12-27 23:21:06] info: [auth] Authenticated user 347cbeb3-ce85-4ee2-97c1-7dbb0c44bcb7 for POST /api/training/train
  console.log
    Training response: {
      "success": true,
      "message": "Training Horse 2 trained in Racing. +5 added.",
      "updatedScore": 5,
      "nextEligibleDate": "2026-01-04T04:21:06.458Z"
    }

      at Object.<anonymous> (tests/training-complete.test.mjs:300:15)

[2025-12-27 23:21:06] info: [auth] Authenticated user 347cbeb3-ce85-4ee2-97c1-7dbb0c44bcb7 for POST /api/training/train
[2025-12-27 23:21:06] warn: [auth] Access token is required for GET /api/horses/trainable/347cbeb3-ce85-4ee2-97c1-7dbb0c44bcb7 from ::ffff:127.0.0.1
PASS tests/training-complete.test.mjs
  üèãÔ∏è INTEGRATION: Training System Complete - End-to-End Workflow
    Authentication and Setup
      ‚àö should have created test user and horses (2 ms)
    Trainable Horses
      ‚àö should get trainable horses for authenticated user (22 ms)
    Training Functionality
      ‚àö should successfully train an adult horse (37 ms)
      ‚àö should reject training for young horse (17 ms)
    Authentication Protection
      ‚àö should reject unauthenticated requests (13 ms)

[2025-12-27 23:21:06] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:06] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:06] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:07] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:07] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:21:07] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:21:07] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:21:07] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:21:07] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:21:07] info: [GET] /api/groom-salaries/cost
[2025-12-27 23:21:07] warn: [MemoryMonitoring] Memory threshold exceeded: 1508MB
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for GET /groom-salaries/cost
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for GET /cost
[2025-12-27 23:21:07] info: [groomSalaryController] Getting salary cost for user 0a049268-cc7d-42b2-9b51-a3c64298ac84
[2025-12-27 23:21:07] info: [GET] /api/groom-salaries/cost - 200
[2025-12-27 23:21:07] info: [GET] /api/groom-salaries/summary
[2025-12-27 23:21:07] warn: [MemoryMonitoring] Memory threshold exceeded: 1510MB
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for GET /groom-salaries/summary
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for GET /summary
[2025-12-27 23:21:07] info: [groomSalaryController] Getting salary summary for user 0a049268-cc7d-42b2-9b51-a3c64298ac84
[2025-12-27 23:21:07] info: [GET] /api/groom-salaries/summary - 200
[2025-12-27 23:21:07] info: [GET] /api/groom-salaries/groom/46778/salary
[2025-12-27 23:21:07] warn: [MemoryMonitoring] Memory threshold exceeded: 1511MB
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for GET /groom-salaries/groom/46778/salary
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for GET /groom/46778/salary
[2025-12-27 23:21:07] info: [ownership] Validated ownership: user 0a049268-cc7d-42b2-9b51-a3c64298ac84 owns groom 46778
[2025-12-27 23:21:07] info: [groomSalaryController] Getting salary for groom 46778
[2025-12-27 23:21:07] info: [GET] /api/groom-salaries/groom/46778/salary - 200
[2025-12-27 23:21:07] info: [GET] /api/groom-salaries/history
[2025-12-27 23:21:07] warn: [MemoryMonitoring] Memory threshold exceeded: 1511MB
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for GET /groom-salaries/history
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for GET /history
[2025-12-27 23:21:07] info: [groomSalaryController] Getting salary history for user 0a049268-cc7d-42b2-9b51-a3c64298ac84, limit: 50
[2025-12-27 23:21:07] info: [GET] /api/groom-salaries/history - 200
[2025-12-27 23:21:07] info: [GET] /api/groom-salaries/status
[2025-12-27 23:21:07] warn: [MemoryMonitoring] Memory threshold exceeded: 1510MB
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for GET /groom-salaries/status
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for GET /status
[2025-12-27 23:21:07] info: [groomSalaryController] Getting cron job status for user 0a049268-cc7d-42b2-9b51-a3c64298ac84
[2025-12-27 23:21:07] info: [GET] /api/groom-salaries/status - 200
[2025-12-27 23:21:07] info: [GET] /api/groom-salaries/groom/46779/salary
[2025-12-27 23:21:07] warn: [MemoryMonitoring] Memory threshold exceeded: 1510MB
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for GET /groom-salaries/groom/46779/salary
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for GET /groom/46779/salary
[2025-12-27 23:21:07] warn: [ownership] groom 46779 not found or not owned by user 0a049268-cc7d-42b2-9b51-a3c64298ac84
[2025-12-27 23:21:07] info: [GET] /api/groom-salaries/groom/46779/salary - 404
[2025-12-27 23:21:07] info: [groomSalaryService] Starting weekly salary processing...
[2025-12-27 23:21:07] info: [groomSalaryService] Paid $115 salary to groom Salary Test Groom for user salaryTestUser
[2025-12-27 23:21:07] info: [groomSalaryService] Processed $115 in salaries for user salaryTestUser
[2025-12-27 23:21:07] info: [groomSalaryService] Weekly salary processing complete. Processed: 1, Successful: 1, Failed: 0, Total: $115
[2025-12-27 23:21:07] info: [groomSalaryService] Starting weekly salary processing...
[2025-12-27 23:21:07] warn: [groomSalaryService] Started grace period for user salaryTestUser - insufficient funds for groom salaries
[2025-12-27 23:21:07] info: [groomSalaryService] Weekly salary processing complete. Processed: 1, Successful: 0, Failed: 1, Total: $0
[2025-12-27 23:21:07] info: [POST] /api/groom-salaries/process
[2025-12-27 23:21:07] warn: [MemoryMonitoring] Memory threshold exceeded: 1517MB
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for POST /groom-salaries/process
[2025-12-27 23:21:07] info: [auth] Authenticated user 0a049268-cc7d-42b2-9b51-a3c64298ac84 for POST /process
[2025-12-27 23:21:07] info: [groomSalaryController] Manual salary processing triggered by user 0a049268-cc7d-42b2-9b51-a3c64298ac84
[2025-12-27 23:21:07] info: [cronJobService] Manually triggering salary processing...
[2025-12-27 23:21:07] info: [groomSalaryService] Starting weekly salary processing...
[2025-12-27 23:21:07] info: [groomSalaryService] Paid $115 salary to groom Salary Test Groom for user salaryTestUser
[2025-12-27 23:21:07] info: [groomSalaryService] Processed $115 in salaries for user salaryTestUser
[2025-12-27 23:21:07] info: [groomSalaryService] Weekly salary processing complete. Processed: 1, Successful: 1, Failed: 0, Total: $115
[2025-12-27 23:21:07] info: [cronJobService] Manual salary processing completed: {"processed":1,"successful":1,"failed":0,"terminated":0,"totalAmount":115,"errors":[]}
[2025-12-27 23:21:07] info: [POST] /api/groom-salaries/process - 200
[2025-12-27 23:21:08] info: [GET] /api/groom-salaries/cost
[2025-12-27 23:21:08] warn: [MemoryMonitoring] Memory threshold exceeded: 1519MB
[2025-12-27 23:21:08] warn: [auth] Access token is required for GET /groom-salaries/cost from ::ffff:127.0.0.1
[2025-12-27 23:21:08] info: [GET] /api/groom-salaries/cost - 401
[2025-12-27 23:21:08] info: [GET] /api/groom-salaries/summary
[2025-12-27 23:21:08] warn: [MemoryMonitoring] Memory threshold exceeded: 1516MB
[2025-12-27 23:21:08] warn: [auth] Access token is required for GET /groom-salaries/summary from ::ffff:127.0.0.1
[2025-12-27 23:21:08] info: [GET] /api/groom-salaries/summary - 401
[2025-12-27 23:21:08] info: [GET] /api/groom-salaries/history
[2025-12-27 23:21:08] warn: [MemoryMonitoring] Memory threshold exceeded: 1512MB
[2025-12-27 23:21:08] warn: [auth] Access token is required for GET /groom-salaries/history from ::ffff:127.0.0.1
[2025-12-27 23:21:08] info: [GET] /api/groom-salaries/history - 401
[2025-12-27 23:21:08] info: [GET] /api/groom-salaries/groom/46778/salary
[2025-12-27 23:21:08] warn: [MemoryMonitoring] Memory threshold exceeded: 1508MB
[2025-12-27 23:21:08] warn: [auth] Access token is required for GET /groom-salaries/groom/46778/salary from ::ffff:127.0.0.1
[2025-12-27 23:21:08] info: [GET] /api/groom-salaries/groom/46778/salary - 401
[2025-12-27 23:21:08] info: [GET] /api/groom-salaries/status
[2025-12-27 23:21:08] warn: [MemoryMonitoring] Memory threshold exceeded: 1520MB
[2025-12-27 23:21:08] warn: [auth] Access token is required for GET /groom-salaries/status from ::ffff:127.0.0.1
[2025-12-27 23:21:08] info: [GET] /api/groom-salaries/status - 401
[2025-12-27 23:21:08] info: [POST] /api/groom-salaries/process
[2025-12-27 23:21:08] warn: [MemoryMonitoring] Memory threshold exceeded: 1516MB
[2025-12-27 23:21:08] warn: [auth] Access token is required for POST /groom-salaries/process from ::ffff:127.0.0.1
[2025-12-27 23:21:08] info: [POST] /api/groom-salaries/process - 401
PASS tests/integration/groomSalarySystem.test.mjs
  Groom Salary System
    Salary Calculation
      ‚àö should calculate correct weekly salary for expert groom with specialty (2 ms)
      ‚àö should calculate correct salary for novice groom (1 ms)
      ‚àö should calculate user total salary cost (6 ms)
    API Endpoints
      ‚àö should get user salary cost (42 ms)
      ‚àö should get salary summary (35 ms)
      ‚àö should get groom salary (36 ms)
      ‚àö should get salary payment history (29 ms)
      ‚àö should get cron job status (32 ms)
      ‚àö should validate groom ownership (58 ms)
    Salary Processing
      ‚àö should process weekly salaries successfully (18 ms)
      ‚àö should handle insufficient funds (18 ms)
      ‚àö should trigger salary processing via API (41 ms)
    Authentication
      ‚àö should require authentication for GET /api/groom-salaries/cost (25 ms)
      ‚àö should require authentication for GET /api/groom-salaries/summary (25 ms)
      ‚àö should require authentication for GET /api/groom-salaries/history (21 ms)
      ‚àö should require authentication for GET /api/groom-salaries/groom/:groomId/salary (24 ms)
      ‚àö should require authentication for GET /api/groom-salaries/status (22 ms)
      ‚àö should require authentication for POST /api/groom-salaries/process (23 ms)

[2025-12-27 23:21:08] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:08] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:08] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 7 horses
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateEffectivePopulationSize] Calculating for 7 horses
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.identifyGeneticFounders] Identifying founders in 7 horses
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94436 and mare 94435
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94447 and mare 94442
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.trackPopulationGeneticHealth] Tracking health for 7 horses
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 7 horses
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateEffectivePopulationSize] Calculating for 7 horses
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94449 and mare 94451
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94450 and mare 94452
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94453 and mare 94451
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.identifyGeneticFounders] Identifying founders in 7 horses
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.analyzeGeneticTrends] Analyzing trends for 7 horses
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 3 horses
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:08] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94457 and mare 94456
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94458 and mare 94459
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94461 and mare 94456
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.generateOptimalBreedingRecommendations] Generating recommendations for 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94464 and mare 94467
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94464 and mare 94467
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94464 and mare 94466
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94464 and mare 94466
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94464 and mare 94469
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94464 and mare 94469
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94464 and mare 94463
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94464 and mare 94463
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94465 and mare 94467
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94465 and mare 94467
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94465 and mare 94466
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94465 and mare 94466
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94465 and mare 94469
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94465 and mare 94469
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94465 and mare 94463
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94465 and mare 94463
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94468 and mare 94467
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94468 and mare 94467
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94468 and mare 94466
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94468 and mare 94466
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94468 and mare 94469
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94468 and mare 94469
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94468 and mare 94463
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94468 and mare 94463
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94472 and mare 94470
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94472 and mare 94470
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.trackGeneticDiversityOverTime] Tracking diversity for 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 3 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.trackPopulationGeneticHealth] Tracking health for 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateEffectivePopulationSize] Calculating for 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94477 and mare 94478
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94481 and mare 94478
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94479 and mare 94480
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.identifyGeneticFounders] Identifying founders in 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.generateGeneticDiversityReport] Generating report for 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.trackPopulationGeneticHealth] Tracking health for 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.analyzeGeneticTrends] Analyzing trends for 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.generateOptimalBreedingRecommendations] Generating recommendations for 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.trackGeneticDiversityOverTime] Tracking diversity for 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateEffectivePopulationSize] Calculating for 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94484 and mare 94487
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94484 and mare 94487
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 3 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94484 and mare 94489
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94484 and mare 94485
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94484 and mare 94489
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94486 and mare 94487
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94484 and mare 94485
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94488 and mare 94485
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94484 and mare 94490
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94484 and mare 94490
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94486 and mare 94487
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 3 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.identifyGeneticFounders] Identifying founders in 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94484 and mare 94485
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94488 and mare 94485
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 1 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94484 and mare 94485
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.trackPopulationGeneticHealth] Tracking health for 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94488 and mare 94487
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateEffectivePopulationSize] Calculating for 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94488 and mare 94487
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94484 and mare 94485
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94488 and mare 94489
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94488 and mare 94489
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94486 and mare 94487
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94488 and mare 94485
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94488 and mare 94490
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94488 and mare 94490
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.identifyGeneticFounders] Identifying founders in 7 horses
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94488 and mare 94485
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94488 and mare 94485
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94486 and mare 94487
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94486 and mare 94487
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94486 and mare 94489
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94486 and mare 94489
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94486 and mare 94490
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94486 and mare 94490
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.assessBreedingPairCompatibility] Assessing stallion 94486 and mare 94485
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateDetailedInbreedingCoefficient] Analyzing stallion 94486 and mare 94485
[2025-12-27 23:21:09] info: [geneticDiversityTrackingService.calculateAdvancedGeneticDiversity] Analyzing 7 horses
PASS tests/unit/geneticDiversityTracking.test.mjs
  üß¨ Genetic Diversity Tracking System
    üî¨ Advanced Genetic Diversity Algorithms
      ‚àö should calculate comprehensive genetic diversity metrics (162 ms)
      ‚àö should calculate effective population size (57 ms)
      ‚àö should identify genetic founders and their contributions (88 ms)
    üîç Enhanced Inbreeding Analysis
      ‚àö should calculate detailed inbreeding coefficients (58 ms)
      ‚àö should detect inbreeding in population (48 ms)
    üìä Population Genetic Health Tracking
      ‚àö should track population genetic health metrics (106 ms)
      ‚àö should analyze genetic trends over time (91 ms)
    üéØ Optimal Breeding Recommendations
      ‚àö should generate optimal breeding recommendations (202 ms)
      ‚àö should assess breeding pair compatibility (40 ms)
    üìà Genetic Diversity Tracking Over Time
      ‚àö should track genetic diversity changes over time (112 ms)
      ‚àö should generate comprehensive genetic diversity report (266 ms)

[2025-12-27 23:21:09] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:09] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:09] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:10] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:10] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:21:10] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:21:10] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:21:10] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:21:10] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:21:10] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculating trait score for horse 94491
[2025-12-27 23:21:10] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculated trait score 14/30 for horse 94491
[2025-12-27 23:21:10] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculating trait score for horse 94492
[2025-12-27 23:21:10] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculated trait score 5/30 for horse 94492
[2025-12-27 23:21:10] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculating trait score for horse 94493
[2025-12-27 23:21:10] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculated trait score 10/30 for horse 94493
[2025-12-27 23:21:10] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculating trait score for horse 94494
[2025-12-27 23:21:10] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculated trait score 5/30 for horse 94494
[2025-12-27 23:21:10] info: [legacyScoreCalculator.calculateLegacyScore] Calculating legacy score for horse 94495
[2025-12-27 23:21:10] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculating trait score for horse 94495
[2025-12-27 23:21:10] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculated trait score 5/30 for horse 94495
[2025-12-27 23:21:10] info: [legacyScoreCalculator.calculateLegacyScore] Calculated legacy score 29/100 (F) for horse 94495
[2025-12-27 23:21:10] info: [legacyScoreCalculator.calculateLegacyScore] Calculating legacy score for horse 94496
[2025-12-27 23:21:10] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculating trait score for horse 94496
[2025-12-27 23:21:10] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculated trait score 0/30 for horse 94496
[2025-12-27 23:21:10] info: [legacyScoreCalculator.calculateLegacyScore] Calculated legacy score 24/100 (F) for horse 94496
[2025-12-27 23:21:10] info: [GET] /api/horses/94497/legacy-score
[2025-12-27 23:21:10] warn: [MemoryMonitoring] Memory threshold exceeded: 1569MB
[2025-12-27 23:21:10] info: [auth] Authenticated user d71aad4c-e998-4663-96ff-9e1864ffd687 for GET /horses/94497/legacy-score
[2025-12-27 23:21:10] info: [ownership] Validated ownership: user d71aad4c-e998-4663-96ff-9e1864ffd687 owns horse 94497
[2025-12-27 23:21:10] info: [legacyScoreCalculator.calculateLegacyScore] Calculating legacy score for horse 94497
[2025-12-27 23:21:11] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculating trait score for horse 94497
[2025-12-27 23:21:11] info: [legacyScoreTraitCalculator.calculateTraitScore] Calculated trait score 5/30 for horse 94497
[2025-12-27 23:21:11] info: [legacyScoreCalculator.calculateLegacyScore] Calculated legacy score 29/100 (F) for horse 94497
[2025-12-27 23:21:11] info: [GET] /api/horses/94497/legacy-score - 200
[2025-12-27 23:21:11] info: [GET] /api/horses/94498/legacy-score
[2025-12-27 23:21:11] warn: [MemoryMonitoring] Memory threshold exceeded: 1574MB
[2025-12-27 23:21:11] warn: [auth] Access token is required for GET /horses/94498/legacy-score from ::ffff:127.0.0.1
[2025-12-27 23:21:11] info: [GET] /api/horses/94498/legacy-score - 401
[2025-12-27 23:21:11] info: [GET] /api/horses/99999/legacy-score
[2025-12-27 23:21:11] warn: [MemoryMonitoring] Memory threshold exceeded: 1573MB
[2025-12-27 23:21:11] info: [auth] Authenticated user 68b71f02-1774-4232-a6e3-aa9474035fdf for GET /horses/99999/legacy-score
[2025-12-27 23:21:11] warn: [ownership] horse 99999 not found or not owned by user 68b71f02-1774-4232-a6e3-aa9474035fdf
[2025-12-27 23:21:11] info: [GET] /api/horses/99999/legacy-score - 404
PASS tests/legacyScoreTraitIntegration.test.mjs
  Legacy Score Trait Integration System
    Trait Score Calculation
      ‚àö should calculate trait score based on count, diversity, and rarity (118 ms)
      ‚àö should apply negative trait penalties (30 ms)
      ‚àö should only count traits gained before age 4 (34 ms)
      ‚àö should calculate groom care consistency from milestone logs (34 ms)
    Legacy Score Integration
      ‚àö should integrate trait score into overall legacy score (40 ms)
      ‚àö should calculate legacy score without traits (40 ms)
    API Endpoints
      ‚àö should get horse legacy score via API (76 ms)
      ‚àö should require authentication for legacy score endpoint (37 ms)
      ‚àö should return 404 for non-existent horse (45 ms)

[2025-12-27 23:21:11] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:11] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:11] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:11] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:12] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:21:12] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:21:12] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:21:12] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:21:12] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generating trait timeline for horse 94500
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generated timeline with 5 events for horse 94500
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generating trait timeline for horse 94501
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generated timeline with 1 events for horse 94501
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generating trait timeline for horse 94502
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generated timeline with 1 events for horse 94502
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generating trait timeline for horse 94503
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generated timeline with 4 events for horse 94503
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generating trait timeline for horse 94504
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generated timeline with 0 events for horse 94504
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generating trait timeline for horse 94505
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generated timeline with 6 events for horse 94505
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generating trait timeline for horse 94506
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generated timeline with 4 events for horse 94506
[2025-12-27 23:21:12] info: [GET] /api/horses/94507/trait-card
[2025-12-27 23:21:12] warn: [MemoryMonitoring] Memory threshold exceeded: 1615MB
[2025-12-27 23:21:12] info: [auth] Authenticated user 383eb63e-274e-43b3-8d1c-ed5b867a2f3a for GET /horses/94507/trait-card
[2025-12-27 23:21:12] info: [ownership] Validated ownership: user 383eb63e-274e-43b3-8d1c-ed5b867a2f3a owns horse 94507
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generating trait timeline for horse 94507
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generated timeline with 1 events for horse 94507
[2025-12-27 23:21:12] info: [GET] /api/horses/94507/trait-card - 200
[2025-12-27 23:21:12] info: [GET] /api/horses/94508/trait-card
[2025-12-27 23:21:12] warn: [MemoryMonitoring] Memory threshold exceeded: 1604MB
[2025-12-27 23:21:12] warn: [auth] Access token is required for GET /horses/94508/trait-card from ::ffff:127.0.0.1
[2025-12-27 23:21:12] info: [GET] /api/horses/94508/trait-card - 401
[2025-12-27 23:21:12] info: [GET] /api/horses/99999/trait-card
[2025-12-27 23:21:12] warn: [MemoryMonitoring] Memory threshold exceeded: 1604MB
[2025-12-27 23:21:12] info: [auth] Authenticated user d87860c4-6536-4409-a566-809a8e0fabf9 for GET /horses/99999/trait-card
[2025-12-27 23:21:12] warn: [ownership] horse 99999 not found or not owned by user d87860c4-6536-4409-a566-809a8e0fabf9
[2025-12-27 23:21:12] info: [GET] /api/horses/99999/trait-card - 404
[2025-12-27 23:21:12] info: [GET] /api/horses/94510/trait-card
[2025-12-27 23:21:12] warn: [MemoryMonitoring] Memory threshold exceeded: 1605MB
[2025-12-27 23:21:12] info: [auth] Authenticated user 435d7378-89bc-4c07-934e-b2fa62ab5794 for GET /horses/94510/trait-card
[2025-12-27 23:21:12] info: [ownership] Validated ownership: user 435d7378-89bc-4c07-934e-b2fa62ab5794 owns horse 94510
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generating trait timeline for horse 94510
[2025-12-27 23:21:12] info: [traitTimelineService.generateTraitTimeline] Generated timeline with 0 events for horse 94510
[2025-12-27 23:21:12] info: [GET] /api/horses/94510/trait-card - 200
PASS tests/traitTimeline.test.mjs
  Trait Timeline System
    Trait Timeline Data Aggregation
      ‚àö should aggregate trait timeline with milestone and groom data (122 ms)
      ‚àö should include detailed trait context and groom involvement (31 ms)
      ‚àö should filter traits by age cutoff (before age 4) (31 ms)
      ‚àö should categorize traits by type and rarity (34 ms)
      ‚àö should handle horses with no trait history (27 ms)
    Timeline Formatting and Organization
      ‚àö should organize events by age ranges (40 ms)
      ‚àö should include bond and stress trend analysis (29 ms)
    API Endpoints
      ‚àö should get trait timeline card via API (76 ms)
      ‚àö should require authentication for trait card endpoint (41 ms)
      ‚àö should return 404 for non-existent horse (44 ms)
      ‚àö should handle horses with empty trait timeline (63 ms)

[2025-12-27 23:21:12] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:12] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:12] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:13] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:13] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:21:13] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:21:13] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:21:13] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:21:13] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:21:13] info: [POST] /api/horses/foals
[2025-12-27 23:21:13] warn: [MemoryMonitoring] Memory threshold exceeded: 1646MB
[2025-12-27 23:21:13] info: [horseController.createFoal] Creating foal: Test Foal with sire 1 and dam 2
[2025-12-27 23:21:13] info: [horseModel.getHorseById] Successfully found horse: Test Sire (ID: 1)
[2025-12-27 23:21:13] info: [horseModel.getHorseById] Successfully found horse: Test Dam (ID: 2)
[2025-12-27 23:21:13] info: [horseController.gatherLineage] Gathering lineage for sire 1 and dam 2, 3 generations
[2025-12-27 23:21:13] info: [horseController.gatherLineage] Gathered 2 ancestors
[2025-12-27 23:21:13] info: [horseController.assessFeedQualityFromMare] Mare Test Dam feed quality: 75 (health: Good, bond: 50)
[2025-12-27 23:21:13] info: [horseController.createFoal] Mare stress: 15, Feed quality: 75, Lineage count: 2
[2025-12-27 23:21:13] info: [applyEpigeneticTraitsAtBirth] Starting trait assignment at birth
[2025-12-27 23:21:13] info: [applyEpigeneticTraitsAtBirth] Mare stress: 15, Feed quality: 75
[2025-12-27 23:21:13] info: [applyEpigeneticTraitsAtBirth] Final traits assigned: {"positive":[],"negative":[]}
[2025-12-27 23:21:13] info: [horseController.createFoal] Applied epigenetic traits: {"positive":[],"negative":[]}
[2025-12-27 23:21:13] info: [horseModel.createHorse] Applying at-birth traits for newborn with sire 1 and dam 2
[2025-12-27 23:21:13] info: [atBirthTraits.applyEpigeneticTraitsAtBirth] Applying at-birth traits for sire 1 and dam 2
[2025-12-27 23:21:13] info: [atBirthTraits.assessFeedQuality] Mare 2 feed quality: 50
[2025-12-27 23:21:13] info: [atBirthTraits.applyEpigeneticTraitsAtBirth] Mare stress: 15, Feed quality: 50
[2025-12-27 23:21:14] info: [atBirthTraits.analyzeLineage] Analyzing lineage for sire 1 and dam 2
[2025-12-27 23:21:14] info: [atBirthTraits.analyzeLineage] Found 0 ancestors, 0 competitions
[2025-12-27 23:21:14] info: [atBirthTraits.detectInbreeding] Checking for inbreeding between sire 1 and dam 2
[2025-12-27 23:21:14] info: [atBirthTraits.detectInbreeding] Inbreeding not detected
[2025-12-27 23:21:14] info: [atBirthTraits.applyEpigeneticTraitsAtBirth] Breeding conditions: {"mareStress":15,"feedQuality":50,"disciplineSpecialization":false,"inbreedingDetected":false,"noInbreeding":true}
[2025-12-27 23:21:14] info: [atBirthTraits.applyEpigeneticTraitsAtBirth] Final traits: {"positive":[],"negative":[],"hidden":[]}
[2025-12-27 23:21:14] info: [horseModel.createHorse] Applied at-birth traits: {"positive":[],"negative":[],"hidden":[]}
[2025-12-27 23:21:14] info: [horseModel.createHorse] Breeding analysis - Lineage specialization: false, Inbreeding: false
[2025-12-27 23:21:14] info: [horseModel.createHorse] Successfully created horse: Integration Test Foal (ID: 3)
[2025-12-27 23:21:14] info: [horseController.createFoal] Successfully created foal: Integration Test Foal (ID: 3)
[2025-12-27 23:21:14] info: [POST] /api/horses/foals - 201
PASS tests/foalCreationIntegration.test.mjs
  üê¥ INTEGRATION: Foal Creation Integration - API Endpoint Validation
    ‚àö should accept valid foal creation data structure (267 ms)

[2025-12-27 23:21:14] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:14] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:14] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:14] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:15] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:21:15] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:21:15] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:21:15] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:21:15] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:21:15] info: [GET] /api/horses/trainable/test-user-uuid-123
[2025-12-27 23:21:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1693MB
[2025-12-27 23:21:15] info: [trainingController.getTrainableHorses] Getting trainable horses for user test-user-uuid-123
[2025-12-27 23:21:15] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 1 across all disciplines
[2025-12-27 23:21:15] error: [trainingModel.getAnyRecentTraining] Database error: Cannot read properties of undefined (reading 'findFirst')
[2025-12-27 23:21:15] warn: [trainingController.getTrainableHorses] Error checking training eligibility for horse 1: Database error: Cannot read properties of undefined (reading 'findFirst')
[2025-12-27 23:21:15] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 2 across all disciplines
[2025-12-27 23:21:15] error: [trainingModel.getAnyRecentTraining] Database error: Cannot read properties of undefined (reading 'findFirst')
[2025-12-27 23:21:15] warn: [trainingController.getTrainableHorses] Error checking training eligibility for horse 2: Database error: Cannot read properties of undefined (reading 'findFirst')
[2025-12-27 23:21:15] info: [trainingController.getTrainableHorses] Found 0 trainable horses for user test-user-uuid-123
[2025-12-27 23:21:15] info: [GET] /api/horses/trainable/test-user-uuid-123 - 200
[2025-12-27 23:21:15] info: [GET] /api/horses/trainable/nonexistent-user-uuid-456
[2025-12-27 23:21:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1698MB
[2025-12-27 23:21:15] info: [trainingController.getTrainableHorses] Getting trainable horses for user nonexistent-user-uuid-456
[2025-12-27 23:21:15] warn: [trainingController.getTrainableHorses] User nonexistent-user-uuid-456 not found
[2025-12-27 23:21:15] info: [GET] /api/horses/trainable/nonexistent-user-uuid-456 - 200
[2025-12-27 23:21:15] info: [GET] /api/horses/trainable/
[2025-12-27 23:21:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1693MB
[2025-12-27 23:21:15] info: [GET] /api/horses/trainable/ - 400
[2025-12-27 23:21:15] info: [GET] /api/horses/trainable/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
[2025-12-27 23:21:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1688MB
[2025-12-27 23:21:15] info: [GET] /api/horses/trainable/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa - 400
[2025-12-27 23:21:15] info: [GET] /api/horses/trainable/test-user-uuid-123
[2025-12-27 23:21:15] warn: [MemoryMonitoring] Memory threshold exceeded: 1697MB
[2025-12-27 23:21:15] info: [trainingController.getTrainableHorses] Getting trainable horses for user test-user-uuid-123
[2025-12-27 23:21:15] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 1 across all disciplines
[2025-12-27 23:21:15] error: [trainingModel.getAnyRecentTraining] Database error: Cannot read properties of undefined (reading 'findFirst')
[2025-12-27 23:21:15] warn: [trainingController.getTrainableHorses] Error checking training eligibility for horse 1: Database error: Cannot read properties of undefined (reading 'findFirst')
[2025-12-27 23:21:15] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 2 across all disciplines
[2025-12-27 23:21:15] error: [trainingModel.getAnyRecentTraining] Database error: Cannot read properties of undefined (reading 'findFirst')
[2025-12-27 23:21:15] warn: [trainingController.getTrainableHorses] Error checking training eligibility for horse 2: Database error: Cannot read properties of undefined (reading 'findFirst')
[2025-12-27 23:21:15] info: [trainingController.getTrainableHorses] Found 0 trainable horses for user test-user-uuid-123
[2025-12-27 23:21:15] info: [GET] /api/horses/trainable/test-user-uuid-123 - 200
PASS tests/integration/horseRoutes.test.mjs
  Horse Routes Integration Tests
    GET /api/horses/trainable/:userId
      ‚àö should return trainable horses for valid user ID (135 ms)
      ‚àö should return empty array for non-existent user (97 ms)
      ‚àö should return validation error for invalid user ID (91 ms)
      ‚àö should return validation error for user ID that is too long (96 ms)
      ‚àö should handle server errors gracefully (100 ms)

[2025-12-27 23:21:15] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:15] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:15] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /metrics
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /metrics
[2025-12-27 23:21:16] warn: [auth] Access token is required for GET /metrics from ::ffff:127.0.0.1
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /performance
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /performance
[2025-12-27 23:21:16] info: [ApiOptimization] Getting performance metrics for timeframe: 24h
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /performance
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /performance
[2025-12-27 23:21:16] info: [ApiOptimization] Getting performance metrics for timeframe: 1h
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /performance
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /performance
[2025-12-27 23:21:16] info: [ApiOptimization] Getting performance metrics for timeframe: 24h
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /performance
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /performance
[2025-12-27 23:21:16] info: [ApiOptimization] Getting performance metrics for timeframe: 7d
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /performance
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /performance
[2025-12-27 23:21:16] info: [ApiOptimization] Getting performance metrics for timeframe: 30d
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /performance
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /performance
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /compression-stats
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /compression-stats
[2025-12-27 23:21:16] info: [ApiOptimization] Getting compression statistics
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /cache-analytics
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /cache-analytics
[2025-12-27 23:21:16] info: [ApiOptimization] Getting cache analytics
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-compression
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-compression
[2025-12-27 23:21:16] info: [ApiOptimization] Testing compression with algorithm: gzip
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-compression
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-compression
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-compression
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-compression
[2025-12-27 23:21:16] info: [ApiOptimization] Testing compression with algorithm: gzip
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-compression
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-compression
[2025-12-27 23:21:16] info: [ApiOptimization] Testing compression with algorithm: brotli
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-compression
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-compression
[2025-12-27 23:21:16] info: [ApiOptimization] Testing compression with algorithm: deflate
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-pagination
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-pagination
[2025-12-27 23:21:16] info: [ApiOptimization] Testing offset pagination with 100 items
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-pagination
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-pagination
[2025-12-27 23:21:16] info: [ApiOptimization] Testing cursor pagination with 100 items
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-pagination
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-pagination
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-pagination
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-pagination
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-pagination
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-pagination
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /recommendations
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for GET /recommendations
[2025-12-27 23:21:16] info: [ApiOptimization] Generating optimization recommendations
[2025-12-27 23:21:16] warn: [auth] Invalid or expired token for GET /metrics from ::ffff:127.0.0.1
[2025-12-27 23:21:16] warn: [auth] Access token is required for GET /metrics from ::ffff:127.0.0.1
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-compression
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-compression
[2025-12-27 23:21:16] info: [ApiOptimization] Testing compression with algorithm: gzip
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-pagination
[2025-12-27 23:21:16] info: [auth] Authenticated user 0fd0e504-ba31-44d4-b954-c066f1e9d447 for POST /test-pagination
[2025-12-27 23:21:16] info: [ApiOptimization] Testing offset pagination with 1000 items
PASS __tests__/routes/apiOptimizationRoutes.test.mjs
  API Optimization Routes
    GET /api/optimization/metrics
      ‚àö retrieves optimization metrics successfully (32 ms)
      ‚àö requires authentication (17 ms)
    GET /api/optimization/performance
      ‚àö retrieves performance analytics with default timeframe (23 ms)
      ‚àö accepts different timeframe parameters (78 ms)
      ‚àö validates timeframe parameter (20 ms)
    GET /api/optimization/compression-stats
      ‚àö retrieves compression statistics successfully (21 ms)
    GET /api/optimization/cache-analytics
      ‚àö retrieves cache analytics successfully (24 ms)
    POST /api/optimization/test-compression
      ‚àö tests compression on sample data successfully (31 ms)
      ‚àö validates required data parameter (19 ms)
      ‚àö accepts different compression algorithms (54 ms)
    POST /api/optimization/test-pagination
      ‚àö tests offset pagination successfully (23 ms)
      ‚àö tests cursor pagination successfully (18 ms)
      ‚àö validates pagination parameters (54 ms)
    GET /api/optimization/recommendations
      ‚àö generates optimization recommendations successfully (20 ms)
    Error Handling
      ‚àö handles invalid authentication tokens (15 ms)
      ‚àö handles missing authorization header (13 ms)
    Performance Validation
      ‚àö compression test shows meaningful results (22 ms)
      ‚àö pagination test shows performance metrics (20 ms)

[2025-12-27 23:21:16] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:16] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:16] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:17] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:17] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:21:17] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:21:17] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:21:17] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:21:17] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
[2025-12-27 23:21:17] info: [GET] /api/horses/94511/overview
[2025-12-27 23:21:17] warn: [MemoryMonitoring] Memory threshold exceeded: 1758MB
[2025-12-27 23:21:17] info: [auth] Authenticated user f5b24504-337d-461b-be4b-1d367003edfd for GET /horses/94511/overview
[2025-12-27 23:21:17] info: [ownership] Validated ownership: user f5b24504-337d-461b-be4b-1d367003edfd owns horse 94511
[2025-12-27 23:21:17] info: [horseController.getHorseOverview] Getting overview for horse 94511
[2025-12-27 23:21:17] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94511 across all disciplines
[2025-12-27 23:21:17] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94511: Sat Dec 20 2025 23:21:17 GMT-0500 (Eastern Standard Time) (discipline: Dressage)
[2025-12-27 23:21:17] info: [horseController.getHorseOverview] Successfully retrieved overview for horse TestHorse Nova (ID: 94511)
[2025-12-27 23:21:17] info: [GET] /api/horses/94511/overview - 200
[2025-12-27 23:21:17] info: [GET] /api/horses/99999/overview
[2025-12-27 23:21:17] warn: [MemoryMonitoring] Memory threshold exceeded: 1764MB
[2025-12-27 23:21:17] info: [auth] Authenticated user a0dfb6ba-117c-47a3-ba2f-55bad04f9173 for GET /horses/99999/overview
[2025-12-27 23:21:17] warn: [ownership] horse 99999 not found or not owned by user a0dfb6ba-117c-47a3-ba2f-55bad04f9173
[2025-12-27 23:21:17] info: [GET] /api/horses/99999/overview - 404
[2025-12-27 23:21:18] info: [GET] /api/horses/invalid/overview
[2025-12-27 23:21:18] warn: [MemoryMonitoring] Memory threshold exceeded: 1763MB
[2025-12-27 23:21:18] info: [auth] Authenticated user 73b331a1-3177-49c1-bc92-85f4e99102c5 for GET /horses/invalid/overview
[2025-12-27 23:21:18] info: [GET] /api/horses/invalid/overview - 400
[2025-12-27 23:21:18] info: [GET] /api/horses/94514/overview
[2025-12-27 23:21:18] warn: [MemoryMonitoring] Memory threshold exceeded: 1761MB
[2025-12-27 23:21:18] info: [auth] Authenticated user 12342ac9-637a-49d7-a256-c8123fa9b455 for GET /horses/94514/overview
[2025-12-27 23:21:18] info: [ownership] Validated ownership: user 12342ac9-637a-49d7-a256-c8123fa9b455 owns horse 94514
[2025-12-27 23:21:18] info: [horseController.getHorseOverview] Getting overview for horse 94514
[2025-12-27 23:21:18] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94514 across all disciplines
[2025-12-27 23:21:18] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94514
[2025-12-27 23:21:18] info: [horseController.getHorseOverview] Successfully retrieved overview for horse TestHorse Nova (ID: 94514)
[2025-12-27 23:21:18] info: [GET] /api/horses/94514/overview - 200
[2025-12-27 23:21:18] info: [GET] /api/horses/94515/overview
[2025-12-27 23:21:18] warn: [MemoryMonitoring] Memory threshold exceeded: 1765MB
[2025-12-27 23:21:18] info: [auth] Authenticated user 3ca48b3c-58e0-4afe-84c5-e7bbae826116 for GET /horses/94515/overview
[2025-12-27 23:21:18] info: [ownership] Validated ownership: user 3ca48b3c-58e0-4afe-84c5-e7bbae826116 owns horse 94515
[2025-12-27 23:21:18] info: [horseController.getHorseOverview] Getting overview for horse 94515
[2025-12-27 23:21:18] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94515 across all disciplines
[2025-12-27 23:21:18] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94515: Wed Dec 24 2025 23:21:18 GMT-0500 (Eastern Standard Time) (discipline: Dressage)
[2025-12-27 23:21:18] info: [horseController.getHorseOverview] Successfully retrieved overview for horse TestHorse Nova (ID: 94515)
[2025-12-27 23:21:18] info: [GET] /api/horses/94515/overview - 200
[2025-12-27 23:21:18] info: [GET] /api/horses/94517/overview
[2025-12-27 23:21:18] warn: [MemoryMonitoring] Memory threshold exceeded: 1767MB
[2025-12-27 23:21:18] info: [auth] Authenticated user 10dead77-9ff6-4121-95a6-be3091607771 for GET /horses/94517/overview
[2025-12-27 23:21:18] info: [ownership] Validated ownership: user 10dead77-9ff6-4121-95a6-be3091607771 owns horse 94517
[2025-12-27 23:21:18] info: [horseController.getHorseOverview] Getting overview for horse 94517
[2025-12-27 23:21:18] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94517 across all disciplines
[2025-12-27 23:21:18] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94517
[2025-12-27 23:21:18] info: [horseController.getHorseOverview] Successfully retrieved overview for horse TestHorse Minimal (ID: 94517)
[2025-12-27 23:21:18] info: [GET] /api/horses/94517/overview - 200
PASS tests/integration/horseOverview.test.mjs
  üèá INTEGRATION: Horse Overview API - Real Database Integration
    GET /api/horses/:id/overview
      ‚àö should return complete horse overview data successfully (256 ms)
      ‚àö should return 404 for non-existent horse (49 ms)
      ‚àö should return validation error for invalid horse ID (43 ms)
      ‚àö should handle horse with no training history gracefully (55 ms)
      ‚àö should calculate next training date correctly when horse has recent training (55 ms)
      ‚àö should handle missing optional fields gracefully (59 ms)

[2025-12-27 23:21:18] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:18] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:18] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:18] info: [cronJobService] Initializing cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs initialized and started
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: weeklySalaries
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: tokenCleanup
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Initializing cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs initialized and started
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: weeklySalaries
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: tokenCleanup
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Initializing cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs initialized and started
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: weeklySalaries
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: tokenCleanup
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Initializing cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs initialized and started
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: weeklySalaries
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: tokenCleanup
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Initializing cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs initialized and started
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: weeklySalaries
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: tokenCleanup
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Initializing cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs initialized and started
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: weeklySalaries
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: tokenCleanup
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Initializing cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs initialized and started
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: weeklySalaries
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: tokenCleanup
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Initializing cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs initialized and started
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: weeklySalaries
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: tokenCleanup
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Initializing cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs initialized and started
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: weeklySalaries
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: tokenCleanup
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 1 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":1,"expired":1,"invalidated":0,"timestamp":"2025-12-28T04:21:18.690Z"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 0 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":0,"expired":0,"invalidated":0,"timestamp":"2025-12-28T04:21:18.707Z"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 5 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":5,"expired":5,"invalidated":0,"timestamp":"2025-12-28T04:21:18.734Z"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 2 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":2,"expired":2,"invalidated":0,"timestamp":"2025-12-28T04:21:18.750Z"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 3 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":3,"expired":3,"invalidated":0,"timestamp":"2025-12-28T04:21:18.769Z"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 0 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":0,"expired":0,"invalidated":0,"timestamp":"2025-12-28T04:21:18.787Z"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 0 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":0,"expired":0,"invalidated":0,"timestamp":"2025-12-28T04:21:18.798Z"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 1 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":1,"expired":1,"invalidated":0,"timestamp":"2025-12-28T04:21:18.812Z"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] error: [TokenRotation] Error cleaning up tokens: Database connection failed
[2025-12-27 23:21:18] error: [cronJobService] Token cleanup error: Database connection failed
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":0,"timestamp":"2025-12-28T04:21:18.826Z","error":"Database connection failed"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Initializing cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs initialized and started
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: weeklySalaries
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: tokenCleanup
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Initializing cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs initialized and started
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 1 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: weeklySalaries
[2025-12-27 23:21:18] info: [cronJobService] Stopped job: tokenCleanup
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 0 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":0,"expired":0,"invalidated":0,"timestamp":"2025-12-28T04:21:18.865Z"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 10 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":10,"expired":10,"invalidated":0,"timestamp":"2025-12-28T04:21:18.895Z"}
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 0 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":0,"expired":0,"invalidated":0,"timestamp":"2025-12-28T04:21:18.942Z"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 1 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":1,"expired":1,"invalidated":0,"timestamp":"2025-12-28T04:21:18.960Z"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:18] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:18] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:18] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:18] info: [cronJobService] Token cleanup completed. Removed 0 expired/invalidated tokens
[2025-12-27 23:21:18] info: [cronJobService] Manual token cleanup completed: {"removed":0,"expired":0,"invalidated":0,"timestamp":"2025-12-28T04:21:18.976Z"}
[2025-12-27 23:21:18] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:18] info: [cronJobService] All cron jobs stopped
[2025-12-27 23:21:19] info: [cronJobService] Manually triggering token cleanup...
[2025-12-27 23:21:19] info: [cronJobService] Starting expired token cleanup...
[2025-12-27 23:21:19] info: [TokenRotation] Token cleanup completed
[2025-12-27 23:21:19] info: [cronJobService] Token cleanup completed. Removed 100 expired/invalidated tokens
[2025-12-27 23:21:19] info: [cronJobService] Manual token cleanup completed: {"removed":100,"expired":100,"invalidated":0,"timestamp":"2025-12-28T04:21:19.265Z"}
[2025-12-27 23:21:19] info: [cronJobService] Stopping all cron jobs...
[2025-12-27 23:21:19] info: [cronJobService] All cron jobs stopped
PASS __tests__/services/cronJobService.test.mjs
  Cron Job Service
    initializeCronJobs()
      ‚àö should initialize weekly salary job (19 ms)
      ‚àö should initialize token cleanup job (10 ms)
      ‚àö should start all jobs after initialization (12 ms)
      ‚àö should initialize exactly 2 cron jobs (7 ms)
      ‚àö should use UTC timezone for all jobs (8 ms)
    stopCronJobs()
      ‚àö should stop all running jobs (13 ms)
      ‚àö should handle stopping when no jobs initialized (6 ms)
      ‚àö should clear all job references (9 ms)
    getCronJobStatus()
      ‚àö should return status for all initialized jobs (11 ms)
      ‚àö should return empty status when no jobs initialized (4 ms)
      ‚àö should include running and scheduled flags (7 ms)
    triggerTokenCleanup() - Manual Execution
      ‚àö should remove expired tokens (24 ms)
      ‚àö should NOT remove valid tokens (16 ms)
      ‚àö should remove multiple expired tokens (23 ms)
      ‚àö should remove expired tokens for all users (17 ms)
      ‚àö should remove only expired tokens from mixed set (24 ms)
      ‚àö should return timestamp of cleanup (11 ms)
      ‚àö should handle cleanup when no expired tokens exist (11 ms)
      ‚àö should handle tokens expiring at exact current time (15 ms)
      ‚àö should include error message on failure (14 ms)
    Token Cleanup Scheduling
      ‚àö should schedule daily cleanup at 3 AM UTC (10 ms)
      ‚àö should execute token cleanup callback when triggered (19 ms)
    Edge Cases
      ‚àö should handle tokens with null expiresAt (should not crash) (10 ms)
      ‚àö should handle concurrent cleanup executions (79 ms)
      ‚àö should handle very old expired tokens (15 ms)
      ‚àö should handle tokens expiring in the future (16 ms)
    Performance
      ‚àö should efficiently remove large number of expired tokens (290 ms)

[2025-12-27 23:21:19] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:19] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:19] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:19] info: [UserDocService] Loaded 1 documentation files
[2025-12-27 23:21:19] info: [UserDocService] Built search index with 34 terms
[2025-12-27 23:21:19] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:19] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:19] info: [UserDocService] Built search index with 111 terms
[2025-12-27 23:21:19] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:19] info: [UserDocRoutes] Getting all documentation list
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting all documentation list
[2025-12-27 23:21:20] info: [UserDocRoutes] Searching documentation for: "horse training"
[2025-12-27 23:21:20] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:21:20] info: [UserDocRoutes] Searching documentation for: "nonexistentterm12345"
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: feature-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: strategy-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting documentation analytics
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting table of contents
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: feature-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: non-existent
[2025-12-27 23:21:20] warn: [UserDocService] Document not found: non-existent
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: feature-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: feature-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: feature-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: feature-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: feature-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting sections for document: feature-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting sections for document: non-existent
[2025-12-27 23:21:20] warn: [UserDocService] Document not found: non-existent
[2025-12-27 23:21:20] info: [UserDocRoutes] Searching in document "feature-guide" for: "training"
[2025-12-27 23:21:20] info: [UserDocRoutes] Searching in document "feature-guide" for: "horse"
[2025-12-27 23:21:20] info: [UserDocRoutes] Searching in document "non-existent" for: "test"
[2025-12-27 23:21:20] warn: [UserDocService] Document not found: non-existent
[2025-12-27 23:21:20] info: [UserDocRoutes] Refreshing documentation cache
[2025-12-27 23:21:20] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:20] info: [UserDocService] Built search index with 111 terms
[2025-12-27 23:21:20] info: [UserDocService] Documentation refreshed successfully
[2025-12-27 23:21:20] info: [UserDocRoutes] Searching documentation for: "horse"
[2025-12-27 23:21:20] info: [UserDocRoutes] Searching documentation for: "training"
[2025-12-27 23:21:20] info: [UserDocRoutes] Searching documentation for: "competition"
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting documentation analytics
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: feature-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: feature-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: strategy-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting documentation analytics
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: feature-guide
[2025-12-27 23:21:20] info: [UserDocRoutes] Getting document: feature-guide
PASS __tests__/routes/userDocumentationRoutes.test.mjs
  User Documentation Routes
    GET /api/user-docs
      ‚àö retrieves all documentation successfully (49 ms)
      ‚àö includes table of contents in response (15 ms)
    GET /api/user-docs/search
      ‚àö searches documentation successfully (18 ms)
      ‚àö validates search query parameter (17 ms)
      ‚àö respects search parameters (14 ms)
      ‚àö handles empty search results (13 ms)
    GET /api/user-docs/analytics
      ‚àö retrieves analytics successfully (61 ms)
    GET /api/user-docs/toc
      ‚àö retrieves table of contents successfully (15 ms)
    GET /api/user-docs/:docName
      ‚àö retrieves specific document successfully (19 ms)
      ‚àö returns 404 for non-existent document (16 ms)
      ‚àö serves markdown format correctly (16 ms)
      ‚àö serves text format correctly (13 ms)
      ‚àö tracks view analytics (40 ms)
    GET /api/user-docs/:docName/sections
      ‚àö retrieves document sections successfully (17 ms)
      ‚àö returns 404 for non-existent document sections (16 ms)
    GET /api/user-docs/:docName/search
      ‚àö searches within specific document successfully (15 ms)
      ‚àö validates search query for document search (10 ms)
      ‚àö highlights search terms in document search (13 ms)
      ‚àö returns 404 for document search on non-existent document (15 ms)
    POST /api/user-docs/refresh
      ‚àö refreshes documentation cache successfully (19 ms)
    GET /api/user-docs/health
      ‚àö returns system health status (15 ms)
    Error Handling
      ‚àö handles invalid route gracefully (12 ms)
      ‚àö handles malformed search parameters (11 ms)
    Integration with Documentation Service
      ‚àö search analytics are tracked across API calls (51 ms)
      ‚àö view analytics are tracked across API calls (52 ms)
      ‚àö document content is consistent across different endpoints (29 ms)

[2025-12-27 23:21:20] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:20] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:20] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:20] info: Incremented career weeks for groom 46800 to 1
[2025-12-27 23:21:20] info: Incremented career weeks for groom 46801 to 1
[2025-12-27 23:21:20] info: Incremented career weeks for groom 46801 to 2
[2025-12-27 23:21:20] info: Incremented career weeks for groom 46801 to 3
[2025-12-27 23:21:20] error: Error incrementing career weeks for groom 99999: 
Invalid `prisma.groom.update()` invocation:


An operation failed because it depends on one or more records that were required but not found. No record was found for an update.
[2025-12-27 23:21:21] info: Processed retirement for groom 46809 with reason: mandatory_career_limit
[2025-12-27 23:21:21] info: Processed retirement for groom 46810 with reason: voluntary
[2025-12-27 23:21:21] info: Processed retirement for groom 46811 with reason: voluntary
[2025-12-27 23:21:21] error: Error processing retirement for groom 46812: Groom 46812 is not eligible for retirement
[2025-12-27 23:21:21] info: Starting weekly career progression processing
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46813 to 1
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46814 to 11
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46815 to 51
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46816 to 81
[2025-12-27 23:21:21] info: Processed retirement for groom 46816 with reason: early_level_cap
[2025-12-27 23:21:21] info: Groom Test Groom Level 10 1766895681260 (ID: 46816) retired: early_level_cap
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46817 to 104
[2025-12-27 23:21:21] info: Processed retirement for groom 46817 with reason: mandatory_career_limit
[2025-12-27 23:21:21] info: Groom Test Groom Near Retirement 1766895681260 (ID: 46817) retired: mandatory_career_limit
[2025-12-27 23:21:21] info: Weekly career progression completed: 5 processed, 2 retired, 0 errors
[2025-12-27 23:21:21] info: Starting weekly career progression processing
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46818 to 1
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46819 to 11
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46820 to 51
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46821 to 104
[2025-12-27 23:21:21] info: Processed retirement for groom 46821 with reason: mandatory_career_limit
[2025-12-27 23:21:21] info: Groom Test Groom Near Retirement 1766895681372 (ID: 46821) retired: mandatory_career_limit
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46822 to 81
[2025-12-27 23:21:21] info: Processed retirement for groom 46822 with reason: early_level_cap
[2025-12-27 23:21:21] info: Groom Test Groom Level 10 1766895681373 (ID: 46822) retired: early_level_cap
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46823 to 1
[2025-12-27 23:21:21] info: Weekly career progression completed: 6 processed, 2 retired, 0 errors
[2025-12-27 23:21:21] info: Starting weekly career progression processing
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46824 to 1
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46826 to 51
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46827 to 104
[2025-12-27 23:21:21] info: Processed retirement for groom 46827 with reason: mandatory_career_limit
[2025-12-27 23:21:21] info: Groom Test Groom Near Retirement 1766895681489 (ID: 46827) retired: mandatory_career_limit
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46828 to 81
[2025-12-27 23:21:21] info: Processed retirement for groom 46828 with reason: early_level_cap
[2025-12-27 23:21:21] info: Groom Test Groom Level 10 1766895681489 (ID: 46828) retired: early_level_cap
[2025-12-27 23:21:21] info: Weekly career progression completed: 4 processed, 2 retired, 0 errors
[2025-12-27 23:21:21] info: Starting weekly career progression processing
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46829 to 1
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46830 to 11
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46831 to 51
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46832 to 104
[2025-12-27 23:21:21] info: Processed retirement for groom 46832 with reason: mandatory_career_limit
[2025-12-27 23:21:21] info: Groom Test Groom Near Retirement 1766895681588 (ID: 46832) retired: mandatory_career_limit
[2025-12-27 23:21:21] info: Incremented career weeks for groom 46833 to 81
[2025-12-27 23:21:21] info: Processed retirement for groom 46833 with reason: early_level_cap
[2025-12-27 23:21:21] info: Groom Test Groom Level 10 1766895681588 (ID: 46833) retired: early_level_cap
[2025-12-27 23:21:21] info: Weekly career progression completed: 5 processed, 2 retired, 0 errors
PASS tests/services/groomRetirementService.test.mjs
  Groom Retirement Service
    Career Week Tracking
      ‚àö should increment career weeks correctly (38 ms)
      ‚àö should handle multiple career week increments (24 ms)
      ‚àö should throw error for non-existent groom (18 ms)
    Retirement Eligibility
      ‚àö should identify groom not eligible for retirement (13 ms)
      ‚àö should identify mandatory retirement at 104 weeks (17 ms)
      ‚àö should identify early retirement at level 10 (17 ms)
      ‚àö should identify early retirement with 12+ assignments (140 ms)
      ‚àö should identify retirement notice period (14 ms)
      ‚àö should handle already retired groom (14 ms)
    Retirement Processing
      ‚àö should process mandatory retirement correctly (28 ms)
      ‚àö should process voluntary retirement (19 ms)
      ‚àö should remove active assignments on retirement (23 ms)
      ‚àö should reject retirement for ineligible groom (13 ms)
    Weekly Career Progression
      ‚àö should process weekly career progression for all active grooms (114 ms)
      ‚àö should handle errors gracefully during weekly progression (114 ms)
      ‚àö should skip already retired grooms (100 ms)
      ‚àö should provide detailed statistics (89 ms)

[2025-12-27 23:21:21] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:21] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:21] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:22] info: [groomProgressionService.awardGroomXP] Awarding 20 XP to groom 46834 for milestone_completion
[2025-12-27 23:21:22] info: [groomProgressionService.awardGroomXP] Groom 46834 gained 20 XP: 0 ‚Üí 20 (Level 1 ‚Üí 1)
[2025-12-27 23:21:22] info: [groomProgressionService.awardGroomXP] Awarding 10 XP to groom 46835 for trait_shaped
[2025-12-27 23:21:22] info: [groomProgressionService.awardGroomXP] Groom 46835 gained 10 XP: 0 ‚Üí 10 (Level 1 ‚Üí 1)
[2025-12-27 23:21:22] info: [groomProgressionService.awardGroomXP] Awarding 15 XP to groom 46836 for show_win
[2025-12-27 23:21:22] info: [groomProgressionService.awardGroomXP] Groom 46836 gained 15 XP: 0 ‚Üí 15 (Level 1 ‚Üí 1)
[2025-12-27 23:21:22] info: [groomProgressionService.awardGroomXP] Awarding 100 XP to groom 46837 for milestone_completion
[2025-12-27 23:21:22] info: [groomProgressionService.awardGroomXP] Groom 46837 gained 100 XP: 0 ‚Üí 100 (Level 1 ‚Üí 2)
[2025-12-27 23:21:22] info: [groomProgressionService.awardGroomXP] Awarding 10000 XP to groom 46839 for milestone_completion
[2025-12-27 23:21:22] info: [groomProgressionService.awardGroomXP] Groom 46839 gained 10000 XP: 0 ‚Üí 10000 (Level 1 ‚Üí 10)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46840 and horse 94525: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 1 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46841 and horse 94526: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 1 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46841 and horse 94526: trait_shaped
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 3 (+2)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46841 and horse 94526: rare_trait_influenced
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 6 (+3)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46842 and horse 94527: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 1 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46842 and horse 94527: reassigned_early
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 0 (-5)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46843 and horse 94528: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 1 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46843 and horse 94528: trait_shaped
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 3 (+2)
[2025-12-27 23:21:22] info: [groomProgressionService.logGroomAssignment] Logging assignment assigned for groom 46844 and horse 94529
[2025-12-27 23:21:22] info: [groomProgressionService.logGroomAssignment] Logging assignment assigned for groom 46845 and horse 94530
[2025-12-27 23:21:22] info: [groomProgressionService.logGroomAssignment] Logging assignment unassigned for groom 46845 and horse 94530
[2025-12-27 23:21:22] info: [groomProgressionService.awardGroomXP] Awarding 150 XP to groom 46846 for milestone_completion
[2025-12-27 23:21:22] info: [groomProgressionService.awardGroomXP] Groom 46846 gained 150 XP: 0 ‚Üí 150 (Level 1 ‚Üí 2)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46846 and horse 94531: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 1 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.logGroomAssignment] Logging assignment assigned for groom 46846 and horse 94531
[2025-12-27 23:21:22] info: [groomProgressionService.getGroomProfile] Getting profile for groom 46846
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 1 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 2 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 3 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 4 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 5 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 6 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 7 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 8 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 9 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 10 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 11 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 12 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 13 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 14 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 15 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 16 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 17 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 18 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 19 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 20 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 21 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 22 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 23 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 24 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Updating synergy for groom 46847 and horse 94532: milestone_completed
[2025-12-27 23:21:22] info: [groomProgressionService.updateGroomSynergy] Synergy updated: 25 (+1)
[2025-12-27 23:21:22] info: [groomProgressionService.getGroomProfile] Getting profile for groom 46847
PASS tests/groomProgression.test.mjs
  Groom Progression System
    XP and Leveling System
      ‚àö Should award XP for milestone completion (365 ms)
      ‚àö Should award XP for trait shaping (36 ms)
      ‚àö Should award XP for show wins (35 ms)
      ‚àö Should level up when reaching XP threshold (30 ms)
      ‚àö Should calculate correct level from experience (28 ms)
      ‚àö Should cap level at 10 (31 ms)
    Groom-Horse Synergy System
      ‚àö Should create synergy record for new groom-horse pair (33 ms)
      ‚àö Should award correct synergy for different actions (36 ms)
      ‚àö Should penalize synergy for reassignment (32 ms)
      ‚àö Should track sessions together (35 ms)
    Assignment History Logging
      ‚àö Should log assignment start (29 ms)
      ‚àö Should log assignment completion with performance data (29 ms)
    Enhanced Groom Profile API
      ‚àö Should return comprehensive groom profile (47 ms)
      ‚àö Should include synergy effects in profile (155 ms)

[2025-12-27 23:21:23] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:23] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:23] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS __tests__/unit/dbPoolConfig.test.mjs
  dbPoolConfig
    ‚àö applies explicit pool settings in production (61 ms)
    ‚àö preserves existing query params (54 ms)
    ‚àö applies defaults in production when pool settings are missing (174 ms)

[2025-12-27 23:21:23] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:23] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:23] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:24] info: [groomController.hireGroom] Hiring new groom Sarah Johnson for user test-user-groom-integration
[2025-12-27 23:21:24] info: [groomController.hireGroom] Successfully hired groom Sarah Johnson (ID: 46848) for 750 coins
[2025-12-27 23:21:24] info: [groomController.hireGroom] Hiring new groom Invalid Groom for user test-user-groom-integration
[2025-12-27 23:21:24] info: [groomController.hireGroom] Hiring new groom Expert Groom for user test-user-groom-integration
[2025-12-27 23:21:24] info: [groomController.hireGroom] Successfully hired groom Expert Groom (ID: 46849) for 750 coins
[2025-12-27 23:21:24] info: [groomController.hireGroom] Hiring new groom Novice Groom for user test-user-groom-integration
[2025-12-27 23:21:24] info: [groomController.hireGroom] Successfully hired groom Novice Groom (ID: 46850) for 350 coins
[2025-12-27 23:21:24] info: [groomController.assignGroom] Assigning groom 46851 to foal 94542
[2025-12-27 23:21:24] info: [groomSystem.assignGroomToFoal] Assigning groom 46851 to foal 94542
[2025-12-27 23:21:24] info: [groomSystem.assignGroomToFoal] Successfully assigned Test Assignment Groom to foal Test Foal
[2025-12-27 23:21:24] info: [groomController.assignGroom] Assigning groom 46853 to foal 94545
[2025-12-27 23:21:24] info: [groomSystem.assignGroomToFoal] Assigning groom 46853 to foal 94545
[2025-12-27 23:21:24] info: [groomSystem.assignGroomToFoal] Successfully assigned Second Test Groom to foal Test Foal
[2025-12-27 23:21:24] info: [groomController.assignGroom] Assigning groom 46854 to foal 94548
[2025-12-27 23:21:24] info: [groomController.recordInteraction] Recording trust_building interaction for foal 94551
[2025-12-27 23:21:24] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task trust_building
[2025-12-27 23:21:24] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:21:24] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:21:24] info: [groomController.recordInteraction] Interaction recorded: 10 bonding, -6 stress
[2025-12-27 23:21:24] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46855 for interaction_completed
[2025-12-27 23:21:24] info: [groomProgressionService.awardGroomXP] Groom 46855 gained 2 XP: 0 ‚Üí 2 (Level 1 ‚Üí 1)
[2025-12-27 23:21:24] info: [groomController.recordInteraction] Awarded 2 XP to groom 46855 for interaction
[2025-12-27 23:21:24] info: [groomController.recordInteraction] Recording hoof_handling interaction for foal 94555
[2025-12-27 23:21:24] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task hoof_handling
[2025-12-27 23:21:24] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:21:24] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:21:24] info: [groomController.recordInteraction] Interaction recorded: 8 bonding, -3 stress
[2025-12-27 23:21:24] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46856 for interaction_completed
[2025-12-27 23:21:24] info: [groomProgressionService.awardGroomXP] Groom 46856 gained 2 XP: 0 ‚Üí 2 (Level 1 ‚Üí 1)
[2025-12-27 23:21:24] info: [groomController.recordInteraction] Awarded 2 XP to groom 46856 for interaction
[2025-12-27 23:21:24] info: [groomController.recordInteraction] Recording brushing interaction for foal 94559
[2025-12-27 23:21:24] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task brushing
[2025-12-27 23:21:24] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: task_specialty
[2025-12-27 23:21:24] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: task_specialty
[2025-12-27 23:21:24] info: [groomController.recordInteraction] Interaction recorded: 10 bonding, -6 stress
[2025-12-27 23:21:24] info: [groomController.recordInteraction] Personality effects applied (gentle): task_specialty - 10% increased success rate on nervous or timid horses
[2025-12-27 23:21:24] info: [groomProgressionService.awardGroomXP] Awarding 2 XP to groom 46857 for interaction_completed
[2025-12-27 23:21:24] info: [groomProgressionService.awardGroomXP] Groom 46857 gained 2 XP: 0 ‚Üí 2 (Level 1 ‚Üí 1)
[2025-12-27 23:21:24] info: [groomController.recordInteraction] Awarded 2 XP to groom 46857 for interaction
PASS tests/integration/groomWorkflowIntegration.test.mjs
  Groom Workflow Integration Tests
    1. Complete Groom Hiring Workflow
      ‚àö should hire groom with proper skill calculations and validation (234 ms)
      ‚àö should validate required fields and reject invalid groom data (37 ms)
      ‚àö should calculate proper session rates based on skill level (68 ms)
    2. Groom Assignment Management
      ‚àö should assign groom to foal with proper validation (61 ms)
      ‚àö should handle assignment conflicts and priority management (62 ms)
      ‚àö should validate ownership and authorization (41 ms)
    3. Age-Based Task Validation
      ‚àö should allow enrichment tasks for foals (0-2 years) (201 ms)
      ‚àö should allow grooming tasks for horses 1-3 years old (90 ms)
      ‚àö should allow grooming tasks for horses over 3 years old (76 ms)

[2025-12-27 23:21:25] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:25] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:25] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/services/dynamicCompatibilityScoring.test.mjs
  Dynamic Compatibility Scoring
    calculateDynamicCompatibility
      ‚àö should calculate high compatibility for calm groom with fearful horse (19 ms)
      ‚àö should calculate low compatibility for energetic groom with fearful horse (14 ms)
      ‚àö should calculate moderate compatibility with contextual improvements (11 ms)
      ‚àö should apply experience bonuses correctly (18 ms)
    analyzeCompatibilityFactors
      ‚àö should analyze all compatibility factors comprehensively (11 ms)
      ‚àö should identify risk factors for poor matches (9 ms)
    predictInteractionOutcome
      ‚àö should predict positive outcome for good compatibility (18 ms)
      ‚àö should predict negative outcome for poor compatibility (12 ms)
    updateCompatibilityHistory
      ‚àö should update compatibility history with interaction results (8 ms)
    getOptimalGroomRecommendations
      ‚àö should recommend optimal grooms for specific horse and context (24 ms)
      ‚àö should provide alternative recommendations (19 ms)
    analyzeCompatibilityTrends
      ‚àö should analyze compatibility trends over time (8 ms)

[2025-12-27 23:21:25] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:25] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:25] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Star: Base score for Racing: 165
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Star: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Star: Luck modifier: -3.0%, adjustment: -5.1
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Star: Final score: 165 (base: 165, trait: +5, luck: -5.1)
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Novice: Base score for Racing: 115
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Novice: Luck modifier: 3.4%, adjustment: 3.9
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Novice: Final score: 119 (base: 115, trait: +0, luck: 3.9)
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Star: Base score for Racing: 165
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Star: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Star: Luck modifier: 0.9%, adjustment: 1.5
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Star: Final score: 172 (base: 165, trait: +5, luck: 1.5)
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Novice: Base score for Racing: 115
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Novice: Luck modifier: -2.2%, adjustment: -2.6
[2025-12-27 23:21:25] info: [calculateCompetitionScore] Horse Competition Novice: Final score: 112 (base: 115, trait: +0, luck: -2.6)
[2025-12-27 23:21:25] info: [resultModel.saveResult] Successfully created new result for horse 94563 in show 5499 with score 85.5
[2025-12-27 23:21:25] info: [resultModel.saveResult] Successfully created new result for horse 94563 in show 5499 with score 90
[2025-12-27 23:21:26] info: [resultModel.saveResult] Successfully created new result for horse 94564 in show 5499 with score 85
[2025-12-27 23:21:26] info: [resultModel.getResultsByShow] Found 3 results for show 5499
[2025-12-27 23:21:26] info: [resultModel.saveResult] Successfully created new result for horse 94563 in show 5499 with score 88
[2025-12-27 23:21:26] info: [resultModel.getResultsByShow] Found 0 results for show 99999
[2025-12-27 23:21:26] info: [resultModel.saveResult] Successfully created new result for horse 94563 in show 5499 with score 92
[2025-12-27 23:21:26] info: [resultModel.saveResult] Successfully created new result for horse 94565 in show 5499 with score 84
[2025-12-27 23:21:26] info: [resultModel.saveResult] Successfully created new result for horse 94564 in show 5499 with score 88
PASS tests/competitionController-business-logic.test.mjs
  üèÜ INTEGRATION: Competition Controller Business Logic - Real Competition Workflow
    Competition Scoring Business Logic
      ‚àö CALCULATES realistic competition scores based on horse stats (11 ms)
      ‚àö APPLIES trait bonuses correctly in competition scoring (8 ms)
    Competition Result Persistence
      ‚àö PERSISTS competition results in database correctly (15 ms)
      ‚àö RETRIEVES competition results by show correctly (22 ms)
      ‚àö MAINTAINS database integrity with proper relationships (12 ms)
    Error Handling and Edge Cases
      ‚àö HANDLES invalid result data gracefully (4 ms)
      ‚àö HANDLES non-existent show ID gracefully (6 ms)
      ‚àö MAINTAINS data consistency during concurrent operations (74 ms)

[2025-12-27 23:21:26] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:26] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:26] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/integration/foalAuthRoutes.test.mjs
  Foal routes auth enforcement
    ‚àö rejects unauthenticated access to foal development (22 ms)
    ‚àö rejects unauthenticated access to foal enrichment (26 ms)
    ‚àö rejects unauthenticated access to foal activity (13 ms)
    ‚àö rejects unauthenticated access to advance-day (11 ms)
    ‚àö rate limits foal activity endpoints (48 ms)
    ‚àö rate limits foal enrichment endpoints (43 ms)
    ‚àö rejects access to foal development when not owned (14 ms)

[2025-12-27 23:21:27] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:27] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:27] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/services/flagEffectIntegration.test.mjs
  Flag Effect Integration
    calculateFlagEffects
      ‚àö should calculate cumulative effects for positive flags (4 ms)
      ‚àö should calculate cumulative effects for negative flags (1 ms)
      ‚àö should handle conflicting flags appropriately (2 ms)
      ‚àö should return neutral effects for horses with no flags (1 ms)
    applyFlagEffectsToCompetition
      ‚àö should apply positive flag effects to competition performance (1 ms)
      ‚àö should apply negative flag effects to competition performance (1 ms)
      ‚àö should handle discipline-specific flag effects (1 ms)
    applyFlagEffectsToTraining
      ‚àö should apply flag effects to training effectiveness (1 ms)
      ‚àö should reduce training effectiveness for negative flags
    applyFlagEffectsToBreeding
      ‚àö should apply flag effects to breeding trait probabilities (1 ms)
      ‚àö should handle breeding between horses with conflicting flags (1 ms)
    resolveFlagConflicts
      ‚àö should identify and resolve flag conflicts (1 ms)
      ‚àö should handle no conflicts gracefully (1 ms)

[2025-12-27 23:21:27] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:27] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:27] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94570 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94570
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94570 is 4 years old
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94570 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94570
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94570 is eligible to train in Dressage
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94571 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94571
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94571 is 2 years old
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94571 is too young (2 years old)
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94572 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94572
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94572 is 5 years old
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94572 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94572: Sat Dec 27 2025 23:21:28 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94572 still in cooldown for any training (7 days remaining)
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 99999 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 99999
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 99999 not found
[2025-12-27 23:21:28] warn: [trainingController.canTrain] Horse 99999 not found
[2025-12-27 23:21:28] error: [trainingController.canTrain] Error checking training eligibility: Horse ID must be a positive integer
[2025-12-27 23:21:28] error: [trainingController.canTrain] Error checking training eligibility: Discipline is required
[2025-12-27 23:21:28] error: [trainingController.canTrain] Error checking training eligibility: Horse ID is required
[2025-12-27 23:21:28] info: [trainingController.getTrainingStatus] Getting training status for horse 94575 in Racing
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94575 in Racing
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94575
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94575 is 4 years old
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94575 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94575
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94575 is eligible to train in Racing
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94575
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94575 is 4 years old
[2025-12-27 23:21:28] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 94575 in Racing
[2025-12-27 23:21:28] info: [trainingModel.getLastTrainingDate] No training records found for horse 94575 in Racing
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94575 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94575
[2025-12-27 23:21:28] info: [trainingController.getTrainingStatus] Training status retrieved for horse 94575: eligible=true
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Attempting to train horse 94575 in Racing
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94575 in Racing
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94575
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94575 is 4 years old
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94575 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94575
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94575 is eligible to train in Racing
[2025-12-27 23:21:28] info: [horseModel.getHorseById] Successfully found horse: Workflow Test Horse (ID: 94575)
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Horse 94575 has traits: 
[2025-12-27 23:21:28] info: [trainingModel.logTrainingSession] Logging training session for horse 94575 in Racing
[2025-12-27 23:21:28] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4833
[2025-12-27 23:21:28] info: [horseModel.incrementDisciplineScore] Incrementing Racing score for horse 94575 by +5
[2025-12-27 23:21:28] info: [horseModel.updateDisciplineScore] Updating Racing score for horse 94575 by +5
[2025-12-27 23:21:28] info: [horseModel.updateDisciplineScore] Successfully updated Racing score for horse 94575: 0 -> 5
[2025-12-27 23:21:28] info: [horseModel.incrementDisciplineScore] Successfully incremented Racing score for horse 94575
[2025-12-27 23:21:28] info: [xpLogModel.logXpEvent] Logging XP event: User 1463cc45-5038-41a3-b061-36765f0f5aa3, Amount: 5, Reason: Trained horse Workflow Test Horse in Racing
[2025-12-27 23:21:28] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2351, User 1463cc45-5038-41a3-b061-36765f0f5aa3, Amount: 5
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Awarded 5 XP to user 1463cc45-5038-41a3-b061-36765f0f5aa3 for training
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Successfully trained horse 94575 in Racing (Log ID: 4833, Score +5)
[2025-12-27 23:21:28] info: [trainingController.getTrainingStatus] Getting training status for horse 94575 in Racing
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94575 in Racing
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94575
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94575 is 4 years old
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94575 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94575: Sat Dec 27 2025 23:21:28 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94575 still in cooldown for any training (7 days remaining)
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94575
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94575 is 4 years old
[2025-12-27 23:21:28] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 94575 in Racing
[2025-12-27 23:21:28] info: [trainingModel.getLastTrainingDate] Last training date for horse 94575 in Racing: Sat Dec 27 2025 23:21:28 GMT-0500 (Eastern Standard Time)
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94575 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94575: Sat Dec 27 2025 23:21:28 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:21:28] info: [trainingController.getTrainingStatus] Training status retrieved for horse 94575: eligible=false
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Attempting to train horse 94571 in Dressage
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94571 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94571
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94571 is 2 years old
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94571 is too young (2 years old)
[2025-12-27 23:21:28] warn: [trainingController.trainHorse] Training rejected: Horse is under age
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Attempting to train horse 94572 in Dressage
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94572 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94572
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94572 is 5 years old
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94572 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94572: Sat Dec 27 2025 23:21:28 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94572 still in cooldown for any training (7 days remaining)
[2025-12-27 23:21:28] warn: [trainingController.trainHorse] Training rejected: Training cooldown active for this horse
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Attempting to train horse 99999 in Dressage
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 99999 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 99999
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 99999 not found
[2025-12-27 23:21:28] warn: [trainingController.canTrain] Horse 99999 not found
[2025-12-27 23:21:28] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Attempting to train horse 94570 in 
[2025-12-27 23:21:28] error: [trainingController.canTrain] Error checking training eligibility: Discipline is required
[2025-12-27 23:21:28] error: [trainingController.trainHorse] Training failed: Training eligibility check failed: Discipline is required
[2025-12-27 23:21:28] info: [trainingController.getTrainingStatus] Getting training status for horse 94570 in Dressage
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94570 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94570
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94570 is 4 years old
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94570 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94570
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94570 is eligible to train in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94570
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94570 is 4 years old
[2025-12-27 23:21:28] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 94570 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getLastTrainingDate] No training records found for horse 94570 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94570 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94570
[2025-12-27 23:21:28] info: [trainingController.getTrainingStatus] Training status retrieved for horse 94570: eligible=true
[2025-12-27 23:21:28] info: [trainingController.getTrainingStatus] Getting training status for horse 94572 in Racing
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94572 in Racing
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94572
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94572 is 5 years old
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94572 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94572: Sat Dec 27 2025 23:21:28 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94572 still in cooldown for any training (7 days remaining)
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94572
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94572 is 5 years old
[2025-12-27 23:21:28] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 94572 in Racing
[2025-12-27 23:21:28] info: [trainingModel.getLastTrainingDate] Last training date for horse 94572 in Racing: Sat Dec 27 2025 23:21:28 GMT-0500 (Eastern Standard Time)
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94572 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94572: Sat Dec 27 2025 23:21:28 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:21:28] info: [trainingController.getTrainingStatus] Training status retrieved for horse 94572: eligible=false
[2025-12-27 23:21:28] info: [trainingController.getTrainingStatus] Getting training status for horse 99999 in Dressage
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 99999 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 99999
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 99999 not found
[2025-12-27 23:21:28] warn: [trainingController.canTrain] Horse 99999 not found
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 99999
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 99999 not found
[2025-12-27 23:21:28] info: [trainingModel.getLastTrainingDate] Checking last training date for horse 99999 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getLastTrainingDate] No training records found for horse 99999 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 99999 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] No training records found for horse 99999
[2025-12-27 23:21:28] info: [trainingController.getTrainingStatus] Training status retrieved for horse 99999: eligible=false
[2025-12-27 23:21:28] info: [trainingController.getTrainableHorses] Getting trainable horses for user 1463cc45-5038-41a3-b061-36765f0f5aa31
[2025-12-27 23:21:28] warn: [trainingController.getTrainableHorses] User 1463cc45-5038-41a3-b061-36765f0f5aa31 not found
[2025-12-27 23:21:28] info: [trainingController.getTrainableHorses] Getting trainable horses for user 1463cc45-5038-41a3-b061-36765f0f5aa3
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94573 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94573
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94574 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94574
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94575 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94575: Sat Dec 27 2025 23:21:28 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:21:28] info: [trainingController.getTrainableHorses] Found 2 trainable horses for user 1463cc45-5038-41a3-b061-36765f0f5aa3
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Attempting to train horse 94570 in Dressage
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94570 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94570
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94570 is 4 years old
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94570 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94570
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94570 is eligible to train in Dressage
[2025-12-27 23:21:28] info: [horseModel.getHorseById] Successfully found horse: Controller Adult Horse (ID: 94570)
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Horse 94570 has traits: 
[2025-12-27 23:21:28] info: [trainingModel.logTrainingSession] Logging training session for horse 94570 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4834
[2025-12-27 23:21:28] info: [horseModel.incrementDisciplineScore] Incrementing Dressage score for horse 94570 by +5
[2025-12-27 23:21:28] info: [horseModel.updateDisciplineScore] Updating Dressage score for horse 94570 by +5
[2025-12-27 23:21:28] info: [horseModel.updateDisciplineScore] Successfully updated Dressage score for horse 94570: 0 -> 5
[2025-12-27 23:21:28] info: [horseModel.incrementDisciplineScore] Successfully incremented Dressage score for horse 94570
[2025-12-27 23:21:28] info: [xpLogModel.logXpEvent] Logging XP event: User a88efda3-9736-44a3-a081-b56e54cac008, Amount: 5, Reason: Trained horse Controller Adult Horse in Dressage
[2025-12-27 23:21:28] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2352, User a88efda3-9736-44a3-a081-b56e54cac008, Amount: 5
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Awarded 5 XP to user a88efda3-9736-44a3-a081-b56e54cac008 for training
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Successfully trained horse 94570 in Dressage (Log ID: 4834, Score +5)
[2025-12-27 23:21:28] info: [trainingController.getTrainableHorses] Getting trainable horses for user a88efda3-9736-44a3-a081-b56e54cac008
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94572 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94572: Sat Dec 27 2025 23:21:28 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94570 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94570: Sat Dec 27 2025 23:21:28 GMT-0500 (Eastern Standard Time) (discipline: Dressage)
[2025-12-27 23:21:28] info: [trainingController.getTrainableHorses] Found 0 trainable horses for user a88efda3-9736-44a3-a081-b56e54cac008
[2025-12-27 23:21:28] info: [trainingController.trainRouteHandler] Training request for horse 94576 in Show Jumping
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Attempting to train horse 94576 in Show Jumping
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94576 in Show Jumping
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94576
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94576 is 4 years old
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94576 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] No training records found for horse 94576
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94576 is eligible to train in Show Jumping
[2025-12-27 23:21:28] info: [horseModel.getHorseById] Successfully found horse: Fresh Route Test Horse (ID: 94576)
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Horse 94576 has traits: 
[2025-12-27 23:21:28] info: [trainingModel.logTrainingSession] Logging training session for horse 94576 in Show Jumping
[2025-12-27 23:21:28] info: [trainingModel.logTrainingSession] Successfully logged training session: ID 4835
[2025-12-27 23:21:28] info: [horseModel.incrementDisciplineScore] Incrementing Show Jumping score for horse 94576 by +5
[2025-12-27 23:21:28] info: [horseModel.updateDisciplineScore] Updating Show Jumping score for horse 94576 by +5
[2025-12-27 23:21:28] info: [horseModel.updateDisciplineScore] Successfully updated Show Jumping score for horse 94576: 0 -> 5
[2025-12-27 23:21:28] info: [horseModel.incrementDisciplineScore] Successfully incremented Show Jumping score for horse 94576
[2025-12-27 23:21:28] info: [xpLogModel.logXpEvent] Logging XP event: User a88efda3-9736-44a3-a081-b56e54cac008, Amount: 5, Reason: Trained horse Fresh Route Test Horse in Show Jumping
[2025-12-27 23:21:28] info: [xpLogModel.logXpEvent] Successfully logged XP event: ID 2353, User a88efda3-9736-44a3-a081-b56e54cac008, Amount: 5
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Awarded 5 XP to user a88efda3-9736-44a3-a081-b56e54cac008 for training
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Successfully trained horse 94576 in Show Jumping (Log ID: 4835, Score +5)
[2025-12-27 23:21:28] info: [trainingController.trainRouteHandler] Training request for horse 94571 in Dressage
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Attempting to train horse 94571 in Dressage
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94571 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94571
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94571 is 2 years old
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94571 is too young (2 years old)
[2025-12-27 23:21:28] warn: [trainingController.trainHorse] Training rejected: Horse is under age
[2025-12-27 23:21:28] info: [trainingController.trainRouteHandler] Training request for horse 94572 in Dressage
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Attempting to train horse 94572 in Dressage
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 94572 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 94572
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 94572 is 5 years old
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Checking most recent training date for horse 94572 across all disciplines
[2025-12-27 23:21:28] info: [trainingModel.getAnyRecentTraining] Most recent training date for horse 94572: Sat Dec 27 2025 23:21:28 GMT-0500 (Eastern Standard Time) (discipline: Racing)
[2025-12-27 23:21:28] info: [trainingController.canTrain] Horse 94572 still in cooldown for any training (7 days remaining)
[2025-12-27 23:21:28] warn: [trainingController.trainHorse] Training rejected: Training cooldown active for this horse
[2025-12-27 23:21:28] info: [trainingController.trainRouteHandler] Training request for horse 99999 in Dressage
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Attempting to train horse 99999 in Dressage
[2025-12-27 23:21:28] info: [trainingController.canTrain] Checking training eligibility for horse 99999 in Dressage
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Getting age for horse 99999
[2025-12-27 23:21:28] info: [trainingModel.getHorseAge] Horse 99999 not found
[2025-12-27 23:21:28] warn: [trainingController.canTrain] Horse 99999 not found
[2025-12-27 23:21:28] warn: [trainingController.trainHorse] Training rejected: Horse not found
[2025-12-27 23:21:28] info: [trainingController.trainRouteHandler] Training request for horse 94570 in 
[2025-12-27 23:21:28] info: [trainingController.trainHorse] Attempting to train horse 94570 in 
[2025-12-27 23:21:28] error: [trainingController.canTrain] Error checking training eligibility: Discipline is required
[2025-12-27 23:21:28] error: [trainingController.trainHorse] Training failed: Training eligibility check failed: Discipline is required
[2025-12-27 23:21:28] error: [trainingController.trainRouteHandler] Error: Training failed: Training eligibility check failed: Discipline is required
PASS tests/trainingController-business-logic.test.mjs
  üèãÔ∏è INTEGRATION: Training Controller Business Logic - Complete Training Workflow
    BUSINESS RULE: canTrain() Function Validation
      ‚àö RETURNS eligible true for horse that meets all requirements (17 ms)
      ‚àö RETURNS eligible false for horse under 3 years old (7 ms)
      ‚àö RETURNS eligible false for horse with recent training (global cooldown) (9 ms)
      ‚àö RETURNS eligible false for non-existent horse (9 ms)
      ‚àö THROWS error for invalid input parameters (7 ms)
    BUSINESS RULE: trainHorse() Function Complete Workflow
      ‚àö EXECUTES successful training workflow for eligible horse (99 ms)
      ‚àö RETURNS error for ineligible horse (age restriction) (9 ms)
      ‚àö RETURNS error for horse in cooldown (12 ms)
      ‚àö RETURNS error for non-existent horse (12 ms)
      ‚àö THROWS error for invalid discipline (3 ms)
    BUSINESS RULE: getTrainingStatus() Function Validation
      ‚àö RETURNS accurate status for horse with no training history (26 ms)
      ‚àö RETURNS accurate status for horse with training history (21 ms)
      ‚àö RETURNS error status for non-existent horse (22 ms)
    BUSINESS RULE: getTrainableHorses() Function Validation
      ‚àö RETURNS empty array for user with no horses (6 ms)
      ‚àö RETURNS array of trainable horses for user (17 ms)
      ‚àö RETURNS empty array after training (horse in cooldown) (58 ms)
    API INTEGRATION: trainRouteHandler() Function Validation
      ‚àö PROCESSES valid training request and RETURNS success response (43 ms)
      ‚àö RETURNS error response for ineligible horse (9 ms)
      ‚àö RETURNS error response for horse in cooldown (15 ms)
      ‚àö RETURNS error response for non-existent horse (9 ms)
      ‚àö RETURNS error response for invalid discipline (6 ms)

[2025-12-27 23:21:28] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:28] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:28] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:29] info: [facilityManagementService.getUserFacilities] Getting facilities for user fb5be93e-8296-4f09-a0eb-b99cbe958c18
[2025-12-27 23:21:29] info: [facilityManagementService.getUserFacilities] Getting facilities for user f7893512-e095-4236-be8f-adf3a073b2ca
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for advanced_training upgrade from 1 to 3
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for invalid_upgrade upgrade from 1 to 2
[2025-12-27 23:21:29] error: [facilityManagementService.calculateUpgradeCost] Error: Invalid upgrade type: invalid_upgrade
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for advanced_training upgrade from 5 to 3
[2025-12-27 23:21:29] error: [facilityManagementService.calculateUpgradeCost] Error: Target level must be higher than current level
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for medical_center upgrade from 1 to 2
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for medical_center upgrade from 2 to 3
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for medical_center upgrade from 3 to 4
[2025-12-27 23:21:29] info: [facilityManagementService.purchaseFacilityUpgrade] User ed3e9f48-4837-4f12-bd58-47afbc6eec33 purchasing automated_care upgrade to level 2
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for automated_care upgrade from 0 to 2
[2025-12-27 23:21:29] info: [facilityManagementService.purchaseFacilityUpgrade] User f455c121-f2c1-49f3-bb4b-1546423ceca4 purchasing competition_hosting upgrade to level 3
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for competition_hosting upgrade from 0 to 3
[2025-12-27 23:21:29] info: [facilityManagementService.purchaseFacilityUpgrade] User d9c47038-ee54-4df1-b4d1-2f03211c4e7c purchasing ventilation upgrade to level 2
[2025-12-27 23:21:29] info: [facilityManagementService.assessFacilityEffectiveness] Assessing facility 6626
[2025-12-27 23:21:29] info: [facilityManagementService.assessFacilityEffectiveness] Assessing facility 6627
[2025-12-27 23:21:29] info: [facilityManagementService.generateFacilityRecommendations] Generating recommendations for user 2397a62c-e198-40c8-bd1f-5abe1d2235a0
[2025-12-27 23:21:29] info: [facilityManagementService.getUserFacilities] Getting facilities for user 2397a62c-e198-40c8-bd1f-5abe1d2235a0
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for advanced_training upgrade from 3 to 4
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for recovery_center upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for specialized_grounds upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for automated_care upgrade from 2 to 3
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for medical_center upgrade from 2 to 3
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for feed_laboratory upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for breeding_optimization upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for genetic_analysis upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for foal_development upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for stable_management upgrade from 3 to 4
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for competition_hosting upgrade from 1 to 2
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for prestige_stable upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for tack_workshop upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for visitor_center upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for advanced_training upgrade from 1 to 2
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for recovery_center upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for specialized_grounds upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for automated_care upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for medical_center upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for feed_laboratory upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for breeding_optimization upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for genetic_analysis upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for foal_development upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for stable_management upgrade from 1 to 2
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for competition_hosting upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for prestige_stable upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for tack_workshop upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for visitor_center upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.generateFacilityRecommendations] Generating recommendations for user 94bfac8e-39a9-4c4c-b498-eb979c0b1248
[2025-12-27 23:21:29] info: [facilityManagementService.getUserFacilities] Getting facilities for user 94bfac8e-39a9-4c4c-b498-eb979c0b1248
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for advanced_training upgrade from 1 to 2
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for recovery_center upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for specialized_grounds upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for automated_care upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for medical_center upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for feed_laboratory upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for breeding_optimization upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for genetic_analysis upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for foal_development upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for stable_management upgrade from 1 to 2
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for competition_hosting upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for prestige_stable upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for tack_workshop upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for visitor_center upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for advanced_training upgrade from 3 to 4
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for recovery_center upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for specialized_grounds upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for automated_care upgrade from 2 to 3
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for medical_center upgrade from 2 to 3
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for feed_laboratory upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for breeding_optimization upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for genetic_analysis upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for foal_development upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for stable_management upgrade from 3 to 4
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for competition_hosting upgrade from 1 to 2
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for prestige_stable upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for tack_workshop upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for visitor_center upgrade from 0 to 1
[2025-12-27 23:21:29] info: [facilityManagementService.calculateMaintenanceCosts] Calculating maintenance for facility 6634
[2025-12-27 23:21:29] info: [facilityManagementService.purchaseFacilityUpgrade] User 28958d66-4caf-497e-bc60-e24f837bf7cf purchasing stable_management upgrade to level 2
[2025-12-27 23:21:29] info: [facilityManagementService.calculateUpgradeCost] Calculating cost for stable_management upgrade from 1 to 2
[2025-12-27 23:21:29] info: [facilityManagementService.getFacilityUpgradeHistory] Getting history for facility 6635
[2025-12-27 23:21:29] info: [facilityManagementService.calculateFacilityROI] Calculating ROI for facility 6638
[2025-12-27 23:21:29] info: [facilityManagementService.getFacilityUpgradeHistory] Getting history for facility 6638
[2025-12-27 23:21:29] info: [facilityManagementService.calculateFacilityROI] Calculating ROI for facility 6640
[2025-12-27 23:21:29] info: [facilityManagementService.getFacilityUpgradeHistory] Getting history for facility 6640
PASS tests/unit/facilityManagementSystem.test.mjs
  üè¢ Facility Management System
    üèóÔ∏è Facility Types and Configuration
      ‚àö should return available facility types with specifications (125 ms)
      ‚àö should include different facility categories (20 ms)
    üë§ User Facility Management
      ‚àö should retrieve user facilities with current status (21 ms)
      ‚àö should calculate environmental mitigation for facilities (15 ms)
    üí∞ Upgrade Cost Calculation
      ‚àö should calculate upgrade costs accurately (13 ms)
      ‚àö should handle invalid upgrade parameters (24 ms)
      ‚àö should calculate progressive cost increases (13 ms)
    üõí Facility Upgrade Purchase
      ‚àö should successfully purchase valid upgrades (30 ms)
      ‚àö should reject upgrades with insufficient funds (19 ms)
      ‚àö should reject invalid facility ownership (21 ms)
    üåø Environmental Mitigation
      ‚àö should calculate environmental mitigation effects (10 ms)
      ‚àö should provide better mitigation for higher-level facilities (8 ms)
    üìä Facility Effectiveness Assessment
      ‚àö should assess facility effectiveness comprehensively (13 ms)
      ‚àö should provide upgrade-specific effectiveness ratings (20 ms)
    üí° Facility Recommendations
      ‚àö should generate actionable facility recommendations (62 ms)
      ‚àö should prioritize recommendations based on cost-benefit analysis (48 ms)
    üîß Maintenance and Operations
      ‚àö should calculate maintenance costs accurately (14 ms)
      ‚àö should track facility upgrade history (28 ms)
    üìà Return on Investment Analysis
      ‚àö should calculate facility ROI accurately (15 ms)
      ‚àö should provide benefit breakdown by category (21 ms)

[2025-12-27 23:21:29] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:29] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:29] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/utils/epigeneticTraits.comprehensive.test.mjs
  üß¨ COMPREHENSIVE: Epigenetic Traits Calculation System
    Basic Trait Inheritance
      ‚àö should calculate traits with optimal breeding conditions (5 ms)
      ‚àö should handle high stress breeding conditions (1 ms)
      ‚àö should produce consistent results with same seed (1 ms)
    Environmental Factor Processing
      ‚àö should handle low bonding score scenarios (8 ms)
      ‚àö should handle high bonding score scenarios (1 ms)
      ‚àö should process moderate environmental conditions (1 ms)
    Trait Conflict Resolution
      ‚àö should handle conflicting parent traits
      ‚àö should handle similar parent traits (1 ms)
    Trait Visibility Determination
      ‚àö should categorize traits by visibility correctly (1 ms)
    Input Validation and Error Handling
      ‚àö should handle empty trait arrays (1 ms)
      ‚àö should handle boundary values for bonding and stress (2 ms)
      ‚àö should handle maximum values for bonding and stress (1 ms)
    Complex Breeding Scenarios
      ‚àö should handle large trait sets from both parents (1 ms)
      ‚àö should produce different results with different seeds (1 ms)
      ‚àö should maintain trait consistency across multiple calculations (3 ms)
    Trait Array Properties
      ‚àö should return sorted trait arrays (1 ms)
      ‚àö should return unique traits in each category

[2025-12-27 23:21:29] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:29] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:29] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:30] error: [ResponseOptimization] Response size exceeds limit: 12715 bytes for GET /test/oversized
PASS __tests__/performance/apiResponseOptimization.test.mjs
  API Response Optimization System
    Pagination Service
      ‚àö creates offset-based pagination correctly (3 ms)
      ‚àö creates cursor-based pagination correctly (2 ms)
      ‚àö generates optimized Prisma query for cursor pagination (2 ms)
    Serialization Service
      ‚àö optimizes response data correctly (1 ms)
      ‚àö selects specific fields correctly (2 ms)
      ‚àö excludes specific fields correctly (1 ms)
      ‚àö handles nested field selection (2 ms)
    Response Cache Service
      ‚àö generates consistent ETags for same data (1 ms)
      ‚àö generates different ETags for different data
      ‚àö determines cacheable requests correctly
    Lazy Loading Service
      ‚àö creates lazy loading configuration
      ‚àö loads related data on demand (5 ms)
    Middleware Integration
      ‚àö handles pagination middleware correctly (28 ms)
      ‚àö handles field selection via query parameters (22 ms)
      ‚àö adds performance headers to responses (18 ms)
      ‚àö handles large response optimization (36 ms)
      ‚àö supports debug mode with optimization info (17 ms)
    Performance Metrics
      ‚àö tracks performance metrics correctly (2 ms)
    ETag and Caching
      ‚àö generates and validates ETags correctly (28 ms)
    Response Size Monitoring
      ‚àö monitors and warns about large responses (27 ms)
      ‚àö handles response size limits (21 ms)

[2025-12-27 23:21:30] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:30] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:30] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:31] warn: [ResourceManagement] Slow request detected: GET /test-slow took 11ms
[2025-12-27 23:21:31] warn: [MemoryMonitoring] Memory threshold exceeded: 1734MB
[2025-12-27 23:21:31] warn: [MemoryMonitoring] Memory threshold exceeded: 1740MB
[2025-12-27 23:21:31] warn: [DatabaseMonitoring] High query count: 15 queries in 2ms for GET /test-many-queries
[2025-12-27 23:21:31] warn: [ResourceManagement] Request timeout: GET /test-timeout
[2025-12-27 23:21:31] warn: [MemoryMonitoring] Memory threshold exceeded: 1739MB
[2025-12-27 23:21:31] warn: [MemoryMonitoring] Memory threshold exceeded: 1731MB
[2025-12-27 23:21:31] warn: [ResourceManagement] Slow request detected: GET /test-thresholds took 7ms
[2025-12-27 23:21:31] warn: [ResourceManagement] High memory usage: GET /test-thresholds used 1MB
PASS __tests__/middleware/resourceManagement.test.mjs
  Resource Management Middleware
    Resource Management Middleware
      ‚àö adds resource tracking helpers to request (32 ms)
      ‚àö tracks and cleans up timers automatically (15 ms)
      ‚àö adds performance headers to response (25 ms)
      ‚àö handles request errors gracefully (121 ms)
      ‚àö tracks memory usage per request (12 ms)
      ‚àö warns about slow requests (30 ms)
    Memory Monitoring Middleware
      ‚àö adds memory headers to response (14 ms)
      ‚àö handles memory threshold checking (19 ms)
      ‚àö triggers GC when enabled and threshold exceeded (2 ms)
    Database Connection Middleware
      ‚àö tracks database queries (13 ms)
      ‚àö warns about high query counts (14 ms)
      ‚àö restores original methods after request (129 ms)
    Request Timeout Middleware
      ‚àö handles normal requests without timeout (11 ms)
      ‚àö times out slow requests (118 ms)
      ‚àö tracks timeout timer as resource (17 ms)
      ‚àö cleans up timeout timer on completion (11 ms)
    Middleware Integration
      ‚àö multiple middleware work together correctly (15 ms)
      ‚àö handles errors across middleware stack (18 ms)
    Configuration Options
      ‚àö respects disabled tracking options (13 ms)
      ‚àö uses custom thresholds correctly (23 ms)

[2025-12-27 23:21:31] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:31] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:31] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/horseAgingSystem.test.mjs
  Horse Aging System
    Age Calculation
      ‚àö should calculate age correctly from dateOfBirth (92 ms)
      ‚àö should handle leap years correctly (14 ms)
      ‚àö should handle timezone differences (10 ms)
    Horse Age Updates
      ‚àö should update horse age when birthday occurs (41 ms)
      ‚àö should not update age when no birthday occurs (19 ms)
      ‚àö should handle horses with incorrect stored age (22 ms)
    Milestone Detection
      ‚àö should detect age 1 milestone and trigger trait evaluation (23 ms)
      ‚àö should not trigger milestone for non-milestone ages (10 ms)
      ‚àö should detect retirement milestone at age 21 (10 ms)
    Batch Processing
      ‚àö should process multiple horses with birthdays (128 ms)
    Integration with Existing Systems
      ‚àö should maintain compatibility with training age requirements (34 ms)
      ‚àö should handle retirement at age 21 (21 ms)

[2025-12-27 23:21:32] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:32] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:32] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/foalTaskLogStreakData.test.mjs
  Foal Task Log and Streak Data
    Task Log JSON Storage
      ‚àö should initialize with null task log (93 ms)
      ‚àö should store task log as JSON object (21 ms)
      ‚àö should handle empty task log object (19 ms)
      ‚àö should update existing task counts (24 ms)
      ‚àö should handle complex task log with all foal tasks (19 ms)
    Consecutive Days Foal Care Tracking
      ‚àö should initialize with zero consecutive days (15 ms)
      ‚àö should track consecutive days of care (17 ms)
      ‚àö should handle streak increments (18 ms)
      ‚àö should handle streak resets (23 ms)
      ‚àö should support high streak counts (15 ms)
    Last Care Date Tracking
      ‚àö should initialize with null last groomed date (12 ms)
      ‚àö should store last care date timestamp (16 ms)
      ‚àö should update last care date on subsequent care (22 ms)
      ‚àö should handle current timestamp updates (17 ms)
    Combined Task Log and Streak Data
      ‚àö should update all foal care fields together (16 ms)
      ‚àö should simulate realistic foal development progression (21 ms)
      ‚àö should handle streak reset with task log preservation (23 ms)
    Data Integrity and Edge Cases
      ‚àö should handle null values gracefully (16 ms)
      ‚àö should handle negative consecutive days (should not occur in practice) (16 ms)
      ‚àö should handle very large task counts (16 ms)
      ‚àö should preserve data types correctly (17 ms)

[2025-12-27 23:21:33] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:33] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:33] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:33] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
[2025-12-27 23:21:33] warn: [AuthRateLimiter] createAuthRateLimiter() is deprecated, using Redis-backed limiter
[2025-12-27 23:21:33] warn: [AuthRateLimiter] resetAllAuthRateLimits() is deprecated with Redis
PASS __tests__/unit/auth-rate-limiter.test.mjs
  Authentication Rate Limiter (Unit)
    Rate Limiter Configuration
      ‚àö should_create_rate_limiter_with_default_config (5 ms)
      ‚àö should_create_rate_limiter_with_custom_config (4 ms)
      ‚àö should_validate_configuration_parameters (4 ms)
    Request Tracking
      ‚àö should_track_requests_by_ip_address (4 ms)
      ‚àö should_allow_requests_within_limit (8 ms)
      ‚àö should_block_requests_exceeding_limit (4 ms)
    Rate Limit Headers
      ‚àö should_set_ratelimit_headers_on_every_request (3 ms)
      ‚àö should_update_remaining_count_with_each_request (3 ms)
      ‚àö should_calculate_accurate_reset_timestamp (4 ms)
    Time Window Reset
      ‚àö should_reset_count_after_time_window (3 ms)
      ‚àö should_maintain_separate_windows_for_different_ips (3 ms)
    Success Reset Mechanism
      ‚àö should_reset_count_on_successful_authentication (2 ms)
      ‚àö should_provide_method_to_reset_specific_ip (7 ms)
    Error Handling
      ‚àö should_handle_missing_ip_address (5 ms)
      ‚àö should_handle_concurrent_requests_atomically (4 ms)
      ‚àö should_not_crash_on_invalid_configuration (3 ms)
    Memory Management
      ‚àö should_clean_up_expired_entries (4 ms)
      ‚àö should_have_configurable_cleanup_interval (2 ms)
      ‚àö should_limit_maximum_storage_size (2 ms)
    Integration with Express
      ‚àö should_work_as_express_middleware (3 ms)
      ‚àö should_call_next_when_within_limit (6 ms)
      ‚àö should_not_call_next_when_rate_limited (3 ms)
    Response Format
      ‚àö should_send_consistent_429_response_format (3 ms)
      ‚àö should_include_retry_after_in_seconds (3 ms)

[2025-12-27 23:21:34] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:34] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:34] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -0.8%, adjustment: -1.0
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 129 (base: 130, trait: +0, luck: -1.0)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.5%, adjustment: -6.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 129 (base: 130, trait: +5, luck: -6.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.5%, adjustment: 2.0
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 132 (base: 130, trait: +0, luck: 2.0)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 2.4%, adjustment: 3.2
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 138 (base: 130, trait: +5, luck: 3.2)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 8.5%, adjustment: 11.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 141 (base: 130, trait: +0, luck: 11.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.0%, adjustment: -4.0
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 131 (base: 130, trait: +5, luck: -4.0)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -2.9%, adjustment: -3.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 126 (base: 130, trait: +0, luck: -3.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -8.2%, adjustment: -14.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 165 (base: 175, trait: +5, luck: -14.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.3%, adjustment: -2.2
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 173 (base: 175, trait: +0, luck: -2.2)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.9%, adjustment: -7.0
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 173 (base: 175, trait: +5, luck: -7.0)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 2.7%, adjustment: 4.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 180 (base: 175, trait: +0, luck: 4.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.1%, adjustment: 5.5
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 175, trait: +5, luck: 5.5)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -5.7%, adjustment: -9.9
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 165 (base: 175, trait: +0, luck: -9.9)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 165
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -2.7%, adjustment: -4.6
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 165 (base: 165, trait: +5, luck: -4.6)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Dressage: 165
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -2.3%, adjustment: -3.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 161 (base: 165, trait: +0, luck: -3.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 160
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 2.8%, adjustment: 4.6
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 170 (base: 160, trait: +5, luck: 4.6)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 160
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 8.3%, adjustment: 13.3
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 173 (base: 160, trait: +0, luck: 13.3)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 160
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -6.5%, adjustment: -10.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 154 (base: 160, trait: +5, luck: -10.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 160
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 4.8%, adjustment: 7.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 168 (base: 160, trait: +0, luck: 7.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 160
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -0.2%, adjustment: -0.4
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 165 (base: 160, trait: +5, luck: -0.4)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 160
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 8.8%, adjustment: 14.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 160, trait: +0, luck: 14.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 160
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.7%, adjustment: -6.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 159 (base: 160, trait: +5, luck: -6.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 160
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 9.0%, adjustment: 14.3
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 160, trait: +0, luck: 14.3)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 160
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.8%, adjustment: 11.2
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 176 (base: 160, trait: +5, luck: 11.2)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Cross Country: 160
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.2%, adjustment: -5.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 155 (base: 160, trait: +0, luck: -5.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.1%, adjustment: 10.6
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 175, trait: +0, luck: 10.6)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.0%, adjustment: 0.0
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 175 (base: 175, trait: +0, luck: 0.0)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -2.1%, adjustment: -3.6
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 171 (base: 175, trait: +0, luck: -3.6)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 8.9%, adjustment: 15.6
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 191 (base: 175, trait: +0, luck: 15.6)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.4%, adjustment: 0.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 176 (base: 175, trait: +0, luck: 0.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -2.0%, adjustment: -3.5
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 172 (base: 175, trait: +0, luck: -3.5)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.0%, adjustment: -6.9
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 168 (base: 175, trait: +0, luck: -6.9)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.3%, adjustment: -5.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 169 (base: 175, trait: +0, luck: -5.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 4.4%, adjustment: 7.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 183 (base: 175, trait: +0, luck: 7.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 8.1%, adjustment: 14.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 189 (base: 175, trait: +0, luck: 14.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.2%, adjustment: 10.9
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 186 (base: 175, trait: +0, luck: 10.9)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -6.6%, adjustment: -11.5
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 163 (base: 175, trait: +0, luck: -11.5)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 8.4%, adjustment: 14.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 190 (base: 175, trait: +0, luck: 14.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.3%, adjustment: 2.2
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 177 (base: 175, trait: +0, luck: 2.2)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -5.5%, adjustment: -9.6
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 165 (base: 175, trait: +0, luck: -9.6)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -6.3%, adjustment: -11.0
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 164 (base: 175, trait: +0, luck: -11.0)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.9%, adjustment: -3.3
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 172 (base: 175, trait: +0, luck: -3.3)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.7%, adjustment: 6.4
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 181 (base: 175, trait: +0, luck: 6.4)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -0.4%, adjustment: -0.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 174 (base: 175, trait: +0, luck: -0.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Show Jumping: 175
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -2.9%, adjustment: -5.0
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 170 (base: 175, trait: +0, luck: -5.0)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.2%, adjustment: 8.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 138 (base: 130, trait: +0, luck: 8.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.0%, adjustment: 7.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 138 (base: 130, trait: +0, luck: 7.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.2%, adjustment: 1.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 137 (base: 130, trait: +5, luck: 1.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 5.7%, adjustment: 7.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 143 (base: 130, trait: +5, luck: 7.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 7.3%, adjustment: 9.9
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 145 (base: 130, trait: +5, luck: 9.9)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -6.5%, adjustment: -8.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 126 (base: 130, trait: +5, luck: -8.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -0.9%, adjustment: -1.2
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 134 (base: 130, trait: +5, luck: -1.2)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -7.6%, adjustment: -10.2
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 125 (base: 130, trait: +5, luck: -10.2)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -8.0%, adjustment: -10.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 124 (base: 130, trait: +5, luck: -10.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -2.1%, adjustment: -2.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 132 (base: 130, trait: +5, luck: -2.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 4.9%, adjustment: 6.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 142 (base: 130, trait: +5, luck: 6.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -5.7%, adjustment: -7.6
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 127 (base: 130, trait: +5, luck: -7.6)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -6.4%, adjustment: -8.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 126 (base: 130, trait: +5, luck: -8.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -2.1%, adjustment: -2.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 127 (base: 130, trait: +0, luck: -2.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 4.1%, adjustment: 5.6
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 141 (base: 130, trait: +5, luck: 5.6)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -7.4%, adjustment: -9.6
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 120 (base: 130, trait: +0, luck: -9.6)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 5.8%, adjustment: 7.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 143 (base: 130, trait: +5, luck: 7.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.7%, adjustment: 8.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 139 (base: 130, trait: +0, luck: 8.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.3%, adjustment: -5.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 129 (base: 130, trait: +5, luck: -5.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.5%, adjustment: -1.9
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 128 (base: 130, trait: +0, luck: -1.9)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.5%, adjustment: 4.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 140 (base: 130, trait: +5, luck: 4.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -8.4%, adjustment: -11.0
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 119 (base: 130, trait: +0, luck: -11.0)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -5.5%, adjustment: -7.4
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 128 (base: 130, trait: +5, luck: -7.4)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.0%, adjustment: -5.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 125 (base: 130, trait: +0, luck: -5.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 2.1%, adjustment: 2.9
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 138 (base: 130, trait: +5, luck: 2.9)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -0.1%, adjustment: -0.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 130 (base: 130, trait: +0, luck: -0.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 2.9%, adjustment: 3.9
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 139 (base: 130, trait: +5, luck: 3.9)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.4%, adjustment: -5.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 124 (base: 130, trait: +0, luck: -5.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 2.5%, adjustment: 3.4
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 138 (base: 130, trait: +5, luck: 3.4)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 8.0%, adjustment: 10.3
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 140 (base: 130, trait: +0, luck: 10.3)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -1.6%, adjustment: -2.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 133 (base: 130, trait: +5, luck: -2.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -7.8%, adjustment: -10.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 120 (base: 130, trait: +0, luck: -10.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -3.0%, adjustment: -4.0
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 131 (base: 130, trait: +5, luck: -4.0)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -8.4%, adjustment: -10.9
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 119 (base: 130, trait: +0, luck: -10.9)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.5%, adjustment: 8.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 144 (base: 130, trait: +5, luck: 8.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 4.4%, adjustment: 5.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 136 (base: 130, trait: +0, luck: 5.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -0.6%, adjustment: -0.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 134 (base: 130, trait: +5, luck: -0.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -7.6%, adjustment: -9.9
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 120 (base: 130, trait: +0, luck: -9.9)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -5.9%, adjustment: -7.9
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 127 (base: 130, trait: +5, luck: -7.9)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.5%, adjustment: 8.5
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 139 (base: 130, trait: +0, luck: 8.5)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 0.1%, adjustment: 0.2
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 135 (base: 130, trait: +5, luck: 0.2)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -2.8%, adjustment: -3.6
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 126 (base: 130, trait: +0, luck: -3.6)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 7.2%, adjustment: 9.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 145 (base: 130, trait: +5, luck: 9.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.7%, adjustment: -6.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 124 (base: 130, trait: +0, luck: -6.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -0.4%, adjustment: -0.6
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 134 (base: 130, trait: +5, luck: -0.6)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.7%, adjustment: -6.1
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 124 (base: 130, trait: +0, luck: -6.1)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 7.9%, adjustment: 10.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 146 (base: 130, trait: +5, luck: 10.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 1.4%, adjustment: 1.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 132 (base: 130, trait: +0, luck: 1.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -4.3%, adjustment: -5.8
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 129 (base: 130, trait: +5, luck: -5.8)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 3.6%, adjustment: 4.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 135 (base: 130, trait: +0, luck: 4.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: 6.4%, adjustment: 8.7
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 144 (base: 130, trait: +5, luck: 8.7)
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Base score for Racing: 130
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Luck modifier: -8.6%, adjustment: -11.2
[2025-12-27 23:21:34] info: [calculateCompetitionScore] Horse Test Horse: Final score: 119 (base: 130, trait: +0, luck: -11.2)
PASS tests/enhancedCompetitionIntegration.test.mjs
  üèÜ INTEGRATION: Enhanced Competition Integration - Trait Scoring Validation
    Basic Integration Tests
      ‚àö should successfully import and use calculateCompetitionScore function (7 ms)
      ‚àö should apply trait bonuses correctly for each discipline (99 ms)
      ‚àö should not apply trait bonus when trait does not match discipline (63 ms)
      ‚àö should handle horses with missing epigeneticModifiers (11 ms)
      ‚àö should provide consistent scoring results with variance (50 ms)
      ‚àö should demonstrate that trait integration is working (151 ms)

[2025-12-27 23:21:34] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:34] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:34] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:35] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
PASS __tests__/unit/security/rate-limit-keys.test.mjs
  Rate Limit Key Generation Unit Tests
    IP-Based Key Generation
      ‚àö should generate key based on IP address (4 ms)
      ‚àö should handle IPv4 addresses (1 ms)
      ‚àö should handle IPv6 addresses (1 ms)
      ‚àö should handle localhost IPv4 (1 ms)
      ‚àö should handle localhost IPv6 (1 ms)
      ‚àö should handle IP from X-Forwarded-For header (1 ms)
      ‚àö should handle IP from X-Real-IP header (1 ms)
    User-Based Key Generation
      ‚àö should generate key based on user ID when authenticated (1 ms)
      ‚àö should handle authenticated user with IP fallback (1 ms)
      ‚àö should handle unauthenticated user (null) (1 ms)
      ‚àö should handle unauthenticated user (undefined) (2 ms)
      ‚àö should handle user with string ID (1 ms)
      ‚àö should handle user with numeric ID (1 ms)
    Route-Based Key Generation
      ‚àö should generate different keys for different routes
      ‚àö should handle parameterized routes (1 ms)
      ‚àö should handle query parameters
      ‚àö should handle nested routes (2 ms)
      ‚àö should handle trailing slashes (1 ms)
      ‚àö should handle root path (1 ms)
    Combined Key Generation
      ‚àö should generate unique keys for user+route combination (7 ms)
      ‚àö should generate unique keys for IP+route combination (1 ms)
      ‚àö should generate unique keys for user+IP+route combination (1 ms)
      ‚àö should generate different keys for same user on different IPs (1 ms)
      ‚àö should generate different keys for different users on same IP (1 ms)
    Key Consistency
      ‚àö should generate consistent keys for same request parameters
      ‚àö should generate consistent keys across requests
      ‚àö should not be affected by request method
      ‚àö should not be affected by request headers (except proxy headers) (1 ms)
      ‚àö should not be affected by request body (2 ms)
    Key Security
      ‚àö should not expose sensitive user information in key (1 ms)
      ‚àö should handle SQL injection attempts in user ID (1 ms)
      ‚àö should handle special characters in IP (1 ms)
      ‚àö should handle null bytes in path (1 ms)
      ‚àö should handle extremely long user IDs (1 ms)
      ‚àö should handle extremely long IPs (IPv6) (1 ms)
    Key Storage Format
      ‚àö should generate Redis-compatible keys (2 ms)
      ‚àö should use colon as delimiter (1 ms)
      ‚àö should handle paths with slashes in keys (1 ms)
    Edge Cases
      ‚àö should handle missing IP address
      ‚àö should handle missing path
      ‚àö should handle empty string IP (1 ms)
      ‚àö should handle empty string path (1 ms)
      ‚àö should handle object as IP (edge case) (1 ms)
      ‚àö should handle array as path (edge case) (4 ms)

[2025-12-27 23:21:35] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:35] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:35] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:36] info: [rateLimiting] Using in-memory rate limiting for test/disabled Redis environment
  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:36] info: [SwaggerSetup] OpenAPI specification loaded successfully
[2025-12-27 23:21:36] info: [SwaggerSetup] API documentation setup completed
[2025-12-27 23:21:36] info: [SwaggerSetup] Interactive docs available at: /api-docs
[2025-12-27 23:21:36] info: [SwaggerSetup] OpenAPI JSON available at: /api-docs/swagger.json
[2025-12-27 23:21:36] info: [SwaggerSetup] OpenAPI YAML available at: /api-docs/swagger.yaml
PASS __tests__/integration/security/rate-limit-enforcement.test.mjs
  Rate Limit Enforcement Integration Tests
    ‚àö should pass a dummy test with app (3 ms)

[2025-12-27 23:21:36] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:36] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:36] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/horseAgingIntegration.test.mjs
  Horse Aging Integration
    Complete Aging Workflow
      ‚àö should process foal birthday with trait milestone evaluation (121 ms)
      ‚àö should handle multiple horses with different milestone scenarios (128 ms)
      ‚àö should handle foal with minimal task history (35 ms)
      ‚àö should handle foal with no task history (30 ms)
    Error Handling
      ‚àö should handle database errors gracefully (26 ms)

[2025-12-27 23:21:37] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:37] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:37] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 4
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 20 points for trait: bonded (total: 20)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 20 points for trait: resilient (total: 20)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 2
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: confident (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: early_touch, count: 3
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: calm (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 20, total: 20, chance: 20%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 5.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 20, total: 20, chance: 20%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 5.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 10, total: 10, chance: 10%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 5.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: calm, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: calm (rolled: 5.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["bonded","resilient","confident","calm"]
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 7
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 10 (streak: 7)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 2
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: bonded (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: resilient (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 1
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 5 points for trait: confident (total: 5)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 10, total: 20, chance: 20%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 10.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 10, total: 20, chance: 20%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 10.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 5, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 10.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["bonded","resilient","confident"]
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 20
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 100 points for trait: bonded (total: 100)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 100 points for trait: resilient (total: 100)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 15
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 75 points for trait: confident (total: 75)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 100, total: 100, chance: 60%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 50.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 100, total: 100, chance: 60%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 50.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 75, total: 75, chance: 60%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 50.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["bonded","resilient","confident"]
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 2
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: bonded (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: resilient (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 1
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 5 points for trait: confident (total: 5)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 10, total: 10, chance: 10%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: bonded (rolled: 90.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 10, total: 10, chance: 10%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: resilient (rolled: 90.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 5, total: 5, chance: 5%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: confident (rolled: 90.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: []
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: []
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] No valid task log provided
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 3
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: bonded (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: resilient (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 10.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 10.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["bonded","resilient"]
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 2
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: confident (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: showground_exposure, count: 1
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 5 points for trait: crowdReady (total: 5)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 5 points for trait: confident (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 4.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: crowdReady, base: 5, total: 5, chance: 5%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: crowdReady (rolled: 4.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["confident","crowdReady"]
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 5
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 25 points for trait: bonded (total: 25)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 25 points for trait: resilient (total: 25)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 3
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: confident (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: early_touch, count: 2
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: calm (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 25, total: 25, chance: 25%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 10.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 25, total: 25, chance: 25%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 10.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 10.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: calm, base: 10, total: 10, chance: 10%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: calm (rolled: 10.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["bonded","resilient","confident"]
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 7
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 10 (streak: 7)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 8
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 40 points for trait: bonded (total: 40)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 40 points for trait: resilient (total: 40)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 5
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 25 points for trait: confident (total: 25)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: showground_exposure, count: 3
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: crowdReady (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: confident (total: 40)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: early_touch, count: 6
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 30 points for trait: calm (total: 30)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: hoof_handling, count: 4
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 20 points for trait: showCalm (total: 20)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: sponge_bath, count: 2
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: showCalm (total: 30)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: presentationBoosted (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 40, total: 50, chance: 50%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 30.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 40, total: 50, chance: 50%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 30.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 40, total: 50, chance: 50%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 30.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: crowdReady, base: 15, total: 25, chance: 25%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: crowdReady (rolled: 30.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: calm, base: 30, total: 40, chance: 40%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: calm (rolled: 30.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: showCalm, base: 30, total: 40, chance: 40%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: showCalm (rolled: 30.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: presentationBoosted, base: 10, total: 20, chance: 20%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: presentationBoosted (rolled: 30.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["bonded","resilient","confident","calm","showCalm"]
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 3
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: confident (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 10.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["confident"]
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: -5
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: -5)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 2
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: bonded (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: resilient (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 10, total: 10, chance: 10%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 5.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 10, total: 10, chance: 10%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 5.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["bonded","resilient"]
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 50
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 250 points for trait: bonded (total: 250)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 250 points for trait: resilient (total: 250)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 30
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 150 points for trait: confident (total: 150)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 250, total: 250, chance: 60%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: bonded (rolled: 70.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 250, total: 250, chance: 60%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: resilient (rolled: 70.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 150, total: 150, chance: 60%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: confident (rolled: 70.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: []
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 3
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: bonded (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: resilient (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 2
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: confident (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 5.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 5.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 10, total: 10, chance: 10%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 5.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["bonded","resilient","confident"]
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 3
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: bonded (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: resilient (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 2
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: confident (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 12.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 12.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 10, total: 10, chance: 10%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: confident (rolled: 12.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["bonded","resilient"]
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 3
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: bonded (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: resilient (total: 15)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 2
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: confident (total: 10)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: bonded (rolled: 20.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: resilient (rolled: 20.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 10, total: 10, chance: 10%
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: confident (rolled: 20.00)
[2025-12-27 23:21:37] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: []
PASS tests/traitMilestoneEvaluation.test.mjs
  Trait Milestone Evaluation
    evaluateEpigeneticTagsFromFoalTasks
      ‚àö should evaluate traits from task log without streak bonus (28 ms)
      ‚àö should apply streak bonus when consecutive days >= 7 (18 ms)
      ‚àö should cap trait probability at 60% (17 ms)
      ‚àö should not assign traits when random chance is too high (15 ms)
      ‚àö should handle empty task log (4 ms)
      ‚àö should handle null task log (7 ms)
      ‚àö should handle tasks not in influence map (11 ms)
      ‚àö should handle multiple tasks influencing same trait (16 ms)
      ‚àö should return unique traits only (18 ms)
      ‚àö should handle comprehensive foal development scenario (37 ms)
      ‚àö should handle edge case with zero task counts (9 ms)
      ‚àö should handle negative streak values (13 ms)
      ‚àö should handle very high task counts with capping (14 ms)
      ‚àö should demonstrate probability distribution (47 ms)

[2025-12-27 23:21:37] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:37] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:37] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:37] info: [UserDocService] Loaded 1 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 34 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] warn: [UserDocService] Document not found: non-existent
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 5 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation refreshed successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] warn: [UserDocService] Documentation directory not found
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 0 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation refreshed successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:37] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:37] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:37] info: [UserDocService] Documentation system initialized successfully
[2025-12-27 23:21:38] info: [UserDocService] Loaded 4 documentation files
[2025-12-27 23:21:38] info: [UserDocService] Built search index with 95 terms
[2025-12-27 23:21:38] info: [UserDocService] Documentation system initialized successfully
PASS __tests__/services/userDocumentation.test.mjs
  User Documentation Service
    Documentation Loading
      ‚àö loads all documentation files correctly (18 ms)
      ‚àö extracts document metadata correctly (20 ms)
      ‚àö extracts sections correctly (11 ms)
      ‚àö builds search index correctly (10 ms)
    Document Retrieval
      ‚àö retrieves existing document correctly (11 ms)
      ‚àö returns null for non-existent document (14 ms)
      ‚àö tracks view analytics correctly (8 ms)
      ‚àö gets all documents correctly (11 ms)
    Search Functionality
      ‚àö searches documentation content successfully (9 ms)
      ‚àö handles single word searches (12 ms)
      ‚àö returns empty results for non-matching search (8 ms)
      ‚àö tracks search analytics (9 ms)
      ‚àö finds matching sections in search results (11 ms)
      ‚àö respects search options (9 ms)
    Analytics and Reporting
      ‚àö generates analytics correctly (13 ms)
      ‚àö tracks popular documents correctly (10 ms)
      ‚àö limits search query history (13 ms)
    Table of Contents
      ‚àö generates table of contents correctly (12 ms)
      ‚àö creates proper anchors for sections (12 ms)
    Content Parsing
      ‚àö counts words correctly (8 ms)
      ‚àö extracts searchable words correctly (8 ms)
      ‚àö normalizes search queries correctly (10 ms)
      ‚àö identifies stop words correctly (8 ms)
    System Management
      ‚àö refreshes documentation successfully (17 ms)
      ‚àö handles refresh errors gracefully (11 ms)
    Helper Functions
      ‚àö getDocument helper function works (8 ms)
      ‚àö searchDocumentation helper function works (11 ms)
      ‚àö getAllDocuments helper function works (8 ms)
      ‚àö getDocumentationAnalytics helper function works (10 ms)
      ‚àö getTableOfContents helper function works (9 ms)

[2025-12-27 23:21:38] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:38] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:38] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:38] info: Found 3 horses eligible for flag evaluation
[2025-12-27 23:21:38] info: Found 3 horses eligible for flag evaluation
[2025-12-27 23:21:38] info: Flag insecure triggered for horse Test Foal Week 1766895698531: Frequent groom changes with declining bond or neglect
[2025-12-27 23:21:38] info: Flag aloof triggered for horse Test Foal Week 1766895698531: Generic negative flag evaluation
[2025-12-27 23:21:38] info: Flag skittish triggered for horse Test Foal Week 1766895698531: Generic negative flag evaluation
[2025-12-27 23:21:38] info: Assigned 3 new flags to horse Test Foal Week 1766895698531: insecure, aloof, skittish
[2025-12-27 23:21:38] info: Starting weekly flag evaluation process
[2025-12-27 23:21:38] info: Found 3 horses eligible for flag evaluation
[2025-12-27 23:21:38] info: Flag aloof triggered for horse Test Foal Month 1766895698532: Generic negative flag evaluation
[2025-12-27 23:21:38] info: Flag skittish triggered for horse Test Foal Month 1766895698532: Generic negative flag evaluation
[2025-12-27 23:21:38] info: Assigned 2 new flags to horse Test Foal Month 1766895698532: aloof, skittish
[2025-12-27 23:21:38] info: Flag aloof triggered for horse Test Horse 2yo 1766895698532: Generic negative flag evaluation
[2025-12-27 23:21:38] info: Flag skittish triggered for horse Test Horse 2yo 1766895698532: Generic negative flag evaluation
[2025-12-27 23:21:38] info: Assigned 2 new flags to horse Test Horse 2yo 1766895698532: aloof, skittish
[2025-12-27 23:21:38] info: Weekly flag evaluation completed: 4 flags assigned to 3 horses
[2025-12-27 23:21:38] info: Starting weekly flag evaluation process
[2025-12-27 23:21:38] info: Found 3 horses eligible for flag evaluation
[2025-12-27 23:21:38] info: Weekly flag evaluation completed: 0 flags assigned to 3 horses
PASS tests/services/weeklyFlagEvaluationService.test.mjs
  Weekly Flag Evaluation Service
    getEligibleHorsesForFlagEvaluation
      ‚àö should return only horses under 3 years old (12 ms)
      ‚àö should include horses with existing flags (8 ms)
    processHorseForFlagEvaluation
      ‚àö should evaluate horse for new flags based on care patterns (29 ms)
      ‚àö should respect maximum 5 flags per horse limit (21 ms)
    evaluateWeeklyFlags
      ‚àö should process all eligible horses and return summary (49 ms)
      ‚àö should handle horses with no groom interactions gracefully (36 ms)

[2025-12-27 23:21:39] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:39] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:39] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:39] warn: [CORS] Request with no origin detected - API key validation required
[2025-12-27 23:21:39] warn: CORS blocked request from origin: http://malicious-site.com
[2025-12-27 23:21:39] warn: Rate limit exceeded for IP: ::ffff:127.0.0.1
[2025-12-27 23:21:39] warn: [CORS] Request with no origin detected - API key validation required
[2025-12-27 23:21:39] warn: [API Key] API_KEY not configured - requests with no origin are allowed (INSECURE)
PASS tests/middleware/security.test.mjs
  Security Middleware
    CORS Configuration
      ‚àö should allow requests from localhost:3000 (12 ms)
      ‚àö should allow requests from localhost:3001 (1 ms)
      ‚àö should allow requests with no origin (4 ms)
      ‚àö should block requests from unauthorized origins (2 ms)
      ‚àö should allow origins from environment variable (1 ms)
    Rate Limiter
      ‚àö should create rate limiter with default values (4 ms)
      ‚àö should create rate limiter with custom values (2 ms)
      ‚àö should limit requests when threshold is exceeded (47 ms)
    Helmet Configuration
      ‚àö should have proper CSP directives (1 ms)
      ‚àö should have HSTS configuration (2 ms)
      ‚àö should disable crossOriginEmbedderPolicy for API compatibility (2 ms)
    Security Middleware Factory
      ‚àö should create security middleware array (2 ms)
      ‚àö should apply security headers through helmet (24 ms)

[2025-12-27 23:21:39] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:39] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:39] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/foalTaskLogStreakIntegration.test.mjs
  Foal Task Log and Streak Data Integration
    Real-World Foal Development Scenarios
      ‚àö should handle week 1 of foal care with enrichment tasks (112 ms)
      ‚àö should handle streak break and recovery (27 ms)
      ‚àö should achieve burnout immunity after 7 consecutive days (42 ms)
    Task Log and Trait Evaluation Integration
      ‚àö should support trait point calculation from stored task log (20 ms)
      ‚àö should track task progression over time (27 ms)
    Grace Period and Streak Maintenance
      ‚àö should maintain streak within 2-day grace period (24 ms)
      ‚àö should break streak beyond grace period (28 ms)
    Care Summary Statistics
      ‚àö should provide comprehensive care statistics (19 ms)
    Data Persistence and Integrity
      ‚àö should maintain data integrity across multiple updates (44 ms)

[2025-12-27 23:21:40] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:40] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:40] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/services/environmentalTriggerSystem.test.mjs
  Environmental Trigger System
    detectEnvironmentalTriggers
      ‚àö should detect environmental triggers from interaction patterns (13 ms)
      ‚àö should handle horses with no environmental exposure (3 ms)
      ‚àö should detect multiple environmental trigger types (7 ms)
    calculateTriggerThresholds
      ‚àö should calculate age-appropriate trigger thresholds (11 ms)
      ‚àö should apply stress-based threshold modifications (5 ms)
    evaluateTraitExpressionProbability
      ‚àö should calculate trait expression probability based on environmental exposure (10 ms)
      ‚àö should handle trait expression for different trait types (13 ms)
    processSeasonalTriggers
      ‚àö should process seasonal environmental triggers (4 ms)
      ‚àö should handle different seasonal variations (6 ms)
    analyzeStressEnvironmentTriggers
      ‚àö should analyze stress-based environmental triggers (9 ms)
    trackCumulativeExposure
      ‚àö should track cumulative environmental exposure over time (11 ms)
    assessCriticalPeriodSensitivity
      ‚àö should assess critical period environmental sensitivity (4 ms)
      ‚àö should show reduced sensitivity for older horses (4 ms)
    generateEnvironmentalReport
      ‚àö should generate comprehensive environmental analysis report (130 ms)

[2025-12-27 23:21:41] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:41] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:41] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/foalTaskLogStorage.test.mjs
  Foal Task Log Storage
    Task Log JSON Storage
      ‚àö should initialize with null task log (94 ms)
      ‚àö should store task log as JSON object (22 ms)
      ‚àö should handle empty task log object (23 ms)
      ‚àö should update existing task counts (21 ms)
      ‚àö should handle complex task log with all foal tasks (21 ms)
    Last Care Date Tracking
      ‚àö should initialize with null last groomed date (15 ms)
      ‚àö should store last care date timestamp (19 ms)
      ‚àö should update last care date on subsequent care (19 ms)
      ‚àö should handle current timestamp updates (16 ms)
    Combined Task Log and Care Date
      ‚àö should update task log and last care date together (16 ms)
      ‚àö should simulate realistic foal development progression (25 ms)
    Data Integrity and Edge Cases
      ‚àö should handle null values gracefully (16 ms)
      ‚àö should handle very large task counts (18 ms)
      ‚àö should preserve data types correctly (16 ms)

[2025-12-27 23:21:41] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:41] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:41] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/services/developmentalWindowSystem.test.mjs
  Developmental Window System
    identifyDevelopmentalWindows
      ‚àö should identify active developmental windows for newborn foal (8 ms)
      ‚àö should identify multiple active windows for appropriate ages (4 ms)
      ‚àö should show closed windows for older foals (3 ms)
    calculateWindowSensitivity
      ‚àö should calculate high sensitivity for critical periods (4 ms)
      ‚àö should calculate reduced sensitivity outside critical periods (2 ms)
      ‚àö should apply environmental modifiers correctly (6 ms)
    evaluateTraitDevelopmentOpportunity
      ‚àö should evaluate trait development opportunities during active windows (7 ms)
      ‚àö should show higher opportunities for window-aligned traits (12 ms)
      ‚àö should provide appropriate recommendations (5 ms)
    trackDevelopmentalMilestones
      ‚àö should track developmental milestones with interactions (12 ms)
      ‚àö should show progression over time (4 ms)
    assessWindowClosure
      ‚àö should assess window closure effects (7 ms)
      ‚àö should show open status for active windows (4 ms)
      ‚àö should identify compensatory mechanisms for closed windows (3 ms)
    coordinateMultiWindowDevelopment
      ‚àö should coordinate development across multiple windows (4 ms)
      ‚àö should identify window conflicts and resolutions (5 ms)
    analyzeCriticalPeriodSensitivity
      ‚àö should analyze critical period sensitivity comprehensively (15 ms)
      ‚àö should identify age-appropriate risk factors (12 ms)
    generateDevelopmentalForecast
      ‚àö should generate comprehensive developmental forecast (4 ms)
      ‚àö should project trait development accurately (5 ms)
      ‚àö should provide actionable recommendations (6 ms)

[2025-12-27 23:21:42] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:42] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:42] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/groomHiringWorkflow.test.mjs
  Groom Hiring Workflow Tests
    1. Required Field Validation
      ‚àö should validate name is required (174 ms)
      ‚àö should validate speciality is required (14 ms)
      ‚àö should validate skill_level is required (18 ms)
      ‚àö should validate personality is required (11 ms)
      ‚àö should validate all required fields at once (11 ms)
    2. Field Value Validation
      ‚àö should validate speciality against defined values (10 ms)
      ‚àö should validate skill_level against defined values (11 ms)
      ‚àö should validate personality against defined values (13 ms)
      ‚àö should accept all valid speciality values (61 ms)
      ‚àö should accept all valid skill_level values (48 ms)
      ‚àö should accept all valid personality values (40 ms)
    3. Optional Field Handling
      ‚àö should use default experience value when not provided (17 ms)
      ‚àö should calculate session rate based on skill level when not provided (25 ms)
      ‚àö should use provided session rate when specified (17 ms)
      ‚àö should store bio when provided (20 ms)
      ‚àö should store availability when provided (17 ms)
    4. User Account Hiring Limits
      ‚àö should enforce maximum groom limit per user (94 ms)
      ‚àö should validate user has sufficient funds for hiring (13 ms)
      ‚àö should allow wealthy users to hire expensive grooms (19 ms)
    5. Error Handling & Edge Cases
      ‚àö should handle empty strings for required fields (9 ms)
      ‚àö should handle extremely long names (9 ms)
      ‚àö should handle negative experience values (12 ms)
      ‚àö should handle negative session rates (11 ms)
      ‚àö should handle missing user ID (12 ms)
    6. System Integration
      ‚àö should retrieve groom definitions with all required data (13 ms)

[2025-12-27 23:21:43] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:43] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:43] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:43] info: [competitionRewards.calculateStatGains] 1st place winner gained +1 speed (10% chance)
[2025-12-27 23:21:43] info: [competitionRewards.calculateStatGains] 2nd place winner gained +1 balance (5% chance)
[2025-12-27 23:21:43] info: [competitionRewards.calculateStatGains] 3rd place winner gained +1 precision (3% chance)
[2025-12-27 23:21:43] info: [competitionRewards.calculateStatGains] 1st place winner gained +1 speed (10% chance)
[2025-12-27 23:21:43] info: [competitionRewards.calculateStatGains] 1st place winner gained +1 stamina (10% chance)
[2025-12-27 23:21:43] info: [competitionRewards.calculateStatGains] 1st place winner gained +1 focus (10% chance)
PASS tests/competitionRewards.test.mjs
  üèÜ UNIT: Competition Rewards System - Prize & Stat Gain Calculations
    calculatePrizeDistribution
      ‚àö should calculate correct prize distribution for 1000 prize pool (3 ms)
      ‚àö should handle odd prize amounts with rounding
      ‚àö should handle small prize amounts
      ‚àö should handle zero prize pool
    getRelevantStats
      ‚àö should return correct stats for Racing discipline (2 ms)
      ‚àö should return correct stats for Show Jumping discipline (1 ms)
      ‚àö should return correct stats for Dressage discipline
      ‚àö should return default stats for unknown discipline (1 ms)
      ‚àö should handle all supported disciplines (3 ms)
    calculateStatGains
      ‚àö should grant stat gain for 1st place with 10% chance (lucky roll) (12 ms)
      ‚àö should not grant stat gain for 1st place with unlucky roll (1 ms)
      ‚àö should grant stat gain for 2nd place with 5% chance (lucky roll) (4 ms)
      ‚àö should grant stat gain for 3rd place with 3% chance (lucky roll) (2 ms)
      ‚àö should not grant stat gain for non-podium placement (1 ms)
      ‚àö should not grant stat gain for invalid placement (1 ms)
      ‚àö should select random stat from relevant discipline stats (5 ms)
    calculateEntryFees
      ‚àö should calculate total entry fees correctly (1 ms)
      ‚àö should handle zero entry fee (1 ms)
      ‚àö should handle zero entries (1 ms)
      ‚àö should handle large numbers (2 ms)
    hasValidRider
      ‚àö should return true for horse with valid rider object (1 ms)
      ‚àö should return false for horse with null rider (1 ms)
      ‚àö should return false for horse with undefined rider
      ‚àö should return false for horse with non-object rider (1 ms)
      ‚àö should return true for horse with empty object rider

[2025-12-27 23:21:43] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:43] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:43] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/trainingCooldown.test.mjs
  ‚è∞ UNIT: Training Cooldown System - Horse Training Restrictions
    canTrain
      ‚àö should return true for horse with no cooldown (3 ms)
      ‚àö should return true for horse with cooldown in the past (1 ms)
      ‚àö should return false for horse with cooldown in the future (1 ms)
      ‚àö should throw error for null horse (5 ms)
      ‚àö should throw error for undefined horse (1 ms)
    getCooldownTimeRemaining
      ‚àö should return null for horse with no cooldown (9 ms)
      ‚àö should return null for horse with cooldown in the past (1 ms)
      ‚àö should return positive milliseconds for horse with cooldown in the future (2 ms)
      ‚àö should return approximately correct time remaining (1 ms)
      ‚àö should throw error for null horse (1 ms)
      ‚àö should throw error for undefined horse (1 ms)
    setCooldown
      ‚àö should set cooldown 7 days in the future (1 ms)
      ‚àö should return updated horse with relations (2 ms)
      ‚àö should throw error for non-existent horse ID (1 ms)
      ‚àö should throw error for null horse ID (1 ms)
      ‚àö should throw error for undefined horse ID (1 ms)
      ‚àö should throw error for invalid horse ID (string) (1 ms)
      ‚àö should throw error for invalid horse ID (negative) (1 ms)
      ‚àö should throw error for invalid horse ID (zero) (2 ms)
      ‚àö should handle string horse ID that can be parsed to integer (1 ms)
    formatCooldown
      ‚àö should return "Ready to train" for null input (1 ms)
      ‚àö should return "Ready to train" for zero milliseconds (13 ms)
      ‚àö should return "Ready to train" for negative milliseconds (1 ms)
      ‚àö should format minutes correctly (1 ms)
      ‚àö should format hours and minutes correctly (1 ms)
      ‚àö should format days and hours correctly (2 ms)
      ‚àö should format exactly 7 days correctly (1 ms)
    Integration Tests
      ‚àö should complete full training cooldown workflow (2 ms)
      ‚àö should work with horse retrieved from database (1 ms)

[2025-12-27 23:21:44] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:44] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:44] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:44] info: Groom 46900 selected talent gentle_hands for tier1
[2025-12-27 23:21:44] info: Groom 46902 selected talent gentle_hands for tier1
[2025-12-27 23:21:44] info: Groom 46903 selected talent gentle_hands for tier1
[2025-12-27 23:21:44] info: Groom 46903 selected talent stress_whisperer for tier2
[2025-12-27 23:21:44] info: Groom 46903 selected talent master_bonding for tier3
[2025-12-27 23:21:44] error: Error selecting talent for groom 46904: Invalid talent selection: invalid_talent
[2025-12-27 23:21:44] error: Error selecting talent for groom 46906: Invalid talent selection: insufficient_level
[2025-12-27 23:21:44] info: Groom 46907 selected talent gentle_hands for tier1
[2025-12-27 23:21:44] info: Groom 46908 selected talent gentle_hands for tier1
[2025-12-27 23:21:44] info: Groom 46908 selected talent stress_whisperer for tier2
[2025-12-27 23:21:44] info: Groom 46910 selected talent gentle_hands for tier1
PASS tests/services/groomTalentService.test.mjs
  Groom Talent Service
    Talent Tree Definitions
      ‚àö should return complete talent tree definitions (23 ms)
      ‚àö should have consistent talent requirements (12 ms)
    Talent Selection Validation
      ‚àö should validate valid talent selection (12 ms)
      ‚àö should reject selection for insufficient level (16 ms)
      ‚àö should reject invalid talent for personality (10 ms)
      ‚àö should reject selection if tier already selected (16 ms)
      ‚àö should require prerequisite tiers (11 ms)
    Talent Selection
      ‚àö should successfully select tier 1 talent (16 ms)
      ‚àö should successfully select multiple tiers in sequence (23 ms)
      ‚àö should reject invalid talent selection (12 ms)
      ‚àö should reject selection for insufficient level (13 ms)
    Talent Effects
      ‚àö should apply talent effects to groom interactions (18 ms)
      ‚àö should handle multiple talent effects (23 ms)
      ‚àö should handle groom with no talent selections (8 ms)
    Talent Retrieval
      ‚àö should get groom talent selections (13 ms)
      ‚àö should return null for groom with no selections (7 ms)

[2025-12-27 23:21:44] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:44] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:44] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:45] warn: [HTTPS] Insecure HTTP request detected, redirecting to HTTPS
[2025-12-27 23:21:45] warn: [HTTPS] Insecure HTTP request detected, redirecting to HTTPS
[2025-12-27 23:21:45] warn: [API Key] Invalid or missing API key
[2025-12-27 23:21:45] warn: [API Key] Invalid or missing API key
[2025-12-27 23:21:45] warn: [API Key] Invalid or missing API key
[2025-12-27 23:21:45] warn: [API Key] API_KEY not configured - requests with no origin are allowed (INSECURE)
[2025-12-27 23:21:45] warn: [API Key] API_KEY not configured - requests with no origin are allowed (INSECURE)
[2025-12-27 23:21:45] warn: CORS blocked request from origin: https://evil.com
[2025-12-27 23:21:45] warn: [CORS] Request with no origin detected - API key validation required
[2025-12-27 23:21:45] warn: [CORS] Request with no origin detected - API key validation required
  console.error
    TypeError: Cannot read properties of undefined (reading 'get')
        at Object.trustProxy (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\node_modules\express-rate-limit\dist\index.mjs:140:21)
        at Object.wrappedValidations.<computed> [as trustProxy] (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\node_modules\express-rate-limit\dist\index.mjs:370:22)
        at Object.keyGenerator (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\node_modules\express-rate-limit\dist\index.mjs:642:20)
        at C:\Users\heirr\OneDrive\Desktop\Equoria\backend\node_modules\express-rate-limit\dist\index.mjs:696:32
        at C:\Users\heirr\OneDrive\Desktop\Equoria\backend\node_modules\express-rate-limit\dist\index.mjs:676:5
        at Object.<anonymous> (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\__tests__\middleware\security.test.mjs:447:7)

    [0m [90m 445 |[39m
     [90m 446 |[39m       [90m// First request should succeed[39m
    [31m[1m>[22m[39m[90m 447 |[39m       [36mawait[39m testLimiter(req[33m,[39m res[33m,[39m next)[33m;[39m
     [90m     |[39m       [31m[1m^[22m[39m
     [90m 448 |[39m       expect(next)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 449 |[39m
     [90m 450 |[39m       [90m// Reset mocks[39m[0m

      at Object.wrappedValidations.<computed> [as trustProxy] (node_modules/express-rate-limit/dist/index.mjs:378:21)
      at Object.keyGenerator (node_modules/express-rate-limit/dist/index.mjs:642:20)
      at node_modules/express-rate-limit/dist/index.mjs:696:32
      at node_modules/express-rate-limit/dist/index.mjs:676:5
      at Object.<anonymous> (__tests__/middleware/security.test.mjs:447:7)

[2025-12-27 23:21:45] warn: Rate limit exceeded for IP: 192.168.1.100
PASS __tests__/middleware/security.test.mjs
  Security Middleware
    enforceHttps()
      Development environment
        ‚àö should allow HTTP requests in development (4 ms)
      Production environment
        ‚àö should allow HTTPS requests (req.secure) (2 ms)
        ‚àö should allow HTTPS requests (x-forwarded-proto header) (2 ms)
        ‚àö should allow HTTPS requests (x-forwarded-ssl header) (3 ms)
        ‚àö should redirect HTTP to HTTPS with 301 status (5 ms)
        ‚àö should preserve query parameters in redirect (10 ms)
    addSecurityHeaders()
      ‚àö should add HSTS header in production (2 ms)
      ‚àö should NOT add HSTS header in development (1 ms)
      ‚àö should add X-Frame-Options header (3 ms)
      ‚àö should add X-Content-Type-Options header (1 ms)
      ‚àö should add X-XSS-Protection header (2 ms)
      ‚àö should add Referrer-Policy header (2 ms)
      ‚àö should add Permissions-Policy header (1 ms)
      ‚àö should add all 6 security headers in production (2 ms)
    validateApiKey()
      Requests WITH origin header
        ‚àö should skip API key validation for browser requests (2 ms)
        ‚àö should skip validation even if X-API-Key is missing (3 ms)
      Requests WITHOUT origin header (mobile/API clients)
        ‚àö should accept valid API key (6 ms)
        ‚àö should reject missing API key (3 ms)
        ‚àö should reject invalid API key (4 ms)
        ‚àö should be case-sensitive for API key (3 ms)
      Missing API_KEY environment variable
        ‚àö should allow requests without API key (backward compatibility) (4 ms)
        ‚àö should log warning when API_KEY not configured (3 ms)
    CORS Configuration
      ‚àö should have credentials enabled (2 ms)
      ‚àö should allow standard HTTP methods (1 ms)
      ‚àö should allow required headers (1 ms)
      corsOptions.origin()
        ‚àö should allow localhost:3000 (3 ms)
        ‚àö should allow localhost:3001 (6 ms)
        ‚àö should allow 127.0.0.1:3000 (1 ms)
        ‚àö should allow additional origins from environment (1 ms)
        ‚àö should block unknown origins (4 ms)
        ‚àö should allow requests with no origin (mobile apps) (2 ms)
        ‚àö should allow requests with null origin (3 ms)
    createRateLimiter()
      ‚àö should create a rate limiter with custom window and max (5 ms)
      ‚àö should create rate limiter with default values (6 ms)
      ‚àö should return rate limiter middleware (2 ms)
    Rate Limiter Instances
      ‚àö should export apiLimiter (1 ms)
      ‚àö should trigger rate limit handler when limit exceeded (13 ms)
    createSecurityMiddleware()
      ‚àö should return an array of middleware functions (4 ms)
      ‚àö should include all required middleware in correct order (2 ms)

[2025-12-27 23:21:45] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:45] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:45] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting memory and resource monitoring
[2025-12-27 23:21:45] info: [MemoryManager] Stopping memory and resource monitoring
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 1 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 2 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 3 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 1 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] warn: [MemoryManager] Potential memory leak detected: 2MB per sample
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] warn: [MemoryManager] Memory threshold alert: 90MB used
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 1 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 1 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting memory and resource monitoring
[2025-12-27 23:21:45] info: [MemoryManager] Stopping memory and resource monitoring
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting memory and resource monitoring
[2025-12-27 23:21:45] info: [MemoryManager] Stopping memory and resource monitoring
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
[2025-12-27 23:21:45] info: [MemoryManager] Starting resource cleanup
[2025-12-27 23:21:45] info: [MemoryManager] Resource cleanup completed: 0 resources cleaned
(node:41752) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 exit listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:41752) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGTERM listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:41752) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGINT listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:41752) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 uncaughtException listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(node:41752) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 unhandledRejection listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
PASS __tests__/services/memoryResourceManagement.test.mjs
  Memory and Resource Management System
    Memory Manager Initialization
      ‚àö creates memory manager with default options (8 ms)
      ‚àö creates memory manager with custom options (16 ms)
      ‚àö returns singleton instance (4 ms)
    Memory Monitoring
      ‚àö starts and stops monitoring correctly (8 ms)
      ‚àö collects memory metrics correctly (9 ms)
      ‚àö stores memory metrics history (6 ms)
      ‚àö limits memory metrics history to 1000 entries (16 ms)
    Resource Tracking
      ‚àö tracks and untracks timers correctly (5 ms)
      ‚àö tracks and untracks intervals correctly (14 ms)
      ‚àö tracks event listeners correctly (7 ms)
      ‚àö gets resource counts correctly (6 ms)
    Resource Cleanup
      ‚àö cleans up all tracked resources (10 ms)
      ‚àö handles cleanup errors gracefully (7 ms)
    Memory Leak Detection
      ‚àö calculates memory trend correctly (5 ms)
      ‚àö detects memory leaks with consistent growth (7 ms)
    Memory Threshold Monitoring
      ‚àö triggers alert when memory threshold exceeded (10 ms)
      ‚àö does not trigger alert when memory is below threshold (4 ms)
    Garbage Collection
      ‚àö optimizes garbage collection when available (6 ms)
      ‚àö handles GC unavailability gracefully (5 ms)
    Comprehensive Report Generation
      ‚àö generates complete memory and resource report (6 ms)
    Helper Functions
      ‚àö trackResource helper function works correctly (8 ms)
      ‚àö untrackResource helper function works correctly (8 ms)
      ‚àö getMemoryReport helper function works correctly (6 ms)
      ‚àö initializeMemoryManagement starts monitoring (13 ms)
    Event Handling
      ‚àö emits monitoring events correctly (9 ms)
      ‚àö emits metrics collection events (5 ms)

[2025-12-27 23:21:46] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:46] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:46] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:46] warn: [ownership] Missing user for horse ownership check
[2025-12-27 23:21:46] warn: [ownership] Missing user for horse ownership check
[2025-12-27 23:21:46] warn: [ownership] Invalid horse ID: invalid
[2025-12-27 23:21:46] info: [ownership] Validated ownership: user user-123 owns horse 1
[2025-12-27 23:21:46] warn: [ownership] horse 1 not found or not owned by user user-123
[2025-12-27 23:21:46] info: [ownership] Validated ownership: user user-123 owns foal 1
[2025-12-27 23:21:46] info: [ownership] Validated ownership: user user-123 owns groom 1
[2025-12-27 23:21:46] info: [ownership] Validated ownership: user user-123 owns groom-assignment 1
[2025-12-27 23:21:46] info: [ownership] Validated ownership: user user-123 owns breeding 1
[2025-12-27 23:21:47] info: [ownership] Validated ownership: user user-123 owns competition-entry 1
[2025-12-27 23:21:47] info: [ownership] Validated ownership: user user-123 owns training-session 1
[2025-12-27 23:21:47] error: [ownership] Unexpected error: Database connection error
[2025-12-27 23:21:47] info: [ownership] Found owned horse 1 for user user-123
[2025-12-27 23:21:47] info: [ownership] Batch validation: user user-123 owns 2/2 horses
[2025-12-27 23:21:47] warn: [ownership] horse 1 not found or not owned by user user-123
[2025-12-27 23:21:47] info: [ownership] Validated ownership: user user-123 owns horse 1
[2025-12-27 23:21:47] info: [ownership] Validated ownership: user user-123 owns horse 1
PASS __tests__/middleware/ownership.test.mjs
  Ownership Middleware
    requireOwnership()
      Authentication validation
        ‚àö should return 401 if user is not authenticated (7 ms)
        ‚àö should return 401 if user.id is missing (4 ms)
      Resource ID validation
        ‚àö should return 400 if resource ID is not a number (17 ms)
      Ownership validation - Horse
        ‚àö should allow access to owned horse (5 ms)
        ‚àö should return 404 if horse does not exist (3 ms)
      Ownership validation - Other resource types
        ‚àö should validate foal ownership (4 ms)
        ‚àö should validate groom ownership (4 ms)
        ‚àö should validate groom-assignment ownership (4 ms)
        ‚àö should validate breeding ownership (maps to horse) (11 ms)
        ‚àö should validate competition-entry ownership (maps to competitionResult) (3 ms)
        ‚àö should validate training-session ownership (maps to trainingLog) (4 ms)
      Error handling
        ‚àö should handle database errors gracefully (3 ms)
    findOwnedResource()
      ‚àö should return owned horse (3 ms)
    validateBatchOwnership()
      ‚àö should return all owned horses (3 ms)
    Security tests
      ‚àö should prevent ownership disclosure (CWE-639) (5 ms)
      ‚àö should prevent TOCTOU vulnerabilities by using atomic single query (3 ms)
      ‚àö should validate user ID from token, not from request params (8 ms)

[2025-12-27 23:21:47] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:47] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:47] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/services/carePatternAnalyzerEnhanced.test.mjs
  Enhanced Care Pattern Analyzer
    calculateAdvancedConsistencyScore
      ‚àö should calculate weighted consistency score with multiple factors (32 ms)
      ‚àö should detect inconsistent care patterns (16 ms)
    detectCareQualityTrends
      ‚àö should detect improving care quality trends (21 ms)
      ‚àö should detect declining care quality trends (12 ms)
    analyzeGroomEffectiveness
      ‚àö should analyze individual groom effectiveness (6 ms)
      ‚àö should identify most and least effective grooms (4 ms)
    calculateCareRiskScore
      ‚àö should calculate comprehensive care risk assessment (9 ms)
      ‚àö should identify specific risk factors (4 ms)
    Enhanced Care Pattern Integration
      ‚àö should integrate all enhanced features for comprehensive analysis (13 ms)

[2025-12-27 23:21:48] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:48] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:48] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS __tests__/unit/cacheHelper.test.mjs
  CacheHelper
    generateCacheKey()
      ‚àö should generate cache key from multiple components (4 ms)
      ‚àö should filter out null and undefined components (1 ms)
      ‚àö should replace colons and spaces with underscores (1 ms)
      ‚àö should handle single component (1 ms)
      ‚àö should handle empty array (1 ms)
      ‚àö should convert numbers to strings (1 ms)
    Test Environment Behavior
      ‚àö should disable Redis in test environment (3 ms)
    Connection Management
      ‚àö should initialize Redis connection successfully (2 ms)
      ‚àö should handle connection failure gracefully (10 ms)
    getCachedQuery()
      ‚àö should execute query on cache miss and store result (2 ms)
      ‚àö should return cached result on cache hit without executing query (2 ms)
      ‚àö should use default TTL of 60 seconds when not specified (1 ms)
      ‚àö should handle JSON parse errors gracefully (2 ms)
      ‚àö should handle query function errors (5 ms)
      ‚àö should handle cache write errors gracefully (1 ms)
      ‚àö should bypass cache when Redis unavailable (1 ms)
    invalidateCache()
      ‚àö should delete single cache key successfully (1 ms)
      ‚àö should return 0 when Redis unavailable (2 ms)
      ‚àö should handle invalidation errors gracefully (2 ms)
    invalidateCachePattern()
      ‚àö should delete all keys matching pattern (1 ms)
      ‚àö should return 0 when no keys match pattern (1 ms)
      ‚àö should handle pattern errors gracefully (2 ms)
    invalidateCacheMultiple()
      ‚àö should delete multiple keys at once (2 ms)
      ‚àö should return 0 for empty array (6 ms)
      ‚àö should handle errors gracefully (2 ms)
    clearAllCache()
      ‚àö should clear all cache keys successfully (1 ms)
      ‚àö should return false when Redis unavailable (1 ms)
      ‚àö should handle errors gracefully (1 ms)
    getCacheStatistics()
      ‚àö should return cache statistics with hit rate (2 ms)
      ‚àö should handle zero hits and misses (1 ms)
      ‚àö should include Redis statistics when available (2 ms)
    resetCacheStatistics()
      ‚àö should reset all cache counters (2 ms)
    closeRedisConnection()
      ‚àö should close Redis connection gracefully (1 ms)
      ‚àö should be idempotent (safe to call multiple times) (1 ms)
      ‚àö should handle close errors gracefully (1 ms)
    Cache Invalidation Helpers
      ‚àö should invalidate all horses caches (1 ms)
      ‚àö should invalidate specific horse cache (2 ms)
      ‚àö should invalidate all grooms caches (1 ms)
      ‚àö should invalidate specific groom cache (1 ms)
      ‚àö should invalidate all leaderboards caches (2 ms)
      ‚àö should invalidate all competitions caches (1 ms)
      ‚àö should invalidate specific competition cache (2 ms)
      ‚àö should invalidate all users caches (5 ms)
      ‚àö should invalidate specific user cache (2 ms)

[2025-12-27 23:21:48] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:48] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:48] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:49] info: Created legacy prot√©g√© Young Apprentice (ID: 46923) from mentor Retired Master Groom 1766895709028 (ID: 46922)
[2025-12-27 23:21:49] info: Inherited perk: Gentle Hands
[2025-12-27 23:21:49] error: Error generating legacy prot√©g√© for mentor 46925: Mentor groom 46925 is not eligible for legacy creation: insufficient_level
[2025-12-27 23:21:49] info: Created legacy prot√©g√© History Test Apprentice (ID: 46929) from mentor Retired Master Groom 1766895709111 (ID: 46928)
[2025-12-27 23:21:49] info: Inherited perk: Empathic Sync
PASS tests/services/groomLegacyService.test.mjs
  Groom Legacy Service
    Legacy Eligibility
      ‚àö should identify eligible retired groom (186 ms)
      ‚àö should reject non-retired groom (29 ms)
      ‚àö should reject low-level retired groom (23 ms)
      ‚àö should reject groom with existing legacy (26 ms)
    Prot√©g√© Generation
      ‚àö should generate prot√©g√© with inherited perks (33 ms)
      ‚àö should reject generation for ineligible mentor (22 ms)
    Legacy Perks
      ‚àö should get available perks for personality type (15 ms)
      ‚àö should handle unknown personality type (12 ms)
    Legacy History
      ‚àö should track user legacy history (32 ms)

[2025-12-27 23:21:49] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:49] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:49] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:49] warn: [Validation] Input validation failed
[2025-12-27 23:21:49] warn: [Validation] Input validation failed
[2025-12-27 23:21:49] warn: [Validation] Input validation failed
PASS __tests__/middleware/validationErrorHandler.test.mjs
  Validation Error Handler
    handleValidationErrors()
      ‚àö should call next() when no validation errors (3 ms)
      ‚àö should return 400 when validation errors exist (5 ms)
      ‚àö should handle single validation error (4 ms)
      ‚àö should handle nested field validation errors (8 ms)
    sanitizeRequestData() - XSS Prevention
      No validation errors
        ‚àö should sanitize body data and remove extra fields (4 ms)
        ‚àö should sanitize query parameters (3 ms)
        ‚àö should sanitize route parameters (3 ms)
        ‚àö should handle multiple request sources simultaneously (3 ms)
        ‚àö should preserve validated data with special characters (3 ms)
        ‚àö should handle empty validated data (3 ms)
        ‚àö should handle optional fields (2 ms)
      With validation errors
        ‚àö should NOT modify request data when validation failed (2 ms)
        ‚àö should still call next() to allow handleValidationErrors to run (5 ms)
      XSS Attack Scenarios
        ‚àö should prevent <script> injection (4 ms)
        ‚àö should prevent event handler injection (2 ms)
        ‚àö should prevent iframe injection (2 ms)
        ‚àö should prevent SVG XSS (2 ms)
      Parameter Pollution Prevention (CWE-20)
        ‚àö should prevent array parameter pollution (2 ms)
        ‚àö should prevent object parameter pollution (4 ms)
        ‚àö should prevent duplicate parameter names (3 ms)

[2025-12-27 23:21:50] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:50] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:50] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 1: 2 traits applied, 11.4% modifier, 7.6 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Base Horse: 2 traits applied, 11.4% modifier, 7.6 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 1: 2 traits applied, -10.4% modifier, -7.0 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Base Horse: 2 traits applied, -10.4% modifier, -7.0 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 1: 3 traits applied, 3.1% modifier, 2.1 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Base Horse: 3 traits applied, 3.1% modifier, 2.1 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 1: 2 traits applied, 11.4% modifier, 7.6 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Bold Horse: 2 traits applied, 11.4% modifier, 7.6 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 2: 2 traits applied, -10.4% modifier, -7.0 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Nervous Horse: 2 traits applied, -10.4% modifier, -7.0 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 1: 1 traits applied, 10.0% modifier, 6.7 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Legendary Horse: 1 traits applied, 10.0% modifier, 6.7 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 2: 1 traits applied, 6.0% modifier, 4.0 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Regular Horse: 1 traits applied, 6.0% modifier, 4.0 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 1: 2 traits applied, 10.4% modifier, 12.3 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Favored Horse: 2 traits applied, 10.4% modifier, 12.3 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 2: 2 traits applied, -13.3% modifier, -15.6 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Unfavored Horse: 2 traits applied, -13.3% modifier, -15.6 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 1: 2 traits applied, 10.5% modifier, 9.9 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Favored Horse: 2 traits applied, 10.5% modifier, 9.9 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 2: 2 traits applied, -10.4% modifier, -9.9 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Unfavored Horse: 2 traits applied, -10.4% modifier, -9.9 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 1: 2 traits applied, 9.5% modifier, 6.4 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Favored Horse: 2 traits applied, 9.5% modifier, 6.4 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 2: 2 traits applied, -13.3% modifier, -8.9 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Unfavored Horse: 2 traits applied, -13.3% modifier, -8.9 point adjustment
[2025-12-27 23:21:50] warn: [traitCompetitionImpact] Unknown trait: legendary_bloodline
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 1: 3 traits applied, 13.5% modifier, 9.0 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Base Horse: 3 traits applied, 13.5% modifier, 9.0 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 1: 5 traits applied, 16.4% modifier, 11.0 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Base Horse: 5 traits applied, 16.4% modifier, 11.0 point adjustment
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 2: 1 traits applied, 6.0% modifier, 4.0 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Base Horse: 1 traits applied, 6.0% modifier, 4.0 point adjustment
[2025-12-27 23:21:50] warn: [traitCompetitionImpact] Unknown trait: unknown_trait
[2025-12-27 23:21:50] warn: [traitCompetitionImpact] Unknown trait: another_unknown
[2025-12-27 23:21:50] info: [traitCompetitionImpact] Horse 1: 1 traits applied, 6.0% modifier, 4.0 point adjustment
[2025-12-27 23:21:50] info: [simulateCompetition] Horse Base Horse: 1 traits applied, 6.0% modifier, 4.0 point adjustment
PASS tests/integration/competitionWithTraits.test.mjs
  Competition Simulation with Trait Impact
    Single Horse Competition
      ‚àö should simulate competition without traits (5 ms)
      ‚àö should apply positive trait bonuses (5 ms)
      ‚àö should apply negative trait penalties (11 ms)
      ‚àö should handle mixed traits correctly (3 ms)
    Multi-Horse Competition
      ‚àö should rank horses correctly with trait differences (5 ms)
      ‚àö should handle legendary traits appropriately (4 ms)
    Discipline-Specific Effects
      ‚àö should apply correct trait effects for Dressage (6 ms)
      ‚àö should apply correct trait effects for Racing (8 ms)
      ‚àö should apply correct trait effects for Cross Country (4 ms)
    Balance and Fairness
      ‚àö should not allow traits to completely dominate base stats (4 ms)
      ‚àö should apply diminishing returns for trait stacking (4 ms)
    Error Handling
      ‚àö should handle horses with malformed trait data (2 ms)
      ‚àö should handle unknown traits gracefully (5 ms)

[2025-12-27 23:21:50] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:50] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:50] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/unit/performanceAnalyticsService.test.mjs
  Performance Analytics Service
    Personal Performance Metrics
      ‚àö should calculate overall win rate correctly (10 ms)
      ‚àö should calculate win rate by discipline (6 ms)
      ‚àö should track placement trends over time (10 ms)
      ‚àö should calculate performance consistency score (4 ms)
    Historical Performance Tracking
      ‚àö should provide complete competition history (6 ms)
      ‚àö should track total earnings by discipline (6 ms)
      ‚àö should track performance improvement over time (6 ms)
    Discipline Analysis
      ‚àö should identify strongest disciplines (5 ms)
      ‚àö should identify weakest disciplines (5 ms)
    Error Handling
      ‚àö should handle non-existent horse gracefully (6 ms)
      ‚àö should handle horse with no competition history (26 ms)

[2025-12-27 23:21:51] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:51] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:51] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/services/groomPersonalityTraits.test.mjs
  Groom Personality Trait System
    getGroomPersonalityTraits
      ‚àö should return detailed personality traits for calm groom (7 ms)
      ‚àö should return detailed personality traits for energetic groom (4 ms)
      ‚àö should return detailed personality traits for methodical groom (3 ms)
    calculatePersonalityModifiers
      ‚àö should calculate modifiers for calm groom with nervous horse (11 ms)
      ‚àö should calculate modifiers for energetic groom with confident horse (5 ms)
      ‚àö should calculate modifiers for energetic groom with nervous horse (4 ms)
      ‚àö should calculate modifiers for methodical groom with any horse (5 ms)
    analyzePersonalityCompatibility
      ‚àö should analyze compatibility between groom and horse personalities (6 ms)
      ‚àö should identify poor compatibility combinations (4 ms)
    updatePersonalityTraits
      ‚àö should update personality traits based on interaction outcomes (15 ms)
    getPersonalityTraitDefinitions
      ‚àö should return comprehensive trait definitions (2 ms)

[2025-12-27 23:21:51] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:51] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:51] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:51] warn: [Validation] Input validation failed
PASS __tests__/unit/security/validation-error-handler.test.mjs
  validationErrorHandler
    ‚àö passes through when no errors (4 ms)
    ‚àö returns 400 on validation errors (3 ms)
    ‚àö sanitizes request body by keeping only validated fields (3 ms)

[2025-12-27 23:21:52] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:52] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:52] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 10
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 10 (streak: 10)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: coat_check, count: 3
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: presentationBoosted (total: 15)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: early_touch, count: 10
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 50 points for trait: calm (total: 50)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: sponge_bath, count: 4
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 20 points for trait: showCalm (total: 20)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 20 points for trait: presentationBoosted (total: 35)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: hoof_handling, count: 6
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 30 points for trait: showCalm (total: 50)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 12
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 60 points for trait: bonded (total: 60)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 60 points for trait: resilient (total: 60)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 8
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 40 points for trait: confident (total: 40)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: showground_exposure, count: 5
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 25 points for trait: crowdReady (total: 25)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 25 points for trait: confident (total: 65)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: presentationBoosted, base: 35, total: 45, chance: 45%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: presentationBoosted (rolled: 30.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: calm, base: 50, total: 60, chance: 60%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: calm (rolled: 30.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: showCalm, base: 50, total: 60, chance: 60%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: showCalm (rolled: 30.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 60, total: 70, chance: 60%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 30.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 60, total: 70, chance: 60%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 30.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 65, total: 75, chance: 60%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 30.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: crowdReady, base: 25, total: 35, chance: 35%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: crowdReady (rolled: 30.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["presentationBoosted","calm","showCalm","bonded","resilient","confident","crowdReady"]
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 3
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 3)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: early_touch, count: 1
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 5 points for trait: calm (total: 5)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 2
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: bonded (total: 10)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: resilient (total: 10)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: calm, base: 5, total: 5, chance: 5%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: calm (rolled: 7.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 10, total: 10, chance: 10%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 7.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 10, total: 10, chance: 10%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 7.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["bonded","resilient"]
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 8
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 10 (streak: 8)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 10
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 50 points for trait: confident (total: 50)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: showground_exposure, count: 6
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 30 points for trait: crowdReady (total: 30)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 30 points for trait: confident (total: 80)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 80, total: 90, chance: 60%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 40.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: crowdReady, base: 30, total: 40, chance: 40%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: crowdReady (rolled: 40.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["confident"]
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: early_touch, count: 4
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 20 points for trait: calm (total: 20)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 5
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 25 points for trait: bonded (total: 25)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 25 points for trait: resilient (total: 25)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 3
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 15 points for trait: confident (total: 15)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: calm, base: 20, total: 20, chance: 20%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: calm (rolled: 10.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 25, total: 25, chance: 25%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 10.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 25, total: 25, chance: 25%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 10.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 15, total: 15, chance: 15%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 10.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["calm","bonded","resilient","confident"]
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: []
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: early_touch, count: 5
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 25 points for trait: calm (total: 25)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 6
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 30 points for trait: bonded (total: 30)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 30 points for trait: resilient (total: 30)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 4
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 20 points for trait: confident (total: 20)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: calm, base: 25, total: 25, chance: 25%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: calm (rolled: 15.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 30, total: 30, chance: 30%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 15.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 30, total: 30, chance: 30%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 15.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 20, total: 20, chance: 20%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 15.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["calm","bonded","resilient","confident"]
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Evaluating traits from task log with streak: 0
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Streak bonus: 0 (streak: 0)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: early_touch, count: 5
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 25 points for trait: calm (total: 25)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: hoof_handling, count: 2
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 10 points for trait: showCalm (total: 10)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: trust_building, count: 8
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 40 points for trait: bonded (total: 40)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 40 points for trait: resilient (total: 40)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Processing task: desensitization, count: 6
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Accumulated 30 points for trait: confident (total: 30)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: calm, base: 25, total: 25, chance: 25%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: calm (rolled: 20.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: showCalm, base: 10, total: 10, chance: 10%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait not assigned: showCalm (rolled: 20.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: bonded, base: 40, total: 40, chance: 40%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: bonded (rolled: 20.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: resilient, base: 40, total: 40, chance: 40%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: resilient (rolled: 20.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait: confident, base: 30, total: 30, chance: 30%
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Trait assigned: confident (rolled: 20.00)
[2025-12-27 23:21:52] info: [traitEvaluation.evaluateEpigeneticTagsFromFoalTasks] Final assigned traits: ["calm","bonded","resilient","confident"]
PASS tests/traitMilestoneIntegration.test.mjs
  Trait Milestone Integration
    Age 1 Milestone Evaluation
      ‚àö should evaluate traits from comprehensive foal development history (124 ms)
      ‚àö should handle minimal development with no streak bonus (34 ms)
      ‚àö should handle specialized development paths (29 ms)
      ‚àö should integrate with real database persistence (41 ms)
      ‚àö should handle edge case of no task history (24 ms)
    Milestone Timing and Business Rules
      ‚àö should demonstrate age 1 milestone evaluation timing (35 ms)
      ‚àö should support trait development progression tracking (53 ms)

[2025-12-27 23:21:52] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:52] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:52] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/unit/breedingAnalyticsService.test.mjs
  Breeding Analytics Service
    Lineage Tracking
      ‚àö should track breeding pair lineage (13 ms)
      ‚àö should identify parent-offspring relationships (14 ms)
    Trait Inheritance Analysis
      ‚àö should analyze trait inheritance patterns (8 ms)
      ‚àö should calculate trait inheritance rates (10 ms)
    Breeding Success Metrics
      ‚àö should calculate breeding success rates (9 ms)
      ‚àö should track foal development outcomes (11 ms)
    Statistical Analysis
      ‚àö should calculate average offspring stats (15 ms)
      ‚àö should compare offspring to parent averages (17 ms)
    Error Handling
      ‚àö should handle user with no breeding data (21 ms)
      ‚àö should handle non-existent user gracefully (5 ms)

[2025-12-27 23:21:53] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:53] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:53] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:53] info: [ApiDocService] OpenAPI specification saved successfully
[2025-12-27 23:21:53] error: [ApiDocService] Failed to load specification: OpenAPI specification file not found
[2025-12-27 23:21:53] info: [ApiDocService] OpenAPI specification saved successfully
[2025-12-27 23:21:53] info: [ApiDocService] Documentation generated for 2 endpoints
[2025-12-27 23:21:53] info: [ApiDocService] OpenAPI specification saved successfully
[2025-12-27 23:21:53] info: [ApiDocService] Documentation generated for 0 endpoints
[2025-12-27 23:21:53] info: [ApiDocService] OpenAPI specification saved successfully
[2025-12-27 23:21:53] info: [ApiDocService] Documentation generated for 1 endpoints
[2025-12-27 23:21:53] info: [ApiDocService] OpenAPI specification validation passed
[2025-12-27 23:21:53] warn: [ApiDocService] OpenAPI specification validation found 1 issues
[2025-12-27 23:21:53] warn: [ApiDocService] OpenAPI specification validation found 1 issues
[2025-12-27 23:21:53] warn: [ApiDocService] OpenAPI specification validation found 1 issues
[2025-12-27 23:21:53] info: [ApiDocService] OpenAPI specification saved successfully
[2025-12-27 23:21:53] info: [ApiDocService] Documentation generated for 2 endpoints
[2025-12-27 23:21:53] info: [ApiDocService] OpenAPI specification saved successfully
[2025-12-27 23:21:53] info: [ApiDocService] Documentation generated for 1 endpoints
[2025-12-27 23:21:53] info: [ApiDocService] OpenAPI specification validation passed
[2025-12-27 23:21:53] info: [ApiDocService] OpenAPI specification saved successfully
[2025-12-27 23:21:53] info: [ApiDocService] Documentation generated for 2 endpoints
[2025-12-27 23:21:53] warn: [ApiDocService] OpenAPI specification validation found 2 issues
[2025-12-27 23:21:53] info: [ApiDocService] OpenAPI specification validation passed
PASS __tests__/services/apiDocumentation.test.mjs
  API Documentation Service
    Specification Loading and Saving
      ‚àö loads OpenAPI specification correctly (10 ms)
      ‚àö saves OpenAPI specification correctly (9 ms)
      ‚àö throws error when specification file not found (10 ms)
    Endpoint Registration
      ‚àö registers endpoint correctly (5 ms)
      ‚àö registers multiple endpoints correctly (4 ms)
      ‚àö handles endpoint registration with minimal options (6 ms)
    Schema Registration
      ‚àö registers schema correctly (4 ms)
      ‚àö registers multiple schemas correctly (11 ms)
    Documentation Generation
      ‚àö generates documentation with registered endpoints (12 ms)
      ‚àö generates documentation with registered schemas (9 ms)
      ‚àö adds generation metadata to specification (12 ms)
    Specification Validation
      ‚àö validates correct specification (7 ms)
      ‚àö detects missing responses (8 ms)
      ‚àö detects missing summaries (8 ms)
      ‚àö detects missing tags (5 ms)
    Metrics and Analytics
      ‚àö calculates metrics correctly (19 ms)
      ‚àö generates health report correctly (16 ms)
      ‚àö provides recommendations based on metrics (13 ms)
    Example Generation
      ‚àö generates string examples correctly (3 ms)
      ‚àö generates email format examples (3 ms)
      ‚àö generates UUID format examples (3 ms)
      ‚àö generates object examples correctly (2 ms)
      ‚àö generates array examples correctly (3 ms)
    Helper Functions
      ‚àö registerEndpoint helper function works (2 ms)
      ‚àö registerSchema helper function works (2 ms)
      ‚àö getDocumentationMetrics helper function works (4 ms)
      ‚àö getDocumentationHealth helper function works (8 ms)

[2025-12-27 23:21:54] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:54] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:54] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/schema-validation.test.mjs
  Schema Validation
    ‚àö should create horse with basic required fields (34 ms)
    ‚àö should create horse with groom-related fields (16 ms)
    ‚àö should create groom with all required fields (13 ms)
    ‚àö should create groom assignment (26 ms)
    ‚àö should create groom interaction (19 ms)

[2025-12-27 23:21:54] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:54] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:54] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:54] info: Flag brave triggered for horse Test Foal 6mo 1766895714770: Consistent care with good stress management and task diversity
[2025-12-27 23:21:54] info: Flag confident triggered for horse Test Foal 6mo 1766895714770: Strong bond growth with diverse, high-quality experiences
[2025-12-27 23:21:54] info: Flag resilient triggered for horse Test Foal 6mo 1766895714770: Generic positive flag evaluation
[2025-12-27 23:21:54] error: Error evaluating triggers for flag fearful: Cannot read properties of undefined (reading 'length')
[2025-12-27 23:21:54] error: Error evaluating triggers for flag insecure: Cannot read properties of undefined (reading 'neglectRatio')
PASS tests/services/flagAssignmentEngineEnhanced.test.mjs
  Enhanced Flag Assignment Engine
    evaluatePersonalityModifiedTriggers
      ‚àö should apply calm groom personality modifiers correctly (11 ms)
      ‚àö should apply energetic groom personality modifiers correctly (9 ms)
    calculateFlagAssignmentScore
      ‚àö should calculate comprehensive flag assignment scores (7 ms)
      ‚àö should apply age-based sensitivity modifiers (8 ms)
    analyzeTemporalPatterns
      ‚àö should analyze temporal patterns in care quality (13 ms)
      ‚àö should identify critical periods for flag assignment (5 ms)
    Advanced Flag Assignment Integration
      ‚àö should integrate all enhancement features for comprehensive evaluation (12 ms)

[2025-12-27 23:21:55] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:55] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:55] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:55] info: [CSRF] Token generated
[2025-12-27 23:21:55] info: [CSRF] Token generated
[2025-12-27 23:21:55] info: [CSRF] Token generated
[2025-12-27 23:21:55] info: [CSRF] Token generated
[2025-12-27 23:21:55] info: [CSRF] Token generated
[2025-12-27 23:21:55] info: [CSRF] Token generated
[2025-12-27 23:21:55] info: [CSRF] Token generated
[2025-12-27 23:21:55] info: [CSRF] Token generated
[2025-12-27 23:21:55] info: [CSRF] Token generated
[2025-12-27 23:21:55] info: [CSRF] Token generated
PASS __tests__/unit/security/csrf-validation.test.mjs
  CSRF Token Validation Unit Tests
    CSRF Token Generation
      ‚àö should generate a CSRF token (6 ms)
      ‚àö should store CSRF token in session (3 ms)
      ‚àö should generate unique tokens for each request (10 ms)
      ‚àö should generate token with sufficient length (1 ms)
      ‚àö should generate token with cryptographically secure randomness (3 ms)
    CSRF Token Validation - Valid Scenarios
      ‚àö should accept valid CSRF token in body (2 ms)
      ‚àö should accept valid CSRF token in header (1 ms)
      ‚àö should prefer body token over header token (1 ms)
      ‚àö should skip CSRF for GET requests (2 ms)
      ‚àö should skip CSRF for HEAD requests (1 ms)
      ‚àö should skip CSRF for OPTIONS requests (1 ms)
    CSRF Token Validation - Invalid Scenarios
      ‚àö should reject POST request without CSRF token (2 ms)
      ‚àö should reject PUT request without CSRF token (1 ms)
      ‚àö should reject DELETE request without CSRF token (2 ms)
      ‚àö should reject PATCH request without CSRF token (1 ms)
      ‚àö should reject mismatched CSRF token (1 ms)
      ‚àö should reject empty CSRF token (1 ms)
      ‚àö should reject null CSRF token
      ‚àö should reject undefined CSRF token (1 ms)
      ‚àö should reject when session has no CSRF token (1 ms)
      ‚àö should reject when session is missing (6 ms)
    CSRF Token Security Edge Cases
      ‚àö should reject token with extra whitespace (1 ms)
      ‚àö should reject token with newline characters (1 ms)
      ‚àö should reject token with special characters appended (1 ms)
      ‚àö should be case-sensitive for token validation (1 ms)
      ‚àö should reject partial token match (1 ms)
      ‚àö should use timing-safe comparison for tokens (2 ms)
    CSRF Error Handling
      ‚àö should return proper error response for CSRF failure (1 ms)
      ‚àö should not leak session token in error message (1 ms)
      ‚àö should not leak provided token in error message (1 ms)
    CSRF Token Rotation
      ‚àö should allow token regeneration (3 ms)
      ‚àö should invalidate old token after regeneration (4 ms)
    CSRF Double-Submit Cookie Pattern
      ‚àö should validate CSRF token from cookie (1 ms)
    CSRF Integration with Different Content Types
      ‚àö should validate CSRF for application/json (1 ms)
      ‚àö should validate CSRF for application/x-www-form-urlencoded (2 ms)
      ‚àö should validate CSRF for multipart/form-data (1 ms)

[2025-12-27 23:21:55] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:55] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:55] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] warn: [FeatureFlag] Flag overridden at runtime
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] warn: [FeatureFlag] Flag overridden at runtime
[2025-12-27 23:21:55] warn: [FeatureFlag] Flag overridden at runtime
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
[2025-12-27 23:21:55] info: [FeatureFlag] All runtime overrides cleared
PASS __tests__/unit/featureFlagService.test.mjs
  Feature Flag Service
    isFeatureEnabled
      ‚àö should return false for undefined flags (7 ms)
      ‚àö should return true for flags set to "true" in environment (118 ms)
      ‚àö should return false for flags set to "false" in environment (3 ms)
      ‚àö should handle case-insensitive boolean strings (4 ms)
      ‚àö should use default value from FLAG_DEFINITIONS (3 ms)
      ‚àö should respect environment override over defaults (3 ms)
    Percentage-based rollout
      ‚àö should consistently hash same user to same bucket (4 ms)
      ‚àö should return false when percentage is 0 (2 ms)
      ‚àö should return true when percentage is 100 (4 ms)
    getFeatureVariant
      ‚àö should return string value from environment (5 ms)
      ‚àö should return default value for undefined flags (9 ms)
      ‚àö should return default when value is not a string (2 ms)
    getAllFlags
      ‚àö should return all defined flags (5 ms)
      ‚àö should evaluate flags with provided context (4 ms)
    getEvaluationStats
      ‚àö should track flag evaluations (4 ms)
      ‚àö should calculate enabled rate correctly (4 ms)
    overrideFlag
      ‚àö should allow runtime flag override (4 ms)
    clearOverrides
      ‚àö should clear all runtime overrides (7 ms)
    Error Handling
      ‚àö should return false on evaluation error (7 ms)

[2025-12-27 23:21:56] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:56] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:56] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 6 at age 365
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 7 at age 730
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_2, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 8 at age 730
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_2, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 9 at age 365
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 10 at age 730
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_2, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 11 at age 1095
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_3, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 12 at age 500
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 13 at age 365
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Milestone age_1 already evaluated, skipping
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 14 at age 730
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_2, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 15 at age 365
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 16 at age 730
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_2, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 17 at age 365
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 18 at age 1095
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_3, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 19 at age 365
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 20 at age 730
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_2, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 21 at age 1095
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_3, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 22 at age 365
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 22 at age 365
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 0 traits
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse 22 at age 365
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:21:56] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 0 traits
PASS tests/utils/milestoneTraitEvaluator.comprehensive.test.mjs
  üèá COMPREHENSIVE: Milestone Trait Evaluator System
    Milestone Eligibility Validation
      ‚àö should validate 1-year milestone eligibility (3 ms)
      ‚àö should validate 2-year milestone eligibility (1 ms)
      ‚àö should validate 3-year milestone eligibility (2 ms)
      ‚àö should handle horses too young for milestones (1 ms)
      ‚àö should handle horses too old for milestones (8 ms)
    Trait Milestone Evaluation
      ‚àö should evaluate traits for 1-year milestone (6 ms)
      ‚àö should evaluate traits for 2-year milestone (4 ms)
      ‚àö should evaluate traits with moderate care history (4 ms)
    Task Log Processing and Trait Scoring
      ‚àö should process extensive task history for trait evaluation (11 ms)
      ‚àö should handle minimal task history (3 ms)
      ‚àö should handle empty task history (5 ms)
    Milestone Age Validation and Edge Cases
      ‚àö should handle non-milestone ages correctly (4 ms)
      ‚àö should handle already evaluated milestones (2 ms)
      ‚àö should handle horses with existing traits (4 ms)
    Error Handling and Edge Cases
      ‚àö should handle missing task_log property (7 ms)
      ‚àö should handle null task_log (3 ms)
      ‚àö should handle invalid horse data gracefully (5 ms)
      ‚àö should handle horses with malformed epigenetic modifiers (5 ms)
    Trait Application and Epigenetic Logic
      ‚àö should apply traits appropriately for different milestone ages (9 ms)
      ‚àö should maintain consistency in trait evaluation (12 ms)

[2025-12-27 23:21:56] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:56] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:56] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:56] info: [ownership] Validated ownership: user user-1 owns horse 1
[2025-12-27 23:21:56] info: [ownership] Validated ownership: user user-1 owns groom 5
[2025-12-27 23:21:56] info: [ownership] Validated ownership: user user-1 owns horse 10
[2025-12-27 23:21:56] info: [ownership] Validated ownership: user user-1 owns horse 20
[2025-12-27 23:21:56] warn: [ownership] horse 1 not found or not owned by user user-1
[2025-12-27 23:21:56] warn: [ownership] groom 5 not found or not owned by user user-1
[2025-12-27 23:21:56] info: [ownership] Validated ownership: user user-1 owns training-session 1
[2025-12-27 23:21:56] info: [ownership] Validated ownership: user user-1 owns competition-entry 1
[2025-12-27 23:21:56] info: [ownership] Found owned horse 1 for user user-1
[2025-12-27 23:21:56] info: [ownership] Found owned groom 5 for user user-1
[2025-12-27 23:21:56] info: [ownership] Batch validation: user user-1 owns 2/2 horses
PASS __tests__/unit/security/ownership-checks.test.mjs
  Ownership Validation Unit Tests
    Owned Resource Scenarios
      ‚àö should allow access to owned horse (7 ms)
      ‚àö should allow access to owned groom (3 ms)
      ‚àö should attach resource to request object and validatedResources (2 ms)
      ‚àö should work with custom idParam (2 ms)
    Not Owned Resource Scenarios
      ‚àö should return 404 for horse owned by different user (4 ms)
      ‚àö should return 404 for groom owned by different user (10 ms)
    Resource Type Validation
      ‚àö should handle training-session resource type (maps to trainingLog) (4 ms)
      ‚àö should handle competition-entry resource type (maps to competitionResult) (2 ms)
    findOwnedResource Helper Function
      ‚àö should find owned horse using ownerId (3 ms)
      ‚àö should find owned groom using userId (3 ms)
    validateBatchOwnership Helper Function
      ‚àö should validate ownership of multiple horses using ownerId (5 ms)

[2025-12-27 23:21:57] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:57] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:57] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 30 XP to horse XP Test Horse (ID: 94705). New XP: 30, Stat points gained: 0, Available: 0
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 30 XP to horse XP Test Horse (ID: 94705). New XP: 30, Stat points gained: 0, Available: 0
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 30 XP to horse XP Test Horse (ID: 94705). New XP: 60, Stat points gained: 0, Available: 0
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 27 XP to horse XP Test Horse (ID: 94705). New XP: 87, Stat points gained: 0, Available: 0
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 25 XP to horse XP Test Horse (ID: 94705). New XP: 112, Stat points gained: 1, Available: 1
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 150 XP to horse XP Test Horse (ID: 94705). New XP: 150, Stat points gained: 1, Available: 1
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 200 XP to horse XP Test Horse (ID: 94705). New XP: 200, Stat points gained: 2, Available: 2
[2025-12-27 23:21:57] info: [horseXpModel.allocateStatPoint] Allocated 1 stat point to speed for horse XP Test Horse (ID: 94705). New speed: 76, Remaining points: 1
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 50 XP to horse XP Test Horse (ID: 94705). New XP: 50, Stat points gained: 0, Available: 0
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 30 XP to horse XP Test Horse (ID: 94705). New XP: 80, Stat points gained: 0, Available: 0
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 25 XP to horse XP Test Horse (ID: 94705). New XP: 105, Stat points gained: 1, Available: 1
[2025-12-27 23:21:57] info: [horseXpModel.getHorseXpHistory] Retrieved 3 XP events for horse 94705
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 30 XP to horse XP Test Horse (ID: 94705). New XP: 30, Stat points gained: 0, Available: 0
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 27 XP to horse XP Test Horse (ID: 94705). New XP: 57, Stat points gained: 0, Available: 0
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 30 XP to horse XP Test Horse (ID: 94705). New XP: 87, Stat points gained: 0, Available: 0
[2025-12-27 23:21:57] info: [horseXpModel.addXpToHorse] Added 25 XP to horse XP Test Horse (ID: 94705). New XP: 112, Stat points gained: 1, Available: 1
[2025-12-27 23:21:57] info: [horseXpModel.allocateStatPoint] Allocated 1 stat point to speed for horse XP Test Horse (ID: 94705). New speed: 77, Remaining points: 0
[2025-12-27 23:21:57] info: [horseXpModel.getHorseXpHistory] Retrieved 4 XP events for horse 94705
PASS tests/horseXpIntegration.test.mjs
  üêé INTEGRATION: Horse XP System - Core Functionality Integration
    Competition Integration
      ‚àö should award horse XP when horse places in competition (44 ms)
      ‚àö should award stat points when horse reaches 100 XP (55 ms)
    Horse XP Model Integration
      ‚àö should get horse XP status directly from model (26 ms)
      ‚àö should allocate stat points directly via model (32 ms)
      ‚àö should get horse XP history directly from model (48 ms)
    Complete Workflow Integration
      ‚àö should complete full horse XP workflow: competition ‚Üí XP ‚Üí stat allocation (67 ms)

[2025-12-27 23:21:57] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:57] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:57] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS __tests__/utils/cookieConfig.test.mjs
  Cookie Configuration Module
    Access Token Cookie Options
      ‚àö should have correct security properties in development (10 ms)
      ‚àö should have correct security properties in production (6 ms)
      ‚àö should use custom domain when COOKIE_DOMAIN is set (5 ms)
      ‚àö should have httpOnly true (XSS protection) (5 ms)
      ‚àö should have sameSite strict (CSRF protection) (7 ms)
      ‚àö should have maxAge matching access token expiry (15 minutes) (6 ms)
      ‚àö should have path set to root (5 ms)
    Refresh Token Cookie Options
      ‚àö should have correct security properties (5 ms)
      ‚àö should have maxAge matching refresh token expiry (7 days) (5 ms)
      ‚àö should have path scoped to refresh endpoint (least privilege) (6 ms)
    CSRF Token Cookie Options
      ‚àö should have httpOnly false (client must read for X-CSRF-Token header) (12 ms)
      ‚àö should have correct security properties (4 ms)
      ‚àö should have maxAge matching access token (session-tied) (5 ms)
    Clear Cookie Options
      ‚àö should match access token options (except maxAge) (5 ms)
      ‚àö should match refresh token options (except maxAge) (5 ms)
      ‚àö should have same path as original cookie (required for proper deletion) (5 ms)
      ‚àö should have same domain as original cookie (required for proper deletion) (4 ms)
    Environment-Specific Behavior
      ‚àö should have secure: false in development (5 ms)
      ‚àö should have secure: false in test (5 ms)
      ‚àö should have secure: true in production (4 ms)
    Cookie Configuration Summary
      ‚àö should return configuration summary (6 ms)
      ‚àö should show production environment correctly (5 ms)
      ‚àö should show custom domain when set (5 ms)
      ‚àö should show same-domain when COOKIE_DOMAIN not set (5 ms)
    Security Compliance
      ‚àö should have all security flags enabled in production (10 ms)
      ‚àö should prevent JavaScript access to auth tokens (XSS mitigation) (6 ms)
      ‚àö should require HTTPS in production (MitM mitigation) (6 ms)
      ‚àö should prevent cross-site requests (CSRF mitigation) (4 ms)
    Exports
      ‚àö should export all required constants (5 ms)

[2025-12-27 23:21:58] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:58] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:58] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Applied influences from 1 flags to trait weights
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Applied influences from 1 flags to trait weights
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Applied influences from 2 flags to trait weights
[2025-12-27 23:21:58] warn: [epigeneticFlagInfluence] Unknown flag: unknown_flag
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Applied influences from 1 flags to trait weights
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Applied influences from 1 flags to trait weights
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 1 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 2 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 2 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 1 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 1 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 1 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 1 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 1 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 1 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 1 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 1 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 1 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 2 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 2 flags
[2025-12-27 23:21:58] info: [epigeneticFlagInfluence] Calculated behavior modifiers from 4 flags
PASS tests/unit/epigeneticFlagInfluence.test.mjs
  Epigenetic Flag Influence System
    applyFlagInfluencesToTraitWeights
      ‚àö should return unchanged weights for no flags (5 ms)
      ‚àö should apply brave flag influences correctly (6 ms)
      ‚àö should apply fearful flag influences correctly (3 ms)
      ‚àö should stack multiple flag influences (5 ms)
      ‚àö should handle unknown flags gracefully (5 ms)
      ‚àö should clamp values to 0-1 range (2 ms)
    calculateBehaviorModifiers
      ‚àö should return empty object for no flags (1 ms)
      ‚àö should calculate modifiers for single flag (11 ms)
      ‚àö should aggregate modifiers from multiple flags (2 ms)
      ‚àö should stack same modifier types (3 ms)
    applyFlagInfluencesToCompetition
      ‚àö should return unchanged score for no flags (2 ms)
      ‚àö should apply competition bonus correctly (2 ms)
      ‚àö should apply competition penalty correctly (4 ms)
      ‚àö should apply stress modifiers correctly (2 ms)
      ‚àö should not allow negative scores (4 ms)
    applyFlagInfluencesToTraining
      ‚àö should return unchanged efficiency for no flags (3 ms)
      ‚àö should apply training efficiency modifier (3 ms)
      ‚àö should apply bonding modifiers to training (3 ms)
      ‚àö should clamp efficiency to 0-1 range (4 ms)
    applyFlagInfluencesToBonding
      ‚àö should return unchanged bonding for no flags (2 ms)
      ‚àö should apply bonding rate modifier (7 ms)
      ‚àö should apply bonding resistance penalty (3 ms)
    getFlagInfluenceSummary
      ‚àö should return empty summary for no flags (3 ms)
      ‚àö should generate complete summary for multiple flags (3 ms)
      ‚àö should aggregate trait influences correctly (4 ms)
      ‚àö should count flag types correctly (2 ms)

[2025-12-27 23:21:58] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:58] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:58] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:21:58] info: [auth] Authenticated user 1603 for GET /api/test
[2025-12-27 23:21:58] info: [auth] Authenticated user 5651 for GET /api/test
[2025-12-27 23:21:58] info: [auth] Authenticated user 1 for GET /api/test
[2025-12-27 23:21:58] info: [auth] Authenticated user 3636 for GET /api/test
[2025-12-27 23:21:58] warn: [auth] Token expired (precheck) for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] warn: [auth] Token expired for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] warn: [auth] Session expired due to age for GET /api/test from 127.0.0.1 (8 days old)
[2025-12-27 23:21:58] warn: [auth] Session expired. Please login again. for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] info: [auth] Authenticated user 4279 for GET /api/test
[2025-12-27 23:21:58] warn: [auth] Session expired due to age for GET /api/test from 127.0.0.1 (7 days old)
[2025-12-27 23:21:58] warn: [auth] Session expired. Please login again. for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] warn: [auth] Token decode failed for GET /api/test from 127.0.0.1: Unexpected token 'ÔøΩ', "ÔøΩ{⁄ñ'" is not valid JSON
[2025-12-27 23:21:58] warn: [auth] Invalid or expired token for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] warn: [auth] Invalid token for GET /api/test from 127.0.0.1: invalid signature
[2025-12-27 23:21:58] warn: [auth] Invalid or expired token for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] warn: [auth] Invalid or expired token for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] warn: [auth] Access token is required for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] warn: [auth] Access token is required for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] warn: [auth] Access token is required for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] warn: [auth] Access token is required for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] warn: [auth] Access token is required for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] warn: [auth] Access token is required for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] warn: [auth] Access token is required for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] info: [auth] Authenticated user 12345 for GET /api/test
[2025-12-27 23:21:58] info: [auth] Authenticated user 99999 for GET /api/test
[2025-12-27 23:21:58] info: [auth] Authenticated user 9712 for GET /api/test
[2025-12-27 23:21:58] info: [auth] Authenticated user 9096 for GET /api/test
[2025-12-27 23:21:58] warn: [auth] Invalid or expired token for GET /api/test from 127.0.0.1
[2025-12-27 23:21:58] info: [auth] Authenticated user undefined for GET /api/test
[2025-12-27 23:21:58] warn: [auth] Invalid or expired token for GET /api/test from 127.0.0.1
PASS __tests__/unit/security/token-validation.test.mjs
  Token Validation Unit Tests
    Valid Token Scenarios
      ‚àö should authenticate with valid token in cookie (9 ms)
      ‚àö should authenticate with valid token in Authorization header (3 ms)
      ‚àö should prefer cookie token over Authorization header (5 ms)
      ‚àö should accept token with additional custom payload (5 ms)
    Expired Token Scenarios
      ‚àö should reject expired token (15 ms)
      ‚àö should reject token older than 7 days (CWE-613) (6 ms)
      ‚àö should accept token exactly 7 days old (3 ms)
      ‚àö should reject token slightly over 7 days old (5 ms)
    Malformed Token Scenarios
      ‚àö should reject malformed token (3 ms)
      ‚àö should reject token with invalid signature (5 ms)
      ‚àö should reject completely invalid token string (2 ms)
      ‚àö should reject empty token string (2 ms)
      ‚àö should reject null token (6 ms)
      ‚àö should reject undefined token (3 ms)
    Missing Token Scenarios
      ‚àö should return 401 when no token in cookie or header (3 ms)
      ‚àö should return 401 when Authorization header has no Bearer token (1 ms)
      ‚àö should return 401 when Authorization header has wrong scheme (4 ms)
      ‚àö should return 401 when Authorization header has no space (3 ms)
    Token Payload Validation
      ‚àö should extract userId from token payload (4 ms)
      ‚àö should handle legacy id field mapping (3 ms)
      ‚àö should include iat (issued at) timestamp in user object (4 ms)
      ‚àö should include exp (expiration) timestamp in user object (5 ms)
    Security Edge Cases
      ‚àö should reject token with modified payload (3 ms)
      ‚àö should reject token without userId field (4 ms)
      ‚àö should reject token signed with algorithm none (5 ms)

[2025-12-27 23:21:59] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:59] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:59] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.generateLineageTree] Generating tree for stallion 94706 and mare 94707, 3 generations
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.generateLineageTree] Generated tree with 2 horses across 1 generations
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.generateLineageTree] Generating tree for stallion 94709 and mare 94710, 2 generations
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.generateLineageTree] Generated tree with 3 horses across 2 generations
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.generateLineageTree] Generating tree for stallion 999 and mare 998, 3 generations
[2025-12-27 23:21:59] warn: [advancedLineageAnalysisService.generateLineageTree] Missing parent horses
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.calculateGeneticDiversityMetrics] Calculating diversity for 3 generations
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.calculateInbreedingCoefficient] Calculating for stallion 1 and mare 2
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.calculateInbreedingCoefficient] Found 0 common ancestors, coefficient: 0
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.analyzeLineagePerformance] Analyzing performance for 3 generations
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.analyzeLineagePerformance] Analyzing performance for 3 generations
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.createVisualizationData] Creating visualization for stallion 94711 and mare 94712
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.generateLineageTree] Generating tree for stallion 94711 and mare 94712, 3 generations
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.generateLineageTree] Generated tree with 2 horses across 1 generations
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.generateBreedingRecommendations] Generating recommendations for stallion 94713 and mare 94714
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.calculateGeneticDiversityMetrics] Calculating diversity for 1 generations
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.calculateInbreedingCoefficient] Calculating for stallion 94713 and mare 94714
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.calculateInbreedingCoefficient] Found 0 common ancestors, coefficient: 0
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.analyzeLineagePerformance] Analyzing performance for 1 generations
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.generateBreedingRecommendations] Generating recommendations for stallion 94715 and mare 94716
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.calculateGeneticDiversityMetrics] Calculating diversity for 1 generations
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.calculateInbreedingCoefficient] Calculating for stallion 94715 and mare 94716
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.calculateInbreedingCoefficient] Found 0 common ancestors, coefficient: 0
[2025-12-27 23:21:59] info: [advancedLineageAnalysisService.analyzeLineagePerformance] Analyzing performance for 1 generations
PASS tests/unit/advancedLineageAnalysis.test.mjs
  üå≥ Advanced Lineage Analysis System
    üå≤ Lineage Tree Generation
      ‚àö should generate hierarchical tree structure from lineage data (111 ms)
      ‚àö should include parent-child relationships in tree nodes (49 ms)
      ‚àö should handle missing lineage data gracefully (9 ms)
    üß¨ Genetic Diversity Metrics
      ‚àö should calculate comprehensive genetic diversity metrics (5 ms)
      ‚àö should identify genetic bottlenecks in lineage (1 ms)
      ‚àö should calculate inbreeding coefficient accurately (10 ms)
    üèÜ Performance Analysis
      ‚àö should analyze performance trends across generations (3 ms)
      ‚àö should identify top performing ancestors (3 ms)
    üìä Visualization Data Generation
      ‚àö should create visualization-ready data structure (28 ms)
    üéØ Breeding Recommendations
      ‚àö should generate comprehensive breeding recommendations (38 ms)
      ‚àö should identify breeding risks and mitigation strategies (35 ms)

[2025-12-27 23:21:59] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:21:59] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:21:59] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/schema-field-test.test.mjs
  Schema Field Test
    ‚àö should create horse with consecutiveDaysFoalCare field (97 ms)

[2025-12-27 23:22:00] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:00] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:00] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] warn: [groomPersonalityEffects.calculatePersonalityEffects] Unknown personality: strict
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for strict: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task feeding
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task grooming
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task dailyCare
[2025-12-27 23:22:00] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: 
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for gentle: none
[2025-12-27 23:22:00] warn: [groomPersonalityEffects.calculatePersonalityEffects] Unknown personality: invalid_personality
[2025-12-27 23:22:00] info: [groomSystem.calculateGroomInteractionEffects] Applied personality effects for invalid_personality: none
PASS tests/groomSystemLogic.test.mjs
  üßÆ UNIT: Groom System Logic - Pure Business Logic Validation
    calculateGroomInteractionEffects
      ‚àö should calculate basic interaction effects (8 ms)
      ‚àö should apply foal care specialty bonuses correctly (15 ms)
      ‚àö should apply skill level modifiers correctly (7 ms)
      ‚àö should apply personality modifiers correctly (5 ms)
      ‚àö should apply experience bonuses correctly (13 ms)
      ‚àö should scale cost with duration and session rate (7 ms)
      ‚àö should handle different interaction types (9 ms)
      ‚àö should handle edge cases gracefully (13 ms)
    System Constants
      ‚àö should have all required groom specialties (3 ms)
      ‚àö should have all required skill levels (3 ms)
      ‚àö should have all required personality traits (1 ms)
      ‚àö should have valid default groom profiles (7 ms)
    Modifier Calculations
      ‚àö should combine modifiers correctly (4 ms)
      ‚àö should handle invalid modifiers gracefully (3 ms)

[2025-12-27 23:22:00] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:00] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:00] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/services/horseTemperamentAnalysis.test.mjs
  Horse Temperament Analysis
    analyzeHorseTemperament
      ‚àö should analyze temperament for nervous horse with interaction history (16 ms)
      ‚àö should analyze temperament for confident horse (13 ms)
      ‚àö should analyze temperament for horse with no interaction history (5 ms)
    classifyTemperamentFromFlags
      ‚àö should classify temperament from positive flags (2 ms)
      ‚àö should classify temperament from negative flags
      ‚àö should handle mixed flags appropriately (2 ms)
      ‚àö should handle empty flags array (2 ms)
    analyzeBehavioralTrends
      ‚àö should analyze behavioral trends over time (14 ms)
    identifyStressResponsePatterns
      ‚àö should identify stress response patterns (7 ms)
    analyzeBondingPreferences
      ‚àö should analyze bonding preferences (5 ms)
    detectTemperamentChanges
      ‚àö should detect temperament changes over time (6 ms)

[2025-12-27 23:22:01] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:01] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:01] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

  console.log
    Users in database: []

      at Object.<anonymous> (tests/data-check.test.mjs:54:13)

  console.log
    Players in database (from user table): []

      at Object.<anonymous> (tests/data-check.test.mjs:86:13)

  console.log
    Horses in database: []

      at Object.<anonymous> (tests/data-check.test.mjs:113:13)

PASS tests/data-check.test.mjs
  üîç INTEGRATION: Database Data Check - Live Data Validation & Debugging
    ‚àö should check what users exist (56 ms)
    ‚àö should check what players exist (using user table) (3 ms)
    ‚àö should check what horses exist (5 ms)

[2025-12-27 23:22:01] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:01] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:01] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/traitCalculation.test.mjs
  üß¨ UNIT: Epigenetic Traits Calculation System
    Edge Cases
      ‚àö should handle extreme bonding values (3 ms)
      ‚àö should handle extreme stress values (1 ms)
      ‚àö should handle empty trait arrays (1 ms)
    Trait Combinations
      ‚àö should handle complementary positive traits (1 ms)
      ‚àö should handle opposing traits appropriately (1 ms)
    Environmental Influence
      ‚àö should produce more positive traits in ideal conditions (1 ms)
      ‚àö should test trait inheritance probability (1 ms)
    Rare Trait Generation
      ‚àö should occasionally produce rare traits (2 ms)
    Input Validation
      ‚àö should handle missing parameters gracefully (5 ms)
      ‚àö should handle invalid parameter types (2 ms)
    Deterministic Behavior
      ‚àö should produce consistent results with the same seed (2 ms)
      ‚àö should produce different results with different seeds
    getTraitDefinition
      ‚àö should return trait definition for valid traits (1 ms)
      ‚àö should return null for invalid traits (10 ms)
      ‚àö should return correct definition for rare traits (1 ms)
    getTraitsByType
      ‚àö should return all traits when type is "all" (1 ms)
      ‚àö should return only positive traits when type is "positive" (1 ms)
      ‚àö should return only negative traits when type is "negative" (1 ms)
      ‚àö should default to "all" when no type specified (1 ms)
    checkTraitConflict
      ‚àö should detect conflicts between opposing traits (1 ms)
      ‚àö should return false for non-conflicting traits (1 ms)
      ‚àö should return false for unknown traits (1 ms)
      ‚àö should handle self-comparison correctly (1 ms)
    Boundary Value Testing
      ‚àö should handle bond score boundaries (0, 50, 100) (1 ms)
      ‚àö should handle stress level boundaries (0, 50, 100) (1 ms)
      ‚àö should reject out-of-bounds values (2 ms)

[2025-12-27 23:22:02] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:02] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:02] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-10-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-01T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-02T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-03T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-04T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-05T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-06T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-07T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-08T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-09T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-10T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-11T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-12T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-13T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-14T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-16T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-17T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-18T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-19T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-20T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-21T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-22T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-23T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-24T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-25T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-26T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-27T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-28T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-29T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-30T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-01T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-02T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-03T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-04T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-05T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-06T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-07T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-08T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-09T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-10T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-11T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-12T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-13T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-14T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-16T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-17T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-18T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-19T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-20T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-21T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-22T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-23T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-24T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-25T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-26T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-27T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-28T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-29T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-07-30T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-01T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-02T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-03T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-04T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-05T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-06T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-07T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-08T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-09T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-10T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-11T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-12T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-13T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-14T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-16T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-17T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-18T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-19T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-20T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-21T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-22T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-23T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-24T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-25T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-26T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-27T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-28T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-29T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-30T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-16T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-17T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-18T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-19T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-20T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-21T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-16T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-17T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-18T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-19T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-20T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-21T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-22T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-23T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-24T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-25T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-26T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-27T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-04-28T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-15T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-16T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-17T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-18T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-19T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-20T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-21T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-22T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-23T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-24T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-25T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-26T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-27T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-01-28T00:00:00.000Z
[2025-12-27 23:22:02] info: [environmentalFactorEngineService.calculateCurrentWeather] Calculating weather for 2024-06-15T00:00:00.000Z
PASS tests/unit/environmentalFactorEngine.test.mjs
  üå§Ô∏è Environmental Factor Engine
    üå°Ô∏è Weather System
      ‚àö should calculate current weather conditions (8 ms)
      ‚àö should generate realistic weather patterns for different seasons (105 ms)
      ‚àö should account for location factors in weather calculation (8 ms)
    üçÇ Seasonal Cycles
      ‚àö should calculate seasonal factors for horse development (4 ms)
      ‚àö should provide seasonal transition effects (1 ms)
    ‚ö° Environmental Triggers
      ‚àö should calculate environmental triggers for trait expression (4 ms)
      ‚àö should identify stress triggers based on weather conditions (2 ms)
      ‚àö should account for horse traits in trigger calculation (2 ms)
    üéØ Environmental Impact Calculation
      ‚àö should calculate environmental impact on horse development (4 ms)
      ‚àö should provide different impacts for different environmental conditions (2 ms)
    üîÆ Weather Forecasting
      ‚àö should generate weather forecast for planning (14 ms)
      ‚àö should provide seasonal forecast trends (33 ms)
    üìä Comfort Zone Analysis
      ‚àö should calculate horse comfort zone based on traits and preferences (2 ms)
      ‚àö should adjust comfort zone based on horse traits (2 ms)
    ‚ö†Ô∏è Environmental Stress Assessment
      ‚àö should assess environmental stress levels (3 ms)
      ‚àö should provide stress mitigation recommendations (1 ms)

[2025-12-27 23:22:02] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:02] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:02] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/foalTaskExclusivity.integration.test.mjs
  Foal Task Exclusivity Integration
    Configuration Integration
      ‚àö should have correct task categories defined (5 ms)
      ‚àö should have no overlap between task categories (1 ms)
    Daily Exclusivity Enforcement
      ‚àö should detect all enrichment tasks correctly (2 ms)
      ‚àö should detect all grooming tasks correctly (11 ms)
      ‚àö should enforce mutual exclusivity between categories (2 ms)
      ‚àö should allow non-foal tasks without blocking (2 ms)
      ‚àö should detect foal tasks mixed with general tasks (1 ms)
    Business Rule Validation
      ‚àö should prevent double-counting with multiple foal tasks (1 ms)
      ‚àö should work correctly across different days (1 ms)
      ‚àö should handle real-world task progression scenario (2 ms)

[2025-12-27 23:22:02] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:02] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:02] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/database.test.mjs
  üîå INTEGRATION: Database Connection - Core Infrastructure Validation
    ‚àö should connect to the database (55 ms)
    ‚àö should be able to query the User table (5 ms)
    ‚àö should be able to perform basic database operations (4 ms)
    ‚àö should handle database errors gracefully (14 ms)

[2025-12-27 23:22:03] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:03] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:03] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/groomSystem.test.mjs
  üë©‚Äçüîß UNIT: Groom System - Foal Care Assignment & Management
    assignGroomToFoal
      ‚àö should assign groom to foal successfully (6 ms)
      ‚àö should throw error when foal not found (15 ms)
      ‚àö should throw error when groom not found (1 ms)
      ‚àö should throw error when groom is not active (2 ms)
      ‚àö should throw error when groom already assigned (2 ms)
      ‚àö should deactivate existing primary assignments when assigning new primary (2 ms)
    ensureDefaultGroomAssignment
      ‚àö should return existing assignment if one exists (1 ms)
      ‚àö should create default assignment if none exists (1 ms)
    calculateGroomInteractionEffects
      ‚àö should calculate bonding and stress effects correctly (4 ms)
      ‚àö should apply specialty modifiers correctly (2 ms)
      ‚àö should apply skill level modifiers correctly (1 ms)
      ‚àö should apply experience bonus correctly (1 ms)
      ‚àö should scale effects with duration (1 ms)
    System Constants
      ‚àö should have all required groom specialties (3 ms)
      ‚àö should have all required skill levels (10 ms)
      ‚àö should have all required personality traits (2 ms)
    hasAlreadyCompletedFoalTaskToday
      ‚àö should return false when foal has no daily task record (2 ms)
      ‚àö should return false when foal has empty daily task record (2 ms)
      ‚àö should return false when foal has no tasks for today (1 ms)
      ‚àö should return false when foal has empty task array for today (1 ms)
      ‚àö should return true when foal has completed enrichment task today (1 ms)
      ‚àö should return true when foal has completed grooming task today (2 ms)
      ‚àö should return true when foal has completed multiple tasks today (1 ms)
      ‚àö should return false when foal has completed non-foal tasks today (1 ms)
      ‚àö should return true when foal has mixed tasks including foal tasks today (1 ms)
      ‚àö should test all enrichment tasks are detected (1 ms)
      ‚àö should test all grooming tasks are detected (3 ms)
      ‚àö should handle edge cases gracefully (1 ms)
    Error Handling
      ‚àö should handle database errors gracefully (3 ms)
      ‚àö should handle invalid groom data in calculations (2 ms)

[2025-12-27 23:22:03] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:03] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:03] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/dbConnection.test.mjs
  üîå INTEGRATION: Database Connection - Alternative Prisma Client Path Testing
    ‚àö should connect to the database and fetch users (158 ms)

[2025-12-27 23:22:04] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:04] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:04] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/groomAgeRestrictions.test.mjs
  Groom Age Restrictions & Task Eligibility
    Configuration Values
      ‚àö should allow grooms to work with foals from birth (3 ms)
      ‚àö should define adult horse age threshold at 3 years (1 ms)
      ‚àö should have foal enrichment tasks defined (2 ms)
      ‚àö should have adult grooming tasks defined (1 ms)
    Foal Enrichment Task Eligibility (0-2 years)
      ‚àö should allow newborn foal (0 days) to receive enrichment tasks (2 ms)
      ‚àö should allow 1-week-old foal (7 days) to receive enrichment tasks (2 ms)
      ‚àö should allow 1-year-old horse (365 days) to receive enrichment tasks (1 ms)
      ‚àö should allow 2.9-year-old horse (1059 days) to receive enrichment tasks (1 ms)
    Adult Horse Grooming Task Eligibility (3+ years)
      ‚àö should allow exactly 3-year-old horse (1095 days) to receive adult grooming tasks (1 ms)
      ‚àö should allow 5-year-old horse (1825 days) to receive adult grooming tasks (1 ms)
      ‚àö should allow senior horse (10+ years) to receive adult grooming tasks (7 ms)
    Task Type Validation
      ‚àö should reject invalid task types for any age (1 ms)
      ‚àö should provide list of eligible tasks when task is invalid (1 ms)
    Age Boundary Conditions
      ‚àö should handle exactly 3 years (1095 days) as adult threshold (1 ms)
      ‚àö should handle day before 3rd birthday (20 days) (1 ms)
    Edge Cases
      ‚àö should handle negative age gracefully (1 ms)
      ‚àö should handle very old horses (20+ years) (1 ms)

[2025-12-27 23:22:04] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:04] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:04] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/unit/trainingAnalyticsService.test.mjs
  Training Analytics Service
    Training Session Log
      ‚àö should provide complete training session history (9 ms)
      ‚àö should order training history by date (most recent first) (10 ms)
    Training Frequency Analysis
      ‚àö should track training frequency and recent activity (6 ms)
      ‚àö should calculate sessions per discipline correctly (6 ms)
    Discipline Training Balance
      ‚àö should show training distribution across disciplines (5 ms)
      ‚àö should calculate training percentages correctly (6 ms)
    Error Handling
      ‚àö should handle non-existent horse gracefully (4 ms)
      ‚àö should handle horse with no training history (20 ms)

[2025-12-27 23:22:05] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:05] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:05] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/lineageTraitCheck.test.mjs
  üß¨ UNIT: Lineage Trait Check - Discipline Affinity Analysis
    checkLineageForDisciplineAffinity
      ‚àö should return affinity true when 3 or more ancestors share the same discipline (3 ms)
      ‚àö should return affinity false when less than 3 ancestors share the same discipline (1 ms)
      ‚àö should handle empty ancestors array (1 ms)
      ‚àö should handle null ancestors (2 ms)
      ‚àö should handle ancestors without discipline information (1 ms)
      ‚àö should handle exactly 3 ancestors with same discipline (8 ms)
      ‚àö should handle more than 3 ancestors with same discipline (1 ms)
    getAncestorPreferredDiscipline
      ‚àö should prioritize direct discipline field (1 ms)
      ‚àö should use competition history when no direct discipline (2 ms)
      ‚àö should use discipline scores when no competition history (1 ms)
      ‚àö should use competitions field as alternative to competitionHistory (1 ms)
      ‚àö should use specialty field as fallback (1 ms)
      ‚àö should return null when no discipline information available (1 ms)
    checkLineageForDisciplineAffinityDetailed
      ‚àö should provide detailed analysis with affinity (3 ms)
      ‚àö should provide detailed analysis without affinity (1 ms)
      ‚àö should handle empty ancestors array (1 ms)
    checkSpecificDisciplineAffinity
      ‚àö should check for specific discipline affinity with default minimum (1 ms)
      ‚àö should check for specific discipline affinity with custom minimum (1 ms)
      ‚àö should return false when not enough ancestors match (1 ms)
      ‚àö should handle empty ancestors or missing target discipline (7 ms)
    getMostCommonDisciplineFromHistory
      ‚àö should return the most common discipline (1 ms)
      ‚àö should handle empty or null history (1 ms)
      ‚àö should handle competitions without discipline field (1 ms)
    getHighestScoringDiscipline
      ‚àö should return the highest scoring discipline (1 ms)
      ‚àö should handle empty or null scores (1 ms)
      ‚àö should handle non-numeric scores (1 ms)
      ‚àö should return null when all scores are non-numeric (2 ms)
    error handling
      ‚àö should handle errors gracefully in main function
      ‚àö should handle errors gracefully in detailed function (1 ms)
      ‚àö should handle errors gracefully in specific discipline check (1 ms)
      ‚àö should handle undefined ancestors gracefully
      ‚àö should handle ancestors with circular references gracefully (1 ms)

[2025-12-27 23:22:05] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:05] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:05] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/foalModel.test.mjs
  üçº UNIT: Foal Model - Foal Development & Activity Management
    getFoalDevelopment
      ‚àö should return foal development data for valid foal (4 ms)
      ‚àö should throw error for horse that is not a foal (2 ms)
      ‚àö should throw error for 2-year-old horse (boundary test) (2 ms)
      ‚àö should accept 1-year-old horse (boundary test) (2 ms)
      ‚àö should validate availableActivities are returned correctly (1 ms)
      ‚àö should filter out completed activities from available activities (1 ms)
      ‚àö should throw error for non-existent horse (1 ms)
      ‚àö should throw error for invalid foal ID (4 ms)
      ‚àö should create default development record for new foal (2 ms)
    completeActivity
      ‚àö should complete an available activity successfully (9 ms)
      ‚àö should update completedActivities correctly when completing activity (3 ms)
      ‚àö should add to existing completed activities for the same day (1 ms)
      ‚àö should enforce bonding level bounds (0-100) (1 ms)
      ‚àö should enforce stress level bounds (0-100) (1 ms)
      ‚àö should throw error for missing development record (2 ms)
      ‚àö should throw error for invalid foal ID (2 ms)
      ‚àö should throw error for missing activity type (1 ms)
      ‚àö should throw error for unavailable activity (1 ms)
    advanceDay
      ‚àö should advance foal to next day successfully (1 ms)
      ‚àö should throw error for foal that has completed development (1 ms)
      ‚àö should throw error for invalid foal ID (2 ms)
    completeEnrichmentActivity
      ‚àö should complete enrichment activity successfully (2 ms)
      ‚àö should validate day parameter (0-6) (1 ms)
      ‚àö should validate activity is appropriate for the day (1 ms)
      ‚àö should enforce bonding and stress bounds (0-100) (1 ms)
      ‚àö should handle null bondScore and stressLevel with defaults (2 ms)
      ‚àö should throw error for horse that is not a foal (1 ms)
    getAvailableActivities
      ‚àö should return activities for day 0
      ‚àö should return different activities for different days
      ‚àö should filter out completed activities (1 ms)
      ‚àö should return empty array for invalid day (6 ms)
      ‚àö should handle missing completedActivities gracefully (1 ms)

[2025-12-27 23:22:06] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:06] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:06] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/foalTaskLoggingSystem.test.mjs
  Foal Task Logging & Streak Tracking System
    Task Category Configuration
      ‚àö should have foal enrichment tasks defined (13 ms)
      ‚àö should have foal grooming tasks defined (2 ms)
      ‚àö should have general grooming tasks defined (2 ms)
      ‚àö should have proper age thresholds configured (1 ms)
    Age-Based Task Eligibility
      ‚àö should allow only enrichment tasks for 0-2 year olds (1 ms)
      ‚àö should allow both enrichment and grooming tasks for 1-3 year olds (2 ms)
      ‚àö should allow all task types for 3+ year olds (1 ms)
    Task Categorization
      ‚àö should correctly categorize enrichment tasks (1 ms)
      ‚àö should correctly categorize grooming tasks (1 ms)
      ‚àö should return null for unknown tasks
    Task Logging System
      ‚àö should initialize empty task log (2 ms)
      ‚àö should increment existing task count (1 ms)
      ‚àö should add new task to existing log (1 ms)
      ‚àö should handle empty object task log (7 ms)
    Streak Tracking System
      ‚àö should start new streak for first grooming (1 ms)
      ‚àö should increment streak for consecutive days (1 ms)
      ‚àö should maintain streak within grace period (1 ms)
      ‚àö should reset streak after grace period expires (1 ms)
      ‚àö should detect bonus eligibility at 7 consecutive days (1 ms)
    Task Mutual Exclusivity
      ‚àö should allow first task of the day (1 ms)
      ‚àö should prevent mixing enrichment and grooming tasks same day (1 ms)
      ‚àö should allow same category tasks (if other rules permit) (1 ms)

[2025-12-27 23:22:06] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:06] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:06] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/atBirthTraits.test.mjs
  üß¨ UNIT: At-Birth Traits System - Comprehensive Breeding Analysis Testing
    AT_BIRTH_TRAITS
      ‚àö should have positive and negative trait categories (5 ms)
      ‚àö should have valid trait definitions (8 ms)
    evaluateTraitConditions
      ‚àö should correctly evaluate mare stress conditions (7 ms)
      ‚àö should correctly evaluate feed quality conditions (1 ms)
      ‚àö should correctly evaluate inbreeding conditions (1 ms)
      ‚àö should correctly evaluate multiple conditions (1 ms)
    assessFeedQuality
      ‚àö should return feed quality based on mare health status (2 ms)
      ‚àö should return default quality for missing mare (1 ms)
      ‚àö should adjust quality based on earnings (2 ms)
    getAncestors
      ‚àö should return empty array for no generations (2 ms)
      ‚àö should return empty array for empty horse IDs (1 ms)
      ‚àö should get immediate parents (1 ms)
    detectInbreeding
      ‚àö should detect no inbreeding when no common ancestors (2 ms)
      ‚àö should detect inbreeding when common ancestors exist (2 ms)
    analyzeLineage
      ‚àö should detect discipline specialization (2 ms)
      ‚àö should handle no competition history (1 ms)
    applyEpigeneticTraitsAtBirth
      ‚àö should apply positive traits for optimal breeding conditions (3 ms)
      ‚àö should apply negative traits for poor breeding conditions (1 ms)
      ‚àö should apply inbred trait when inbreeding detected (2 ms)
      ‚àö should apply inbred trait with direct condition testing (1 ms)
      ‚àö should apply specialized lineage trait when discipline specialization detected (6 ms)
      ‚àö should handle missing mare gracefully (3 ms)
      ‚àö should require both sire and dam IDs (2 ms)
      ‚àö should use mare stress level from database when not provided (3 ms)
      ‚àö should move traits to hidden when many traits are applied (2 ms)
      ‚àö should handle errors in lineage analysis gracefully (1 ms)
    checkLineageForDisciplineAffinity
      ‚àö should return affinity true when 3 or more ancestors share the same discipline (2 ms)
      ‚àö should return affinity false when less than 3 ancestors share the same discipline (2 ms)
      ‚àö should handle ancestors with competition history (2 ms)
      ‚àö should handle ancestors with discipline scores (1 ms)
      ‚àö should handle empty ancestors array (1 ms)
      ‚àö should handle null ancestors (1 ms)
      ‚àö should handle ancestors without discipline information (1 ms)
      ‚àö should prioritize direct discipline field over other methods (2 ms)
      ‚àö should handle mixed data sources correctly (1 ms)
    getMostCommonDisciplineFromHistory
      ‚àö should return the most common discipline from competition history (1 ms)
      ‚àö should return null for empty competition history (5 ms)
      ‚àö should return null for null competition history
      ‚àö should handle competitions without discipline field (1 ms)
    getHighestScoringDiscipline
      ‚àö should return the discipline with the highest score (2 ms)
      ‚àö should return null for empty discipline scores (1 ms)
      ‚àö should return null for null discipline scores (1 ms)
      ‚àö should handle non-numeric scores (1 ms)
      ‚àö should handle all non-numeric scores (1 ms)

[2025-12-27 23:22:06] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:06] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:06] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task brushing
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: task_specialty, trait_match
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying playful personality effects for task grooming_game
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied playful effects: task_specialty, age_match
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying firm personality effects for task hand_walking
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied firm effects: task_specialty, trait_match
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying patient personality effects for task puddle_training
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied patient effects: task_specialty, category_match
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying high_energy personality effects for task obstacle_course
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied high_energy effects: task_specialty, extra_trait_points
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying aloof personality effects for task brushing
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied aloof effects: 
[2025-12-27 23:22:06] warn: [groomPersonalityEffects.calculatePersonalityEffects] Unknown personality: unknown_personality
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying patient personality effects for task puddle_training
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied patient effects: task_specialty, category_match
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task brushing
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: task_specialty
[2025-12-27 23:22:06] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying playful personality effects for task grooming_game
[2025-12-27 23:22:07] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied playful effects: task_specialty
[2025-12-27 23:22:07] info: [groomPersonalityEffects.calculatePersonalityEffects] Applying gentle personality effects for task brushing
[2025-12-27 23:22:07] info: [groomPersonalityEffects.calculatePersonalityEffects] Applied gentle effects: task_specialty, trait_match
PASS tests/groomPersonalityEffects.test.mjs
  Groom Personality Effects System
    GROOM_PERSONALITY_EFFECTS Configuration
      ‚àö should have all required personality types defined (7 ms)
      ‚àö should have correct gentle personality configuration (2 ms)
      ‚àö should have correct aloof personality penalty configuration (2 ms)
    calculatePersonalityEffects
      ‚àö should apply gentle personality effects for nervous horse with brushing (4 ms)
      ‚àö should apply playful personality effects for young horse (11 ms)
      ‚àö should apply firm personality effects for stubborn horse (3 ms)
      ‚àö should apply patient personality effects for enrichment tasks (3 ms)
      ‚àö should apply high_energy personality effects with extra trait points (2 ms)
      ‚àö should apply aloof personality penalties (4 ms)
      ‚àö should handle unknown personality gracefully (2 ms)
      ‚àö should not exceed maximum success rate of 0.99 (2 ms)
    getPersonalityEffectSummary
      ‚àö should return correct summary for gentle personality with bonus task (1 ms)
      ‚àö should return correct summary for personality without task bonus (4 ms)
      ‚àö should handle unknown personality type (1 ms)
    getAllPersonalityTypes
      ‚àö should return all personality types with correct structure (4 ms)
      ‚àö should correctly identify penalty personalities (1 ms)
    Edge Cases and Error Handling
      ‚àö should handle horse without traits (3 ms)
      ‚àö should handle missing age information (3 ms)
      ‚àö should handle empty base effects object (3 ms)

[2025-12-27 23:22:07] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:07] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:07] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:22:07] info: [groomRareTraitPerks] Perk revealed: Phoenix Whisperer for groom 1
[2025-12-27 23:22:07] info: [groomRareTraitPerks] Perk revealed: Phoenix Whisperer for groom 1
PASS tests/ultraRareTraitsCore.test.mjs
  Ultra-Rare & Exotic Traits Core Functionality
    Trait Definitions System
      ‚àö should retrieve all ultra-rare trait definitions (5 ms)
      ‚àö should retrieve all exotic trait definitions (2 ms)
      ‚àö should get specific trait definition by name (1 ms)
      ‚àö should have correct trait structure for all ultra-rare traits (16 ms)
      ‚àö should have correct trait structure for all exotic traits (3 ms)
    Groom Perk System
      ‚àö should apply rare trait booster effects to probability calculations (5 ms)
      ‚àö should not apply bonuses when no conditions are met (1 ms)
    Mechanical Effects Integration
      ‚àö should apply ultra-rare stress effects correctly
      ‚àö should apply ultra-rare competition effects correctly (2 ms)
      ‚àö should check ultra-rare abilities correctly (1 ms)
      ‚àö should handle multiple ultra-rare traits correctly (1 ms)
      ‚àö should handle stress immunity correctly (1 ms)
    Trait Conflicts and Stacking
      ‚àö should define proper trait conflicts (1 ms)
      ‚àö should define proper trait stacking (2 ms)

[2025-12-27 23:22:07] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:07] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:07] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/taskInfluenceConfig.test.mjs
  Task Influence Configuration
    Task Influence Map Structure
      ‚àö should define influence map for all foal tasks (3 ms)
      ‚àö should have entries for all enrichment tasks (4 ms)
      ‚àö should have entries for all grooming tasks (13 ms)
      ‚àö should have correct structure for each task entry (9 ms)
    Task Coverage Validation
      ‚àö should cover all enrichment tasks (1 ms)
      ‚àö should cover all grooming tasks (6 ms)
      ‚àö should not have entries for non-foal tasks (2 ms)
    Trait Influence Validation
      ‚àö should have logical trait mappings for enrichment tasks (1 ms)
      ‚àö should have logical trait mappings for grooming tasks (1 ms)
      ‚àö should have consistent daily values (1 ms)
      ‚àö should have unique trait combinations per task (1 ms)
    Business Rule Validation
      ‚àö should support trait point accumulation system (2 ms)
      ‚àö should have reasonable trait distribution (1 ms)
      ‚àö should support epigenetic development progression (1 ms)
    Integration Validation
      ‚àö should integrate with foal task categories (1 ms)
      ‚àö should provide complete task influence coverage (1 ms)
    Data Quality Validation
      ‚àö should have meaningful trait names (3 ms)
      ‚àö should maintain consistent naming conventions (6 ms)
    Utility Functions
      getTaskInfluence
        ‚àö should return influence object for valid task (1 ms)
        ‚àö should return null for invalid task (1 ms)
      getTraitsInfluencedByTask
        ‚àö should return traits for valid task (1 ms)
        ‚àö should return empty array for invalid task (2 ms)
        ‚àö should return copy of traits array (1 ms)
      getDailyTraitValue
        ‚àö should return daily value for valid task (1 ms)
        ‚àö should return 0 for invalid task
      getTasksInfluencingTrait
        ‚àö should return tasks that influence a specific trait
        ‚àö should return empty array for non-existent trait (1 ms)
        ‚àö should return all tasks for presentationBoosted trait (1 ms)
      getAllInfluencedTraits
        ‚àö should return all unique traits (3 ms)
        ‚àö should return sorted array (1 ms)
        ‚àö should return unique traits only
      calculateTraitPoints
        ‚àö should calculate trait points for single task (1 ms)
        ‚àö should calculate trait points for multiple tasks (2 ms)
        ‚àö should handle overlapping traits correctly (1 ms)
        ‚àö should ignore invalid tasks (1 ms)
        ‚àö should handle zero completions (1 ms)
      validateTaskInfluenceMap
        ‚àö should validate correct structure (1 ms)

[2025-12-27 23:22:08] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:08] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:08] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/horseXpController.test.mjs
  Horse XP Controller - API Endpoints
    getHorseXpStatus
      ‚àö should return horse XP status for authorized user (5 ms)
      ‚àö should reject unauthorized access to other users horses (2 ms)
      ‚àö should handle horse not found (2 ms)
    allocateStatPoint
      ‚àö should allocate stat point successfully (3 ms)
      ‚àö should validate stat name (2 ms)
      ‚àö should require stat name in request body (2 ms)
    getHorseXpHistory
      ‚àö should return horse XP history with pagination (5 ms)
    awardXpToHorse
      ‚àö should award XP to horse (system/admin use) (13 ms)
      ‚àö should validate XP amount (1 ms)

[2025-12-27 23:22:08] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:08] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:08] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:22:08] warn: CORS blocked request from origin: http://evil.com
[2025-12-27 23:22:08] warn: [CORS] Request with no origin detected - API key validation required
  console.error
    TypeError: Cannot read properties of undefined (reading 'get')
        at Object.trustProxy (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\node_modules\express-rate-limit\dist\index.mjs:140:21)
        at Object.wrappedValidations.<computed> [as trustProxy] (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\node_modules\express-rate-limit\dist\index.mjs:370:22)
        at Object.keyGenerator (C:\Users\heirr\OneDrive\Desktop\Equoria\backend\node_modules\express-rate-limit\dist\index.mjs:642:20)
        at C:\Users\heirr\OneDrive\Desktop\Equoria\backend\node_modules\express-rate-limit\dist\index.mjs:696:32
        at C:\Users\heirr\OneDrive\Desktop\Equoria\backend\node_modules\express-rate-limit\dist\index.mjs:676:5

      at Object.wrappedValidations.<computed> [as trustProxy] (node_modules/express-rate-limit/dist/index.mjs:378:21)
      at Object.keyGenerator (node_modules/express-rate-limit/dist/index.mjs:642:20)
      at node_modules/express-rate-limit/dist/index.mjs:696:32
      at node_modules/express-rate-limit/dist/index.mjs:676:5

[2025-12-27 23:22:08] warn: [API Key] API_KEY not configured - requests with no origin are allowed (INSECURE)
[2025-12-27 23:22:08] warn: [API Key] Invalid or missing API key
[2025-12-27 23:22:08] warn: [HTTPS] Insecure HTTP request detected, redirecting to HTTPS
PASS __tests__/unit/security/security-middleware.test.mjs
  security middleware
    corsOptions
      ‚àö allows known origins and rejects unknown (8 ms)
      ‚àö allows no-origin requests (legacy) and supports ALLOWED_ORIGINS env (2 ms)
    createRateLimiter
      ‚àö returns an express-rate-limit instance (4 ms)
    validateApiKey
      ‚àö skips when API_KEY not set (3 ms)
      ‚àö rejects missing or invalid key when configured (5 ms)
      ‚àö allows valid key (1 ms)
    enforceHttps
      ‚àö bypasses in non-production (2 ms)
      ‚àö redirects http in production (2 ms)
    addSecurityHeaders
      ‚àö sets baseline headers (1 ms)
    createSecurityMiddleware
      ‚àö returns middleware array including helmet, cors, and rate limiter (11 ms)

[2025-12-27 23:22:09] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:09] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:09] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/simulateCompetition.test.mjs
  üèá UNIT: Competition Simulation System - Horse Performance & Ranking
    getStatScore
      ‚àö should calculate correct weighted score for Racing discipline (5 ms)
      ‚àö should calculate correct weighted score for Show Jumping discipline (1 ms)
      ‚àö should handle missing stats by defaulting to 0 (1 ms)
      ‚àö should throw error for invalid discipline (7 ms)
      ‚àö should throw error for missing horse object (2 ms)
    getHealthModifier
      ‚àö should return correct modifiers for all health ratings (16 ms)
      ‚àö should return 0 for unknown health rating (1 ms)
    applyRiderModifiers
      ‚àö should apply bonus correctly (1 ms)
      ‚àö should apply penalty correctly (1 ms)
      ‚àö should apply both bonus and penalty (1 ms)
      ‚àö should handle default values (2 ms)
      ‚àö should validate input ranges (3 ms)
    simulateCompetition
      ‚àö should simulate competition with 5 horses and return correct rankings (5 ms)
      ‚àö should calculate discipline affinity trait bonus correctly (5 ms)
      ‚àö should handle horses with missing optional fields (2 ms)
      ‚àö should handle empty horse array (2 ms)
      ‚àö should validate inputs (3 ms)
      ‚àö should handle calculation errors gracefully (3 ms)
      ‚àö should verify complete scoring formula with random luck modifier (19 ms)
      ‚àö should apply random luck modifier causing score variation (3 ms)

[2025-12-27 23:22:09] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:09] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:09] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Simulating breeding outcomes
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Simulating breeding outcomes
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:09] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Simulating breeding outcomes
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Simulating breeding outcomes
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating multi-generational predictions
[2025-12-27 23:22:10] info: Calculating multi-generational predictions
[2025-12-27 23:22:10] info: Calculating genetic diversity impact
[2025-12-27 23:22:10] info: Calculating genetic diversity impact
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
[2025-12-27 23:22:10] info: Calculating enhanced genetic probabilities
PASS tests/unit/enhancedGeneticProbabilityCalculator.test.mjs
  üß¨ Enhanced Genetic Probability Calculator
    üéØ Enhanced Trait Inheritance Probability Calculator
      ‚àö should calculate detailed trait inheritance probabilities (27 ms)
      ‚àö should calculate stat inheritance probabilities (4 ms)
      ‚àö should handle edge cases with minimal genetic data (4 ms)
    ü§ù Genetic Compatibility Scoring System
      ‚àö should calculate genetic compatibility score (5 ms)
      ‚àö should identify trait conflicts (2 ms)
      ‚àö should calculate stat compatibility (2 ms)
    üé≤ Breeding Outcome Simulation
      ‚àö should simulate multiple breeding outcomes (228 ms)
      ‚àö should provide confidence intervals (99 ms)
      ‚àö should handle deterministic simulation with seed (34 ms)
    üå≥ Multi-Generational Prediction Engine
      ‚àö should calculate multi-generational predictions (4 ms)
      ‚àö should weight recent generations more heavily (4 ms)
    üåà Genetic Diversity Impact Calculator
      ‚àö should calculate genetic diversity impact (3 ms)
      ‚àö should detect inbreeding risks (7 ms)
    ‚ö° Trait Interaction Modeling
      ‚àö should calculate trait interactions (4 ms)
      ‚àö should identify athletic + intelligent synergy (1 ms)
    üí° Breeding Recommendation Engine
      ‚àö should generate breeding recommendations (3 ms)
      ‚àö should provide specific optimization suggestions (3 ms)
    üèÜ Performance Prediction Algorithm
      ‚àö should predict offspring performance (7 ms)
      ‚àö should identify performance strengths and weaknesses (3 ms)

[2025-12-27 23:22:10] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:10] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:10] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/groomMarketplace.test.mjs
  üè™ Groom Marketplace System
    Random Groom Generation
      ‚àö should generate a valid groom with all required properties (8 ms)
      ‚àö should generate experience within skill level ranges (16 ms)
      ‚àö should calculate session rates based on skill level and experience (2 ms)
      ‚àö should generate unique marketplace IDs (9 ms)
      ‚àö should generate meaningful bios that include name and specialty (2 ms)
    Marketplace Generation
      ‚àö should generate marketplace with default size (2 ms)
      ‚àö should generate marketplace with custom size (1 ms)
      ‚àö should respect quality distribution over large sample (10 ms)
    Refresh Mechanics
      ‚àö should need refresh when no last refresh provided (1 ms)
      ‚àö should need refresh when enough time has passed
      ‚àö should not need refresh when not enough time has passed (1 ms)
      ‚àö should calculate correct refresh cost (1 ms)
    Configuration Validation
      ‚àö should have valid marketplace configuration (5 ms)

[2025-12-27 23:22:10] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:10] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:10] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:22:10] info: [simulateCompetition] Horse JumpSpecialist: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:22:10] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:22:10] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:22:10] info: [simulateCompetition] Horse TraitHorse: Discipline affinity bonus applied for discipline_affinity_show_jumping (+5 points)
[2025-12-27 23:22:10] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_show_jumping
[2025-12-27 23:22:10] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:22:10] info: [simulateCompetition] Horse RacingSpecialist: Discipline affinity bonus applied for discipline_affinity_racing (+5 points)
[2025-12-27 23:22:10] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:22:10] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:22:10] info: [simulateCompetition] Horse DressageSpecialist: Discipline affinity bonus applied for discipline_affinity_dressage (+5 points)
[2025-12-27 23:22:10] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_dressage
[2025-12-27 23:22:10] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:22:10] info: [simulateCompetition] Horse Cross CountrySpecialist: Discipline affinity bonus applied for discipline_affinity_cross_country (+5 points)
[2025-12-27 23:22:10] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_cross_country
[2025-12-27 23:22:10] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:22:10] info: [simulateCompetition] Horse EnduranceSpecialist: Discipline affinity bonus applied for discipline_affinity_endurance (+5 points)
[2025-12-27 23:22:10] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_endurance
[2025-12-27 23:22:10] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
[2025-12-27 23:22:10] warn: [traitCompetitionImpact] Unknown trait: discipline_affinity_racing
[2025-12-27 23:22:10] info: [traitCompetitionImpact] Horse 1: 0 traits applied, 0.0% modifier, 0.0 point adjustment
PASS tests/task9IntegrationExample.test.mjs
  üèÜ INTEGRATION: Task 9 Integration Example - Discipline Affinity Trait Bonus
    ‚àö should apply +5 flat bonus for discipline_affinity_jump trait in Show Jumping (8 ms)
    ‚àö should demonstrate the exact code pattern from TASK 9 specification (13 ms)
    ‚àö should work with different discipline types and their corresponding traits (19 ms)
    ‚àö should not apply bonus when trait does not match discipline (3 ms)

[2025-12-27 23:22:11] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:11] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:11] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/applyEpigeneticTraitsAtBirthTask8.test.mjs
  üß¨ UNIT: Apply Epigenetic Traits At Birth Task 8 - Deterministic Breeding Analysis
    Low-stress, premium-fed mare produces positive traits
      ‚àö should produce hardy trait with low stress and premium feed (7 ms)
      ‚àö should produce well_bred trait with optimal conditions and no inbreeding (15 ms)
      ‚àö should produce premium_care trait with exceptional conditions (2 ms)
      ‚àö should NOT produce positive traits with high stress (2 ms)
      ‚àö should NOT produce positive traits with poor feed quality (3 ms)
    Inbreeding detection triggers negative traits
      ‚àö should produce inbred trait when duplicate ancestors detected (3 ms)
      ‚àö should NOT produce inbred trait without common ancestors (3 ms)
    Poor breeding conditions trigger negative traits
      ‚àö should produce weak_constitution trait with high stress and poor feed (3 ms)
      ‚àö should produce stressed_lineage trait with high mare stress (4 ms)
      ‚àö should produce poor_nutrition trait with very poor feed quality (1 ms)
    Discipline specialization produces legacy traits
      ‚àö should produce specialized_lineage trait with 3+ ancestors in same discipline (2 ms)
      ‚àö should NOT produce specialized_lineage trait without sufficient specialization (4 ms)
      ‚àö should handle no competition history gracefully (11 ms)
    Deterministic testing with Math.random mocking
      ‚àö should consistently apply traits when random value is below threshold (3 ms)
      ‚àö should consistently NOT apply traits when random value is above threshold (2 ms)
      ‚àö should handle edge case random values at exact thresholds (4 ms)
    Error handling and edge cases
      ‚àö should throw error when sireId is missing (6 ms)
      ‚àö should throw error when damId is missing (4 ms)
      ‚àö should throw error when mare is not found (3 ms)
      ‚àö should handle database errors gracefully in lineage analysis (1 ms)

[2025-12-27 23:22:11] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:11] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:11] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/traitDiscovery.test.mjs
  üîç UNIT: Trait Discovery System - Environmental Trait Detection
    ‚àö should pass basic test (2 ms)
    ‚àö should handle trait discovery logic (1 ms)
    ‚àö should handle enrichment activity counting (2 ms)
    ‚àö should validate trait rarity levels (1 ms)
    ‚àö should validate trait types (2 ms)

[2025-12-27 23:22:12] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:12] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:12] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/enhancedCompetitionLogic.test.mjs
  üèÜ UNIT: Enhanced Competition Logic - Complete Competition System Validation
    üìä Horse Level Calculation
      ‚àö should calculate horse level correctly for Racing discipline (2 ms)
      ‚àö should handle high-level horses correctly (2 ms)
    üéÇ Age Requirements
      ‚àö should accept horses aged 3-21 (in days) (1 ms)
      ‚àö should reject horses under 3 or over 21 (in days) (1 ms)
    üß¨ Trait Requirements
      ‚àö should require Gaited trait for Gaited competitions (1 ms)
      ‚àö should not require special traits for most disciplines (1 ms)
    üìà Stat Gain System
      ‚àö should award stat gains for 1st place (10% chance) (3 ms)
      ‚àö should not award stat gains when random chance fails (1 ms)
      ‚àö should not award stat gains for 4th place or lower (1 ms)
    üèÜ Prize Distribution
      ‚àö should not award prizes to 4th place (1 ms)
    üéØ Discipline Configuration
      ‚àö should have all 24 disciplines (3 ms)
      ‚àö should have correct stats for each discipline (2 ms)
      ‚àö should have Gaited trait requirement for Gaited discipline (1 ms)
    üîß Error Handling
      ‚àö should handle missing horse data gracefully (1 ms)
      ‚àö should handle invalid discipline gracefully (1 ms)

[2025-12-27 23:22:13] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:13] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:13] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/isHorseEligible.test.mjs
  üèÜ UNIT: Horse Eligibility - Competition Entry Validation
    Input Validation
      ‚àö should throw error for null horse (7 ms)
      ‚àö should throw error for undefined horse (2 ms)
      ‚àö should throw error for null show (9 ms)
      ‚àö should throw error for undefined show (1 ms)
      ‚àö should throw error for non-array previousEntries (1 ms)
      ‚àö should throw error for null previousEntries (1 ms)
    Age Requirements (3-20 inclusive)
      ‚àö should return false for horse younger than 3 (2 ms)
      ‚àö should return false for horse age 1
      ‚àö should return true for horse exactly age 3
      ‚àö should return true for horse exactly age 20
      ‚àö should return false for horse older than 20 (1 ms)
      ‚àö should return false for horse age 25
      ‚àö should return false for horse with non-numeric age
      ‚àö should return false for horse with null age (1 ms)
      ‚àö should return false for horse with undefined age (1 ms)
    Level Requirements
      ‚àö should return false for horse level below show minimum
      ‚àö should return true for horse level exactly at show minimum (1 ms)
      ‚àö should return true for horse level exactly at show maximum
      ‚àö should return false for horse level above show maximum
      ‚àö should return true for horse level within show range (1 ms)
      ‚àö should return false for horse with non-numeric level (1 ms)
      ‚àö should return false for horse with null level (1 ms)
      ‚àö should return false for horse with undefined level (2 ms)
      ‚àö should handle show with no levelMin specified (1 ms)
      ‚àö should handle show with no levelMax specified
      ‚àö should handle show with neither levelMin nor levelMax specified (8 ms)
    Previous Entries Check
      ‚àö should return false if horse has already entered this show (1 ms)
      ‚àö should return true if horse has not entered this show
      ‚àö should return true with empty previousEntries array (1 ms)
      ‚àö should return true when previousEntries is not provided (default empty array) (2 ms)
      ‚àö should handle numeric show IDs in previousEntries (1 ms)
      ‚àö should handle mixed type show IDs in previousEntries (1 ms)
    Discipline Independence
      ‚àö should allow horse to enter Dressage regardless of trait
      ‚àö should allow horse to enter Jumping regardless of trait
      ‚àö should allow horse to enter Racing regardless of trait (1 ms)
      ‚àö should allow horse to enter any discipline regardless of health status
    Valid Entry Cases
      ‚àö should return true for completely valid entry
      ‚àö should return true for minimum age and level requirements
      ‚àö should return true for maximum age and level requirements (1 ms)
    Edge Cases
      ‚àö should handle show with zero as levelMin
      ‚àö should handle negative horse level (1 ms)
      ‚àö should handle very large previousEntries array (1 ms)
      ‚àö should handle show ID that is an empty string

[2025-12-27 23:22:13] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:13] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:13] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/simple-db.test.mjs
  Simple Database Test
    ‚àö should connect to database (56 ms)
    ‚àö should create a simple user (18 ms)

[2025-12-27 23:22:13] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:13] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:13] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/groomConfig.test.mjs
  Groom Configuration
    Foal Task Categories
      Enrichment Tasks (0-2 years)
        ‚àö should define correct enrichment tasks for early development (3 ms)
        ‚àö should have exactly 7 enrichment tasks (1 ms)
        ‚àö should contain only string values (1 ms)
        ‚àö should not contain any grooming tasks (1 ms)
      Foal Grooming Tasks (1-3 years)
        ‚àö should define correct grooming tasks for handling preparation (2 ms)
        ‚àö should have exactly 5 grooming tasks
        ‚àö should contain only string values (10 ms)
        ‚àö should not contain any enrichment tasks (1 ms)
      Task Category Separation
        ‚àö should have no overlap between enrichment and grooming tasks (1 ms)
        ‚àö should have all tasks be unique within each category (1 ms)
    Configuration Constants
      ‚àö should have correct age thresholds for task eligibility (1 ms)
      ‚àö should have task category definitions
      ‚àö should have bonding and streak configuration (1 ms)
    Age-Based Task Eligibility Logic
      ‚àö should allow enrichment tasks for ages 0-2 (1 ms)
      ‚àö should allow grooming tasks for ages 1-3 (2 ms)
      ‚àö should allow general grooming tasks for ages 3+ (2 ms)
      ‚àö should have overlap period for ages 1-3 (both enrichment and grooming)

[2025-12-27 23:22:14] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:14] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:14] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/unit/epigeneticFlagDefinitions.test.mjs
  Epigenetic Flag Definitions
    Constants
      ‚àö should have correct flag types (3 ms)
      ‚àö should have correct source categories (1 ms)
      ‚àö should have correct max flags limit (1 ms)
      ‚àö should have correct age range (1 ms)
    Flag Definitions Structure
      ‚àö should have exactly 9 starter flags (1 ms)
      ‚àö should have all required starter flags (2 ms)
      ‚àö each flag should have required properties (18 ms)
      ‚àö each flag should have valid influences structure (12 ms)
    Flag Type Distribution
      ‚àö should have correct distribution of flag types (1 ms)
      ‚àö should have correct distribution of source categories
    Helper Functions
      getAllFlagDefinitions
        ‚àö should return all flag definitions (1 ms)
      getFlagDefinition
        ‚àö should return correct flag definition for valid name
        ‚àö should return correct flag definition for uppercase name (1 ms)
        ‚àö should return null for invalid flag name (1 ms)
        ‚àö should handle empty string
      getFlagsByType
        ‚àö should return positive flags (1 ms)
        ‚àö should return negative flags (1 ms)
        ‚àö should return empty array for adaptive flags
        ‚àö should return empty array for invalid type (1 ms)
      getFlagsBySourceCategory
        ‚àö should return flags by bonding category (1 ms)
        ‚àö should return flags by novelty category (2 ms)
        ‚àö should return flags by environment category (1 ms)
        ‚àö should return empty array for invalid category
    Specific Flag Validation
      ‚àö BRAVE flag should have correct properties
      ‚àö FEARFUL flag should have correct properties (5 ms)
      ‚àö RESILIENT flag should have correct properties (1 ms)

[2025-12-27 23:22:14] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:14] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:14] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/foalTaskLogManager.test.mjs
  Foal Task Log Manager
    Task Log Initialization and Manipulation
      ‚àö should initialize empty task log (4 ms)
      ‚àö should increment task count for new task (2 ms)
      ‚àö should increment existing task count (2 ms)
      ‚àö should increment by custom amount (11 ms)
      ‚àö should handle null task log (2 ms)
      ‚àö should get task count for existing task (2 ms)
      ‚àö should return 0 for non-existent task (1 ms)
      ‚àö should handle null task log in getTaskCount (3 ms)
    Task Log Statistics
      ‚àö should calculate total task count (1 ms)
      ‚àö should handle empty task log in total count (1 ms)
      ‚àö should ignore non-numeric values in total count (1 ms)
      ‚àö should get completed tasks list (2 ms)
      ‚àö should handle empty task log in completed tasks (1 ms)
    Streak Calculation
      ‚àö should handle null last care date (1 ms)
      ‚àö should calculate same day care (2 ms)
      ‚àö should calculate within grace period (2 ms)
      ‚àö should detect broken streak beyond grace period (7 ms)
      ‚àö should use custom grace period (1 ms)
    Burnout Immunity
      ‚àö should grant immunity after 7 days (1 ms)
      ‚àö should not grant immunity before 7 days (2 ms)
      ‚àö should handle invalid input (1 ms)
      ‚àö should use custom immunity threshold (1 ms)
    Care Data Updates
      ‚àö should update foal care data with new task (1 ms)
      ‚àö should continue streak within grace period (1 ms)
      ‚àö should reset streak when broken (1 ms)
    Task Log Validation
      ‚àö should validate correct task log (2 ms)
      ‚àö should allow null task log (1 ms)
      ‚àö should reject non-object task log (1 ms)
      ‚àö should reject invalid task names (1 ms)
      ‚àö should reject invalid counts (2 ms)
    Care Summary
      ‚àö should generate comprehensive care summary (2 ms)
      ‚àö should handle empty foal data (1 ms)
    Streak Reset
      ‚àö should reset foal care streak (1 ms)
    Error Handling
      ‚àö should handle errors in incrementTaskCount (7 ms)
      ‚àö should handle errors in calculateStreakFromLastCareDate (6 ms)

[2025-12-27 23:22:15] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:15] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:15] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:22:15] info: [bondingModifiers] Bonding change for horse 1: 32 -> 50 (56.3% trait modifier)
[2025-12-27 23:22:15] info: [bondingModifiers] Bonding change for horse 1: 1.5 -> 0.8 (-46.7% trait modifier)
[2025-12-27 23:22:15] info: [bondingModifiers] Bonding change for horse 1: 6 -> 7.5 (25.0% trait modifier)
[2025-12-27 23:22:15] info: [temperamentDrift] Temperament drift suppressed by traits for horse 1
[2025-12-27 23:22:15] info: [temperamentDrift] Temperament drift suppressed by traits for horse 1
[2025-12-27 23:22:15] warn: [traitEffects.getTraitEffects] No effects defined for trait: unknown_trait
[2025-12-27 23:22:15] warn: [traitEffects.getTraitEffects] No effects defined for trait: another_unknown
[2025-12-27 23:22:15] info: [bondingModifiers] Bonding change for horse 1: 17 -> 17 (0.0% trait modifier)
[2025-12-27 23:22:15] info: [bondingModifiers] Bonding change for horse 1: 1.5 -> 1.5 (0.0% trait modifier)
[2025-12-27 23:22:15] error: [bondingModifiers] Error calculating bonding change: Unknown activity type: invalid_activity
PASS tests/traitIntegration.test.mjs
  üéÆ UNIT: Trait Integration System - Gameplay Effect Application
    Bonding Modifiers
      ‚àö should apply trait bonuses to grooming bonding (7 ms)
      ‚àö should apply trait penalties to bonding for antisocial horses (10 ms)
      ‚àö should calculate competition bonding with placement modifiers (3 ms)
    Temperament Drift Suppression
      ‚àö should suppress temperament drift for resilient horses (2 ms)
      ‚àö should allow temperament drift for horses without suppressing traits (1 ms)
      ‚àö should suppress drift completely for calm horses (5 ms)
    Trait Effects Combination
      ‚àö should combine multiple positive trait effects correctly (2 ms)
      ‚àö should combine positive and negative trait effects (1 ms)
      ‚àö should handle empty trait arrays (2 ms)
      ‚àö should handle unknown traits gracefully (3 ms)
    Competition Stress Response
      ‚àö should calculate stress impact during competition (1 ms)
      ‚àö should apply stress resistance from traits (1 ms)
    Integration Error Handling
      ‚àö should handle missing trait data gracefully (10 ms)
      ‚àö should handle malformed trait data (2 ms)
      ‚àö should handle invalid activity types gracefully (2 ms)

[2025-12-27 23:22:15] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:15] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:15] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 2 traits applied, 8.5% modifier, 8.5 point adjustment
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 2 traits applied, -10.4% modifier, -10.4 point adjustment
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 3 traits applied, 4.5% modifier, 4.5 point adjustment
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 1 traits applied, 6.0% modifier, 6.0 point adjustment
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 2: 5 traits applied, 16.4% modifier, 16.4 point adjustment
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 1 traits applied, 10.0% modifier, 10.0 point adjustment
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 1 traits applied, 6.0% modifier, 6.0 point adjustment
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 1 traits applied, 5.0% modifier, 5.0 point adjustment
[2025-12-27 23:22:15] warn: [traitCompetitionImpact] Unknown trait: unknown_trait
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 1 traits applied, 6.0% modifier, 6.0 point adjustment
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 1 traits applied, 6.0% modifier, 6.0 point adjustment
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 1 traits applied, 6.0% modifier, 6.0 point adjustment
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 1 traits applied, 7.0% modifier, 7.0 point adjustment
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 1 traits applied, -5.0% modifier, -5.0 point adjustment
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 1 traits applied, -6.0% modifier, -6.0 point adjustment
[2025-12-27 23:22:15] warn: [traitCompetitionImpact] Unknown trait: legendary_bloodline
[2025-12-27 23:22:15] info: [traitCompetitionImpact] Horse 1: 6 traits applied, 19.6% modifier, 19.6 point adjustment
PASS tests/traitCompetitionImpact.test.mjs
  üèÜ UNIT: Trait Competition Impact System - Scoring Modifier Calculations
    calculateTraitCompetitionImpact
      ‚àö should handle horse with no traits (13 ms)
      ‚àö should apply positive trait bonuses correctly (3 ms)
      ‚àö should apply negative trait penalties correctly (3 ms)
      ‚àö should apply mixed traits correctly (2 ms)
      ‚àö should apply diminishing returns for multiple traits (4 ms)
      ‚àö should handle legendary traits correctly (2 ms)
      ‚àö should handle rare environmental traits (2 ms)
      ‚àö should handle missing epigenetic_modifiers gracefully (1 ms)
      ‚àö should handle unknown traits gracefully (5 ms)
    getTraitCompetitionEffect
      ‚àö should return correct trait effect (1 ms)
      ‚àö should return null for unknown trait (1 ms)
    hasSpecializedEffect
      ‚àö should return true for specialized combinations
      ‚àö should return false for non-specialized combinations (1 ms)
    getAllTraitCompetitionEffects
      ‚àö should return all trait effects (4 ms)
    Discipline-Specific Effects
      ‚àö Bold should excel at Show Jumping (1 ms)
      ‚àö Intelligent should excel at Dressage (2 ms)
      ‚àö Athletic should excel at Racing (2 ms)
      ‚àö Nervous should struggle with Show Jumping (1 ms)
      ‚àö Stubborn should struggle with Dressage (2 ms)
    Balance and Fairness
      ‚àö should ensure trait effects are balanced (9 ms)
      ‚àö should not allow trait stacking to become overpowered (3 ms)

[2025-12-27 23:22:15] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:15] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:15] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/burnoutImmunityGracePeriod.test.mjs
  Burnout Immunity Grace Period
    Grace Period Mechanics
      ‚àö should preserve streak within 2-day grace period (4 ms)
      ‚àö should reset streak after grace period expires (1 ms)
      ‚àö should increment streak when groomed today (2 ms)
      ‚àö should handle exactly 2-day grace period boundary (1 ms)
      ‚àö should reset at 3-day lapse (beyond grace period) (1 ms)
    Burnout Immunity Achievement
      ‚àö should grant immunity at 7 consecutive days (1 ms)
      ‚àö should maintain immunity above 7 days (1 ms)
      ‚àö should show days remaining before immunity (1 ms)
      ‚àö should handle edge case at 6 days (one day before immunity) (7 ms)
    Streak Tracking Integration
      ‚àö should handle first-time grooming (3 ms)
      ‚àö should increment streak for consecutive days (1 ms)
      ‚àö should grant bonus eligibility at 7 consecutive days (1 ms)
      ‚àö should preserve streak within grace period (1 ms)
      ‚àö should reset streak beyond grace period (2 ms)
    Per-Horse Tracking
      ‚àö should demonstrate independent streak tracking per horse (2 ms)
    Configuration Validation
      ‚àö should use correct grace period configuration (1 ms)
      ‚àö should have consistent grace periods across systems (1 ms)
    Edge Cases and Error Handling
      ‚àö should handle zero consecutive days (1 ms)
      ‚àö should handle negative consecutive days (2 ms)
      ‚àö should handle very large streak numbers (2 ms)
      ‚àö should handle zero days since last grooming (1 ms)
    Real-World Scenarios
      ‚àö should handle weekend gap scenario (1 ms)
      ‚àö should handle vacation scenario (2 ms)
      ‚àö should handle immunity achievement and maintenance (2 ms)

[2025-12-27 23:22:16] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:16] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:16] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:22:16] info: [CSRF] Token generated
[2025-12-27 23:22:16] error: [CSRF] Token generation failed: Token generation failed
[2025-12-27 23:22:16] info: [CSRF] Token generated
[2025-12-27 23:22:16] warn: [CSRF] Invalid token detected
[2025-12-27 23:22:16] warn: [CSRF] Invalid token detected
[2025-12-27 23:22:16] warn: [CSRF] Invalid token detected
[2025-12-27 23:22:16] warn: [CSRF] Invalid token detected
[2025-12-27 23:22:16] warn: [CSRF] Invalid token detected
[2025-12-27 23:22:16] warn: [CSRF] Invalid token detected
[2025-12-27 23:22:16] info: [CSRF] Token generated
[2025-12-27 23:22:16] info: [CSRF] Token generated
[2025-12-27 23:22:16] info: [CSRF] Token generated
PASS __tests__/middleware/csrf.test.mjs
  CSRF Protection Middleware
    getCsrfToken
      ‚àö should generate and return CSRF token (7 ms)
      ‚àö should handle token generation failure (6 ms)
      ‚àö should generate token without user (unauthenticated) (12 ms)
    applyCsrfProtection
      ‚àö should apply CSRF protection to POST requests (1 ms)
      ‚àö should apply CSRF protection to PUT requests (1 ms)
      ‚àö should apply CSRF protection to DELETE requests (2 ms)
      ‚àö should apply CSRF protection to PATCH requests (2 ms)
      ‚àö should skip CSRF protection for GET requests (1 ms)
      ‚àö should skip CSRF protection for HEAD requests (1 ms)
      ‚àö should skip CSRF protection for OPTIONS requests (1 ms)
    csrfErrorHandler
      ‚àö should handle CSRF validation errors (EBADCSRFTOKEN) (3 ms)
      ‚àö should pass non-CSRF errors to next handler (2 ms)
      ‚àö should handle CSRF error without user context (1 ms)
      ‚àö should include security logging context on CSRF error (2 ms)
    Security Scenarios
      ‚àö should protect against missing CSRF token (9 ms)
      ‚àö should protect against invalid CSRF token (2 ms)
      ‚àö should provide user-friendly error message (4 ms)
    Integration with Cookie Configuration
      ‚àö getCsrfToken should work without authentication (2 ms)
      ‚àö should handle concurrent token generation (5 ms)
    HTTP Method Classification
      ‚àö should NOT require CSRF token for GET requests (1 ms)
      ‚àö should NOT require CSRF token for HEAD requests (1 ms)
      ‚àö should NOT require CSRF token for OPTIONS requests (1 ms)
      ‚àö should require CSRF token for POST requests (1 ms)
      ‚àö should require CSRF token for PUT requests (2 ms)
      ‚àö should require CSRF token for DELETE requests
      ‚àö should require CSRF token for PATCH requests

[2025-12-27 23:22:16] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:16] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:16] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/errors/AppError.test.mjs
  Error Classes
    AppError
      ‚àö should create an AppError with default values (3 ms)
      ‚àö should create an AppError with custom values (3 ms)
      ‚àö should set status to "fail" for 4xx status codes (2 ms)
      ‚àö should set status to "error" for 5xx status codes
      ‚àö should capture stack trace (5 ms)
    ValidationError
      ‚àö should create a ValidationError with default values (1 ms)
      ‚àö should create a ValidationError with field and value (1 ms)
      ‚àö should inherit from AppError (2 ms)
    DatabaseError
      ‚àö should create a DatabaseError with default values (1 ms)
      ‚àö should create a DatabaseError with original error (1 ms)
      ‚àö should inherit from AppError (13 ms)
    NotFoundError
      ‚àö should create a NotFoundError with default message (1 ms)
      ‚àö should create a NotFoundError with custom resource (1 ms)
      ‚àö should create a NotFoundError with resource and ID (3 ms)
      ‚àö should inherit from AppError (1 ms)

[2025-12-27 23:22:17] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:17] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:17] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/integration/groomRoutes.test.mjs
  Groom Routes Integration Tests
    ‚àö should pass basic test (3 ms)
    ‚àö should test groom system constants (2 ms)
    ‚àö should validate interaction types (1 ms)
    ‚àö should validate duration ranges (1 ms)
    ‚àö should validate session rate ranges (2 ms)

[2025-12-27 23:22:17] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:17] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:17] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS models/horseModel.test.mjs
  Horse Model At-Birth Traits Integration
    createHorse with at-birth traits
      ‚àö should apply at-birth traits for newborn with parents (6 ms)
      ‚àö should pass custom mare stress and feed quality (2 ms)
      ‚àö should merge at-birth traits with existing traits (3 ms)
      ‚àö should not apply at-birth traits for older horses (2 ms)
      ‚àö should not apply at-birth traits for horses without parents (1 ms)
      ‚àö should continue horse creation even if at-birth trait application fails (2 ms)
      ‚àö should handle missing sire_id gracefully (2 ms)
      ‚àö should handle missing dam_id gracefully (1 ms)
      ‚àö should log breeding analysis information (1 ms)

[2025-12-27 23:22:18] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:18] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:18] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/utils/groomBondingSystem.comprehensive.test.mjs
  ü§ù COMPREHENSIVE: Groom Bonding System & Task Eligibility
    Age-Based Task Eligibility
      ‚àö should return enrichment tasks for newborn foals (0-2 years) (3 ms)
      ‚àö should return appropriate tasks for young foals (1-2 years) (15 ms)
      ‚àö should return grooming tasks for yearlings (1-2 years) (3 ms)
      ‚àö should return general tasks for mature horses (3+ years) (2 ms)
      ‚àö should handle age boundary conditions correctly (3 ms)
    Grooming Eligibility Validation
      ‚àö should validate eligibility for young foal enrichment (2 ms)
      ‚àö should validate eligibility for yearling grooming (1 ms)
      ‚àö should validate eligibility for mature horse general care (1 ms)
      ‚àö should reject inappropriate tasks for age groups (2 ms)
      ‚àö should handle edge cases in age validation (7 ms)
    Bonding Effect Calculations
      ‚àö should calculate bonding effects for grooming tasks (1 ms)
      ‚àö should calculate bonding effects for non-grooming tasks (1 ms)
      ‚àö should handle maximum bonding score scenarios (1 ms)
      ‚àö should handle minimum bonding score scenarios (1 ms)
    Task Categorization
      ‚àö should categorize enrichment tasks correctly (1 ms)
      ‚àö should categorize grooming tasks correctly (1 ms)
      ‚àö should categorize general care tasks correctly (1 ms)
      ‚àö should handle unknown task types (1 ms)
    Age Group Descriptions
      ‚àö should provide correct descriptions for different age groups (1 ms)
      ‚àö should handle boundary ages consistently (2 ms)
    Input Validation and Error Handling
      ‚àö should handle invalid age values gracefully (2 ms)
      ‚àö should handle missing horse data gracefully
      ‚àö should handle invalid bonding calculation data
      ‚àö should handle null and undefined inputs (1 ms)
    System Integration Scenarios
      ‚àö should provide consistent results across related functions (1 ms)
      ‚àö should maintain logical progression through age groups (1 ms)

[2025-12-27 23:22:18] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:18] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:18] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:22:18] warn: [traitEffects.getTraitEffects] No effects defined for trait: nonexistent_trait
[2025-12-27 23:22:18] warn: [traitEffects.getTraitEffects] Invalid trait name: null
[2025-12-27 23:22:18] warn: [traitEffects.getTraitEffects] Invalid trait name: undefined
[2025-12-27 23:22:18] warn: [traitEffects.getTraitEffects] Invalid trait name: 
[2025-12-27 23:22:18] warn: [traitEffects.getTraitEffects] Invalid trait name: 123
[2025-12-27 23:22:18] warn: [traitEffects.getTraitEffects] No effects defined for trait: nonexistent_trait
[2025-12-27 23:22:18] warn: [traitEffects.getCombinedTraitEffects] Invalid trait names array
[2025-12-27 23:22:18] warn: [traitEffects.getTraitEffects] No effects defined for trait: invalid_trait
PASS tests/traitEffects.test.mjs
  üé≠ UNIT: Trait Effects System - Trait Impact Calculation & Combination
    getTraitEffects
      ‚àö should return effects for valid trait (3 ms)
      ‚àö should return null for invalid trait (4 ms)
      ‚àö should return null for invalid input (15 ms)
    hasTraitEffect
      ‚àö should return true for existing effect (1 ms)
      ‚àö should return false for non-existing effect (4 ms)
    getCombinedTraitEffects
      ‚àö should combine multiple trait effects correctly (1 ms)
      ‚àö should handle numeric modifiers additively (3 ms)
      ‚àö should handle boolean effects correctly (2 ms)
      ‚àö should merge object effects correctly (1 ms)
      ‚àö should handle empty array (3 ms)
      ‚àö should handle invalid input (1 ms)
      ‚àö should ignore invalid trait names (2 ms)
    Positive Traits
      ‚àö resilient trait should have correct effects (2 ms)
      ‚àö intelligent trait should have correct effects (1 ms)
      ‚àö athletic trait should have correct effects (1 ms)
    Negative Traits
      ‚àö nervous trait should have correct penalties (10 ms)
      ‚àö lazy trait should have correct penalties (2 ms)
      ‚àö burnout trait should have severe penalties (1 ms)
    Rare Traits
      ‚àö legendary_bloodline trait should have powerful effects (2 ms)
    Discipline-Specific Modifiers
      ‚àö should have appropriate discipline bonuses for positive traits (1 ms)
      ‚àö should have appropriate discipline penalties for negative traits (2 ms)
    getAllTraitEffects
      ‚àö should return complete trait effects mapping (3 ms)
      ‚àö should include all expected trait categories (1 ms)

[2025-12-27 23:22:19] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:19] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:19] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS __tests__/unit/clusterManager.test.mjs
  clusterManager
    ‚àö disables clustering by default in test env (3 ms)
    ‚àö enables clustering when explicitly enabled (2 ms)
    ‚àö uses WEB_CONCURRENCY when set (1 ms)
    ‚àö defaults to CPU count when WEB_CONCURRENCY is not set (1 ms)
    ‚àö clamps invalid worker counts to 1 (1 ms)

[2025-12-27 23:22:19] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:19] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:19] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/horseConformation.test.mjs
  üêé UNIT: Horse Conformation Scoring System
    Default Conformation Scores
      ‚àö should create horse with default conformation scores of 20 (6 ms)
      ‚àö should have all required conformation regions (5 ms)
    Conformation Score Validation
      ‚àö should validate conformation scores are within 1-100 range (4 ms)
      ‚àö should validate all conformation regions are present (1 ms)
    Conformation Score Updates
      ‚àö should update individual conformation scores
      ‚àö should handle bulk conformation updates
    Error Handling
      ‚àö should reject invalid conformation scores (9 ms)
      ‚àö should reject invalid conformation regions (1 ms)

[2025-12-27 23:22:19] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:19] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:19] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/applyEpigeneticTraitsAtBirthUnit.test.mjs
  üß¨ UNIT: Apply Epigenetic Traits At Birth Unit - Pure Logic Validation
    Low-stress mare with premium feed ‚Üí positive traits
      ‚àö should assign resilient trait when mare has low stress and premium feed (14 ms)
      ‚àö should assign peopleTrusting trait when mare has low stress and premium feed (3 ms)
      ‚àö should assign both positive traits with optimal conditions (1 ms)
      ‚àö should not assign positive traits when stress is too high (2 ms)
      ‚àö should not assign positive traits when feed quality is too low (2 ms)
    Inbreeding (repeated ancestor IDs) ‚Üí negative traits
      ‚àö should assign fragile trait with high inbreeding (4+ repeated ancestors) (2 ms)
      ‚àö should assign reactive trait with moderate inbreeding (3 repeated ancestors) (1 ms)
      ‚àö should assign low_immunity trait with inbreeding (1 ms)
      ‚àö should assign multiple negative traits with severe inbreeding (2 ms)
      ‚àö should not assign inbreeding traits without repeated ancestor IDs (2 ms)
    3+ ancestors with same mostCompetedDiscipline ‚Üí affinity + legacy_talent
      ‚àö should assign discipline_affinity_racing with 3+ racing ancestors (2 ms)
      ‚àö should assign legacy_talent with 4+ ancestors in same discipline (1 ms)
      ‚àö should assign discipline_affinity_dressage with dressage specialization (1 ms)
      ‚àö should not assign discipline traits without sufficient specialization (7 ms)
      ‚àö should handle ancestors without mostCompetedDiscipline field (3 ms)
    Random behavior consistency
      ‚àö should produce consistent results with mocked randomness (2 ms)
      ‚àö should not assign traits when random values are above thresholds (1 ms)

[2025-12-27 23:22:20] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:20] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:20] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:22:20] info: [personalityEvolutionSystem.evolveGroomPersonality] Starting evolution analysis for groom 46941
[2025-12-27 23:22:20] info: [personalityEvolutionSystem.applyPersonalityEvolutionEffects] Applying effects for groom 46941
[2025-12-27 23:22:20] info: [personalityEvolutionSystem.evolveGroomPersonality] Starting evolution analysis for groom 46942
[2025-12-27 23:22:20] info: [personalityEvolutionSystem.calculatePersonalityEvolutionTriggers] Analyzing triggers for groom 46941
[2025-12-27 23:22:20] info: [personalityEvolutionSystem.evolveHorseTemperament] Starting evolution analysis for horse 94724
[2025-12-27 23:22:20] info: [personalityEvolutionSystem.applyPersonalityEvolutionEffects] Applying effects for horse 94724
[2025-12-27 23:22:20] info: [personalityEvolutionSystem.evolveHorseTemperament] Starting evolution analysis for horse 94725
[2025-12-27 23:22:20] info: [personalityEvolutionSystem.analyzePersonalityStability] Analyzing stability for horse 94724
[2025-12-27 23:22:20] info: [personalityEvolutionSystem.predictPersonalityEvolution] Predicting evolution for groom 46941 over 30 days
[2025-12-27 23:22:20] info: [personalityEvolutionSystem.getPersonalityEvolutionHistory] Getting history for groom 46941
[2025-12-27 23:22:20] info: [personalityEvolutionSystem.applyPersonalityEvolutionEffects] Applying effects for groom 46941
[2025-12-27 23:22:20] info: [personalityEvolutionSystem.analyzePersonalityStability] Analyzing stability for horse 94724
PASS tests/services/personalityEvolutionSystem.test.mjs
  Personality Evolution System
    Groom Personality Evolution
      ‚àö should evolve groom personality based on interaction patterns (65 ms)
      ‚àö should not evolve personality with insufficient interaction data (37 ms)
      ‚àö should calculate personality evolution triggers accurately (12 ms)
    Horse Temperament Evolution
      ‚àö should evolve horse temperament based on care history (56 ms)
      ‚àö should maintain temperament stability with mixed care patterns (44 ms)
      ‚àö should analyze personality stability accurately (7 ms)
    Personality Evolution Prediction
      ‚àö should predict future personality evolution accurately (5 ms)
      ‚àö should get personality evolution history (3 ms)
      ‚àö should apply personality evolution effects correctly (3 ms)
    Cross-Species Personality Influence
      ‚àö should detect personality convergence between groom and horse (77 ms)

[2025-12-27 23:22:21] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:21] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:21] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/constants/schema.test.mjs
  üèá UNIT: Schema Constants Validation
    Horse Sex Constants
      ‚àö should have all required horse sex values (4 ms)
      ‚àö should validate horse sex correctly (11 ms)
      ‚àö should have consistent values array (1 ms)
    Horse Temperament Constants
      ‚àö should have all required temperament values
      ‚àö should validate temperament correctly
    Competition Disciplines
      ‚àö should have all major disciplines
      ‚àö should validate disciplines correctly (1 ms)
      ‚àö should have comprehensive discipline list (3 ms)
    Groom Constants
      ‚àö should have all groom specialties (1 ms)
      ‚àö should validate groom specialties correctly (1 ms)
      ‚àö should have all skill levels (1 ms)
      ‚àö should validate skill levels correctly (2 ms)
    Age Validation
      ‚àö should validate training age correctly (1 ms)
      ‚àö should validate competition age correctly (1 ms)
      ‚àö should validate breeding age correctly (1 ms)
    Score Validation
      ‚àö should validate competition scores correctly (2 ms)
      ‚àö should validate discipline scores correctly (2 ms)
    User Progression Calculations
      ‚àö should calculate XP for levels correctly (8 ms)
      ‚àö should calculate level from XP correctly (1 ms)
      ‚àö should have consistent XP progression
    Horse Stats Validation
      ‚àö should have all required horse stats defined (1 ms)
      ‚àö should validate horse stats correctly (2 ms)
      ‚àö should have consistent stat object and array values (2 ms)
    Constant Integrity
      ‚àö should have no duplicate values in arrays
      ‚àö should have consistent object and array values (1 ms)

[2025-12-27 23:22:21] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:21] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:21] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/epigeneticTraits.test.mjs
  üß¨ UNIT: Epigenetic Traits System - Breeding & Environmental Trait Calculation
    Input Validation
      ‚àö should throw error for missing required parameters (8 ms)
      ‚àö should throw error for invalid trait arrays (1 ms)
      ‚àö should throw error for invalid bond scores (1 ms)
      ‚àö should throw error for out-of-range values (1 ms)
      ‚àö should accept valid input without throwing (2 ms)
    Basic Trait Inheritance
      ‚àö should inherit positive traits from both parents (2 ms)
      ‚àö should have chance to inherit each parent trait (2 ms)
      ‚àö should not inherit negative traits from positive parent traits (1 ms)
    Bonding Score Effects
      ‚àö should increase positive trait probability with high bonding (3 ms)
      ‚àö should reduce negative trait probability with high bonding (2 ms)
    Stress Level Effects
      ‚àö should increase negative trait probability with high stress (8 ms)
      ‚àö should reduce positive trait expression with high stress (3 ms)
    Hidden Trait Generation
      ‚àö should generate hidden traits based on environmental factors (1 ms)
      ‚àö should include rare traits in hidden category (2 ms)
    Complex Breeding Scenarios
      ‚àö should handle mixed positive and negative parent traits (1 ms)
      ‚àö should handle parents with no traits (1 ms)
      ‚àö should handle optimal breeding conditions (2 ms)
      ‚àö should handle poor breeding conditions (1 ms)
    Trait Consistency
      ‚àö should not generate contradictory traits (7 ms)
      ‚àö should maintain trait type consistency
    Deterministic Behavior
      ‚àö should produce consistent results with same seed (8 ms)
      ‚àö should produce different results without seed

[2025-12-27 23:22:22] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:22] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:22] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/horseXpSystem.test.mjs
  Horse XP System - Core Business Logic
    addXpToHorse
      ‚àö should add XP to horse and calculate available stat points correctly (6 ms)
      ‚àö should handle multiple stat points correctly (200+ XP) (2 ms)
      ‚àö should preserve existing stat points when adding XP (9 ms)
      ‚àö should handle validation errors properly (2 ms)
      ‚àö should handle horse not found error (1 ms)
    allocateStatPoint
      ‚àö should allocate stat point and decrease available points (2 ms)
      ‚àö should reject allocation when no stat points available (2 ms)
      ‚àö should validate stat names properly (2 ms)
      ‚àö should handle all valid stat names (2 ms)
    getHorseXpHistory
      ‚àö should retrieve horse XP events with proper filtering (2 ms)
  Horse XP System - Integration with Competition System
    Competition XP Awards
      ‚àö should award horse XP based on competition performance (1 ms)

[2025-12-27 23:22:22] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:22] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:22] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS __tests__/unit/security/session-management.test.mjs
  sessionManagement middleware
    sessionTimeout
      ‚àö allows when no session (4 ms)
      ‚àö blocks expired session (4 ms)
      ‚àö refreshes active session (2 ms)
    sessionConcurrencyLimit
      ‚àö allows when no limit set (1 ms)
      ‚àö blocks when concurrency exceeded (15 ms)
    sessionCleanup
      ‚àö removes expired sessions and continues (2 ms)

[2025-12-27 23:22:23] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:23] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:23] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/taskTraitInfluence.integration.test.mjs
  Task-Trait Influence Integration
    System Integration Validation
      ‚àö should have complete coverage of foal tasks (3 ms)
      ‚àö should provide logical trait development progression (1 ms)
    Trait Point Accumulation Scenarios
      ‚àö should calculate trait points for early foal development (0-1 years) (3 ms)
      ‚àö should calculate trait points for middle development (1-2 years) (1 ms)
      ‚àö should calculate trait points for advanced development (2-3 years)
    Real-World Development Scenarios
      ‚àö should support comprehensive foal development progression (2 ms)
      ‚àö should handle specialized development paths (1 ms)
    Trait Influence Analysis
      ‚àö should identify tasks that develop specific traits (2 ms)
      ‚àö should provide complete trait coverage (1 ms)
    Business Rule Validation
      ‚àö should enforce consistent daily values across all tasks (1 ms)
      ‚àö should support meaningful trait point accumulation (1 ms)
      ‚àö should provide balanced trait development opportunities (7 ms)
    Development Stage Integration
      ‚àö should align with foal development stages (1 ms)
      ‚àö should support age-appropriate task progression

[2025-12-27 23:22:23] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:23] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:23] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/traitMetadataValidation.test.mjs
  Trait Metadata Validation
    Required Trait Structure
      ‚àö should have complete metadata for confident (12 ms)
      ‚àö should have complete metadata for resilient (1 ms)
      ‚àö should have complete metadata for presentationBoosted (1 ms)
      ‚àö should have complete metadata for bonded (1 ms)
      ‚àö should have complete metadata for fearful (2 ms)
      ‚àö should have complete metadata for easilyOverwhelmed (1 ms)
    Trait Categories
      ‚àö should have epigenetic traits (1 ms)
      ‚àö should have bond traits (1 ms)
      ‚àö should have situational traits (1 ms)
      ‚àö should categorize all traits correctly (1 ms)
    Trait Descriptions
      ‚àö should have proper description format for confident trait (2 ms)
      ‚àö should have proper description format for resilient trait (1 ms)
      ‚àö should have proper description format for presentationBoosted trait (1 ms)
      ‚àö should have proper description format for bonded trait (1 ms)
      ‚àö should have proper description format for fearful trait
      ‚àö should have proper description format for easilyOverwhelmed trait (6 ms)
      ‚àö should have descriptions for all traits (5 ms)
    Trait Conflicts
      ‚àö should have bidirectional conflicts (5 ms)
      ‚àö should validate specific conflict relationships (2 ms)
      ‚àö should not have self-conflicts (4 ms)
    Task Influence Map Integration
      ‚àö should have all traits referenced in task influence map (2 ms)
      ‚àö should validate specific task-trait mappings (1 ms)
      ‚àö should have valid daily values for all tasks (3 ms)
    Trait Type Distribution
      ‚àö should have balanced positive and negative traits (1 ms)
      ‚àö should have appropriate rarity distribution (1 ms)
    Foal Development Integration
      ‚àö should support foal milestone evaluation traits (1 ms)
      ‚àö should support presentation and show traits (1 ms)
    Error Handling
      ‚àö should handle invalid trait names gracefully
      ‚àö should handle empty category queries (2 ms)

[2025-12-27 23:22:24] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:24] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:24] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/competitionController.test.mjs
  üèÜ PURE ALGORITHMIC: Competition Controller Helper Functions
    detectTraitBonuses
      ‚àö should detect discipline affinity trait bonuses correctly (3 ms)
      ‚àö should return no bonus for horses without matching traits (1 ms)
      ‚àö should handle horses with no epigenetic modifiers (1 ms)
      ‚àö should handle discipline names with spaces correctly (1 ms)
      ‚àö should be case insensitive for discipline matching (1 ms)

[2025-12-27 23:22:24] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:24] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:24] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/applyEpigeneticTraitsAtBirth.test.mjs
  üß¨ UNIT: Apply Epigenetic Traits At Birth - Breeding Condition Analysis
    Input Validation
      ‚àö should throw error when mare is not provided (8 ms)
      ‚àö should handle missing optional parameters (2 ms)
    Low Stress and Premium Feed Conditions
      ‚àö should assign resilient trait with low stress and premium feed (11 ms)
      ‚àö should assign peopleTrusting trait with low stress and premium feed (1 ms)
      ‚àö should not assign positive traits with high stress (1 ms)
      ‚àö should not assign positive traits with poor feed quality (2 ms)
    Inbreeding Detection and Negative Traits
      ‚àö should assign fragile trait with high inbreeding (2 ms)
      ‚àö should assign reactive trait with moderate inbreeding (1 ms)
      ‚àö should assign low_immunity trait with inbreeding (1 ms)
      ‚àö should not assign inbreeding traits without common ancestors (2 ms)
    Discipline Specialization
      ‚àö should assign discipline affinity trait with 3+ ancestors in same discipline (2 ms)
      ‚àö should assign legacy_talent trait with 4+ ancestors in same discipline (1 ms)
      ‚àö should use disciplineScores when discipline field is not available (1 ms)
      ‚àö should not assign discipline traits without sufficient specialization (2 ms)
    Additional Stress and Nutrition Effects
      ‚àö should assign nervous trait with very high mare stress (2 ms)
      ‚àö should assign low_immunity trait with poor nutrition (7 ms)
      ‚àö should not duplicate traits (1 ms)
    Return Value Structure
      ‚àö should return object with positive and negative arrays (1 ms)
      ‚àö should handle empty lineage gracefully (1 ms)
      ‚àö should handle null lineage gracefully (3 ms)

[2025-12-27 23:22:24] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:24] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:24] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/integration/xpLogging.test.mjs
  üìä INTEGRATION: XP Logging Integration - Experience Point Workflow
    Training XP Logging
      ‚àö should log XP event when training is successful (13 ms)
      ‚àö should log XP event with trait-modified amount (2 ms)
      ‚àö should continue training even if XP logging fails (2 ms)
      ‚àö should not log XP event if training fails (1 ms)
    Competition XP Logging
      ‚àö should log XP events for competition placements (1 ms)
      ‚àö should log different XP amounts for different placements (1 ms)

[2025-12-27 23:22:25] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:25] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:25] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/services/traitInteractionMatrix.test.mjs
  Trait Interaction Matrix
    analyzeTraitInteractions
      ‚àö should analyze trait interactions for synergistic traits (8 ms)
      ‚àö should analyze trait interactions for conflicting traits (5 ms)
      ‚àö should handle horses with minimal traits (4 ms)
    calculateTraitSynergies
      ‚àö should calculate synergies for compatible traits (4 ms)
      ‚àö should calculate amplification effects correctly (5 ms)
      ‚àö should categorize synergies by type (3 ms)
    identifyTraitConflicts
      ‚àö should identify conflicts between opposing traits (8 ms)
      ‚àö should calculate suppression effects (3 ms)
      ‚àö should handle horses with no conflicts (5 ms)
    evaluateTraitDominance
      ‚àö should evaluate trait dominance hierarchy (4 ms)
      ‚àö should identify primary and secondary traits correctly (3 ms)
    processComplexInteractions
      ‚àö should process complex multi-trait interactions (2 ms)
      ‚àö should identify emergent properties from trait combinations (4 ms)
      ‚àö should calculate complexity scores appropriately (4 ms)
    assessInteractionStability
      ‚àö should assess stability of trait interactions (5 ms)
      ‚àö should identify volatility risks in conflicting traits (4 ms)
    modelTemporalInteractions
      ‚àö should model trait interactions over time (4 ms)
      ‚àö should project future interaction changes (3 ms)
    generateInteractionMatrix
      ‚àö should generate comprehensive interaction matrix (8 ms)
      ‚àö should create matrix visualization data (11 ms)

[2025-12-27 23:22:25] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:25] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:25] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/generateMockShows.test.mjs
  üé™ UNIT: Generate Mock Shows - Competition Data Generation Utilities
    generateMockShows
      ‚àö should generate the correct number of shows (3 ms)
      ‚àö should generate default 10 shows when no count provided (2 ms)
      ‚àö should generate 0 shows when count is 0
      ‚àö should throw error for negative count (5 ms)
      ‚àö should throw error for non-number count (8 ms)
      ‚àö should generate shows with all required properties (3 ms)
      ‚àö should generate unique sequential IDs (2 ms)
      ‚àö should use only valid disciplines (2 ms)
      ‚àö should generate realistic show names (4 ms)
      ‚àö should respect level constraints (11 ms)
      ‚àö should respect entry fee range (100-500) (4 ms)
      ‚àö should respect prize range (500-2000) (3 ms)
      ‚àö should generate run dates within ¬±30 days of today (8 ms)
      ‚àö should generate variety in disciplines across multiple shows (2 ms)
      ‚àö should generate variety in show names (1 ms)
    generateSingleMockShow
      ‚àö should generate a single show with default properties (1 ms)
      ‚àö should allow overriding specific properties (1 ms)
      ‚àö should maintain constraints for non-overridden properties (1 ms)
    Integration with statMap
      ‚àö should only use disciplines that exist in statMap (2 ms)
      ‚àö should eventually use most available disciplines with enough shows (2 ms)

[2025-12-27 23:22:26] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:26] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:26] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/horseModel.test.mjs
  üêé UNIT: Horse Model - Discipline Score Management
    updateDisciplineScore
      ‚àö should update discipline score for existing horse (6 ms)
      ‚àö should add to existing discipline score (1 ms)
      ‚àö should handle multiple disciplines independently (3 ms)
      ‚àö should throw error for invalid horse ID (4 ms)
      ‚àö should throw error for non-existent horse (2 ms)
      ‚àö should throw error for invalid discipline (2 ms)
      ‚àö should throw error for invalid points (11 ms)
    getDisciplineScores
      ‚àö should return empty object for horse with no scores (2 ms)
      ‚àö should return discipline scores for horse with scores (1 ms)
      ‚àö should throw error for invalid horse ID (2 ms)
      ‚àö should throw error for non-existent horse (1 ms)

[2025-12-27 23:22:26] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:26] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:26] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:22:26] error: ‚ùå Environment validation failed:
[2025-12-27 23:22:26] error:   - Missing required environment variable: DATABASE_URL
[2025-12-27 23:22:26] error:   - Missing required environment variable: JWT_SECRET
[2025-12-27 23:22:26] error:   - NODE_ENV must be one of: development, production, test (current: invalid)
[2025-12-27 23:22:26] error:   - PORT must be a number (current: abc)
[2025-12-27 23:22:26] error: 
Please fix the above errors in your .env file and restart.
[2025-12-27 23:22:26] info: ‚úÖ Environment validation passed
[2025-12-27 23:22:26] warn: [validateEnvironment] SECURITY WARNING: ALLOWED_ORIGINS contains HTTP URLs in production
[2025-12-27 23:22:26] warn:   HTTP origins detected: http://example.com
[2025-12-27 23:22:26] warn:   These should be HTTPS in production to prevent man-in-the-middle attacks
[2025-12-27 23:22:26] warn: [validateEnvironment] SECURITY WARNING: PORT is set to 80 (HTTP) in production
[2025-12-27 23:22:26] warn:   Consider using HTTPS (443) or a reverse proxy with HTTPS termination
[2025-12-27 23:22:26] error: ‚ùå Environment validation failed:
[2025-12-27 23:22:26] error:   - JWT_SECRET must be at least 32 characters (current: 17)
[2025-12-27 23:22:26] error:   - JWT_SECRET appears to be a placeholder value. Please generate a real secret.
[2025-12-27 23:22:26] error:   - DATABASE_URL contains a weak password. Please use a strong password.
[2025-12-27 23:22:26] error: 
Please fix the above errors in your .env file and restart.
[2025-12-27 23:22:26] info: ‚úÖ Environment validation passed
[2025-12-27 23:22:26] info: ‚úÖ Environment validation passed
PASS __tests__/unit/security/validate-environment.test.mjs
  validateEnvironment
    ‚àö throws when required envs are missing or invalid (10 ms)
    ‚àö warns about weak JWT secrets and HTTP origins in production (17 ms)
    ‚àö passes for valid configuration (2 ms)

[2025-12-27 23:22:27] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:27] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:27] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/horseHistory.test.mjs
  üìö UNIT: Horse History Controller - Competition History Retrieval
    getHorseHistory
      ‚àö should return horse competition history successfully (5 ms)
      ‚àö should return empty array when horse has no competition history (1 ms)
      ‚àö should handle invalid horse ID (non-numeric) (2 ms)
      ‚àö should handle invalid horse ID (negative number) (1 ms)
      ‚àö should handle invalid horse ID (zero) (2 ms)
      ‚àö should handle database errors gracefully (2 ms)
      ‚àö should properly parse stat gains JSON (1 ms)
      ‚àö should handle malformed stat gains JSON gracefully (1 ms)
      ‚àö should handle large horse ID numbers (1 ms)
      ‚àö should maintain order from database query (newest first) (9 ms)

[2025-12-27 23:22:27] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:27] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:27] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

[2025-12-27 23:22:27] info: [horseModel.hasTrait] Checking if horse invalid has trait 'trait'
[2025-12-27 23:22:27] error: [horseModel.hasTrait] Error checking trait: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.hasTrait] Checking if horse -1 has trait 'trait'
[2025-12-27 23:22:27] error: [horseModel.hasTrait] Error checking trait: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.hasTrait] Checking if horse 0 has trait 'trait'
[2025-12-27 23:22:27] error: [horseModel.hasTrait] Error checking trait: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.hasTrait] Checking if horse null has trait 'trait'
[2025-12-27 23:22:27] error: [horseModel.hasTrait] Error checking trait: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.hasTrait] Checking if horse 1 has trait ''
[2025-12-27 23:22:27] error: [horseModel.hasTrait] Error checking trait: Trait name must be a non-empty string
[2025-12-27 23:22:27] info: [horseModel.hasTrait] Checking if horse 1 has trait 'null'
[2025-12-27 23:22:27] error: [horseModel.hasTrait] Error checking trait: Trait name must be a non-empty string
[2025-12-27 23:22:27] info: [horseModel.hasTrait] Checking if horse 1 has trait 'undefined'
[2025-12-27 23:22:27] error: [horseModel.hasTrait] Error checking trait: Trait name must be a non-empty string
[2025-12-27 23:22:27] info: [horseModel.hasTrait] Checking if horse 1 has trait '123'
[2025-12-27 23:22:27] error: [horseModel.hasTrait] Error checking trait: Trait name must be a non-empty string
[2025-12-27 23:22:27] info: [horseModel.getPositiveTraitsArray] Getting positive traits for horse invalid
[2025-12-27 23:22:27] error: [horseModel.getPositiveTraitsArray] Error getting positive traits: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.getPositiveTraitsArray] Getting positive traits for horse -1
[2025-12-27 23:22:27] error: [horseModel.getPositiveTraitsArray] Error getting positive traits: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.getPositiveTraitsArray] Getting positive traits for horse 0
[2025-12-27 23:22:27] error: [horseModel.getPositiveTraitsArray] Error getting positive traits: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.getNegativeTraitsArray] Getting negative traits for horse invalid
[2025-12-27 23:22:27] error: [horseModel.getNegativeTraitsArray] Error getting negative traits: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.getNegativeTraitsArray] Getting negative traits for horse -1
[2025-12-27 23:22:27] error: [horseModel.getNegativeTraitsArray] Error getting negative traits: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.getNegativeTraitsArray] Getting negative traits for horse 0
[2025-12-27 23:22:27] error: [horseModel.getNegativeTraitsArray] Error getting negative traits: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.addTrait] Adding trait 'trait' to category 'positive' for horse invalid
[2025-12-27 23:22:27] error: [horseModel.addTrait] Error adding trait: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.addTrait] Adding trait 'trait' to category 'positive' for horse -1
[2025-12-27 23:22:27] error: [horseModel.addTrait] Error adding trait: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.addTrait] Adding trait 'trait' to category 'positive' for horse 0
[2025-12-27 23:22:27] error: [horseModel.addTrait] Error adding trait: Invalid horse ID provided
[2025-12-27 23:22:27] info: [horseModel.addTrait] Adding trait '' to category 'positive' for horse 1
[2025-12-27 23:22:27] error: [horseModel.addTrait] Error adding trait: Trait name must be a non-empty string
[2025-12-27 23:22:27] info: [horseModel.addTrait] Adding trait 'null' to category 'positive' for horse 1
[2025-12-27 23:22:27] error: [horseModel.addTrait] Error adding trait: Trait name must be a non-empty string
[2025-12-27 23:22:27] info: [horseModel.addTrait] Adding trait '123' to category 'positive' for horse 1
[2025-12-27 23:22:27] error: [horseModel.addTrait] Error adding trait: Trait name must be a non-empty string
[2025-12-27 23:22:27] info: [horseModel.addTrait] Adding trait 'trait' to category 'invalid' for horse 1
[2025-12-27 23:22:27] error: [horseModel.addTrait] Error adding trait: Invalid category 'invalid'. Must be one of: positive, negative
[2025-12-27 23:22:27] info: [horseModel.addTrait] Adding trait 'trait' to category 'hidden' for horse 1
[2025-12-27 23:22:27] error: [horseModel.addTrait] Error adding trait: Invalid category 'hidden'. Must be one of: positive, negative
[2025-12-27 23:22:27] info: [horseModel.addTrait] Adding trait 'trait' to category '' for horse 1
[2025-12-27 23:22:27] error: [horseModel.addTrait] Error adding trait: Invalid category ''. Must be one of: positive, negative
[2025-12-27 23:22:27] info: [horseModel.hasTrait] Checking if horse 999999 has trait 'trait'
[2025-12-27 23:22:27] error: [horseModel.hasTrait] Error checking trait: Horse with ID 999999 not found
[2025-12-27 23:22:27] info: [horseModel.getPositiveTraitsArray] Getting positive traits for horse 999999
[2025-12-27 23:22:27] error: [horseModel.getPositiveTraitsArray] Error getting positive traits: Horse with ID 999999 not found
[2025-12-27 23:22:27] info: [horseModel.getNegativeTraitsArray] Getting negative traits for horse 999999
[2025-12-27 23:22:27] error: [horseModel.getNegativeTraitsArray] Error getting negative traits: Horse with ID 999999 not found
[2025-12-27 23:22:27] info: [horseModel.hasTrait] Checking if horse 999999 has trait 'trait'
[2025-12-27 23:22:27] error: [horseModel.hasTrait] Error checking trait: Horse with ID 999999 not found
[2025-12-27 23:22:27] info: [horseModel.getPositiveTraitsArray] Getting positive traits for horse 999999
[2025-12-27 23:22:27] error: [horseModel.getPositiveTraitsArray] Error getting positive traits: Horse with ID 999999 not found
[2025-12-27 23:22:27] info: [horseModel.getNegativeTraitsArray] Getting negative traits for horse 999999
[2025-12-27 23:22:27] error: [horseModel.getNegativeTraitsArray] Error getting negative traits: Horse with ID 999999 not found
PASS tests/horseModelTask7.test.mjs
  üê¥ UNIT: Horse Model Task 7 - Instance-Style Helper Methods Validation
    API Validation Tests (without database)
      ‚àö should validate hasTrait function signature (3 ms)
      ‚àö should validate getPositiveTraitsArray function signature (12 ms)
      ‚àö should validate getNegativeTraitsArray function signature
      ‚àö should validate addTrait function signature
      ‚àö should validate createHorse still works with epigenetic_modifiers (1 ms)
    Input Validation Tests
      ‚àö should reject invalid horse IDs in hasTrait (14 ms)
      ‚àö should reject invalid trait names in hasTrait (13 ms)
      ‚àö should reject invalid horse IDs in getPositiveTraitsArray (6 ms)
      ‚àö should reject invalid horse IDs in getNegativeTraitsArray (7 ms)
      ‚àö should reject invalid inputs in addTrait (19 ms)
    Function Behavior Tests
      ‚àö should handle non-existent horse IDs gracefully (68 ms)
      ‚àö should validate that functions return correct types (20 ms)
    Integration with Existing System
      ‚àö should verify epigenetic_modifiers default structure is supported (2 ms)
      ‚àö should verify trait categories are properly defined
    TASK 7 Requirements Verification
      ‚àö should verify all requested helper methods exist (1 ms)
      ‚àö should verify method signatures match requirements (1 ms)
      ‚àö should verify epigenetic_modifiers field structure (1 ms)

[2025-12-27 23:22:27] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:27] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:27] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/integration/user.test.mjs
  User Integration Tests - Mocked Database
    User Retrieval from Seeded Data
      ‚àö should retrieve the seeded user by ID (4 ms)
      ‚àö should retrieve the seeded user by email (1 ms)
      ‚àö should return null for non-existent user (1 ms)
    User with Horses Relationship
      ‚àö should retrieve user with their 2 horses (3 ms)
      ‚àö should include breed information for horses (1 ms)
    JSON Settings Field
      ‚àö should confirm JSON settings field exists and includes darkMode = true (1 ms)
    Database Constraints
      ‚àö should confirm unique email constraint (1 ms)

[2025-12-27 23:22:28] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:28] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:28] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/disciplineAffinityBonusTask9.test.mjs
  üèÜ UNIT: Discipline Affinity Trait Bonus - Competition Score Enhancement
    Discipline Affinity Trait Matching
      ‚àö should apply +5 bonus for discipline_affinity_racing trait in Racing competition (4 ms)
      ‚àö should apply +5 bonus for discipline_affinity_show_jumping trait in Show Jumping competition (1 ms)
      ‚àö should apply +5 bonus for discipline_affinity_dressage trait in Dressage competition (1 ms)
      ‚àö should apply +5 bonus for discipline_affinity_cross_country trait in Cross Country competition (1 ms)
    Discipline Affinity Trait Non-Matching
      ‚àö should NOT apply bonus for discipline_affinity_racing trait in Dressage competition (2 ms)
      ‚àö should NOT apply bonus for discipline_affinity_show_jumping trait in Racing competition (1 ms)
    Multiple Discipline Affinity Traits
      ‚àö should only apply one +5 bonus even with multiple discipline affinity traits (1 ms)
    Discipline Name Conversion
      ‚àö should correctly convert "Show Jumping" to "discipline_affinity_show_jumping" (1 ms)
      ‚àö should correctly convert "Cross Country" to "discipline_affinity_cross_country" (1 ms)
    Integration with Existing Trait System
      ‚àö should apply discipline affinity bonus in addition to existing trait effects (1 ms)
    Edge Cases and Error Handling
      ‚àö should handle horses without epigeneticModifiers gracefully (2 ms)
      ‚àö should handle horses with null epigeneticModifiers gracefully (1 ms)
      ‚àö should handle horses with undefined positive traits gracefully (9 ms)

[2025-12-27 23:22:28] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:28] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:28] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/foalEnrichment.test.mjs
  üê¥ PURE ALGORITHMIC: Foal Enrichment Helper Functions
    calculateActivityOutcome
      ‚àö should calculate activity outcome within specified ranges (16 ms)
      ‚àö should classify outcome as excellent for high bonding and low stress (1 ms)
      ‚àö should classify outcome as challenging for low bonding or high stress (1 ms)
      ‚àö should classify outcome as success for moderate bonding and stress (2 ms)
    calculateBoundedScore
      ‚àö should enforce minimum bound of 0 (1 ms)
      ‚àö should enforce maximum bound of 100 (1 ms)
      ‚àö should return correct values within bounds (1 ms)
      ‚àö should handle edge cases at boundaries (1 ms)
    applyDefaultScores
      ‚àö should use default values for null inputs (1 ms)
      ‚àö should preserve non-null values (1 ms)
      ‚àö should handle mixed null and non-null values (7 ms)
      ‚àö should handle zero values correctly (not treat as null)

[2025-12-27 23:22:29] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:29] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:29] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS __tests__/utils/validateEnvironment.test.mjs
  validateEnvironment()
    Required variables validation
      ‚àö should pass with all required variables present (4 ms)
      ‚àö should fail when DATABASE_URL is missing (2 ms)
      ‚àö should fail when JWT_SECRET is missing (2 ms)
      ‚àö should fail when NODE_ENV is missing (10 ms)
      ‚àö should fail when PORT is missing (2 ms)
    Minimum length validation
      ‚àö should fail when DATABASE_URL is too short (<20 chars) (1 ms)
      ‚àö should fail when JWT_SECRET is too short (<32 chars) (2 ms)
      ‚àö should pass when JWT_SECRET is exactly 32 characters (2 ms)
    Allowed values validation
      ‚àö should pass when NODE_ENV is "development" (1 ms)
      ‚àö should pass when NODE_ENV is "production" (1 ms)
      ‚àö should pass when NODE_ENV is "test" (1 ms)
      ‚àö should fail when NODE_ENV is invalid (2 ms)
    Type validation
      ‚àö should pass when PORT is a valid number (1 ms)
      ‚àö should fail when PORT is not a number (1 ms)
    JWT_SECRET strength validation
      ‚àö should reject placeholder "your-super-secret" (1 ms)
      ‚àö should reject placeholder "change-this" (2 ms)
      ‚àö should reject placeholder "REPLACE_WITH" (2 ms)
      ‚àö should reject placeholder "example" (9 ms)
      ‚àö should warn when JWT_SECRET lacks character variety (line 72) (1 ms)
    DATABASE_URL format validation
      ‚àö should pass with postgresql:// prefix (2 ms)
      ‚àö should pass with postgres:// prefix (1 ms)
      ‚àö should fail without postgresql prefix (2 ms)
      ‚àö should reject weak password "password" (1 ms)
      ‚àö should reject weak password "admin" (1 ms)
      ‚àö should reject weak password "123456" (2 ms)
      ‚àö should reject weak password "postgres" (2 ms)
    Production HTTPS warnings
      ‚àö should warn about HTTP origins in production (1 ms)
      ‚àö should NOT warn about HTTPS origins in production (2 ms)
      ‚àö should warn about PORT 80 in production (2 ms)
      ‚àö should NOT warn about PORT 443 in production (2 ms)
    Multiple errors
      ‚àö should report all validation errors at once (1 ms)

[2025-12-27 23:22:29] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:29] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:29] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:22:29] error: Error Test error
[2025-12-27 23:22:29] error: Error Generic error
[2025-12-27 23:22:29] error: Error Unique constraint failed
[2025-12-27 23:22:29] error: Error Record not found
[2025-12-27 23:22:29] error: Error Test error
[2025-12-27 23:22:29] error: Error Test error
[2025-12-27 23:22:29] error: Error Test error
PASS tests/middleware/errorHandler.test.mjs
  Error Handler Middleware
    ‚àö should handle AppError correctly (8 ms)
    ‚àö should handle generic errors with 500 status (2 ms)
    ‚àö should handle Prisma P2002 error (duplicate) (2 ms)
    ‚àö should handle Prisma P2025 error (not found) (12 ms)
    ‚àö should include stack trace in development mode (2 ms)
    ‚àö should not include stack trace in production mode (2 ms)
    ‚àö should handle errors without throwing (2 ms)

[2025-12-27 23:22:29] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:29] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:29] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/groomBondingSystem.test.mjs
  Groom Bonding & Burnout Prevention System
    Bond Score Mechanics
      ‚àö should start horses with bond score of 0 (3 ms)
      ‚àö should increase bond score by +2 for eligible grooming tasks (2 ms)
      ‚àö should cap bond score at maximum of 100 (2 ms)
      ‚àö should not increase bond score beyond 100 (1 ms)
    Eligible Grooming Tasks
      ‚àö should recognize brushing as eligible task (2 ms)
      ‚àö should recognize hand-walking as eligible task (2 ms)
      ‚àö should recognize stall_care as eligible task (1 ms)
      ‚àö should reject non-eligible tasks for bonding (1 ms)
    Age Restrictions
      ‚àö should allow grooming for horses 3+ years old (1 ms)
      ‚àö should reject adult grooming tasks for horses under 3 years old (12 ms)
      ‚àö should allow enrichment tasks for horses under 3 years old (1 ms)
    Consecutive Day Tracking
      ‚àö should increment consecutive days for daily grooming
      ‚àö should reset consecutive days to 0 after 2+ day lapse (3 ms)
      ‚àö should maintain consecutive days for 1-day lapse (1 ms)
    Burnout Immunity System
      ‚àö should grant immunity after 7 consecutive days
      ‚àö should maintain none status for less than 7 days
      ‚àö should reset immunity status when consecutive days reset (1 ms)

[2025-12-27 23:22:30] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:30] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:30] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/horseModelAtBirth.test.mjs
  üê¥ UNIT: Horse Model At-Birth Traits - Creation Integration Testing
    createHorse with at-birth traits
      ‚àö should apply at-birth traits for newborn with parents (5 ms)
      ‚àö should pass custom mare stress and feed quality (2 ms)
      ‚àö should merge at-birth traits with existing traits (2 ms)
      ‚àö should not apply at-birth traits for older horses (1 ms)
      ‚àö should not apply at-birth traits for horses without parents (1 ms)
      ‚àö should continue horse creation even if at-birth trait application fails (2 ms)
      ‚àö should handle missing sireId gracefully (1 ms)
      ‚àö should handle missing damId gracefully (1 ms)
      ‚àö should log breeding analysis information (2 ms)

[2025-12-27 23:22:30] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:30] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:30] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse test-horse-milestone at age 365
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {"bonded":3,"patient":3,"aloof":-3}
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait bonded (epigenetic: true)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait patient (epigenetic: true)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait resists_aloof (epigenetic: true)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 3 traits
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse test-horse-milestone at age 730
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {"bonded":3,"patient":3,"aloof":-3}
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait bonded (epigenetic: true)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait patient (epigenetic: true)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait resists_aloof (epigenetic: true)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_2, applied 3 traits
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse test-horse-milestone at age 1095
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {"trusting":3,"brave":3,"nervous":-3}
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait trusting (epigenetic: false)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait brave (epigenetic: false)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait resists_nervous (epigenetic: false)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_3, applied 3 traits
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse test-horse-milestone at age 365
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {"bonded":3,"patient":2,"aloof":-3,"affectionate":1,"friendly":1,"playful":1,"independent":-1}
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait bonded (epigenetic: true)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait resists_aloof (epigenetic: true)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 2 traits
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse test-horse-milestone at age 365
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Milestone age_1 already evaluated, skipping
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse test-horse-milestone at age 200
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse test-horse-milestone at age 365
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {}
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 0 traits
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse test-horse-milestone at age 365
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {"bonded":1,"patient":1,"aloof":-1}
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 0 traits
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Starting evaluation for horse test-horse-milestone at age 365
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Calculated trait scores: {"bonded":3,"patient":3,"aloof":-3}
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Trait bonded already exists, skipping
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait patient (epigenetic: true)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.applyTraitToHorse] Applied trait resists_aloof (epigenetic: true)
[2025-12-27 23:22:30] info: [milestoneTraitEvaluator.evaluateTraitMilestones] Completed milestone age_1, applied 2 traits
PASS tests/milestoneTraitEvaluator.test.mjs
  Milestone Trait Evaluator
    evaluateTraitMilestones
      ‚àö should assign positive trait when encouraged 3+ times at age 1 (26 ms)
      ‚àö should assign resistance trait when discouraged 3+ times at age 2 (9 ms)
      ‚àö should not mark traits as epigenetic at age 3 (7 ms)
      ‚àö should calculate net trait scores correctly with mixed influences (17 ms)
      ‚àö should not evaluate if already completed for that milestone (3 ms)
      ‚àö should not evaluate if not a milestone age (2 ms)
      ‚àö should handle empty task log gracefully (5 ms)
      ‚àö should handle task log with unknown tasks (5 ms)
      ‚àö should prevent duplicate trait assignment (13 ms)
    calculateTraitScores
      ‚àö should calculate correct scores for single task type (1 ms)
      ‚àö should calculate net scores for mixed task types (1 ms)
      ‚àö should handle empty task log (1 ms)
      ‚àö should ignore unknown tasks (1 ms)
    checkMilestoneEligibility
      ‚àö should return eligible for milestone age without completion (2 ms)
      ‚àö should return not eligible if already evaluated (1 ms)
      ‚àö should return not eligible for non-milestone age (1 ms)
    getMilestoneSummary
      ‚àö should return correct summary for horse with completed milestones (2 ms)
      ‚àö should return correct summary for horse with all milestones complete (1 ms)
    Configuration Validation
      ‚àö should have correct milestone ages defined (2 ms)
      ‚àö should have correct trait thresholds defined (1 ms)
      ‚àö should have valid task trait influence map (6 ms)

[2025-12-27 23:22:31] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:31] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:31] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/horseModelTraitHelpers.test.mjs
  üê¥ UNIT: Horse Model Trait Helpers - Utility Function Validation
    trait addition
      ‚àö should add a trait to the correct category if not present (5 ms)
      ‚àö should not add a duplicate trait (1 ms)
    trait removal
      ‚àö should remove a trait from the correct category (2 ms)
      ‚àö should handle removal of a non-existent trait gracefully (2 ms)
    getAllTraits utility
      ‚àö should return a flattened array of all traits (1 ms)
      ‚àö should handle empty trait categories (1 ms)

[2025-12-27 23:22:31] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:31] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:31] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

PASS tests/training-fixed.test.mjs
  Training Fixed Tests
    ‚àö should be a placeholder test (2 ms)

[2025-12-27 23:22:32] info: [envValidator] Validating test environment configuration...
[2025-12-27 23:22:32] info: [envValidator] ‚úÖ All 5 required environment variables are present
[2025-12-27 23:22:32] info: [envValidator] Test environment validation complete. Success: true
  console.log
    üß™ Test environment loaded

      at tests/setup.mjs:53:9

  console.log
    üìä Database: postgresql://postgres:***@localhost:5432/equoria_test

      at tests/setup.mjs:54:9

  console.info
    [PrismaClient] Jest cleanup registered successfully.

      at ../packages/database/prismaClient.mjs:55:13

PASS tests/burnoutImmunityTraitIntegration.test.mjs
  Burnout Immunity & Trait Integration
    Complete Foal Development Workflow
      ‚àö should demonstrate full workflow from consistent care to trait rewards (7 ms)
      ‚àö should handle streak loss and recovery scenario (3 ms)
      ‚àö should demonstrate per-horse independent tracking (2 ms)
    Grace Period Edge Cases
      ‚àö should handle exactly 2-day grace period with trait evaluation (3 ms)
      ‚àö should handle 3-day gap (beyond grace period) (1 ms)
    Trait Assignment with Streak Bonuses
      ‚àö should demonstrate streak bonus impact on trait assignment (2 ms)
      ‚àö should validate trait metadata for all assigned traits (11 ms)
    Real-World Player Scenarios
      ‚àö should handle casual player with weekend-only care (1 ms)
      ‚àö should handle dedicated player with consistent daily care (1 ms)

Summary of all failing tests
FAIL tests/groomBonusTraits.test.mjs
  ‚óè Groom Bonus Traits System ‚Ä∫ Trait Assignment Logic Integration ‚Ä∫ should not apply bonus when coverage is insufficient

    expect(received).toBe(expected) // Object.is equality

    Expected: "Bond score too low"
    Received: "Insufficient assignment coverage"

    [0m [90m 302 |[39m       expect(result[33m.[39mfinalProbability)[33m.[39mtoBe([35m0.1[39m)[33m;[39m [90m// No bonus applied[39m
     [90m 303 |[39m       expect(result[33m.[39mbonusApplied)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 304 |[39m       expect(result[33m.[39mreason)[33m.[39mtoBe([32m'Bond score too low'[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 305 |[39m     })[33m;[39m
     [90m 306 |[39m   })[33m;[39m
     [90m 307 |[39m[0m

      at Object.<anonymous> (tests/groomBonusTraits.test.mjs:304:29)

FAIL tests/integration/horseBreedingWorkflow.integration.test.mjs
  ‚óè ÔøΩÔøΩ INTEGRATION: Complete Horse Breeding Workflow ‚Ä∫ ÔøΩÔøΩ STEP 4: Groom Assignment & Care ‚Ä∫ should assign specialized foal care groom to newborn

    expect(received).toBe(expected) // Object.is equality

    Expected: "foal_care"
    Received: "foalCare"

    [0m [90m 286 |[39m
     [90m 287 |[39m       expect(dbAssignment)[33m.[39mtoBeTruthy()[33m;[39m
    [31m[1m>[22m[39m[90m 288 |[39m       expect(dbAssignment[33m.[39mgroom[33m.[39mspeciality)[33m.[39mtoBe([32m'foal_care'[39m)[33m;[39m
     [90m     |[39m                                             [31m[1m^[22m[39m
     [90m 289 |[39m
     [90m 290 |[39m       assignedGroom [33m=[39m dbAssignment[33m.[39mgroom[33m;[39m
     [90m 291 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/integration/horseBreedingWorkflow.integration.test.mjs:288:45)

  ‚óè ÔøΩÔøΩ INTEGRATION: Complete Horse Breeding Workflow ‚Ä∫ ÔøΩÔøΩ STEP 4: Groom Assignment & Care ‚Ä∫ should record groom interaction with foal

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 297 |[39m       [36mconst[39m interactionData [33m=[39m {
     [90m 298 |[39m         foalId[33m:[39m foal[33m.[39mid[33m,[39m
    [31m[1m>[22m[39m[90m 299 |[39m         groomId[33m:[39m assignedGroom[33m.[39mid[33m,[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 300 |[39m         interactionType[33m:[39m [32m'daily_care'[39m[33m,[39m
     [90m 301 |[39m         duration[33m:[39m [35m60[39m[33m,[39m [90m// 1 hour[39m
     [90m 302 |[39m         notes[33m:[39m [32m'Initial care for newborn foal'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/integration/horseBreedingWorkflow.integration.test.mjs:299:32)

  ‚óè ÔøΩÔøΩ INTEGRATION: Complete Horse Breeding Workflow ‚Ä∫ ÔøΩÔøΩ STEP 6: End-to-End Workflow Validation ‚Ä∫ should validate complete breeding workflow integrity

    expect(received).toBe(expected) // Object.is equality

    Expected: "foal_care"
    Received: "foalCare"

    [0m [90m 371 |[39m       [90m// Groom care system[39m
     [90m 372 |[39m       expect(foalWithFamily[33m.[39mgroomAssignments)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 373 |[39m       expect(foalWithFamily[33m.[39mgroomAssignments[[35m0[39m][33m.[39mgroom[33m.[39mspeciality)[33m.[39mtoBe([32m'foal_care'[39m)[33m;[39m
     [90m     |[39m                                                                   [31m[1m^[22m[39m
     [90m 374 |[39m       expect(foalWithFamily[33m.[39mgroomInteractions)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m 375 |[39m
     [90m 376 |[39m       [90m// Development tracking[39m[0m

      at Object.<anonymous> (tests/integration/horseBreedingWorkflow.integration.test.mjs:373:67)

  ‚óè ÔøΩÔøΩ INTEGRATION: Complete Horse Breeding Workflow ‚Ä∫ ÔøΩÔøΩ STEP 6: End-to-End Workflow Validation ‚Ä∫ should validate business rules are enforced throughout workflow

    TypeError: Cannot read properties of undefined (reading 'speciality')

    [0m [90m 397 |[39m
     [90m 398 |[39m       [90m// Groom specialization rules[39m
    [31m[1m>[22m[39m[90m 399 |[39m       expect(assignedGroom[33m.[39mspeciality)[33m.[39mtoBe([32m'foal_care'[39m)[33m;[39m [90m// Correct specialty for foal[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 400 |[39m
     [90m 401 |[39m       [90m// Data integrity[39m
     [90m 402 |[39m       expect(foal[33m.[39msireId)[33m.[39mtoBe(stallion[33m.[39mid)[33m;[39m[0m

      at Object.<anonymous> (tests/integration/horseBreedingWorkflow.integration.test.mjs:399:28)

FAIL tests/training-updated.test.mjs
  ‚óè ÔøΩÔøΩÔ∏è INTEGRATION: Training System Updated - User Model Integration ‚Ä∫ Training Status Tests ‚Ä∫ should get training status for a specific horse and discipline

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

    [0m [90m 163 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)[33m;[39m [90m// Ensure auth token is sent[39m
     [90m 164 |[39m
    [31m[1m>[22m[39m[90m 165 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 166 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 167 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'eligible'[39m)[33m;[39m
     [90m 168 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'reason'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/training-updated.test.mjs:165:31)

  ‚óè ÔøΩÔøΩÔ∏è INTEGRATION: Training System Updated - User Model Integration ‚Ä∫ Training Status Tests ‚Ä∫ should get all training status for a horse

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

    [0m [90m 180 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)[33m;[39m [90m// Ensure auth token is sent[39m
     [90m 181 |[39m
    [31m[1m>[22m[39m[90m 182 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 183 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 184 |[39m       expect([36mtypeof[39m response[33m.[39mbody[33m.[39mdata)[33m.[39mtoBe([32m'object'[39m)[33m;[39m [90m// Fixed: API returns object with discipline keys, not array[39m
     [90m 185 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'Racing'[39m)[33m;[39m [90m// Fixed: Check for discipline properties[39m[0m

      at Object.<anonymous> (tests/training-updated.test.mjs:182:31)

  ‚óè ÔøΩÔøΩÔ∏è INTEGRATION: Training System Updated - User Model Integration ‚Ä∫ Error Handling Tests ‚Ä∫ should handle invalid horse ID gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 403

    [0m [90m 217 |[39m       })[33m;[39m
     [90m 218 |[39m
    [31m[1m>[22m[39m[90m 219 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 220 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 221 |[39m       expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoContain([32m'not found'[39m)[33m;[39m
     [90m 222 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/training-updated.test.mjs:219:31)

  ‚óè ÔøΩÔøΩÔ∏è INTEGRATION: Training System Updated - User Model Integration ‚Ä∫ Error Handling Tests ‚Ä∫ should handle invalid discipline gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 403

    [0m [90m 228 |[39m       })[33m;[39m
     [90m 229 |[39m
    [31m[1m>[22m[39m[90m 230 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)[33m;[39m [90m// Ownership fails before discipline validation in test mode[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 231 |[39m       expect(response[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 232 |[39m     })[33m;[39m
     [90m 233 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/training-updated.test.mjs:230:31)

FAIL tests/trainingController.test.mjs
  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should return eligible true for horse that meets all requirements

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
    -   "eligible": true,
    -   "reason": null,
    +   "eligible": false,
    +   "reason": "Horse not found",
      }

    [0m [90m  97 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m canTrain([35m1[39m[33m,[39m [32m'Dressage'[39m)[33m;[39m
     [90m  98 |[39m
    [31m[1m>[22m[39m[90m  99 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 100 |[39m         eligible[33m:[39m [36mtrue[39m[33m,[39m
     [90m 101 |[39m         reason[33m:[39m [36mnull[39m[33m,[39m
     [90m 102 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:99:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should return eligible false for horse under 3 years old

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 1

      Object {
        "eligible": false,
    -   "reason": "Horse is under age",
    +   "reason": "Horse not found",
      }

    [0m [90m 110 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m canTrain([35m1[39m[33m,[39m [32m'Dressage'[39m)[33m;[39m
     [90m 111 |[39m
    [31m[1m>[22m[39m[90m 112 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 113 |[39m         eligible[33m:[39m [36mfalse[39m[33m,[39m
     [90m 114 |[39m         reason[33m:[39m [32m'Horse is under age'[39m[33m,[39m
     [90m 115 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:112:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should return eligible false for horse with recent training in any discipline

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 1

      Object {
        "eligible": false,
    -   "reason": "Training cooldown active for this horse",
    +   "reason": "Horse not found",
      }

    [0m [90m 126 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m canTrain([35m1[39m[33m,[39m [32m'Dressage'[39m)[33m;[39m
     [90m 127 |[39m
    [31m[1m>[22m[39m[90m 128 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 129 |[39m         eligible[33m:[39m [36mfalse[39m[33m,[39m
     [90m 130 |[39m         reason[33m:[39m [32m'Training cooldown active for this horse'[39m[33m,[39m
     [90m 131 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:128:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should return eligible true for horse with old training (8+ days ago)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
    -   "eligible": true,
    -   "reason": null,
    +   "eligible": false,
    +   "reason": "Horse not found",
      }

    [0m [90m 142 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m canTrain([35m1[39m[33m,[39m [32m'Dressage'[39m)[33m;[39m
     [90m 143 |[39m
    [31m[1m>[22m[39m[90m 144 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 145 |[39m         eligible[33m:[39m [36mtrue[39m[33m,[39m
     [90m 146 |[39m         reason[33m:[39m [36mnull[39m[33m,[39m
     [90m 147 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:144:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should return eligible false for non-existent horse

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 999

    Number of calls: 0

    [0m [90m 159 |[39m         reason[33m:[39m [32m'Horse not found'[39m[33m,[39m
     [90m 160 |[39m       })[33m;[39m
    [31m[1m>[22m[39m[90m 161 |[39m       expect(mockGetHorseAge)[33m.[39mtoHaveBeenCalledWith([35m999[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 162 |[39m       expect(mockGetAnyRecentTraining)[33m.[39mnot[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 163 |[39m     })[33m;[39m
     [90m 164 |[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:161:31)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"eligible": false, "reason": "Horse not found"}

    [0m [90m 178 |[39m       mockGetHorseAge[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database connection failed'[39m))[33m;[39m
     [90m 179 |[39m
    [31m[1m>[22m[39m[90m 180 |[39m       [36mawait[39m expect(canTrain([35m1[39m[33m,[39m [32m'Dressage'[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Training eligibility check failed'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 181 |[39m     })[33m;[39m
     [90m 182 |[39m
     [90m 183 |[39m     it([32m'should calculate cooldown correctly for edge case (exactly 7 days)'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/trainingController.test.mjs:180:13)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ canTrain ‚Ä∫ should calculate cooldown correctly for edge case (exactly 7 days)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
    -   "eligible": true,
    -   "reason": null,
    +   "eligible": false,
    +   "reason": "Horse not found",
      }

    [0m [90m 190 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m canTrain([35m1[39m[33m,[39m [32m'Dressage'[39m)[33m;[39m
     [90m 191 |[39m
    [31m[1m>[22m[39m[90m 192 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 193 |[39m         eligible[33m:[39m [36mtrue[39m[33m,[39m
     [90m 194 |[39m         reason[33m:[39m [36mnull[39m[33m,[39m
     [90m 195 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:192:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainHorse ‚Ä∫ should successfully train eligible horse

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 246 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m trainHorse([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 247 |[39m
    [31m[1m>[22m[39m[90m 248 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 249 |[39m       expect(result[33m.[39mmessage)[33m.[39mtoContain([32m'Horse trained successfully in Racing. +5 added.'[39m)[33m;[39m
     [90m 250 |[39m       expect(result[33m.[39mupdatedHorse[33m.[39mname)[33m.[39mtoBe([32m'Test Horse'[39m)[33m;[39m
     [90m 251 |[39m       expect(result[33m.[39mnextEligible)[33m.[39mtoBeDefined()[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:248:30)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainHorse ‚Ä∫ should reject training for ineligible horse (under age)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
    -   "message": "Training not allowed: Horse is under age",
    +   "message": "Training not allowed: Horse not found",
        "nextEligible": null,
    -   "reason": "Horse is under age",
    +   "reason": "Horse not found",
        "success": false,
        "updatedHorse": null,
      }

    [0m [90m 262 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m trainHorse([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 263 |[39m
    [31m[1m>[22m[39m[90m 264 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 265 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 266 |[39m         reason[33m:[39m [32m'Horse is under age'[39m[33m,[39m
     [90m 267 |[39m         updatedHorse[33m:[39m [36mnull[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:264:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainHorse ‚Ä∫ should reject training for horse in cooldown

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
    -   "message": "Training not allowed: Training cooldown active for this horse",
    +   "message": "Training not allowed: Horse not found",
        "nextEligible": null,
    -   "reason": "Training cooldown active for this horse",
    +   "reason": "Horse not found",
        "success": false,
        "updatedHorse": null,
      }

    [0m [90m 279 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m trainHorse([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 280 |[39m
    [31m[1m>[22m[39m[90m 281 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 282 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 283 |[39m         reason[33m:[39m [32m'Training cooldown active for this horse'[39m[33m,[39m
     [90m 284 |[39m         updatedHorse[33m:[39m [36mnull[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:281:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainHorse ‚Ä∫ should handle training log errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"message": "Training not allowed: Horse not found", "nextEligible": null, "reason": "Horse not found", "success": false, "updatedHorse": null}

    [0m [90m 299 |[39m       mockLogTrainingSession[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Failed to log training'[39m))[33m;[39m
     [90m 300 |[39m
    [31m[1m>[22m[39m[90m 301 |[39m       [36mawait[39m expect(trainHorse([35m1[39m[33m,[39m [32m'Racing'[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Training failed: Failed to log training'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 302 |[39m     })[33m;[39m
     [90m 303 |[39m
     [90m 304 |[39m     it([32m'should award +5 XP after successful training'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/trainingController.test.mjs:301:13)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainHorse ‚Ä∫ should award +5 XP after successful training

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 344 |[39m
     [90m 345 |[39m       [90m// Verify training success[39m
    [31m[1m>[22m[39m[90m 346 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 347 |[39m       expect(result[33m.[39mmessage)[33m.[39mtoContain([32m'Horse trained successfully in Dressage. +5 added.'[39m)[33m;[39m
     [90m 348 |[39m
     [90m 349 |[39m       [90m// Verify XP award system[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:346:30)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainHorse ‚Ä∫ should handle XP system errors gracefully without breaking training

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 386 |[39m
     [90m 387 |[39m       [90m// Training should still succeed despite XP error[39m
    [31m[1m>[22m[39m[90m 388 |[39m       expect(result[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 389 |[39m       expect(result[33m.[39mmessage)[33m.[39mtoContain([32m'Horse trained successfully in Racing. +5 added.'[39m)[33m;[39m
     [90m 390 |[39m       expect(result[33m.[39mupdatedHorse[33m.[39mname)[33m.[39mtoBe([32m'Error Test Horse'[39m)[33m;[39m
     [90m 391 |[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:388:30)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainingStatus ‚Ä∫ should return complete status for eligible horse with no training history

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 3

      Object {
        "cooldown": null,
    -   "eligible": true,
    -   "horseAge": 5,
    +   "eligible": false,
    +   "horseAge": null,
        "lastTrainingDate": null,
    -   "reason": null,
    +   "reason": "Horse not found",
      }

    [0m [90m 409 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getTrainingStatus([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 410 |[39m
    [31m[1m>[22m[39m[90m 411 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 412 |[39m         eligible[33m:[39m [36mtrue[39m[33m,[39m
     [90m 413 |[39m         reason[33m:[39m [36mnull[39m[33m,[39m
     [90m 414 |[39m         horseAge[33m:[39m [35m5[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:411:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainingStatus ‚Ä∫ should return complete status for horse in active cooldown

    expect(received).toBe(expected) // Object.is equality

    Expected: "Training cooldown active for this horse"
    Received: "Horse not found"

    [0m [90m 427 |[39m
     [90m 428 |[39m       expect(result[33m.[39meligible)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 429 |[39m       expect(result[33m.[39mreason)[33m.[39mtoBe([32m'Training cooldown active for this horse'[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 430 |[39m       expect(result[33m.[39mhorseAge)[33m.[39mtoBe([35m4[39m)[33m;[39m
     [90m 431 |[39m       expect(result[33m.[39mlastTrainingDate)[33m.[39mtoBe([36mnull[39m)[33m;[39m [90m// Still null for this specific discipline[39m
     [90m 432 |[39m       expect(result[33m.[39mcooldown[33m.[39mactive)[33m.[39mtoBe([36mtrue[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:429:29)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainingStatus ‚Ä∫ should return complete status for horse with expired cooldown

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 443 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getTrainingStatus([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 444 |[39m
    [31m[1m>[22m[39m[90m 445 |[39m       expect(result[33m.[39meligible)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 446 |[39m       expect(result[33m.[39mreason)[33m.[39mtoBe([36mnull[39m)[33m;[39m
     [90m 447 |[39m       expect(result[33m.[39mhorseAge)[33m.[39mtoBe([35m4[39m)[33m;[39m
     [90m 448 |[39m       expect(result[33m.[39mlastTrainingDate)[33m.[39mtoEqual(eightDaysAgo)[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:445:31)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainingStatus ‚Ä∫ should return status for ineligible horse (under age)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

      Object {
        "cooldown": null,
        "eligible": false,
    -   "horseAge": 2,
    +   "horseAge": null,
        "lastTrainingDate": null,
    -   "reason": "Horse is under age",
    +   "reason": "Horse not found",
      }

    [0m [90m 458 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getTrainingStatus([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 459 |[39m
    [31m[1m>[22m[39m[90m 460 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 461 |[39m         eligible[33m:[39m [36mfalse[39m[33m,[39m
     [90m 462 |[39m         reason[33m:[39m [32m'Horse is under age'[39m[33m,[39m
     [90m 463 |[39m         horseAge[33m:[39m [35m2[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:460:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainingStatus ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"cooldown": null, "eligible": false, "horseAge": null, "lastTrainingDate": null, "reason": "Horse not found"}

    [0m [90m 470 |[39m       mockGetHorseAge[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database error'[39m))[33m;[39m
     [90m 471 |[39m
    [31m[1m>[22m[39m[90m 472 |[39m       [36mawait[39m expect(getTrainingStatus([35m1[39m[33m,[39m [32m'Racing'[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Training status check failed'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 473 |[39m     })[33m;[39m
     [90m 474 |[39m   })[33m;[39m
     [90m 475 |[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/trainingController.test.mjs:472:13)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ Integration scenarios ‚Ä∫ should handle different disciplines with global cooldown

    expect(received).toBe(expected) // Object.is equality

    Expected: "Training cooldown active for this horse"
    Received: "Horse not found"

    [0m [90m 491 |[39m       [90m// Both should be blocked due to global cooldown[39m
     [90m 492 |[39m       expect(racingResult[33m.[39meligible)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 493 |[39m       expect(racingResult[33m.[39mreason)[33m.[39mtoBe([32m'Training cooldown active for this horse'[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 494 |[39m
     [90m 495 |[39m       expect(jumpingResult[33m.[39meligible)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 496 |[39m       expect(jumpingResult[33m.[39mreason)[33m.[39mtoBe([32m'Training cooldown active for this horse'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:493:35)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ Integration scenarios ‚Ä∫ should handle edge case of exactly 7 days cooldown

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 504 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m canTrain([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
     [90m 505 |[39m
    [31m[1m>[22m[39m[90m 506 |[39m       expect(result[33m.[39meligible)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 507 |[39m       expect(result[33m.[39mreason)[33m.[39mtoBe([36mnull[39m)[33m;[39m
     [90m 508 |[39m     })[33m;[39m
     [90m 509 |[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:506:31)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ Integration scenarios ‚Ä∫ should handle complete training workflow

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 542 |[39m
     [90m 543 |[39m       [36mconst[39m trainResult [33m=[39m [36mawait[39m trainHorse([35m1[39m[33m,[39m [32m'Racing'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 544 |[39m       expect(trainResult[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 545 |[39m
     [90m 546 |[39m       [90m// Now mock that the horse has recently trained[39m
     [90m 547 |[39m       [36mconst[39m justNow [33m=[39m [36mnew[39m [33mDate[39m()[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:544:35)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainableHorses ‚Ä∫ should return trainable horses for user with eligible horses

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 0
    Received array:  []

    [0m [90m 577 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getTrainableHorses(playerId)[33m;[39m
     [90m 578 |[39m
    [31m[1m>[22m[39m[90m 579 |[39m       expect(result)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 580 |[39m       expect(result[[35m0[39m])[33m.[39mtoEqual({
     [90m 581 |[39m         horseId[33m:[39m [35m1[39m[33m,[39m
     [90m 582 |[39m         name[33m:[39m [32m'Thunder'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:579:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainableHorses ‚Ä∫ should filter out horses under 3 years old

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

    [0m [90m 630 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getTrainableHorses(playerId)[33m;[39m
     [90m 631 |[39m
    [31m[1m>[22m[39m[90m 632 |[39m       expect(result)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 633 |[39m       expect(result[[35m0[39m][33m.[39mname)[33m.[39mtoBe([32m'Adult Horse'[39m)[33m;[39m
     [90m 634 |[39m       expect(result[[35m0[39m][33m.[39mage)[33m.[39mtoBe([35m4[39m)[33m;[39m
     [90m 635 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:632:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainableHorses ‚Ä∫ should handle database errors gracefully for individual horses

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

    [0m [90m 668 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getTrainableHorses(playerId)[33m;[39m
     [90m 669 |[39m
    [31m[1m>[22m[39m[90m 670 |[39m       expect(result)[33m.[39mtoHaveLength([35m1[39m)[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 671 |[39m       expect(result[[35m0[39m][33m.[39mname)[33m.[39mtoBe([32m'Good Horse'[39m)[33m;[39m
     [90m 672 |[39m       expect(result[[35m0[39m][33m.[39mtrainableDisciplines)[33m.[39mtoEqual([
     [90m 673 |[39m         [32m'Racing'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:670:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ getTrainableHorses ‚Ä∫ should handle player model errors

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: []

    [0m [90m 688 |[39m       mockGetUserWithHorses[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Player database error'[39m))[33m;[39m
     [90m 689 |[39m
    [31m[1m>[22m[39m[90m 690 |[39m       [36mawait[39m expect(getTrainableHorses(playerId))[33m.[39mrejects[33m.[39mtoThrow(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 691 |[39m         [32m'Failed to get trainable horses: Player database error'[39m[33m,[39m
     [90m 692 |[39m       )[33m;[39m
     [90m 693 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/trainingController.test.mjs:690:13)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainRouteHandler ‚Ä∫ should return success response with correct format for successful training

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Nova trained in Dressage. +5 added.",
    -   "nextEligibleDate": Any<String>,
    -   "success": true,
    -   "traitEffects": ObjectContaining {
    -     "appliedTraits": Array [],
    -     "scoreModifier": 0,
    -     "xpModifier": 0,
    -   },
    -   "updatedScore": 25,
    +   "message": "Training not allowed: Horse not found",
    +   "success": false,
      },

    Number of calls: 1

    [0m [90m 747 |[39m       [36mawait[39m trainRouteHandler(mockReq[33m,[39m mockRes)[33m;[39m
     [90m 748 |[39m
    [31m[1m>[22m[39m[90m 749 |[39m       expect(mockRes[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 750 |[39m         success[33m:[39m [36mtrue[39m[33m,[39m
     [90m 751 |[39m         message[33m:[39m [32m'Nova trained in Dressage. +5 added.'[39m[33m,[39m
     [90m 752 |[39m         updatedScore[33m:[39m [35m25[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:749:28)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainRouteHandler ‚Ä∫ should return failure response for ineligible horse (under age)

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Training not allowed: Horse is under age",
    +   "message": "Training not allowed: Horse not found",
        "success": false,
      },

    Number of calls: 1

    [0m [90m 768 |[39m
     [90m 769 |[39m       expect(mockRes[33m.[39mstatus)[33m.[39mtoHaveBeenCalledWith([35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 770 |[39m       expect(mockRes[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 771 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 772 |[39m         message[33m:[39m [32m'Training not allowed: Horse is under age'[39m[33m,[39m
     [90m 773 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:770:28)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainRouteHandler ‚Ä∫ should return failure response for horse in cooldown

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Training not allowed: Training cooldown active for this horse",
    +   "message": "Training not allowed: Horse not found",
        "success": false,
      },

    Number of calls: 1

    [0m [90m 783 |[39m
     [90m 784 |[39m       expect(mockRes[33m.[39mstatus)[33m.[39mtoHaveBeenCalledWith([35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 785 |[39m       expect(mockRes[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 786 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 787 |[39m         message[33m:[39m [32m'Training not allowed: Training cooldown active for this horse'[39m[33m,[39m
     [90m 788 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:785:28)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainRouteHandler ‚Ä∫ should handle missing discipline score gracefully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Nova trained in Dressage. +5 added.",
    -   "nextEligibleDate": Any<String>,
    -   "success": true,
    -   "traitEffects": ObjectContaining {
    -     "appliedTraits": Array [],
    -     "scoreModifier": 0,
    -     "xpModifier": 0,
    -   },
    -   "updatedScore": 0,
    +   "message": "Training not allowed: Horse not found",
    +   "success": false,
      },

    Number of calls: 1

    [0m [90m 825 |[39m       [36mawait[39m trainRouteHandler(mockReq[33m,[39m mockRes)[33m;[39m
     [90m 826 |[39m
    [31m[1m>[22m[39m[90m 827 |[39m       expect(mockRes[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 828 |[39m         success[33m:[39m [36mtrue[39m[33m,[39m
     [90m 829 |[39m         message[33m:[39m [32m'Nova trained in Dressage. +5 added.'[39m[33m,[39m
     [90m 830 |[39m         updatedScore[33m:[39m [35m0[39m[33m,[39m [90m// Should default to 0 when no scores exist[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:827:28)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainRouteHandler ‚Ä∫ should handle server errors gracefully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 500
    Received: 400

    Number of calls: 1

    [0m [90m 844 |[39m       [36mawait[39m trainRouteHandler(mockReq[33m,[39m mockRes)[33m;[39m
     [90m 845 |[39m
    [31m[1m>[22m[39m[90m 846 |[39m       expect(mockRes[33m.[39mstatus)[33m.[39mtoHaveBeenCalledWith([35m500[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 847 |[39m       expect(mockRes[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m 848 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 849 |[39m         message[33m:[39m [32m'Failed to train horse'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:846:30)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Controller - Horse Training Business Logic ‚Ä∫ trainRouteHandler ‚Ä∫ should handle trait effects in training

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Intelligent Horse trained in Dressage. +6 added.",
    -   "nextEligibleDate": Any<String>,
    -   "success": true,
    -   "traitEffects": ObjectContaining {
    -     "appliedTraits": Array [
    -       "intelligent",
    -     ],
    -     "scoreModifier": 1,
    -     "xpModifier": 1,
    -   },
    -   "updatedScore": 6,
    +   "message": "Training not allowed: Horse not found",
    +   "success": false,
      },

    Number of calls: 1

    [0m [90m 889 |[39m       [36mawait[39m trainRouteHandler(mockReq[33m,[39m mockRes)[33m;[39m
     [90m 890 |[39m
    [31m[1m>[22m[39m[90m 891 |[39m       expect(mockRes[33m.[39mjson)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 892 |[39m         success[33m:[39m [36mtrue[39m[33m,[39m
     [90m 893 |[39m         message[33m:[39m [32m'Intelligent Horse trained in Dressage. +6 added.'[39m[33m,[39m
     [90m 894 |[39m         updatedScore[33m:[39m [35m6[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingController.test.mjs:891:28)

FAIL seed/horseSeed.test.mjs
  ‚óè Horse Seed Integration Tests ‚Ä∫ findOrCreateBreed - Real Database Operations ‚Ä∫ should return existing breed if found in database

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[seed] Found existing breed: TestSeed_Thoroughbred (ID: 20906)"

    Number of calls: 0

    [0m [90m 152 |[39m       expect(result[33m.[39mname)[33m.[39mtoBe([32m'TestSeed_Thoroughbred'[39m)[33m;[39m
     [90m 153 |[39m       expect(result[33m.[39mid)[33m.[39mtoBe(testBreed[33m.[39mid)[33m;[39m
    [31m[1m>[22m[39m[90m 154 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 155 |[39m         [32m`[seed] Found existing breed: TestSeed_Thoroughbred (ID: ${testBreed.id})`[39m[33m,[39m
     [90m 156 |[39m       )[33m;[39m
     [90m 157 |[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:154:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ findOrCreateBreed - Real Database Operations ‚Ä∫ should create new breed if not found in database

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[seed] Breed \"TestSeed_NewArabian\" not found, creating new one."

    Number of calls: 0

    [0m [90m 166 |[39m       expect(result[33m.[39mname)[33m.[39mtoBe([32m'TestSeed_NewArabian'[39m)[33m;[39m
     [90m 167 |[39m       expect(result[33m.[39mdescription)[33m.[39mtoBe([32m'Seed-created TestSeed_NewArabian'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 168 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Breed "TestSeed_NewArabian" not found, creating new one.'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 169 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m`[seed] Created breed: TestSeed_NewArabian (ID: ${result.id})`[39m)[33m;[39m
     [90m 170 |[39m
     [90m 171 |[39m       [90m// Verify it was actually created in database[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:168:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ findOrCreateBreed - Real Database Operations ‚Ä∫ should return null for undefined breed name

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[seed] Breed name is undefined or null. Skipping breed creation/connection."

    Number of calls: 0

    [0m [90m 182 |[39m
     [90m 183 |[39m       expect(result)[33m.[39mtoBeNull()[33m;[39m
    [31m[1m>[22m[39m[90m 184 |[39m       expect(mockLogger[33m.[39mwarn)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 185 |[39m         [32m'[seed] Breed name is undefined or null. Skipping breed creation/connection.'[39m[33m,[39m
     [90m 186 |[39m       )[33m;[39m
     [90m 187 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:184:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ ensureReferencedRecordsExist - Real Database Operations ‚Ä∫ should create users and stables if they do not exist in database

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[seed] Ensured User owner1@example.com exists."

    Number of calls: 0

    [0m [90m 220 |[39m       expect(stable2[33m.[39mname)[33m.[39mtoBe([32m'Second Stable'[39m)[33m;[39m
     [90m 221 |[39m
    [31m[1m>[22m[39m[90m 222 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured User owner1@example.com exists.'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 223 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured User owner2@example.com exists.'[39m)[33m;[39m
     [90m 224 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured Stable ID 1 exists.'[39m)[33m;[39m
     [90m 225 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured Stable ID 2 exists.'[39m)[33m;[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:222:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ ensureReferencedRecordsExist - Real Database Operations ‚Ä∫ should update existing users and stables if they already exist

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[seed] Ensured User owner1@example.com exists."

    Number of calls: 0

    [0m [90m 242 |[39m       expect(user2)[33m.[39mtoBeTruthy()[33m;[39m
     [90m 243 |[39m
    [31m[1m>[22m[39m[90m 244 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured User owner1@example.com exists.'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 245 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured User owner2@example.com exists.'[39m)[33m;[39m
     [90m 246 |[39m     })[33m;[39m
     [90m 247 |[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:244:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ seedHorses - Real Database Operations ‚Ä∫ should log a warning and return an empty array if no users are provided

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "No users provided for horse seeding. Skipping horse creation."

    Number of calls: 0

    [0m [90m 265 |[39m     it([32m'should log a warning and return an empty array if no users are provided'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 266 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m seedHorses(prisma[33m,[39m [])[33m;[39m
    [31m[1m>[22m[39m[90m 267 |[39m       expect(mockLogger[33m.[39mwarn)[33m.[39mtoHaveBeenCalledWith([32m'No users provided for horse seeding. Skipping horse creation.'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 268 |[39m       expect(result)[33m.[39mtoEqual([])[33m;[39m
     [90m 269 |[39m     })[33m;[39m
     [90m 270 |[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:267:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ seedHorses - Real Database Operations ‚Ä∫ should create breeds and horses for the provided user in database

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "Created horse:"

    Number of calls: 0

    [0m [90m 302 |[39m
     [90m 303 |[39m       [90m// Verify logging occurred[39m
    [31m[1m>[22m[39m[90m 304 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 305 |[39m         expect[33m.[39mstringContaining([32m'Created horse:'[39m)[33m,[39m
     [90m 306 |[39m       )[33m;[39m
     [90m 307 |[39m[0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:304:31)

  ‚óè Horse Seed Integration Tests ‚Ä∫ Complete Horse Seeding Integration Test ‚Ä∫ should execute complete seeding workflow with real database operations

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "[seed] Ensured User owner1@example.com exists."

    Number of calls: 0

    [0m [90m 386 |[39m
     [90m 387 |[39m       [90m// Verify logging occurred[39m
    [31m[1m>[22m[39m[90m 388 |[39m       expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([32m'[seed] Ensured User owner1@example.com exists.'[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 389 |[39m
     [90m 390 |[39m       [36mif[39m (result[33m.[39mlength [33m>[39m [35m0[39m) {
     [90m 391 |[39m         expect(mockLogger[33m.[39minfo)[33m.[39mtoHaveBeenCalledWith([0m

      at Object.<anonymous> (seed/horseSeed.test.mjs:388:31)

FAIL tests/resultModel.test.mjs
  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ saveResult ‚Ä∫ should save a competition result with all required fields

    Database error in saveResult: 
    Invalid `prisma.competitionResult.create()` invocation:


    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`

    [0m [90m 128 |[39m   } [36mcatch[39m (error) {
     [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 131 |[39m   }
     [90m 132 |[39m }
     [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at Object.<anonymous> (tests/resultModel.test.mjs:105:22)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ saveResult ‚Ä∫ should save a result without placement (null for non-top-3)

    Database error in saveResult: 
    Invalid `prisma.competitionResult.create()` invocation:


    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`

    [0m [90m 128 |[39m   } [36mcatch[39m (error) {
     [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 131 |[39m   }
     [90m 132 |[39m }
     [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at Object.<anonymous> (tests/resultModel.test.mjs:146:22)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ saveResult ‚Ä∫ should handle prizeWon as string and convert to float

    Database error in saveResult: 
    Invalid `prisma.competitionResult.create()` invocation:


    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`

    [0m [90m 128 |[39m   } [36mcatch[39m (error) {
     [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 131 |[39m   }
     [90m 132 |[39m }
     [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at Object.<anonymous> (tests/resultModel.test.mjs:329:7)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ saveResult ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow(expected)

    Expected substring: "Database error in saveResult: Database connection failed"
    Received message:   "Database error in saveResult:¬∑
    Invalid `prisma.competitionResult.create()` invocation:¬∑¬∑
    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`"

        [0m [90m 128 |[39m   } [36mcatch[39m (error) {
         [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
        [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
         [90m     |[39m           [31m[1m^[22m[39m
         [90m 131 |[39m   }
         [90m 132 |[39m }
         [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at Object.<anonymous> (tests/resultModel.test.mjs:352:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/resultModel.test.mjs:352:52)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ saveResult ‚Ä∫ should update existing placeholder result instead of creating new one

    Database error in saveResult: 
    Invalid `prisma.competitionResult.create()` invocation:


    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`

    [0m [90m 128 |[39m   } [36mcatch[39m (error) {
     [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 131 |[39m   }
     [90m 132 |[39m }
     [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at Object.<anonymous> (tests/resultModel.test.mjs:390:22)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ saveResult ‚Ä∫ should create new result when no placeholder exists

    Database error in saveResult: 
    Invalid `prisma.competitionResult.create()` invocation:


    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`

    [0m [90m 128 |[39m   } [36mcatch[39m (error) {
     [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 131 |[39m   }
     [90m 132 |[39m }
     [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at Object.<anonymous> (tests/resultModel.test.mjs:447:22)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByHorse ‚Ä∫ should retrieve all results for a specific horse

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 517 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m getResultsByHorse(horseId)[33m;[39m
     [90m 518 |[39m
    [31m[1m>[22m[39m[90m 519 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 520 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m 521 |[39m         where[33m:[39m { horseId[33m:[39m [35m1[39m }[33m,[39m
     [90m 522 |[39m         include[33m:[39m {[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:519:53)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByHorse ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: []

    [0m [90m 551 |[39m       mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database connection failed'[39m))[33m;[39m
     [90m 552 |[39m
    [31m[1m>[22m[39m[90m 553 |[39m       [36mawait[39m expect(getResultsByHorse([35m1[39m))[33m.[39mrejects[33m.[39mtoThrow(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 554 |[39m         [32m'Database error in getResultsByHorse: Database connection failed'[39m[33m,[39m
     [90m 555 |[39m       )[33m;[39m
     [90m 556 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/resultModel.test.mjs:553:13)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByShow ‚Ä∫ should retrieve all results for a specific show

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 589 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m getResultsByShow(showId)[33m;[39m
     [90m 590 |[39m
    [31m[1m>[22m[39m[90m 591 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 592 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m 593 |[39m         where[33m:[39m { showId[33m:[39m [35m2[39m }[33m,[39m
     [90m 594 |[39m         include[33m:[39m {[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:591:53)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByShow ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: []

    [0m [90m 623 |[39m       mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database connection failed'[39m))[33m;[39m
     [90m 624 |[39m
    [31m[1m>[22m[39m[90m 625 |[39m       [36mawait[39m expect(getResultsByShow([35m1[39m))[33m.[39mrejects[33m.[39mtoThrow(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 626 |[39m         [32m'Database error in getResultsByShow: Database connection failed'[39m[33m,[39m
     [90m 627 |[39m       )[33m;[39m
     [90m 628 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/resultModel.test.mjs:625:13)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultById ‚Ä∫ should retrieve a specific result by ID

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 648 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getResultById(resultId)[33m;[39m
     [90m 649 |[39m
    [31m[1m>[22m[39m[90m 650 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33m;[39m
     [90m     |[39m                                                       [31m[1m^[22m[39m
     [90m 651 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith({
     [90m 652 |[39m         where[33m:[39m { id[33m:[39m [35m1[39m }[33m,[39m
     [90m 653 |[39m         include[33m:[39m {[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:650:55)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultById ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: null

    [0m [90m 681 |[39m       mockPrisma[33m.[39mcompetitionResult[33m.[39mfindUnique[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database connection failed'[39m))[33m;[39m
     [90m 682 |[39m
    [31m[1m>[22m[39m[90m 683 |[39m       [36mawait[39m expect(getResultById([35m1[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Database error in getResultById: Database connection failed'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 684 |[39m     })[33m;[39m
     [90m 685 |[39m   })[33m;[39m
     [90m 686 |[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/resultModel.test.mjs:683:13)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ createResult ‚Ä∫ should be an alias for saveResult and work identically

    Database error in saveResult: 
    Invalid `prisma.competitionResult.create()` invocation:


    Foreign key constraint violated on the constraint: `competition_results_horseId_fkey`

    [0m [90m 128 |[39m   } [36mcatch[39m (error) {
     [90m 129 |[39m     logger[33m.[39merror([32m'[resultModel.saveResult] Database error: %o'[39m[33m,[39m error)[33m;[39m
    [31m[1m>[22m[39m[90m 130 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error in saveResult: ${error.message}`[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 131 |[39m   }
     [90m 132 |[39m }
     [90m 133 |[39m[0m

      at saveResult (models/resultModel.mjs:130:11)
      at createResult (models/resultModel.mjs:248:10)
      at Object.<anonymous> (tests/resultModel.test.mjs:702:22)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByUser ‚Ä∫ should retrieve results for all user horses with default options

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"include": {"horse": {"include": {"breed": true}}, "show": true}, "orderBy": {"runDate": "desc"}, "skip": 0, "take": 50, "where": {"horse": {"userId": "user123"}}}

    Number of calls: 0

    [0m [90m 736 |[39m       [36mconst[39m results [33m=[39m [36mawait[39m getResultsByUser(userId)[33m;[39m
     [90m 737 |[39m
    [31m[1m>[22m[39m[90m 738 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 739 |[39m         where[33m:[39m {
     [90m 740 |[39m           horse[33m:[39m {
     [90m 741 |[39m             userId[33m:[39m [32m'user123'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:738:53)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByUser ‚Ä∫ should handle custom options (limit, offset, discipline)

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"include": Any<Object>, "orderBy": {"runDate": "desc"}, "skip": 5, "take": 10, "where": {"discipline": "Racing", "horse": {"userId": "user123"}}}

    Number of calls: 0

    [0m [90m 767 |[39m       [36mawait[39m getResultsByUser(userId[33m,[39m options)[33m;[39m
     [90m 768 |[39m
    [31m[1m>[22m[39m[90m 769 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 770 |[39m         where[33m:[39m {
     [90m 771 |[39m           horse[33m:[39m {
     [90m 772 |[39m             userId[33m:[39m [32m'user123'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:769:53)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByUser ‚Ä∫ should cap limit at 100 and ensure non-negative offset

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"skip": 0, "take": 100}

    Number of calls: 0

    [0m [90m 789 |[39m       [36mawait[39m getResultsByUser(userId[33m,[39m options)[33m;[39m
     [90m 790 |[39m
    [31m[1m>[22m[39m[90m 791 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 792 |[39m         expect[33m.[39mobjectContaining({
     [90m 793 |[39m           take[33m:[39m [35m100[39m[33m,[39m [90m// Capped at 100[39m
     [90m 794 |[39m           skip[33m:[39m [35m0[39m[33m,[39m [90m// Non-negative[39m[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:791:53)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ getResultsByUser ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: []

    [0m [90m 800 |[39m       mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database error'[39m))[33m;[39m
     [90m 801 |[39m
    [31m[1m>[22m[39m[90m 802 |[39m       [36mawait[39m expect(getResultsByUser([32m'user123'[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Database error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 803 |[39m     })[33m;[39m
     [90m 804 |[39m   })[33m;[39m
     [90m 805 |[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/resultModel.test.mjs:802:13)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ parseInt conversion edge cases ‚Ä∫ should handle string IDs in getResultsByHorse

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"where": {"horseId": 123}}

    Number of calls: 0

    [0m [90m 810 |[39m       [36mawait[39m getResultsByHorse([32m'123'[39m)[33m;[39m [90m// String ID[39m
     [90m 811 |[39m
    [31m[1m>[22m[39m[90m 812 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 813 |[39m         expect[33m.[39mobjectContaining({
     [90m 814 |[39m           where[33m:[39m { horseId[33m:[39m [35m123[39m }[33m,[39m [90m// Should be converted to number[39m
     [90m 815 |[39m         })[33m,[39m[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:812:53)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ parseInt conversion edge cases ‚Ä∫ should handle string IDs in getResultsByShow

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"where": {"showId": 456}}

    Number of calls: 0

    [0m [90m 822 |[39m       [36mawait[39m getResultsByShow([32m'456'[39m)[33m;[39m [90m// String ID[39m
     [90m 823 |[39m
    [31m[1m>[22m[39m[90m 824 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                     [31m[1m^[22m[39m
     [90m 825 |[39m         expect[33m.[39mobjectContaining({
     [90m 826 |[39m           where[33m:[39m { showId[33m:[39m [35m456[39m }[33m,[39m [90m// Should be converted to number[39m
     [90m 827 |[39m         })[33m,[39m[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:824:53)

  ‚óè ÔøΩÔøΩ UNIT: Result Model - Competition Result Management ‚Ä∫ parseInt conversion edge cases ‚Ä∫ should handle string IDs in getResultById

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"where": {"id": 789}}

    Number of calls: 0

    [0m [90m 834 |[39m       [36mawait[39m getResultById([32m'789'[39m)[33m;[39m [90m// String ID[39m
     [90m 835 |[39m
    [31m[1m>[22m[39m[90m 836 |[39m       expect(mockPrisma[33m.[39mcompetitionResult[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                                       [31m[1m^[22m[39m
     [90m 837 |[39m         expect[33m.[39mobjectContaining({
     [90m 838 |[39m           where[33m:[39m { id[33m:[39m [35m789[39m }[33m,[39m [90m// Should be converted to number[39m
     [90m 839 |[39m         })[33m,[39m[0m

      at Object.<anonymous> (tests/resultModel.test.mjs:836:55)

FAIL tests/unit/flagEvaluationEngine.test.mjs
  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should evaluate and assign flags for eligible horse

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:124:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should reject horse outside age range

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:147:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should reject horse with maximum flags

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:162:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should not assign duplicate flags

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:180:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should respect flag limit during assignment

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:210:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should handle care analysis ineligibility

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:224:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ evaluateHorseFlags ‚Ä∫ should handle database errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Database error"
    Received message:   "Horse with ID 1 not found"

        [0m [90m 49 |[39m
         [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
        [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
         [90m    |[39m             [31m[1m^[22m[39m
         [90m 52 |[39m     }
         [90m 53 |[39m
         [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:241:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:241:51)

  ‚óè Flag Evaluation Engine ‚Ä∫ Flag Trigger Evaluation ‚Ä∫ should trigger brave flag with correct conditions

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:278:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ Flag Trigger Evaluation ‚Ä∫ should trigger fearful flag with correct conditions

    Horse with ID 1 not found

    [0m [90m 49 |[39m
     [90m 50 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 51 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 52 |[39m     }
     [90m 53 |[39m
     [90m 54 |[39m     [90m// Check age eligibility[39m[0m

      at evaluateHorseFlags (utils/flagEvaluationEngine.mjs:51:13)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:318:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ batchEvaluateFlags ‚Ä∫ should evaluate multiple horses

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 348 |[39m
     [90m 349 |[39m       expect(results)[33m.[39mtoHaveLength([35m3[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 350 |[39m       expect(results[33m.[39mevery(r [33m=>[39m r[33m.[39msuccess))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                             [31m[1m^[22m[39m
     [90m 351 |[39m     })[33m;[39m
     [90m 352 |[39m
     [90m 353 |[39m     test([32m'should handle mixed success/failure in batch'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:350:45)

  ‚óè Flag Evaluation Engine ‚Ä∫ batchEvaluateFlags ‚Ä∫ should handle mixed success/failure in batch

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 373 |[39m
     [90m 374 |[39m       expect(results)[33m.[39mtoHaveLength([35m2[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 375 |[39m       expect(results[[35m0[39m][33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 376 |[39m       expect(results[[35m1[39m][33m.[39msuccess)[33m.[39mtoBe([36mfalse[39m)[33m;[39m
     [90m 377 |[39m       expect(results[[35m1[39m][33m.[39merror)[33m.[39mtoContain([32m'Horse with ID 2 not found'[39m)[33m;[39m
     [90m 378 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:375:34)

  ‚óè Flag Evaluation Engine ‚Ä∫ getEligibleHorses ‚Ä∫ should return eligible horses within age range

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 1

    - Array [
    -   1,
    -   2,
    - ]
    + Array []

    [0m [90m 390 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getEligibleHorses()[33m;[39m
     [90m 391 |[39m
    [31m[1m>[22m[39m[90m 392 |[39m       expect(result)[33m.[39mtoEqual([[35m1[39m[33m,[39m [35m2[39m])[33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 393 |[39m       expect(mockPrisma[33m.[39mhorse[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m 394 |[39m         where[33m:[39m {
     [90m 395 |[39m           dateOfBirth[33m:[39m {[0m

      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:392:22)

  ‚óè Flag Evaluation Engine ‚Ä∫ getEligibleHorses ‚Ä∫ should handle database errors in getEligibleHorses

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: []

    [0m [90m 410 |[39m       mockPrisma[33m.[39mhorse[33m.[39mfindMany[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database error'[39m))[33m;[39m
     [90m 411 |[39m
    [31m[1m>[22m[39m[90m 412 |[39m       [36mawait[39m expect(getEligibleHorses())[33m.[39mrejects[33m.[39mtoThrow([32m'Database error'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 413 |[39m     })[33m;[39m
     [90m 414 |[39m   })[33m;[39m
     [90m 415 |[39m })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/unit/flagEvaluationEngine.test.mjs:412:13)

FAIL tests/xpLogModel.test.mjs
  ‚óè ÔøΩÔøΩ UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ logXpEvent ‚Ä∫ should log XP event successfully

    PrismaClientKnownRequestError: 
    Invalid `prisma.xpEvent.create()` invocation:


    Foreign key constraint violated on the constraint: `xp_events_userId_fkey`

    [0m [90m 38 |[39m
     [90m 39 |[39m     [90m// Insert XP event into database using Prisma[39m
    [31m[1m>[22m[39m[90m 40 |[39m     [36mconst[39m xpEvent [33m=[39m [36mawait[39m prisma[33m.[39mxpEvent[33m.[39mcreate({
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 41 |[39m       data[33m:[39m {
     [90m 42 |[39m         userId[33m,[39m [90m// Changed userId to userId[39m
     [90m 43 |[39m         amount[33m,[39m[0m

      at Zn.handleRequestError (../packages/database/node_modules/@prisma/client/runtime/library.js:121:7459)
      at Zn.handleAndLogRequestError (../packages/database/node_modules/@prisma/client/runtime/library.js:121:6784)
      at Zn.request (../packages/database/node_modules/@prisma/client/runtime/library.js:121:6491)
      at l (../packages/database/node_modules/@prisma/client/runtime/library.js:130:9778)
      at logXpEvent (models/xpLogModel.mjs:40:21)
      at Object.<anonymous> (tests/xpLogModel.test.mjs:98:22)

  ‚óè ÔøΩÔøΩ UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ logXpEvent ‚Ä∫ should handle database errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Database connection failed"
    Received message:   "
    Invalid `prisma.xpEvent.create()` invocation:¬∑¬∑
    Foreign key constraint violated on the constraint: `xp_events_userId_fkey`"

        [0m [90m 38 |[39m
         [90m 39 |[39m     [90m// Insert XP event into database using Prisma[39m
        [31m[1m>[22m[39m[90m 40 |[39m     [36mconst[39m xpEvent [33m=[39m [36mawait[39m prisma[33m.[39mxpEvent[33m.[39mcreate({
         [90m    |[39m                     [31m[1m^[22m[39m
         [90m 41 |[39m       data[33m:[39m {
         [90m 42 |[39m         userId[33m,[39m [90m// Changed userId to userId[39m
         [90m 43 |[39m         amount[33m,[39m[0m

      at Zn.handleRequestError (../packages/database/node_modules/@prisma/client/runtime/library.js:121:7459)
      at Zn.handleAndLogRequestError (../packages/database/node_modules/@prisma/client/runtime/library.js:121:6784)
      at Zn.request (../packages/database/node_modules/@prisma/client/runtime/library.js:121:6491)
      at l (../packages/database/node_modules/@prisma/client/runtime/library.js:130:9778)
      at logXpEvent (models/xpLogModel.mjs:40:21)
      at Object.<anonymous> (tests/xpLogModel.test.mjs:157:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/xpLogModel.test.mjs:163:17)

  ‚óè ÔøΩÔøΩ UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ logXpEvent ‚Ä∫ should handle negative XP amounts

    PrismaClientKnownRequestError: 
    Invalid `prisma.xpEvent.create()` invocation:


    Foreign key constraint violated on the constraint: `xp_events_userId_fkey`

    [0m [90m 38 |[39m
     [90m 39 |[39m     [90m// Insert XP event into database using Prisma[39m
    [31m[1m>[22m[39m[90m 40 |[39m     [36mconst[39m xpEvent [33m=[39m [36mawait[39m prisma[33m.[39mxpEvent[33m.[39mcreate({
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 41 |[39m       data[33m:[39m {
     [90m 42 |[39m         userId[33m,[39m [90m// Changed userId to userId[39m
     [90m 43 |[39m         amount[33m,[39m[0m

      at Zn.handleRequestError (../packages/database/node_modules/@prisma/client/runtime/library.js:121:7459)
      at Zn.handleAndLogRequestError (../packages/database/node_modules/@prisma/client/runtime/library.js:121:6784)
      at Zn.request (../packages/database/node_modules/@prisma/client/runtime/library.js:121:6491)
      at l (../packages/database/node_modules/@prisma/client/runtime/library.js:130:9778)
      at logXpEvent (models/xpLogModel.mjs:40:21)
      at Object.<anonymous> (tests/xpLogModel.test.mjs:181:22)

  ‚óè ÔøΩÔøΩ UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ getUserXpEvents ‚Ä∫ should retrieve XP events for a user

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"orderBy": {"timestamp": "desc"}, "skip": 0, "take": 50, "where": {"userId": "user-123"}}

    Number of calls: 0

    [0m [90m 219 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserXpEvents([32m'user-123'[39m)[33m;[39m
     [90m 220 |[39m
    [31m[1m>[22m[39m[90m 221 |[39m       expect(mockPrismaXpEvent[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 222 |[39m         where[33m:[39m { userId[33m:[39m [32m'user-123'[39m }[33m,[39m
     [90m 223 |[39m         orderBy[33m:[39m { timestamp[33m:[39m [32m'desc'[39m }[33m,[39m
     [90m 224 |[39m         take[33m:[39m [35m50[39m[33m,[39m[0m

      at Object.<anonymous> (tests/xpLogModel.test.mjs:221:42)

  ‚óè ÔøΩÔøΩ UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ getUserXpEvents ‚Ä∫ should handle date filters

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"orderBy": {"timestamp": "desc"}, "skip": 5, "take": 10, "where": {"timestamp": {"gte": 2024-01-01T00:00:00.000Z, "lte": 2024-01-02T00:00:00.000Z}, "userId": "user-123"}}

    Number of calls: 0

    [0m [90m 245 |[39m       })[33m;[39m
     [90m 246 |[39m
    [31m[1m>[22m[39m[90m 247 |[39m       expect(mockPrismaXpEvent[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 248 |[39m         where[33m:[39m {
     [90m 249 |[39m           userId[33m:[39m [32m'user-123'[39m[33m,[39m
     [90m 250 |[39m           timestamp[33m:[39m {[0m

      at Object.<anonymous> (tests/xpLogModel.test.mjs:247:42)

  ‚óè ÔøΩÔøΩ UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ getUserXpSummary ‚Ä∫ should calculate XP summary correctly

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 4

      Object {
    -   "netTotal": 45,
    -   "totalEvents": 5,
    -   "totalGained": 50,
    -   "totalLost": 5,
    +   "netTotal": 0,
    +   "totalEvents": 0,
    +   "totalGained": 0,
    +   "totalLost": 0,
      }

    [0m [90m 268 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserXpSummary([32m'user-123'[39m)[33m;[39m
     [90m 269 |[39m
    [31m[1m>[22m[39m[90m 270 |[39m       expect(result)[33m.[39mtoEqual({
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 271 |[39m         totalGained[33m:[39m [35m50[39m[33m,[39m [90m// 20 + 15 + 5 + 10[39m
     [90m 272 |[39m         totalLost[33m:[39m [35m5[39m[33m,[39m [90m// abs(-5)[39m
     [90m 273 |[39m         netTotal[33m:[39m [35m45[39m[33m,[39m [90m// 20 + 15 + 5 - 5 + 10[39m[0m

      at Object.<anonymous> (tests/xpLogModel.test.mjs:270:22)

  ‚óè ÔøΩÔøΩ UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ getUserXpSummary ‚Ä∫ should handle date filters in summary

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"select": {"amount": true}, "where": {"timestamp": {"gte": 2024-01-01T00:00:00.000Z, "lte": 2024-01-02T00:00:00.000Z}, "userId": "user-123"}}

    Number of calls: 0

    [0m [90m 302 |[39m       [36mawait[39m getUserXpSummary([32m'user-123'[39m[33m,[39m startDate[33m,[39m endDate)[33m;[39m
     [90m 303 |[39m
    [31m[1m>[22m[39m[90m 304 |[39m       expect(mockPrismaXpEvent[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 305 |[39m         where[33m:[39m {
     [90m 306 |[39m           userId[33m:[39m [32m'user-123'[39m[33m,[39m
     [90m 307 |[39m           timestamp[33m:[39m {[0m

      at Object.<anonymous> (tests/xpLogModel.test.mjs:304:42)

  ‚óè ÔøΩÔøΩ UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ getRecentXpEvents ‚Ä∫ should retrieve recent XP events across all users

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"include": {"user": {"select": {"id": true, "username": true}}}, "orderBy": {"timestamp": "desc"}, "skip": 0, "take": 10}

    Number of calls: 0

    [0m [90m 338 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getRecentXpEvents({ limit[33m:[39m [35m10[39m[33m,[39m offset[33m:[39m [35m0[39m })[33m;[39m
     [90m 339 |[39m
    [31m[1m>[22m[39m[90m 340 |[39m       expect(mockPrismaXpEvent[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 341 |[39m         orderBy[33m:[39m { timestamp[33m:[39m [32m'desc'[39m }[33m,[39m
     [90m 342 |[39m         take[33m:[39m [35m10[39m[33m,[39m
     [90m 343 |[39m         skip[33m:[39m [35m0[39m[33m,[39m[0m

      at Object.<anonymous> (tests/xpLogModel.test.mjs:340:42)

  ‚óè ÔøΩÔøΩ UNIT: XP Log Model - Experience Point Event Tracking ‚Ä∫ getRecentXpEvents ‚Ä∫ should use default options

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"include": {"user": {"select": {"id": true, "username": true}}}, "orderBy": {"timestamp": "desc"}, "skip": 0, "take": 100}

    Number of calls: 0

    [0m [90m 363 |[39m       [36mawait[39m getRecentXpEvents()[33m;[39m
     [90m 364 |[39m
    [31m[1m>[22m[39m[90m 365 |[39m       expect(mockPrismaXpEvent[33m.[39mfindMany)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                          [31m[1m^[22m[39m
     [90m 366 |[39m         orderBy[33m:[39m { timestamp[33m:[39m [32m'desc'[39m }[33m,[39m
     [90m 367 |[39m         take[33m:[39m [35m100[39m[33m,[39m
     [90m 368 |[39m         skip[33m:[39m [35m0[39m[33m,[39m[0m

      at Object.<anonymous> (tests/xpLogModel.test.mjs:365:42)

FAIL tests/unit/carePatternAnalysis.test.mjs
  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze patterns for eligible horse

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:58:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should reject horse too old for evaluation

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:78:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze consistent care patterns

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:123:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze novelty exposure patterns

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:172:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze stress management patterns

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:222:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze bonding patterns

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:263:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze neglect patterns

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:296:22)

  ‚óè Care Pattern Analysis ‚Ä∫ analyzeCarePatterns ‚Ä∫ should analyze environmental factors

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:338:22)

  ‚óè Care Pattern Analysis ‚Ä∫ Edge Cases ‚Ä∫ should handle horse with no interactions

    Horse with ID 1 not found

    [0m [90m 46 |[39m
     [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
    [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 49 |[39m     }
     [90m 50 |[39m
     [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:355:22)

  ‚óè Care Pattern Analysis ‚Ä∫ Edge Cases ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow(expected)

    Expected substring: "Database connection failed"
    Received message:   "Horse with ID 1 not found"

        [0m [90m 46 |[39m
         [90m 47 |[39m     [36mif[39m ([33m![39mhorse) {
        [31m[1m>[22m[39m[90m 48 |[39m       [36mthrow[39m [36mnew[39m [33mError[39m([32m`Horse with ID ${horseId} not found`[39m)[33m;[39m
         [90m    |[39m             [31m[1m^[22m[39m
         [90m 49 |[39m     }
         [90m 50 |[39m
         [90m 51 |[39m     [90m// Calculate horse age in days[39m[0m

      at analyzeCarePatterns (utils/carePatternAnalysis.mjs:48:13)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:367:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/unit/carePatternAnalysis.test.mjs:367:52)

  ‚óè Care Pattern Analysis ‚Ä∫ Edge Cases ‚Ä∫ should handle invalid evaluation date

    PrismaClientValidationError: 
    Invalid `prisma.horse.findUnique()` invocation:

    {
      where: {
        id: 1
      },
      include: {
        groomInteractions: {
          where: {
            createdAt: {
              gte: new Date("Invalid Date")
                   ~~~~~~~~~~~~~~~~~~~~~~~~
            }
          },
          orderBy: {
            createdAt: "asc"
          }
        }
      }
    }

    Invalid value for argument `gte`: Provided Date object is invalid. Expected Date.

      at kn (../packages/database/node_modules/@prisma/client/runtime/library.js:29:1363)
      at e.throwValidationError (../packages/database/node_modules/@prisma/client/runtime/library.js:29:10051)
      at Ia (../packages/database/node_modules/@prisma/client/runtime/library.js:29:7488)
      at ka (../packages/database/node_modules/@prisma/client/runtime/library.js:29:8741)
      at Ia (../packages/database/node_modules/@prisma/client/runtime/library.js:29:8272)
      at ka (../packages/database/node_modules/@prisma/client/runtime/library.js:29:8741)
      at Ia (../packages/database/node_modules/@prisma/client/runtime/library.js:29:8272)
      at ka (../packages/database/node_modules/@prisma/client/runtime/library.js:29:8741)
      at Et (../packages/database/node_modules/@prisma/client/runtime/library.js:29:5845)
      at rm (../packages/database/node_modules/@prisma/client/runtime/library.js:29:6654)
      at em (../packages/database/node_modules/@prisma/client/runtime/library.js:29:6300)
      at Xd (../packages/database/node_modules/@prisma/client/runtime/library.js:29:6186)
      at Et (../packages/database/node_modules/@prisma/client/runtime/library.js:29:5863)
      at Nn (../packages/database/node_modules/@prisma/client/runtime/library.js:29:5747)
      at ../packages/database/node_modules/@prisma/client/runtime/library.js:130:10331
      at Object.runInChildSpan (../packages/database/node_modules/@prisma/client/runtime/library.js:121:1549)
      at Io.runInChildSpan (../packages/database/node_modules/@prisma/client/runtime/library.js:121:1913)
      at r._executeRequest (../packages/database/node_modules/@prisma/client/runtime/library.js:130:10310)
      at il (../packages/database/node_modules/@prisma/client/runtime/library.js:31:9835)
      at l (../packages/database/node_modules/@prisma/client/runtime/library.js:130:9784)
      at ../packages/database/node_modules/@prisma/client/runtime/library.js:130:10078
      at ../packages/database/node_modules/@prisma/client/runtime/library.js:130:10058
      at Object.runInChildSpan (../packages/database/node_modules/@prisma/client/runtime/library.js:121:1549)
      at Io.runInChildSpan (../packages/database/node_modules/@prisma/client/runtime/library.js:121:1913)
      at r._request (../packages/database/node_modules/@prisma/client/runtime/library.js:130:9981)
      at e._createPrismaPromise.action (../packages/database/node_modules/@prisma/client/runtime/library.js:31:5390)
      at o (../packages/database/node_modules/@prisma/client/runtime/library.js:121:1018)
      at Proxy.then (../packages/database/node_modules/@prisma/client/runtime/library.js:121:1114)

FAIL tests/trainingModel.test.mjs
  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ logTrainingSession ‚Ä∫ should log a training session with all required fields

    Database error: 
    Invalid `prisma.trainingLog.create()` invocation:


    Foreign key constraint violated on the constraint: `training_logs_horseId_fkey`

    [0m [90m 47 |[39m   } [36mcatch[39m (error) {
     [90m 48 |[39m     logger[33m.[39merror([32m`[trainingModel.logTrainingSession] Database error: ${error.message}`[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 49 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error: ${error.message}`[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 50 |[39m   }
     [90m 51 |[39m }
     [90m 52 |[39m[0m

      at logTrainingSession (models/trainingModel.mjs:49:11)
      at Object.<anonymous> (tests/trainingModel.test.mjs:86:22)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ logTrainingSession ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow(expected)

    Expected substring: "Database error: Database connection failed"
    Received message:   "Database error:¬∑
    Invalid `prisma.trainingLog.create()` invocation:¬∑¬∑
    Foreign key constraint violated on the constraint: `training_logs_horseId_fkey`"

        [0m [90m 47 |[39m   } [36mcatch[39m (error) {
         [90m 48 |[39m     logger[33m.[39merror([32m`[trainingModel.logTrainingSession] Database error: ${error.message}`[39m)[33m;[39m
        [31m[1m>[22m[39m[90m 49 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error: ${error.message}`[39m)[33m;[39m
         [90m    |[39m           [31m[1m^[22m[39m
         [90m 50 |[39m   }
         [90m 51 |[39m }
         [90m 52 |[39m[0m

      at logTrainingSession (models/trainingModel.mjs:49:11)
      at Object.<anonymous> (tests/trainingModel.test.mjs:123:7)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/trainingModel.test.mjs:123:86)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ getLastTrainingDate ‚Ä∫ should return the most recent training date for horse and discipline

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"orderBy": {"trainedAt": "desc"}, "where": {"discipline": "Show Jumping", "horseId": 5}}

    Number of calls: 0

    [0m [90m 136 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getLastTrainingDate([35m5[39m[33m,[39m [32m'Show Jumping'[39m)[33m;[39m
     [90m 137 |[39m
    [31m[1m>[22m[39m[90m 138 |[39m       expect(mockTrainingLogFindFirst)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                        [31m[1m^[22m[39m
     [90m 139 |[39m         where[33m:[39m {
     [90m 140 |[39m           horseId[33m:[39m [35m5[39m[33m,[39m
     [90m 141 |[39m           discipline[33m:[39m [32m'Show Jumping'[39m[33m,[39m[0m

      at Object.<anonymous> (tests/trainingModel.test.mjs:138:40)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ getLastTrainingDate ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: null

    [0m [90m 173 |[39m       mockTrainingLogFindFirst[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database connection failed'[39m))[33m;[39m
     [90m 174 |[39m
    [31m[1m>[22m[39m[90m 175 |[39m       [36mawait[39m expect(getLastTrainingDate([35m5[39m[33m,[39m [32m'Racing'[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Database error: Database connection failed'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 176 |[39m     })[33m;[39m
     [90m 177 |[39m   })[33m;[39m
     [90m 178 |[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/trainingModel.test.mjs:175:13)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ getHorseAge ‚Ä∫ should return horse age from database

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"select": {"age": true}, "where": {"id": 10}}

    Number of calls: 0

    [0m [90m 186 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getHorseAge([35m10[39m)[33m;[39m
     [90m 187 |[39m
    [31m[1m>[22m[39m[90m 188 |[39m       expect(mockHorseFindUnique)[33m.[39mtoHaveBeenCalledWith({
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 189 |[39m         where[33m:[39m { id[33m:[39m [35m10[39m }[33m,[39m
     [90m 190 |[39m         select[33m:[39m { age[33m:[39m [36mtrue[39m }[33m,[39m
     [90m 191 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (tests/trainingModel.test.mjs:188:35)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ getHorseAge ‚Ä∫ should handle database errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: null

    [0m [90m 212 |[39m       mockHorseFindUnique[33m.[39mmockRejectedValue([36mnew[39m [33mError[39m([32m'Database connection failed'[39m))[33m;[39m
     [90m 213 |[39m
    [31m[1m>[22m[39m[90m 214 |[39m       [36mawait[39m expect(getHorseAge([35m5[39m))[33m.[39mrejects[33m.[39mtoThrow([32m'Database error: Database connection failed'[39m)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 215 |[39m     })[33m;[39m
     [90m 216 |[39m   })[33m;[39m
     [90m 217 |[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/trainingModel.test.mjs:214:13)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ Integration scenarios ‚Ä∫ should handle multiple training sessions for same horse different disciplines

    Database error: 
    Invalid `prisma.trainingLog.create()` invocation:


    Foreign key constraint violated on the constraint: `training_logs_horseId_fkey`

    [0m [90m 47 |[39m   } [36mcatch[39m (error) {
     [90m 48 |[39m     logger[33m.[39merror([32m`[trainingModel.logTrainingSession] Database error: ${error.message}`[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 49 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m`Database error: ${error.message}`[39m)[33m;[39m
     [90m    |[39m           [31m[1m^[22m[39m
     [90m 50 |[39m   }
     [90m 51 |[39m }
     [90m 52 |[39m[0m

      at logTrainingSession (models/trainingModel.mjs:49:11)
      at Object.<anonymous> (tests/trainingModel.test.mjs:228:7)

  ‚óè ÔøΩÔøΩÔ∏è UNIT: Training Model - Training Session Logging & Horse Data ‚Ä∫ Integration scenarios ‚Ä∫ should validate horse age before allowing training

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: null

    [0m [90m 237 |[39m
     [90m 238 |[39m       [36mconst[39m age [33m=[39m [36mawait[39m getHorseAge([35m5[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 239 |[39m       expect(age)[33m.[39mtoBe([35m2[39m)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 240 |[39m
     [90m 241 |[39m       [90m// In the actual training logic, this would prevent training[39m
     [90m 242 |[39m       [90m// since horse is under 3 years old[39m[0m

      at Object.<anonymous> (tests/trainingModel.test.mjs:239:19)

FAIL models/userModel.test.mjs
  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ createUser ‚Ä∫ should create a user successfully

    TypeError: mockPrisma.user.create.mockResolvedValue is not a function

    [0m [90m 122 |[39m       }[33m;[39m
     [90m 123 |[39m
    [31m[1m>[22m[39m[90m 124 |[39m       mockPrisma[33m.[39muser[33m.[39mcreate[33m.[39mmockResolvedValue(mockCreatedUser)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 125 |[39m
     [90m 126 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m createUser(baseUserData)[33m;[39m
     [90m 127 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:124:30)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ createUser ‚Ä∫ should throw error on unique constraint violation for username

    TypeError: mockPrisma.user.create.mockRejectedValue is not a function

    [0m [90m 154 |[39m     it([32m'should throw error on unique constraint violation for username'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 155 |[39m       [36mconst[39m dbError [33m=[39m { code[33m:[39m [32m'P2002'[39m[33m,[39m meta[33m:[39m { target[33m:[39m [[32m'username'[39m] } }[33m;[39m
    [31m[1m>[22m[39m[90m 156 |[39m       mockPrisma[33m.[39muser[33m.[39mcreate[33m.[39mmockRejectedValue(dbError)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 157 |[39m       [36mawait[39m expect(createUser(baseUserData))[33m.[39mrejects[33m.[39mtoThrow([32m'Duplicate value for username.'[39m)[33m;[39m
     [90m 158 |[39m     })[33m;[39m
     [90m 159 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:156:30)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ createUser ‚Ä∫ should throw error on unique constraint violation for email

    TypeError: mockPrisma.user.create.mockRejectedValue is not a function

    [0m [90m 160 |[39m     it([32m'should throw error on unique constraint violation for email'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 161 |[39m       [36mconst[39m dbError [33m=[39m { code[33m:[39m [32m'P2002'[39m[33m,[39m meta[33m:[39m { target[33m:[39m [[32m'email'[39m] } }[33m;[39m
    [31m[1m>[22m[39m[90m 162 |[39m       mockPrisma[33m.[39muser[33m.[39mcreate[33m.[39mmockRejectedValue(dbError)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 163 |[39m       [36mawait[39m expect(createUser(baseUserData))[33m.[39mrejects[33m.[39mtoThrow([32m'Duplicate value for email.'[39m)[33m;[39m
     [90m 164 |[39m     })[33m;[39m
     [90m 165 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:162:30)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ createUser ‚Ä∫ should throw DatabaseError for other Prisma errors

    TypeError: mockPrisma.user.create.mockRejectedValue is not a function

    [0m [90m 166 |[39m     it([32m'should throw DatabaseError for other Prisma errors'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 167 |[39m       [36mconst[39m dbError [33m=[39m [36mnew[39m [33mError[39m([32m'Some other DB error'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 168 |[39m       mockPrisma[33m.[39muser[33m.[39mcreate[33m.[39mmockRejectedValue(dbError)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 169 |[39m       [36mawait[39m expect(createUser(baseUserData))[33m.[39mrejects[33m.[39mtoThrow(
     [90m 170 |[39m         [36mnew[39m [33mDatabaseError[39m([32m'Create user failed: Some other DB error'[39m)[33m,[39m
     [90m 171 |[39m       )[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:168:30)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserById ‚Ä∫ should return user if found

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 175 |[39m     it([32m'should return user if found'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 176 |[39m       [36mconst[39m mockUser [33m=[39m { id[33m:[39m [35m1[39m[33m,[39m username[33m:[39m [32m'testuser'[39m[33m,[39m email[33m:[39m [32m'test@example.com'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 177 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 178 |[39m
     [90m 179 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserById([35m1[39m)[33m;[39m
     [90m 180 |[39m       expect(mockPrisma[33m.[39muser[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith({ where[33m:[39m { id[33m:[39m [35m1[39m } })[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:177:34)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserById ‚Ä∫ should return null if user not found

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 183 |[39m
     [90m 184 |[39m     it([32m'should return null if user not found'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 185 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 186 |[39m       [36mconst[39m user [33m=[39m [36mawait[39m getUserById([35m99[39m)[33m;[39m
     [90m 187 |[39m       expect(user)[33m.[39mtoBeNull()[33m;[39m
     [90m 188 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:185:34)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserByEmail ‚Ä∫ should return user by email (case insensitive)

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 197 |[39m     it([32m'should return user by email (case insensitive)'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 198 |[39m       [36mconst[39m mockUser [33m=[39m { id[33m:[39m [35m1[39m[33m,[39m email[33m:[39m [32m'test@example.com'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 199 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 200 |[39m
     [90m 201 |[39m       [36mconst[39m user [33m=[39m [36mawait[39m getUserByEmail([32m'TEST@EXAMPLE.COM'[39m)[33m;[39m
     [90m 202 |[39m       expect(mockPrisma[33m.[39muser[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith({[0m

      at Object.<anonymous> (models/userModel.test.mjs:199:34)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserWithHorses ‚Ä∫ should return user with horses if found

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 215 |[39m     it([32m'should return user with horses if found'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 216 |[39m       [36mconst[39m mockUser [33m=[39m { id[33m:[39m [35m1[39m[33m,[39m horses[33m:[39m [{ id[33m:[39m [35m101[39m[33m,[39m name[33m:[39m [32m'Spirit'[39m }] }[33m;[39m
    [31m[1m>[22m[39m[90m 217 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 218 |[39m
     [90m 219 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserWithHorses([35m1[39m)[33m;[39m
     [90m 220 |[39m       expect(mockPrisma[33m.[39muser[33m.[39mfindUnique)[33m.[39mtoHaveBeenCalledWith({[0m

      at Object.<anonymous> (models/userModel.test.mjs:217:34)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ updateUser ‚Ä∫ should update user successfully

    TypeError: mockPrisma.user.update.mockResolvedValue is not a function

    [0m [90m 235 |[39m     it([32m'should update user successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 236 |[39m       [36mconst[39m mockUpdatedUser [33m=[39m { id[33m:[39m [35m1[39m[33m,[39m username[33m:[39m [32m'testuser'[39m[33m,[39m [33m...[39mupdateData }[33m;[39m
    [31m[1m>[22m[39m[90m 237 |[39m       mockPrisma[33m.[39muser[33m.[39mupdate[33m.[39mmockResolvedValue(mockUpdatedUser)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 238 |[39m
     [90m 239 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m updateUser([35m1[39m[33m,[39m updateData)[33m;[39m
     [90m 240 |[39m       expect(mockPrisma[33m.[39muser[33m.[39mupdate)[33m.[39mtoHaveBeenCalledWith({[0m

      at Object.<anonymous> (models/userModel.test.mjs:237:30)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ updateUser ‚Ä∫ should handle Prisma update errors (user not found)

    TypeError: mockPrisma.user.update.mockRejectedValue is not a function

    [0m [90m 253 |[39m     it([32m'should handle Prisma update errors (user not found)'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 254 |[39m       [36mconst[39m prismaError [33m=[39m { code[33m:[39m [32m'P2025'[39m[33m,[39m message[33m:[39m [32m'Record to update not found.'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 255 |[39m       mockPrisma[33m.[39muser[33m.[39mupdate[33m.[39mmockRejectedValue(prismaError)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 256 |[39m
     [90m 257 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m updateUser([35m1[39m[33m,[39m updateData)[33m;[39m
     [90m 258 |[39m       expect(result)[33m.[39mtoBeNull()[33m;[39m [90m// Returns null when user not found[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:255:30)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ updateUser ‚Ä∫ should handle general update errors

    TypeError: mockPrisma.user.update.mockRejectedValue is not a function

    [0m [90m 261 |[39m     it([32m'should handle general update errors'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 262 |[39m       [36mconst[39m prismaError [33m=[39m { message[33m:[39m [32m'Some other update error'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 263 |[39m       mockPrisma[33m.[39muser[33m.[39mupdate[33m.[39mmockRejectedValue(prismaError)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 264 |[39m
     [90m 265 |[39m       [36mawait[39m expect(updateUser([35m1[39m[33m,[39m updateData))[33m.[39mrejects[33m.[39mtoThrow(
     [90m 266 |[39m         [36mnew[39m [33mDatabaseError[39m([32m'Update failed: Some other update error'[39m)[33m,[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:263:30)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ deleteUser ‚Ä∫ should delete user successfully

    TypeError: mockPrisma.user.delete.mockResolvedValue is not a function

    [0m [90m 272 |[39m     it([32m'should delete user successfully'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 273 |[39m       [36mconst[39m deletedUser [33m=[39m { id[33m:[39m [35m1[39m[33m,[39m username[33m:[39m [32m'testuser'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 274 |[39m       mockPrisma[33m.[39muser[33m.[39m[36mdelete[39m[33m.[39mmockResolvedValue(deletedUser)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 275 |[39m
     [90m 276 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m deleteUser([35m1[39m)[33m;[39m
     [90m 277 |[39m       expect(mockPrisma[33m.[39muser[33m.[39m[36mdelete[39m)[33m.[39mtoHaveBeenCalledWith({ where[33m:[39m { id[33m:[39m [35m1[39m } })[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:274:30)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ deleteUser ‚Ä∫ should handle Prisma delete errors (user not found)

    TypeError: mockPrisma.user.delete.mockRejectedValue is not a function

    [0m [90m 285 |[39m     it([32m'should handle Prisma delete errors (user not found)'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 286 |[39m       [36mconst[39m prismaError [33m=[39m { code[33m:[39m [32m'P2025'[39m[33m,[39m message[33m:[39m [32m'Record to delete not found.'[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 287 |[39m       mockPrisma[33m.[39muser[33m.[39m[36mdelete[39m[33m.[39mmockRejectedValue(prismaError)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 288 |[39m
     [90m 289 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m deleteUser([35m99[39m)[33m;[39m
     [90m 290 |[39m       expect(result)[33m.[39mtoBeNull()[33m;[39m [90m// Returns null when user not found[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:287:30)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ addXpToUser ‚Ä∫ should add XP without leveling up

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 296 |[39m
     [90m 297 |[39m     it([32m'should add XP without leveling up'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 298 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(baseUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 299 |[39m       [36mconst[39m updatedUser [33m=[39m { [33m...[39mbaseUser[33m,[39m xp[33m:[39m [35m70[39m[33m,[39m level[33m:[39m [35m1[39m }[33m;[39m
     [90m 300 |[39m       mockPrisma[33m.[39muser[33m.[39mupdate[33m.[39mmockResolvedValue(updatedUser)[33m;[39m
     [90m 301 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:298:34)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ addXpToUser ‚Ä∫ should add XP and level up

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 313 |[39m
     [90m 314 |[39m     it([32m'should add XP and level up'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 315 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(baseUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 316 |[39m       [36mconst[39m updatedUser [33m=[39m { [33m...[39mbaseUser[33m,[39m xp[33m:[39m [35m200[39m[33m,[39m level[33m:[39m [35m2[39m }[33m;[39m
     [90m 317 |[39m       mockPrisma[33m.[39muser[33m.[39mupdate[33m.[39mmockResolvedValue(updatedUser)[33m;[39m
     [90m 318 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:315:34)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ addXpToUser ‚Ä∫ should return error for invalid XP amount

    expect(received).toHaveBeenCalledWith(...expected)

    Matcher error: received value must be a mock or spy function

    Received has type:  function
    Received has value: [Function anonymous]

    [0m [90m 337 |[39m         })[33m,[39m
     [90m 338 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 339 |[39m       expect(mockLogger[33m.[39merror)[33m.[39mtoHaveBeenCalledWith(
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 340 |[39m         expect[33m.[39mstringContaining([32m'Error: XP amount must be a positive number.'[39m)[33m,[39m
     [90m 341 |[39m       )[33m;[39m
     [90m 342 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:339:32)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ addXpToUser ‚Ä∫ should return error for invalid user ID

    expect(received).toHaveBeenCalledWith(...expected)

    Matcher error: received value must be a mock or spy function

    Received has type:  function
    Received has value: [Function anonymous]

    [0m [90m 350 |[39m         })[33m,[39m
     [90m 351 |[39m       )[33m;[39m
    [31m[1m>[22m[39m[90m 352 |[39m       expect(mockLogger[33m.[39merror)[33m.[39mtoHaveBeenCalledWith(expect[33m.[39mstringContaining([32m'Error: User ID is required.'[39m))[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 353 |[39m     })[33m;[39m
     [90m 354 |[39m
     [90m 355 |[39m     it([32m'should return error if user not found'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (models/userModel.test.mjs:352:32)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ addXpToUser ‚Ä∫ should return error if user not found

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 354 |[39m
     [90m 355 |[39m     it([32m'should return error if user not found'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 356 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 357 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m addXpToUser([35m99[39m[33m,[39m [35m20[39m)[33m;[39m
     [90m 358 |[39m       expect(result)[33m.[39mtoEqual(
     [90m 359 |[39m         expect[33m.[39mobjectContaining({[0m

      at Object.<anonymous> (models/userModel.test.mjs:356:34)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserProgress ‚Ä∫ should return user progress

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 369 |[39m     it([32m'should return user progress'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 370 |[39m       [36mconst[39m mockUser [33m=[39m { id[33m:[39m [35m1[39m[33m,[39m level[33m:[39m [35m1[39m[33m,[39m xp[33m:[39m [35m50[39m }[33m;[39m
    [31m[1m>[22m[39m[90m 371 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 372 |[39m
     [90m 373 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserProgress([35m1[39m)[33m;[39m
     [90m 374 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:371:34)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserProgress ‚Ä∫ should throw DatabaseError if user not found

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 389 |[39m
     [90m 390 |[39m     it([32m'should throw DatabaseError if user not found'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 391 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 392 |[39m       [36mawait[39m expect(getUserProgress([35m99[39m))[33m.[39mrejects[33m.[39mtoThrow([36mnew[39m [33mDatabaseError[39m([32m'Progress fetch failed: User not found.'[39m))[33m;[39m
     [90m 393 |[39m     })[33m;[39m
     [90m 394 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:391:34)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserStats ‚Ä∫ should return user stats with horses

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 409 |[39m       }[33m;[39m
     [90m 410 |[39m
    [31m[1m>[22m[39m[90m 411 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 412 |[39m
     [90m 413 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserStats([35m1[39m)[33m;[39m
     [90m 414 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:411:34)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserStats ‚Ä∫ should handle user with no horses

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 442 |[39m       }[33m;[39m
     [90m 443 |[39m
    [31m[1m>[22m[39m[90m 444 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 445 |[39m
     [90m 446 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserStats([35m2[39m)[33m;[39m
     [90m 447 |[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:444:34)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserStats ‚Ä∫ should handle user with null horses array

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 468 |[39m       }[33m;[39m
     [90m 469 |[39m
    [31m[1m>[22m[39m[90m 470 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue(mockUser)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 471 |[39m
     [90m 472 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserStats([35m3[39m)[33m;[39m
     [90m 473 |[39m       expect(result)[33m.[39mtoEqual([0m

      at Object.<anonymous> (models/userModel.test.mjs:470:34)

  ‚óè ÔøΩÔøΩ UNIT: User Model - Database Operations & Business Logic ‚Ä∫ getUserStats ‚Ä∫ should return null for non-existent user

    TypeError: mockPrisma.user.findUnique.mockResolvedValue is not a function

    [0m [90m 480 |[39m
     [90m 481 |[39m     it([32m'should return null for non-existent user'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 482 |[39m       mockPrisma[33m.[39muser[33m.[39mfindUnique[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 483 |[39m
     [90m 484 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m getUserStats([35m999[39m)[33m;[39m
     [90m 485 |[39m       expect(result)[33m.[39mtoBeNull()[33m;[39m[0m

      at Object.<anonymous> (models/userModel.test.mjs:482:34)

FAIL tests/integration/advancedBreedingGeneticsAPI.test.mjs
  ‚óè ÔøΩÔøΩ Advanced Breeding Genetics API Integration ‚Ä∫ ÔøΩÔøΩ Advanced Lineage Analysis API ‚Ä∫ POST /api/breeding/breeding-recommendations should generate comprehensive recommendations

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 241 |[39m         [33m.[39m[36mset[39m([32m'x-test-skip-csrf'[39m[33m,[39m [32m'true'[39m)
     [90m 242 |[39m         [33m.[39msend({
    [31m[1m>[22m[39m[90m 243 |[39m           stallionId[33m:[39m testStallion[33m.[39mid[33m,[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 244 |[39m           mareId[33m:[39m testMare[33m.[39mid[33m,[39m
     [90m 245 |[39m         })[33m;[39m
     [90m 246 |[39m[0m

      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:243:36)

  ‚óè ÔøΩÔøΩ Advanced Breeding Genetics API Integration ‚Ä∫ ÔøΩÔøΩ Genetic Diversity Tracking API ‚Ä∫ POST /api/genetics/population-analysis should analyze population genetics

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 265 |[39m   describe([32m'ÔøΩÔøΩ Genetic Diversity Tracking API'[39m[33m,[39m () [33m=>[39m {
     [90m 266 |[39m     test([32m'POST /api/genetics/population-analysis should analyze population genetics'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 267 |[39m       [36mconst[39m horseIds [33m=[39m testPopulation[33m.[39mmap(h [33m=>[39m h[33m.[39mid)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 268 |[39m
     [90m 269 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
     [90m 270 |[39m         [33m.[39mpost([32m'/api/genetics/population-analysis'[39m)[0m

      at tests/integration/advancedBreedingGeneticsAPI.test.mjs:267:50
          at Array.map (<anonymous>)
      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:267:39)

  ‚óè ÔøΩÔøΩ Advanced Breeding Genetics API Integration ‚Ä∫ ÔøΩÔøΩ Genetic Diversity Tracking API ‚Ä∫ POST /api/genetics/inbreeding-analysis should calculate detailed inbreeding

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 298 |[39m         [33m.[39m[36mset[39m([32m'x-test-skip-csrf'[39m[33m,[39m [32m'true'[39m)
     [90m 299 |[39m         [33m.[39msend({
    [31m[1m>[22m[39m[90m 300 |[39m           stallionId[33m:[39m testStallion[33m.[39mid[33m,[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 301 |[39m           mareId[33m:[39m testMare[33m.[39mid[33m,[39m
     [90m 302 |[39m         })[33m;[39m
     [90m 303 |[39m[0m

      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:300:36)

  ‚óè ÔøΩÔøΩ Advanced Breeding Genetics API Integration ‚Ä∫ ÔøΩÔøΩ Genetic Diversity Tracking API ‚Ä∫ POST /api/genetics/optimal-breeding should recommend optimal breeding pairs

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 345 |[39m
     [90m 346 |[39m     test([32m'POST /api/genetics/optimal-breeding should recommend optimal breeding pairs'[39m[33m,[39m [36masync[39m () [33m=>[39m {
    [31m[1m>[22m[39m[90m 347 |[39m       [36mconst[39m horseIds [33m=[39m testPopulation[33m.[39mmap(h [33m=>[39m h[33m.[39mid)[33m;[39m
     [90m     |[39m                                                  [31m[1m^[22m[39m
     [90m 348 |[39m
     [90m 349 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
     [90m 350 |[39m         [33m.[39mpost([32m'/api/genetics/optimal-breeding'[39m)[0m

      at tests/integration/advancedBreedingGeneticsAPI.test.mjs:347:50
          at Array.map (<anonymous>)
      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:347:39)

  ‚óè ÔøΩÔøΩ Advanced Breeding Genetics API Integration ‚Ä∫ ÔøΩÔøΩ API Security and Validation ‚Ä∫ All genetic endpoints should require authentication

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 378 |[39m       [36mconst[39m endpoints [33m=[39m [
     [90m 379 |[39m         { method[33m:[39m [32m'post'[39m[33m,[39m path[33m:[39m [32m'/api/breeding/genetic-probability'[39m }[33m,[39m
    [31m[1m>[22m[39m[90m 380 |[39m         { method[33m:[39m [32m'get'[39m[33m,[39m path[33m:[39m [32m`/api/breeding/lineage-analysis/${testStallion.id}/${testMare.id}`[39m }[33m,[39m
     [90m     |[39m                                                                               [31m[1m^[22m[39m
     [90m 381 |[39m         { method[33m:[39m [32m'post'[39m[33m,[39m path[33m:[39m [32m'/api/breeding/breeding-recommendations'[39m }[33m,[39m
     [90m 382 |[39m         { method[33m:[39m [32m'post'[39m[33m,[39m path[33m:[39m [32m'/api/genetics/population-analysis'[39m }[33m,[39m
     [90m 383 |[39m         { method[33m:[39m [32m'post'[39m[33m,[39m path[33m:[39m [32m'/api/genetics/inbreeding-analysis'[39m }[33m,[39m[0m

      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:380:79)

  ‚óè ÔøΩÔøΩ Advanced Breeding Genetics API Integration ‚Ä∫ ÔøΩÔøΩ API Security and Validation ‚Ä∫ Genetic endpoints should handle ownership validation

    TypeError: Cannot read properties of undefined (reading 'id')

    [0m [90m 451 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${otherToken}`[39m)
     [90m 452 |[39m         [33m.[39msend({
    [31m[1m>[22m[39m[90m 453 |[39m           stallionId[33m:[39m testStallion[33m.[39mid[33m,[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 454 |[39m           mareId[33m:[39m testMare[33m.[39mid[33m,[39m
     [90m 455 |[39m         })[33m;[39m
     [90m 456 |[39m[0m

      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:453:36)


Test Suites: 12 failed, 1 skipped, 200 passed, 212 of 213 total
Tests:       139 failed, 18 skipped, 3225 passed, 3382 total
Snapshots:   0 total
Time:        277.436 s
Ran all test suites.
üßπ Running global teardown...
[Teardown] Disconnecting Prisma instances...
[Teardown] ‚úÖ Prisma instances disconnected
‚úÖ Global teardown completed successfully

Jest has detected the following 2 open handles potentially keeping Jest from exiting:

  ‚óè  TCPSERVERWRAP

    [0m [90m 237 |[39m     test([32m'POST /api/breeding/breeding-recommendations should generate comprehensive recommendations'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 238 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 239 |[39m         [33m.[39mpost([32m'/api/breeding/breeding-recommendations'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 240 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 241 |[39m         [33m.[39m[36mset[39m([32m'x-test-skip-csrf'[39m[33m,[39m [32m'true'[39m)
     [90m 242 |[39m         [33m.[39msend({[0m

      at Test.serverAddress (node_modules/supertest/lib/test.js:63:35)
      at new Test (node_modules/supertest/lib/test.js:49:14)
      at Object.obj.<computed> [as post] (node_modules/supertest/index.js:39:18)
      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:239:10)


  ‚óè  TCPSERVERWRAP

    [0m [90m 294 |[39m     test([32m'POST /api/genetics/inbreeding-analysis should calculate detailed inbreeding'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 295 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
    [31m[1m>[22m[39m[90m 296 |[39m         [33m.[39mpost([32m'/api/genetics/inbreeding-analysis'[39m)
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 297 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${authToken}`[39m)
     [90m 298 |[39m         [33m.[39m[36mset[39m([32m'x-test-skip-csrf'[39m[33m,[39m [32m'true'[39m)
     [90m 299 |[39m         [33m.[39msend({[0m

      at Test.serverAddress (node_modules/supertest/lib/test.js:63:35)
      at new Test (node_modules/supertest/lib/test.js:49:14)
      at Object.obj.<computed> [as post] (node_modules/supertest/index.js:39:18)
      at Object.<anonymous> (tests/integration/advancedBreedingGeneticsAPI.test.mjs:296:10)

