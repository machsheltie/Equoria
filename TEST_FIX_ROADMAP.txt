╔═══════════════════════════════════════════════════════════════════════════════╗
║                    EQUORIA TEST FAILURE FIX ROADMAP                          ║
║                         94.5% → 99.2% Pass Rate                              ║
║                         165 Failures → 30 Skipped                            ║
╚═══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│ CURRENT STATE (2026-01-28)                                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│ Total Tests:    3,540                                                       │
│ Passing:        3,345 (94.5%)                                              │
│ Failing:        165 (4.7%)                                                  │
│ Skipped:        30                                                          │
│ Failed Suites:  23/220 (10.5%)                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ FAILURE CATEGORIES                                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│ P0: Prisma Syntax Error       122 failures (73.9%)  ████████████████████   │
│ P1: Personality Definition     17 failures (10.3%)  ██                     │
│ P2: API Response Structure     20 failures (12.1%)  ███                    │
│ P3: Individual Failures         6 failures ( 3.6%)  █                      │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ FIX PHASES (Sequential Execution)                                           │
└─────────────────────────────────────────────────────────────────────────────┘

  PHASE 1: CRITICAL SYNTAX FIX (10 minutes)
  ┌───────────────────────────────────────────────────────────────────────────┐
  │ Task: Fix Prisma user/userId syntax in 10 test files                     │
  │ Impact: 122 failures → Pass rate: 97.9% (3,467/3,540)                    │
  │ Files: groomHandlerSystem, groomAssignmentSystem, groomSalarySystem,    │
  │        groomWorkflowIntegration, groomRetirementService,                 │
  │        groomBondingIntegration, groomBonusTraits,                        │
  │        foalTaskLoggingIntegration, foalEnrichmentIntegration,            │
  │        legacyScoreTraitIntegration                                        │
  │ Method: Global find-replace                                               │
  │   Find: user: { connect: { id: X } }                                     │
  │   Replace: userId: X                                                      │
  │ Verify: npm test -- groom                                                 │
  └───────────────────────────────────────────────────────────────────────────┘
                                    ⬇
  PHASE 2: PERSONALITY DEFINITION (5 minutes)
  ┌───────────────────────────────────────────────────────────────────────────┐
  │ Task: Add 'balanced' to PERSONALITY_TRAIT_DEFINITIONS                     │
  │ Impact: 17 failures → Pass rate: 98.5% (3,484/3,540)                     │
  │ Files: services/groomPersonalityTraits.mjs                               │
  │ Method: Add constant definition                                           │
  │ Verify: npm test -- dynamicCompatibility                                  │
  └───────────────────────────────────────────────────────────────────────────┘
                                    ⬇
  PHASE 3: API RESPONSE STRUCTURE (30 minutes)
  ┌───────────────────────────────────────────────────────────────────────────┐
  │ Task: Update test expectations for new API format                         │
  │ Impact: 20 failures → Pass rate: 99.0% (3,504/3,540)                     │
  │ Files: userProgressAPI.integration.test.mjs (5 tests)                    │
  │        userRoutes.test.mjs (1 test)                                       │
  │        groomWorkflowIntegration.test.mjs (14 tests)                      │
  │ Method: Replace .toEqual() with .toMatchObject()                         │
  │ Verify: npm test -- userProgress                                          │
  └───────────────────────────────────────────────────────────────────────────┘
                                    ⬇
  PHASE 4: INDIVIDUAL FAILURES (45 minutes)
  ┌───────────────────────────────────────────────────────────────────────────┐
  │ Task: Fix 6 unique test failures                                          │
  │ Impact: 6 failures → Pass rate: 99.2% (3,510/3,540)                      │
  │ Files: breedingPrediction, competitionWorkflow, epigeneticTraitSystem,   │
  │        horseBreedingWorkflow, horseRoutes, enhancedReportingRoutes       │
  │ Method: Individual debugging (7.5 min per file)                          │
  │ Issues: Age validation, ownership checks, data isolation                 │
  │ Verify: npm test (full suite)                                             │
  └───────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ PROGRESS TRACKING                                                           │
└─────────────────────────────────────────────────────────────────────────────┘

  Current:     3,345 ████████████████████████████                (94.5%)
               ─────────────────────────────────────────────────────────────
  Phase 1:     3,467 ██████████████████████████████              (97.9%) +122
               ─────────────────────────────────────────────────────────────
  Phase 2:     3,484 ███████████████████████████████             (98.5%) +17
               ─────────────────────────────────────────────────────────────
  Phase 3:     3,504 ████████████████████████████████            (99.0%) +20
               ─────────────────────────────────────────────────────────────
  Target:      3,510 ████████████████████████████████            (99.2%) +6
               ─────────────────────────────────────────────────────────────
                     0     500   1000  1500  2000  2500  3000  3540

┌─────────────────────────────────────────────────────────────────────────────┐
│ TIME INVESTMENT & ROI                                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│ Phase    Time    Fixes   ROI (fixes/min)   Cumulative Pass Rate            │
├─────────────────────────────────────────────────────────────────────────────┤
│ Phase 1  10 min  122     12.2 fixes/min    97.9%  ★★★★★ HIGHEST ROI      │
│ Phase 2   5 min   17      3.4 fixes/min    98.5%  ★★★★☆                  │
│ Phase 3  30 min   20      0.7 fixes/min    99.0%  ★★☆☆☆                  │
│ Phase 4  45 min    6      0.1 fixes/min    99.2%  ★☆☆☆☆                  │
├─────────────────────────────────────────────────────────────────────────────┤
│ TOTAL    90 min  165      1.8 fixes/min    99.2%                          │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ RISK ASSESSMENT                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ Phase 1: LOW    ✓ Mechanical find-replace, easy rollback                  │
│ Phase 2: LOW    ✓ Simple constant addition, no logic changes              │
│ Phase 3: MEDIUM ⚠ API contract changes, test carefully                    │
│ Phase 4: VARIES ⚠ Unknown issues, may uncover real bugs                   │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ QUICK START COMMANDS                                                        │
└─────────────────────────────────────────────────────────────────────────────┘

cd backend

# Phase 1: Find-Replace in VSCode (Ctrl+Shift+H)
Find:    user: \{ connect: \{ id: ([^}]+) \} \}
Replace: userId: $1
Files:   tests/**/*.test.mjs
         (Review 10 groom-related files)

npm test -- groom  # Verify Phase 1

# Phase 2: Add balanced personality
# Edit: services/groomPersonalityTraits.mjs
# Add: balanced: { name: "Balanced", ... }

npm test -- dynamicCompatibility  # Verify Phase 2

# Phase 3: Update test expectations
# Edit: userProgressAPI.integration.test.mjs, userRoutes.test.mjs
# Change: .toEqual() → .toMatchObject()

npm test -- userProgress  # Verify Phase 3

# Phase 4: Individual fixes (per file)
npm test -- <filename> --verbose  # Debug each failure

npm test  # Final validation

┌─────────────────────────────────────────────────────────────────────────────┐
│ SUCCESS CRITERIA                                                            │
├─────────────────────────────────────────────────────────────────────────────┤
│ ✓ Pass Rate: 99.2% (3,510/3,540)                                          │
│ ✓ Failed Suites: <5 (from 23)                                             │
│ ✓ No Prisma syntax errors                                                  │
│ ✓ All groom-related tests passing                                         │
│ ✓ Git push hook passes                                                     │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ DOCUMENTATION                                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│ Full Report:     TEST_FAILURE_CATEGORIZATION_REPORT.md                     │
│ Execution Plan:  TEST_FIX_EXECUTION_PLAN.md                                │
│ This Roadmap:    TEST_FIX_ROADMAP.txt                                      │
└─────────────────────────────────────────────────────────────────────────────┘

Generated: 2026-01-28 by Claude Code (Error Detective)
